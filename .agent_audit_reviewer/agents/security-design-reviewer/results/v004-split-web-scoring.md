# 採点結果: v004-variant-split-web

## スコアサマリ
Mean=10.2, SD=0.4
Run1=10.5(検出10.5+bonus0-penalty0), Run2=10.5(検出10.5+bonus0-penalty0), Run3=9.5(検出9.5+bonus0-penalty0)

## 検出マトリクス
| ID | カテゴリ | 深刻度 | Run1 | Run2 | Run3 |
|----|---------|--------|------|------|------|
| P01 | 認証・認可設計 | 重大 | ○ | ○ | ○ |
| P02 | 入力検証・攻撃防御 | 中 | ○ | ○ | ○ |
| P03 | 入力検証・攻撃防御 | 中 | ○ | ○ | ○ |
| P04 | 入力検証・攻撃防御 | 中 | ○ | ○ | ○ |
| P05 | 脅威モデリング(Information Disclosure) | 中 | ○ | ○ | ○ |
| P06 | データ保護 | 重大 | ○ | ○ | ○ |
| P07 | データ保護 | 中 | △ | △ | △ |
| P08 | データ保護 | 軽微 | × | × | × |
| P09 | データ保護 | 重大 | ○ | ○ | ○ |
| P10 | 脅威モデリング(Repudiation)、インフラ・依存関係・監査 | 中 | ○ | ○ | ○ |
| P11 | 認証・認可設計 | 重大 | ○ | ○ | ○ |
| P12 | インフラ・依存関係・監査 | 中 | ○ | ○ | ○ |
| P13 | インフラ・依存関係・監査 | 軽微 | ○ | ○ | ○ |
| P14 | 脅威モデリング(Tampering) | 軽微 | × | × | × |
| P15 | 入力検証・攻撃防御 | 軽微 | ○ | ○ | × |

## ボーナス・ペナルティ詳細

### Run1
- Bonus: なし
- Penalty: なし

### Run2
- Bonus: なし
- Penalty: なし

### Run3
- Bonus: なし
- Penalty: なし

## エラー分析（抽象的）

### Missed/Partial by Category
| Category | Problems | ○ | △ | × | Stability | Prompt Gap |
|----------|----------|---|---|---|-----------|------------|
| データ保護 | 3 | 2 | 1 | 0 | 高（一貫して○△） | P07で保持期間・分類方針の具体的欠如を指摘できていない。プロンプトの「Data Protection」セクションで「PII分類・保持期間・削除方針の設計が存在するか」の分析深度が不足。データの暗号化（P09）は検出するが、データライフサイクル管理の欠如は部分検出にとどまる |
| データ保護 | 1 | 0 | 0 | 1 | 高（一貫して×） | P08で内部通信暗号化の欠如を全く指摘していない。プロンプトの「Data Protection」セクションで「機密データの保存・転送時の保護方式」と記載しているが、実際の分析対象が「保存時暗号化」と「外部通信（クライアント-API Gateway間）」に偏っており、内部通信（API Gateway-バックエンド、バックエンド-DB）の検証が抜け落ちている |
| 脅威モデリング(Tampering) | 1 | 0 | 0 | 1 | 高（一貫して×） | P14でデータ完全性検証（改ざん検知メカニズム）を全く指摘していない。プロンプトのSTRIDE分析セクションで「T=データ完全性検証」と一言触れるのみで、具体的な検証項目（ハッシュ、デジタル署名、監査証跡）の分析指示がない |
| 入力検証・攻撃防御 | 1 | 0 | 0 | 1 | 低（Run1,2は○、Run3は×） | P15でXSS対策・ファイルアップロード検証の欠如を指摘できていない（Run3のみ未検出）。プロンプトの「Input Validation & Attack Defense」セクションで「XSS対策（出力エスケーピング）」「ファイルアップロード等のリスク領域への制限」と記載しているが、Run3では検出ロジックが不安定。項目が軽微レベルのため、他の重大問題を優先した結果、出力から漏れた可能性 |

### Improvement Directions

**データ保護カテゴリの深化**:
- 現状: 暗号化（at-rest/in-transit）の検出に偏っている
- 改善方向: データライフサイクル管理（分類方針・保持期間・削除ポリシー）と内部通信暗号化（マイクロサービス間、DB接続）の分析を明示的に強化する方向
- 具体的アプローチ: 「Data Protection」セクションを「暗号化」「データライフサイクル」「通信経路」の3サブセクションに分割し、各サブセクションで確認すべき設計要素を列挙する

**脅威モデリング（Tampering）の検出強化**:
- 現状: STRIDE-T（改ざん）の分析がほぼ機能していない
- 改善方向: データ完全性検証メカニズム（ハッシュ、デジタル署名、バージョン管理、監査証跡）の具体的な分析指示を追加する方向
- 具体的アプローチ: STRIDEセクションで「T=データ完全性検証」だけでなく、「重要データ（医療記録、財務データ等）に対する改ざん検知設計（ハッシュ値記録、デジタル署名、イベントソーシング等）が存在するか」と具体化

**入力検証カテゴリの安定性向上**:
- 現状: XSS対策・ファイルアップロード検証の検出が不安定（Run3で漏れ）
- 改善方向: 軽微レベルの問題でも一貫して検出するよう、分析プロセスの安定性を向上させる方向
- 具体的アプローチ: 「Input Validation & Attack Defense」セクションで「出力エスケーピング（XSS対策）」「ファイルアップロード検証（拡張子・MIMEタイプ・サイズ制限）」を独立した確認項目として明示し、重要度順ではなく網羅性重視で分析する指示を追加

### Strengths to Preserve

**認証・認可設計カテゴリの完全検出**:
- P01（JWT localStorage保存のXSS脆弱性）とP11（APIエンドポイントの認可チェック詳細不明）を全Run で○判定
- プロンプトの「Authentication & Authorization Design」セクションで「認証フローが設計されているか、認可モデル（RBAC/ABAC等）の選定が適切か、APIアクセス制御とセッション管理の設計にセキュリティ上の問題がないか」という3階層の確認項目が有効
- セッション管理の具体的リスク（JWT保存方法、トークン失効メカニズム）とリソースレベル認可（水平権限昇格防止）の両方をカバーできている

**入力検証・攻撃防御カテゴリの高検出率**:
- P02（CSRF対策欠如）、P03（CORS設定未定義）、P04（認証エンドポイントレート制限欠如）を全Runで○判定
- プロンプトの「Input Validation & Attack Defense」セクションで「CSRF対策、CORS/オリジン制御、レート制限」を明示的に列挙しているため、設計書に記載がない場合の欠如検出が確実に機能
- 特にP04は「API Gatewayの全体レート制限はあるが認証エンドポイント専用の制限がない」という微妙なケースでも検出できている

**脅威モデリング（Information Disclosure, Repudiation）の安定検出**:
- P05（エラーメッセージの情報露出）とP10（セキュリティ監査ログ欠如）を全Runで○判定
- プロンプトのSTRIDEセクションで「I=データ分類・暗号化」「R=監査ログ」と明示的に対応付けられているため、該当する設計要素の欠如を一貫して検出
- エラーハンドリング設計書に「詳細なスタックトレースを含める」という明示的な問題記述があるため、検出が容易

**データ保護カテゴリの暗号化関連検出**:
- P06（ログへの機密データ出力）とP09（保存時データ暗号化欠如）を全Runで○判定
- プロンプトの「Data Protection」セクションで「機密データの保存・転送時の保護方式（暗号化アルゴリズム、鍵管理）が適切か」という直接的な確認項目が効果的
- 特にP06はログ方針に「すべてのリクエスト・レスポンスを出力」という設計があり、その中にPII/PHIが含まれるリスクを推論できている

**インフラ・依存関係・監査カテゴリの全問検出**:
- P10（セキュリティ監査ログ欠如）、P12（シークレット管理方針不足）、P13（依存ライブラリ脆弱性管理欠如）を全Runで○判定
- プロンプトの「Infrastructure, Dependencies & Audit」セクションで「シークレット管理（環境変数・Vault等）の設計が適切か」「サードパーティライブラリの脆弱性管理方針が存在するか」「セキュリティ監査ログの設計が存在するか」という3要素を明確に列挙
- 設計書にParameter Storeの記載はあるがシークレット管理の詳細が不足している場合（P12）、ライブラリバージョンは記載されているが脆弱性管理が未記載の場合（P13）の欠如を正確に検出
