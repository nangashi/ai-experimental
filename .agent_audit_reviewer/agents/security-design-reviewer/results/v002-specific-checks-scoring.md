# 採点結果: v002-variant-specific-checks

## スコアサマリ
Mean=10.3, SD=0.5
Run1=10.0(検出10.0+bonus1-penalty1), Run2=10.5(検出10.0+bonus2-penalty1), Run3=10.5(検出10.0+bonus2-penalty1)

## 検出マトリクス
| ID | カテゴリ | 深刻度 | Run1 | Run2 | Run3 |
|----|---------|--------|------|------|------|
| P01 | 認証・認可設計 | 重大 | ○ | ○ | ○ |
| P02 | 入力検証・攻撃防御 | 中 | × | × | × |
| P03 | 入力検証・攻撃防御 | 中 | × | × | × |
| P04 | 入力検証・攻撃防御 | 中 | ○ | ○ | ○ |
| P05 | 脅威モデリング（Information Disclosure） | 中 | ○ | ○ | ○ |
| P06 | データ保護 | 重大 | ○ | ○ | ○ |
| P07 | データ保護 | 中 | ○ | ○ | ○ |
| P08 | データ保護 | 軽微 | × | × | × |
| P09 | データ保護 | 重大 | ○ | ○ | ○ |
| P10 | 脅威モデリング（Repudiation）、インフラ・依存関係・監査 | 中 | △ | △ | △ |
| P11 | 認証・認可設計 | 重大 | ○ | ○ | ○ |
| P12 | インフラ・依存関係・監査 | 中 | ○ | ○ | ○ |
| P13 | インフラ・依存関係・監査 | 軽微 | ○ | ○ | ○ |
| P14 | 脅威モデリング（Tampering） | 軽微 | ○ | ○ | ○ |
| P15 | 入力検証・攻撃防御 | 軽微 | △ | △ | △ |

## ボーナス・ペナルティ詳細

### Run1
- Bonus (1件):
  - M1: トークン失効メカニズムの欠如を指摘（ログアウト時のトークン無効化、パスワード変更時の既存トークン無効化）
- Penalty (1件):
  - MI1: エラーメッセージでの詳細スタックトレース出力の削除 → P05で既にカバー（重複）

### Run2
- Bonus (2件):
  - M1: トークン失効メカニズムの欠如を指摘
  - MI2: パスワードポリシーの明文化 → セキュリティスコープ内（強度要件は認証設計の一部）
- Penalty (1件):
  - MI1: エラーメッセージでの詳細スタックトレース出力の削除 → P05で既にカバー（重複）

### Run3
- Bonus (2件):
  - B06: トークン失効メカニズムの欠如を指摘（M1）
  - MI2: パスワードポリシーの明文化（設計レベルの強度要件）
- Penalty (1件):
  - MI1: エラーメッセージでの詳細スタックトレース出力の削除 → P05で既にカバー（重複）

## エラー分析（抽象的）

### Missed/Partial by Category
| Category | Problems | ○ | △ | × | Stability | Prompt Gap |
|----------|----------|---|---|---|-----------|------------|
| 入力検証・攻撃防御 | 5 | 1 | 1 | 3 | 高 | CSRF対策・CORS設定・内部通信暗号化の検出指示が欠如。現在のプロンプトはSQLインジェクション・XSSに焦点があるが、クロスオリジン攻撃への言及がない |
| データ保護 | 4 | 3 | 0 | 1 | 高 | 内部通信暗号化（P08）が未検出。プロンプトは保存時暗号化と転送時暗号化（外部）に言及しているが、バックエンド-DB間の内部通信暗号化の明示がない |
| 脅威モデリング（Repudiation） | 1 | 0 | 1 | 0 | 高 | セキュリティ監査ログ（P10）が部分検出。プロンプトは「ロギング設計」に言及しているが、「セキュリティイベント固有のログ（認証失敗、権限変更、機密データアクセス）」の具体的な列挙がない |
| 入力検証・攻撃防御（P15） | 1 | 0 | 1 | 0 | 高 | 入力検証方針（P15）が部分検出。SQLインジェクションには言及するが、XSS対策（出力エスケーピング）・ファイルアップロード検証の具体的な欠如を指摘していない |

### Improvement Directions
- **入力検証・攻撃防御カテゴリ**: プロンプトに以下を追加する方向
  - CSRF対策の具体的なチェック項目（CSRFトークン、SameSite Cookie属性の設計有無）
  - CORS設定の明示（許可オリジンのホワイトリスト化、ワイルドカード禁止）
  - XSS対策の出力エスケーピング設計の確認
  - ファイルアップロード検証（拡張子・MIMEタイプ・サイズ制限）の設計確認

- **データ保護カテゴリ**: プロンプトに以下を追加する方向
  - 内部通信暗号化の確認（バックエンド-DB間、マイクロサービス間のTLS設定）
  - 暗号化スコープの3層チェック（外部通信・内部通信・保存時）

- **脅威モデリング（Repudiation）**: プロンプトに以下を追加する方向
  - セキュリティ監査ログの具体的なイベントリスト（認証失敗、権限変更、機密データアクセス、管理者操作）
  - 一般的なアプリケーションログとセキュリティ監査ログの区別を明示

### Strengths to Preserve
- **認証・認可設計カテゴリ（P01, P11）**: プロンプトのJWT保存方式チェック、エンドポイント単位の認可チェック確認が有効。3回とも完全検出を達成
- **データ保護カテゴリ（P06, P07, P09）**: プロンプトの機密データログ出力チェック、データ分類・保持期間方針、保存時暗号化の確認が有効
- **インフラ・依存関係・監査カテゴリ（P12, P13）**: シークレット管理、依存ライブラリ脆弱性管理の確認が有効
- **脅威モデリング（Tampering）（P14）**: データ整合性検証（改ざん検知メカニズム）の確認が有効
