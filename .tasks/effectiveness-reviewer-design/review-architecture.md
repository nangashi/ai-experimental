# アーキテクチャ整合性レビュー

## 重大な問題（設計を変更すべき）

なし

## 改善提案（設計を強化できる）

- [出力フォーマット不整合]: [draft-template.md:63-91] テンプレートの出力フォーマットが他4レビューアーと構造が異なる。他レビューアーは「### {観点}レビュー結果」→「#### 重大な問題/改善提案/良い点」の3段構造だが、このテンプレートは「### 有効性レビュー結果」→「#### 宣言された目的」→「#### 重大な問題/改善提案」→「#### 目的達成度サマリ（テーブル）」→「#### 良い点」の5段構造。Phase 3のコンフリクト検出で「重大な問題」「改善提案」セクションをGrep検索する際、テーブルセクションが挿入されていると、指摘抽出の正規表現が複雑化する。他レビューアーと同じ3段構造にし、「目的達成度サマリ」テーブルを「#### 良い点」の後に移動することを推奨。[impact: medium] [effort: low]

- [SKILL.md行数への影響]: [draft-implementation-plan.md:11-26] Phase 2の変更で並列起動部分に1レビューアー分のテンプレート行（テーブル1行+プロンプト8行）が追加される。Phase 3の想定コンフリクトパターンに1行追加される。Phase 7の完了サマリで「レビュー観点: 4」→「5」の変更。合計約10-12行の増加が見込まれる（現在299行→310行程度）。250行基準（quality-criteria.md 2.効率性）を超えているため、SKILL.mdの行数削減の機会を検討すべき。具体的には：Phase 2の各レビューアープロンプトをテーブル外のセクションで1回だけ定義し、テーブルではテンプレート名のみ記載する方式に統一すれば約20行削減可能。[impact: low] [effort: medium]

- [コンフリクトパターンの網羅性]: [draft-implementation-plan.md:22-23] 実装計画に記載されたコンフリクトパターンは「有効性↔効率性」のみ。以下のパターンも追加すべき：(1) 有効性「判定ロジック変更」↔ 安定性「判定フォーマット維持」→ 判定ロジックが目的達成に不可欠なら有効性優先、出力形式の維持が目的達成に影響しないなら安定性優先。(2) 有効性「フェーズ追加」↔ アーキテクチャ「テンプレート外部化が必要」→ 両立可能（フェーズ追加時にテンプレート外部化も実施）。(3) 有効性「エッジケース対応追加」↔ UX「確認ポイント追加」→ エッジケースが致命的エラーを引き起こすなら有効性優先、ユーザー判断が必要なら両方採用。[impact: medium] [effort: low]

- [quality-criteria.md の粒度不整合]: [draft-implementation-plan.md:8] 追加予定の「5. 有効性・目的達成度」セクションの項目（A〜E）は、テンプレートの評価項目と1:1対応しているが、既存セクション（1〜4）と比較すると粒度が細かい。既存セクションは3-6項目のチェックリスト形式なのに対し、提案セクションは5項目の評価項目（各項目が複数サブ項目を持つ）。既存セクションの粒度に合わせて箇条書き形式（例：「目的−手段の整合性が確保されていること」「フェーズ間のデータフローが妥当であること」「評価・判定ロジックが目的と整合していること」「エッジケースで目的を達成できること」「採用アプローチが代替と比較して妥当であること」）に簡略化することを推奨。詳細な評価手順はテンプレート側で定義する。[impact: low] [effort: low]

- [Phase 3の最低基準変更の妥当性]: [draft-implementation-plan.md:19-20] 「最低基準: 3件 → 4件（5件中4件成功で続行）」の変更は、レビュー観点が増えた場合の品質担保としては妥当だが、4件中3件成功が許容されていた理由（観点の独立性、1観点失敗でも他観点で補完可能）が5レビューアー体制でも同様に成立するかを検討すべき。有効性レビューアーが失敗した場合、他4観点（安定性・効率性・UX・アーキテクチャ）では目的達成度を評価できないため、有効性レビューアーの失敗は致命的。逆に安定性レビューアーが失敗しても、有効性レビューアーが目的達成を評価できるため補完可能。最低基準を「5件中4件 かつ 有効性レビューアーは必須」に変更することを推奨。[impact: medium] [effort: medium]

- [有効性レビューアーの実行順序]: [draft-implementation-plan.md:14-17] Phase 2で5件を並列起動する設計だが、有効性レビューアーは「宣言された目的」を抽出する役割を持つ。この目的情報は他レビューアー（特にアーキテクチャレビューアーの「C. ナレッジ蓄積」項目や効率性レビューアーの「削除可能なステップ」判定）でも参照される可能性がある。現状では各レビューアーがSKILL.mdを独立に読み込むため問題ないが、Phase 3で有効性レビューアーが抽出した「宣言された目的」を他レビューアーの評価に反映させる仕組みがない。コンフリクト解決時に「目的達成に不可欠か」を判定する際、有効性レビューアーの「宣言された目的」セクションを参照することを明示的に記載すべき。[impact: low] [effort: low]

## 良い点

- [テンプレート構造の一貫性]: テンプレートの基本構造（パス変数、手順、評価項目、出力、サマリ返答）が既存4レビューアーと完全に一致している。各評価項目（A〜E）が独立した検出ロジックを持ち、他レビューアーの評価項目と重複しない。

- [SKILL.md Phase 2への組込み設計]: 実装計画で示されたPhase 2の変更（テーブル1行追加、並列起動を5件に変更）は既存ワークフローと完全に整合している。レビューアーテンプレートのプロンプトパターン（Read template + パス変数）が既存4件と同一であるため、Phase 2のサブエージェント起動ロジックを変更する必要がない。

- [Phase 3のコンフリクト解決への配慮]: 実装計画で有効性↔効率性のコンフリクトパターンと判定基準を明示している。有効性レビューアーが他観点とトレードオフを生む場合（フェーズ追加、判定ロジック変更等）を想定し、Phase 3の判定基準ヒントに組み込む設計は適切。
