# エージェント種別タクソノミ

agent_create が対象とするエージェントの種別分類。問題生成プロンプトが種別に応じた適切なテスト入力を生成するための基盤。

---

## 1. 種別一覧

### Type-A: ドキュメントレビューア

特定の観点から入力文書の問題を検出し、重要度別に整理して報告するエージェント。

| 属性 | 定義 |
|------|------|
| **入力型** | 設計書、仕様書、アーキテクチャ文書（100-300行のMarkdown） |
| **出力型** | 問題指摘リスト（重要度: Critical/Significant/Moderate/Minor） |
| **核心能力** | 問題検出の網羅性、重要度判定の正確性、改善提案の具体性 |
| **テスト入力の要件** | 既知の問題を埋め込んだ設計書。問題の重要度・カテゴリが分布。reviewer_optimize 方式（answer-key + 問題埋め込み）が最適 |
| **該当エージェント** | security-design-reviewer, performance-design-reviewer, reliability-design-reviewer, consistency-design-reviewer, structural-quality-design-reviewer |

### Type-B: コードレビューア

ソースコードの問題を検出し報告するエージェント。Type-A と構造は類似するが入力がコード。

| 属性 | 定義 |
|------|------|
| **入力型** | ソースコード（100-200行、1-3ファイル） |
| **出力型** | 問題指摘リスト（重要度別） |
| **核心能力** | コード上の欠陥検出、パターン違反検出、改善提案の実装可能性 |
| **テスト入力の要件** | 既知の欠陥を埋め込んだコード。言語・フレームワーク固有の問題を含む |
| **該当エージェント** | (code perspectives: security, performance, consistency, maintainability, best-practices) |

### Type-C: メタ評価エージェント（批評者）

エージェント定義や観点定義そのものの品質を評価するエージェント。入力がプロンプト/定義であり、Type-A/B とは根本的に異なる。

| 属性 | 定義 |
|------|------|
| **入力型** | 観点定義ファイル、エージェント定義ファイル（Markdown） |
| **出力型** | 批評レポート（問題点、改善提案、良い点の確認） |
| **核心能力** | 定義の明確性評価、スコープ重複検出、実行可能性判断、汎用性評価 |
| **テスト入力の要件** | 品質の異なる観点/エージェント定義。良い定義・曖昧な定義・スコープ重複定義・過度に狭い定義など、意図的に問題を含むもの |
| **該当エージェント** | critic-effectiveness, critic-generality, critic-clarity, critic-completeness |

**重要**: このタイプのエージェントに設計書やコードをテスト入力として与えてはならない（入力型不整合で評価が無効化される）。

### Type-D: 計画・設計エージェント

要件やコードベース情報を基に、実装計画や設計を生成するエージェント。

| 属性 | 定義 |
|------|------|
| **入力型** | 要件定義、コードベース分析結果、技術選定情報 |
| **出力型** | 実装計画書、設計書、ADR（アーキテクチャ決定記録） |
| **核心能力** | 要件の網羅性、設計の実現可能性、具体性（関数名・型・パラメータ）、テスト戦略 |
| **テスト入力の要件** | 異なる複雑度の要件セット。明確な要件・曖昧な要件・矛盾する要件など |
| **該当エージェント** | plan-architect |

### Type-E: 実装エージェント

設計や要件を受けてコードや設定ファイルを生成するエージェント。

| 属性 | 定義 |
|------|------|
| **入力型** | 設計書、実装ステップリスト、既存コードベース情報 |
| **出力型** | ソースコード、設定ファイル、テストコード |
| **核心能力** | コードの正確性、設計への準拠、テストの網羅性、エラーハンドリング |
| **テスト入力の要件** | 実装すべき機能の設計と既存コード。正常系・異常系・エッジケースを含む仕様 |
| **該当エージェント** | (issue_implement パイプライン内の実装フェーズ) |

### Type-F: 変換・処理エージェント

特定の入力フォーマットを別のフォーマットに変換する、または入力に対して定型処理を行うエージェント。

| 属性 | 定義 |
|------|------|
| **入力型** | フォーマットA（エージェントごとに固有） |
| **出力型** | フォーマットB（エージェントごとに固有） |
| **核心能力** | 変換の正確性、情報の保全性、フォーマット準拠 |
| **テスト入力の要件** | 正常な入力・不正な入力・エッジケース入力の組み合わせ |
| **該当エージェント** | (汎用カテゴリ、今後の拡張用) |

---

## 2. 種別判定フロー

問題生成プロンプトがエージェント定義から種別を判定する際のフロー:

```
1. エージェント定義の「入力」と「出力」を特定する

2. 入力型を分類する:
   - 設計書/仕様書/アーキテクチャ文書 → ドキュメント入力
   - ソースコード → コード入力
   - エージェント定義/観点定義/プロンプト → メタ入力
   - 要件/Issue/ユーザー要求 → 要件入力
   - その他の特定フォーマット → 固有入力

3. 出力型を分類する:
   - 問題指摘リスト/評価レポート → 評価出力
   - 設計書/計画書/ADR → 設計出力
   - ソースコード/設定ファイル → コード出力
   - 変換結果 → 変換出力

4. 入力型×出力型の組み合わせで種別を決定する:
   - ドキュメント入力 × 評価出力 → Type-A (ドキュメントレビューア)
   - コード入力 × 評価出力 → Type-B (コードレビューア)
   - メタ入力 × 評価出力 → Type-C (メタ評価エージェント)
   - 要件入力 × 設計出力 → Type-D (計画・設計エージェント)
   - 設計出力/要件入力 × コード出力 → Type-E (実装エージェント)
   - 固有入力 × 変換出力 → Type-F (変換・処理エージェント)
   - 上記に該当しない → Type-F (汎用) + ユーザー確認を要求
```

---

## 3. 種別ごとのテスト入力生成戦略

| 種別 | テスト入力の生成方法 | 評価の仕組み |
|------|---------------------|-------------|
| **Type-A** | 既知の問題を埋め込んだ設計書を生成。問題バンク（埋め込む問題リスト）を先に設計し、answer-key を同時生成 | answer-key の ○/△/× 判定 |
| **Type-B** | 既知の欠陥を埋め込んだコードを生成。言語・フレームワーク固有の問題パターンを使用 | answer-key の ○/△/× 判定 |
| **Type-C** | 品質の異なる定義ファイルを生成。意図的な欠陥（曖昧性、スコープ重複、非実行可能性等）を埋め込む | ルーブリック (Full/Partial/Miss) + Expected Key Behaviors |
| **Type-D** | 異なる複雑度・曖昧度の要件セットを生成。完全な要件、曖昧な要件、矛盾する要件を混在 | ルーブリック (Full/Partial/Miss) — 出力の網羅性・具体性・実現可能性を評価 |
| **Type-E** | 実装すべき機能の設計＋既存コードを生成。正常系・異常系・エッジケースを含む | 生成コードの正確性（テスト実行可能なら自動テスト、不可なら手動ルーブリック） |
| **Type-F** | 入力フォーマットの正常例・異常例・エッジケースを生成 | 変換結果の正確性をルーブリックで評価 |
