# Problem Generator — v001-variant-answer-key

baseline に対して「○/△/× 式の答え合わせキー」を追加したバリアント。
reviewer_optimize の answer-key パターンを scenario モードにも適用し、採点の曖昧性を削減する。

---

## あなたのタスク

与えられたエージェント定義を分析し、テストシナリオセット、ルーブリック、および各シナリオの答え合わせキーを生成してください。答え合わせキーはテスト入力に含まれる問題や要点ごとに、検出/達成の具体的な判定基準を定義します。

## 入力

- `{agent_definition_path}`: 評価対象エージェントの定義ファイルパス
- `{knowledge_path}`: 知見ファイルパス（テスト履歴確認用、存在する場合）
- `{test_set_save_path}`: テストシナリオセットの保存先パス
- `{rubric_save_path}`: ルーブリックの保存先パス
- `{agent_name}`: エージェント名

## 手順

### Step 1: エージェント定義の分析

Read で `{agent_definition_path}` を読み込み、以下を特定する:
- 主要タスク、想定入力、期待出力、主要な能力カテゴリ（3-5個）

`{knowledge_path}` が存在する場合は Read で読み込み、テスト履歴を確認。

### Step 2: テストシナリオの生成

5-8個のテストシナリオを生成する。

分布: 易2 / 中3 / 難1-3。全カテゴリカバー。
入力: 20-100行、自然で現実的、多様なドメイン。

### Step 3: 答え合わせキーの設計

各シナリオについて、入力に含まれる「エージェントが検出/処理すべきポイント」を列挙し、それぞれに3段階の判定基準を定義する。

各シナリオの構造:

```markdown
### T01: {Scenario Title}

**Difficulty**: Easy / Medium / Hard
**Category**: {テストする能力カテゴリ}

#### Input
{入力コンテンツ}

#### Answer Key

このシナリオでエージェントが検出/処理すべきポイント:

**AK-T01-01: {ポイント名}**
- Weight: 1.0 (核心) / 0.5 (補助)
- ○ (Full, 2pt): {具体的な達成条件。何を言及し、どのように分析/処理していれば Full か}
- △ (Partial, 1pt): {具体的な部分達成条件。関連内容に触れているが何が不足しているか}
- × (Miss, 0pt): {未達成条件。言及なし、または誤った分析/処理}

**AK-T01-02: {ポイント名}**
- Weight: 1.0
- ○: {条件}
- △: {条件}
- × (Miss, 0pt): {条件}

**Bonus Opportunities** (各 +0.5pt):
- {エージェントの能力スコープ内で、Answer Key に含まれないが指摘/処理すれば加点すべきポイント}

**Penalty Conditions** (各 -0.5pt):
- {エージェントのスコープ外の指摘、または事実に反する分析}

#### Expected Key Behaviors
- {良い出力の特徴}

#### Anti-patterns
- {悪い出力の特徴}
```

**答え合わせキーの設計原則**:

1. **○ と △ の境界は具体的に**: △ は「○の条件を部分的に満たす」ではなく、「{具体的に何が}不足している」と明記する
2. **各ポイント 3-6 個/シナリオ**: 少なすぎると識別力不足、多すぎると採点コスト増
3. **Weight の配分**: 核心的ポイント=1.0、補助的ポイント=0.5
4. **Bonus は控えめに**: 各シナリオ 0-2 個。スコープ内の追加発見のみ加点
5. **Penalty は明確に**: スコープ外の指摘、事実誤認のみ減点。「疑わしい場合は減点しない」

### Step 4: スコア計算方法の記載

ルーブリックファイルの冒頭に以下のスコア計算方法を記載する:

```
## スコア計算

scenario_score = (Σ(rating × weight) + bonus_total - penalty_total) / max_possible × 10

- rating: ○=2, △=1, ×=0
- max_possible: Σ(2 × weight) for all answer key items
- bonus_total: 0.5 × bonus_count
- penalty_total: 0.5 × penalty_count
```

### Step 5: 品質チェック

- [ ] 全テスト入力がエージェントの想定入力型と一致するか
- [ ] 各 Answer Key ポイントの ○/△/× 条件が具体的で曖昧さがないか
- [ ] 各 △ の条件が「○から何が不足」を明確に記述しているか
- [ ] 各シナリオに3-6個のポイントがあるか
- [ ] Bonus がスコープ内に限定されているか
- [ ] 全能力カテゴリをカバーしているか

### Step 6: 保存

テストシナリオセットを `{test_set_save_path}` に、ルーブリック（Answer Key 含む）を `{rubric_save_path}` に Write で保存する。

### Step 7: サマリ返答

```
## テストシナリオセット
- エージェント: {agent_name}
- シナリオ数: {N}
- 能力カテゴリ: {カテゴリリスト}
- Answer Key ポイント合計: {N}

| ID | タイトル | 難易度 | カテゴリ | AK数 | Bonus |
|----|---------|--------|---------|------|-------|
| T01 | {title} | {difficulty} | {category} | {N} | {N} |
...
```
