# Problem Generator — v001-variant-problem-bank

baseline に対して「問題バンク先行設計 → テスト入力への埋め込み」パターンを採用したバリアント。
reviewer_optimize の test-document 方式を一般化し、全エージェント種別に適用する。

---

## あなたのタスク

与えられたエージェント定義を分析し、まずエージェントが検出/処理すべき問題のバンクを設計した上で、それらの問題を自然に埋め込んだテストシナリオセットとルーブリックを生成してください。

## 入力

- `{agent_definition_path}`: 評価対象エージェントの定義ファイルパス
- `{knowledge_path}`: 知見ファイルパス（テスト履歴確認用、存在する場合）
- `{test_set_save_path}`: テストシナリオセットの保存先パス
- `{rubric_save_path}`: ルーブリックの保存先パス
- `{agent_name}`: エージェント名

## 手順

### Step 1: エージェント定義の分析

Read で `{agent_definition_path}` を読み込み、以下を特定する:
- 主要タスク、想定入力、期待出力
- 主要な能力カテゴリ（3-5個）
- エージェントが検出/処理すべき問題・課題のパターン

`{knowledge_path}` が存在する場合は Read で読み込み、テスト履歴を確認。

### Step 2: 問題バンクの設計

エージェントの能力カテゴリに基づき、テストで検出/処理されるべき問題のバンクを先に設計する。

**問題バンクの構造**:

```markdown
## Problem Bank

### PB-01: {問題名}
- **カテゴリ**: {能力カテゴリ}
- **重要度**: High / Medium / Low
- **期待される検出/処理**: {エージェントがこの問題に対してどう反応すべきか}
- **検出基準**:
  - ○ (完全検出): {具体的条件}
  - △ (部分検出): {具体的条件}
  - × (未検出): {具体的条件}

### PB-02: ...
```

**問題バンクの要件**:
- 問題数: 15-25個（テスト全体で使用するプール）
- カテゴリ分布: 各能力カテゴリから最低3個
- 重要度分布: High 30% / Medium 40% / Low 30%
- 難易度の幅: 表面的なもの（すぐ気づく）から深い分析が必要なもの（関係性の理解が必要）まで

### Step 3: シナリオへの問題割り当て

問題バンクから各シナリオに 3-5 個の問題を割り当てる:

| シナリオ | 難易度 | 問題数 | 重要度分布 |
|---------|--------|--------|-----------|
| 易 (2個) | Easy | 3個 | High 1 + Medium 2 |
| 中 (3個) | Medium | 4個 | High 1 + Medium 2 + Low 1 |
| 難 (1-3個) | Hard | 5個 | High 1 + Medium 2 + Low 2 (微妙な問題含む) |

### Step 4: テストシナリオの生成

各シナリオについて、割り当てられた問題を自然に埋め込んだ入力コンテンツを生成する。

**入力コンテンツの要件**:
- 分量: 30-100行
- 内容: エージェントが実際に受け取る入力と同じ種類のもの
- 問題の埋め込み方: 意図的なマーカー（TODO、FIXME等）を使わない。自然な内容の中に問題が存在する状態にする
- ドメイン: シナリオごとに異なるドメインを使用

各シナリオの構造:

```markdown
### T01: {Scenario Title}

**Difficulty**: Easy / Medium / Hard
**Category**: {主要な能力カテゴリ}
**Embedded Problems**: PB-{XX}, PB-{XX}, PB-{XX}

#### Input
{問題が自然に埋め込まれた入力コンテンツ}

#### Quality Rubric

| Criterion ID | Criterion | Full (2) | Partial (1) | Miss (0) | Weight |
|-------------|-----------|----------|-------------|----------|--------|
| T01-C1 | PB-{XX} 検出 | {○の条件} | {△の条件} | {×の条件} | 1.0 |

#### Expected Key Behaviors
- {問題バンクの期待される検出/処理から導出}

#### Anti-patterns
- {問題を見落とすパターン}
- {誤った問題を指摘するパターン}
```

**ルーブリック基準の対応**: 各問題バンクの項目が1つのルーブリック基準に対応。検出基準は問題バンクの ○/△/× を Full/Partial/Miss にマッピング。

### Step 5: 品質チェック

- [ ] 全シナリオの入力がエージェントの想定入力型と一致するか
- [ ] 問題バンクの全カテゴリがシナリオでカバーされているか
- [ ] 問題の埋め込みが自然か（明示的マーカーがないか）
- [ ] 各シナリオの ○/△/× 条件が具体的で曖昧さがないか
- [ ] シナリオ間でドメインが多様か

### Step 6: 保存

テストシナリオセットを `{test_set_save_path}` に、ルーブリック（問題バンク含む）を `{rubric_save_path}` に Write で保存する。

### Step 7: サマリ返答

```
## テストシナリオセット
- エージェント: {agent_name}
- 問題バンク: {N}問題
- シナリオ数: {N}
- 能力カテゴリ: {カテゴリリスト}

| ID | タイトル | 難易度 | 埋め込み問題 | カテゴリ |
|----|---------|--------|-------------|---------|
| T01 | {title} | {difficulty} | PB-{XX},{XX},{XX} | {category} |
...
```
