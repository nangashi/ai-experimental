# ADR-0001: Java Version Selection for New Project

## ステータス

Proposed

## 日付

2026-02-16

## コンテキスト

新規開発プロジェクトにおいて、使用するJavaバージョンを選定する必要が生じた。

この決定はプロジェクトの開発期間および運用期間を通じて、長期的な保守性、エコシステムとの互換性、チームの生産性、パフォーマンス、将来の技術選択の柔軟性に影響を与える。

### スコープ
- **対象**: 新規開発プロジェクトで使用するJavaのバージョン（LTS vs 非LTS、具体的なバージョン番号の選定）
- **対象外**: 既存プロジェクトのマイグレーション、JVM言語の選択（Kotlin, Scala等）、ビルドツールやフレームワークの選定、JDKディストリビューションの選択

### 可逆性
medium - Javaは後方互換性が比較的高く段階的な移行が可能だが、バージョン固有のAPI利用やライブラリ互換性の影響があり、プロジェクト規模が大きくなるほど変更コストが増加する。

## 前提条件

### 確実（Certainty）

- **C1**: プロジェクトは新規開発である
  - 根拠: 決定ステートメントで明示
- **C3**: Spring Boot 3.xはJava 17を最小要件とする（S1が成立する場合）
  - 根拠: Spring Boot公式リリースノートで明示
- **C4**: Java LTSバージョンは17, 21, 25が現時点で選択可能
  - 根拠: Oracleのリリーススケジュールで確定。次回LTSは2027年9月のJava 29

### 仮定（Supposition）

- **S1**: プロジェクトで主要なJavaフレームワーク（Spring Boot等）を使用する
  - 根拠: エンタープライズJavaで標準的
  - 検証方法: プロジェクトの技術スタック要件を確認
- **S2**: Java 21のVirtual Threadsが並行処理で有効に機能する
  - 根拠: ベンチマーク結果で性能向上が報告されているがアプリ特性に依存
  - 検証方法: 並行処理要件とアーキテクチャを評価
- **S3**: OpenJDKディストリビューションが無償利用可能な状態が継続する
  - 根拠: 複数ベンダーが無償提供中だが将来変更の可能性あり
  - 検証方法: ライセンスポリシーを定期確認
- **S4**: プロジェクトの開発期間は2年以上継続する
  - 根拠: エンタープライズ開発の標準的な期間
  - 検証方法: プロジェクト計画書で確認
- **S5**: チームメンバーはJava 8/11経験があるがJava 17以降の新機能には未習熟
  - 根拠: Java 8/11が長期利用された一般的状況
  - 検証方法: チームスキルセット調査
- **S6**: パフォーマンスが重要な要件である
  - 根拠: 非機能要件の優先度は未確定
  - 検証方法: 非機能要件の優先順位を確認
- **S7**: Java 11のサポート終了時期はディストリビューションに依存する
  - 根拠: Oracle JDKは2026年9月EOLだがEclipse TemurinやCorrettoは異なるサポート期間を持つ
  - 検証方法: 採用予定のディストリビューションのサポート期間を確認
- **S8**: 一般的なJavaアプリケーションでは後方互換性が保たれることが多い
  - 根拠: Java 8→11のJava EE分離、11→17のNashorn削除等の破壊的変更も存在
  - 検証方法: 使用するAPIの互換性マトリクスを確認
- **S9**: プロジェクトは単一のJavaバージョンで統一される
  - 根拠: マイクロサービス構成では複数バージョン並行利用もあり得る
  - 検証方法: システムアーキテクチャを確認
- **S10**: プロジェクトは少なくとも3年以上の運用を前提とする
  - 根拠: 運用期間がLTSサポート期間の重要性に影響
  - 検証方法: ライフサイクル計画で運用終了時期を確認
- **S11**: エコシステムの成熟度を重視し安定性を優先する
  - 根拠: 組織の技術採用方針に依存
  - 検証方法: 技術採用方針（保守的 vs 革新的）を確認

### 不確実（Doubt）

- **D1**: サードパーティライブラリのJava 21/25互換性
  - 影響範囲: 必要なライブラリが利用できない可能性
  - リスク: 開始後に互換性問題が発覚しバージョン変更が必要になる
- **D2**: チームの学習コスト許容度と教育リソースの確保
  - 影響範囲: 新バージョン機能習得の時間と投資
  - リスク: 学習コストが見積もりより大きく開発速度に影響
- **D3**: Oracle JDK vs OpenJDK系の選択方針
  - 影響範囲: Java 21 NFTC版期限（2026年9月）等の影響
  - リスク: ディストリビューション未確定の場合バージョン評価に影響
- **D4**: 並行処理要件の具体的な規模
  - 影響範囲: Virtual Threadsの価値評価
  - リスク: 並行処理が少ない場合Java 21の性能的メリットが限定的
- **D5**: インフラ環境（クラウド/オンプレ、コンテナ化の有無）
  - 影響範囲: GC最適化の効果が環境依存
  - リスク: 環境次第で性能特性が変化しバージョン選択の優先順位が変わる
- **D6**: Java 25のエコシステム成熟度（2026年2月時点）
  - 影響範囲: ツール・ライブラリ・IDE・ドキュメントの成熟度
  - リスク: 早期採用による情報不足で開発効率低下
- **D7**: デプロイメント環境とオーケストレーション方式
  - 影響範囲: コンテナ特有の最適化（CDS, Generational ZGC等）の効果が環境依存
  - リスク: 環境未確定の場合に性能最適化の優先順位が評価できない

## 判断基準

以下の5つの判断基準で各代替案を評価した。優先度は決定者（人間）が設定する。

### OBJ-1: 長期的な保守性の確保

プロジェクトの開発期間および運用期間を通じて、安定したサポートとセキュリティ更新が継続的に提供されること。

- 評価の視点:
  - LTSサポート期間の長さと終了時期
  - セキュリティパッチ提供の継続性
  - ディストリビューション選択の柔軟性
  - バージョン変更時の移行リスクと移行コスト

### OBJ-2: エコシステムの成熟度と互換性

開発に必要なフレームワーク、ライブラリ、ツール、ドキュメントが十分に整備され、安定して利用できること。

- 評価の視点:
  - 主要フレームワーク（Spring Boot等）との互換性
  - サードパーティライブラリのサポート状況
  - IDE、ビルドツール、CI/CDツールの対応状況
  - トラブルシューティング情報とコミュニティサポートの充実度

### OBJ-3: チームの学習コストと生産性

チームメンバーが新バージョンの機能を習得し、効率的に開発を進められること。

- 評価の視点:
  - 既存スキルセット（Java 8/11）からの学習コスト
  - 新機能（Records, Pattern Matching, Virtual Threads等）の習得難易度
  - 教育リソース（研修、ドキュメント、社内ナレッジ）の確保容易性
  - 開発初期段階での生産性への影響

### OBJ-4: パフォーマンスと技術的優位性

アプリケーションの性能要件を満たし、最新の技術的改善を活用できること。

- 評価の視点:
  - GC（Garbage Collector）の性能改善効果
  - Virtual Threads等の並行処理機能の有効性
  - 起動時間とメモリフットプリントの最適化
  - インフラ環境（コンテナ等）での性能特性

### OBJ-5: 将来の技術選択の柔軟性

今回の選択が将来の技術進化への対応や新機能の採用を妨げないこと。

- 評価の視点:
  - 将来のLTSバージョンへの移行の容易性
  - エコシステムの進化（新フレームワーク、新ライブラリ）への追従可能性
  - プロジェクト拡張時の技術的負債の蓄積リスク
  - 可逆性（バージョンダウングレードの実現可能性）

## 検討した選択肢

### ALT-1: Java 17（LTS）

2021年リリースのLTS。エコシステムが最も成熟しており、Spring Boot 3の最小要件。安定性と豊富な情報を重視する保守的な選択肢。

- 提案元: OBJ-1（長期的な保守性）、OBJ-2（エコシステム成熟度）、OBJ-3（学習コスト）、OBJ-5（将来の柔軟性）

### ALT-2: Java 21（LTS）

2023年リリースのLTS。Virtual Threads、Generational ZGC等の革新的機能を持ち、性能と将来性のバランスに優れる選択肢。

- 提案元: OBJ-1（長期的な保守性）、OBJ-4（パフォーマンス）、OBJ-5（将来の柔軟性）

### ALT-3: Java 25（LTS）

2025年9月リリースの最新LTS。最長のサポート期間と最新機能を持つが、2026年2月時点ではリリース後5ヶ月でエコシステムが未成熟。

- 提案元: OBJ-4（パフォーマンス）、OBJ-5（将来の柔軟性）

### 除外した選択肢

- **Java 8**: エコシステムから完全離脱済み、Spring Boot 3.x利用不可、新規プロジェクトに不適切（C3, C1により除外）
- **Java 11**: Oracle JDK EOLが2026年9月に迫り、Spring Boot 3.x利用不可（C3）。S4/S10の仮定（長期運用）と矛盾（C3, S7により除外）
- **Java 23（非LTS）**: Premier Supportが6ヶ月のみで長期運用に不適。S4/S10の仮定と矛盾（S4, S10により除外）

## トレードオフ分析

### マトリクス

| 判断基準 | ALT-1: Java 17 | ALT-2: Java 21 | ALT-3: Java 25 |
|----------|-----------------|-----------------|-----------------|
| OBJ-1: 長期的な保守性 | ◎ | ○ | △ |
| OBJ-2: エコシステム成熟度と互換性 | ◎ | ○ | × |
| OBJ-3: 学習コストと生産性 | ◎ | ○ | × |
| OBJ-4: パフォーマンスと技術的優位性 | ○ | ◎ | ○ |
| OBJ-5: 将来の技術選択の柔軟性 | ○ | ◎ | △ |

### 各セルの詳細

#### ALT-1 (Java 17) × OBJ-1 (長期的な保守性)
- **評価**: ◎
- **利点**: Extended Support 2029年9月まで確保、4年以上の運用実績で安定性が高い、複数ディストリビューションが長期サポート提供
- **欠点**: 次のLTS（Java 29）への移行が比較的早期に必要になる可能性
- **根拠**: サポート期間の確実性が最も高く、トラブルシューティング情報が豊富

#### ALT-1 (Java 17) × OBJ-2 (エコシステム成熟度)
- **評価**: ◎
- **利点**: Spring Boot 3.x正式サポート、サードパーティライブラリ対応が最も成熟、IDE・ビルドツール・CI/CDツール全般で安定
- **欠点**: 最先端の技術からは距離がある
- **根拠**: リリースから5年経過しエコシステム全体で安定稼働の実績

#### ALT-1 (Java 17) × OBJ-3 (学習コストと生産性)
- **評価**: ◎
- **利点**: Java 8/11からの段階的学習経路が確立、教育リソース最充実、新機能の段階的採用が可能
- **欠点**: Records、Sealed Classes、Pattern Matchingの習得は必要
- **根拠**: 5年の実績で書籍・研修・Q&Aが最も豊富

#### ALT-1 (Java 17) × OBJ-4 (パフォーマンス)
- **評価**: ○
- **利点**: ベースライン比6%高速、GC改善成熟（ZGC、Shenandoah）、コンテナ最適化進展
- **欠点**: Virtual Threads未搭載、Generational ZGC利用不可、Java 21比で約6%低速
- **根拠**: 十分な性能だが最先端の性能最適化は得られない
- **CSD依存**: D4（並行処理要件）が大きい場合に差が顕著

#### ALT-1 (Java 17) × OBJ-5 (将来の柔軟性)
- **評価**: ○
- **利点**: 将来LTSへの移行パスが明確、広範なエコシステム互換性
- **欠点**: Virtual Threads未搭載により将来のアーキテクチャ選択肢が制限される可能性
- **根拠**: 移行事例とツールが豊富だが、新しいフレームワークがJava 21以上を要件にした場合に追従困難

#### ALT-2 (Java 21) × OBJ-1 (長期的な保守性)
- **評価**: ○
- **利点**: LTSとして標準的な長期サポート、リリースから1年半経過し一定の安定性確保
- **欠点**: Java 17比でエコシステム成熟度がやや劣る、NFTC版期限（2026年9月）によりディストリビューション選択が重要
- **根拠**: OpenJDKディストリビューション経由でサポート継続可能
- **CSD依存**: S3（OpenJDKディストリビューション無償提供の継続）、D3（ディストリビューション選択方針）

#### ALT-2 (Java 21) × OBJ-2 (エコシステム成熟度)
- **評価**: ○
- **利点**: Spring Boot 3.2+で正式サポート、主要フレームワーク対応完了、Virtual Threads活用事例増加中
- **欠点**: Java 17比でトラブルシューティング情報・コミュニティサポートが少ない
- **根拠**: 2年経過し主要エコシステム要素は対応済みだが情報蓄積に差あり
- **CSD依存**: D1（ライブラリ互換性）の不確実性が影響

#### ALT-2 (Java 21) × OBJ-3 (学習コストと生産性)
- **評価**: ○
- **利点**: Virtual Threads習得後の生産性向上が期待、Java 17の機能に加え新機能で開発効率向上
- **欠点**: Virtual Threadsの構造化並行性は新概念で学習コスト高、教育リソースがJava 17比で少ない
- **根拠**: 学習コストは増加するが、習得後の生産性向上が期待される
- **CSD依存**: D4（並行処理要件）が小さい場合やD2（学習コスト許容度）が厳しい場合は評価が△に低下

#### ALT-2 (Java 21) × OBJ-4 (パフォーマンス)
- **評価**: ◎
- **利点**: ベースライン比12%高速、Virtual Threadsで並行処理を革新、Generational ZGCで10%改善
- **欠点**: Java 25比で最新の最適化が含まれない可能性（ただし実証データなし）
- **根拠**: パフォーマンス機能が本番利用可能なレベルで成熟
- **CSD依存**: D4（並行処理要件）が大きくD5（インフラ環境）がコンテナ環境の場合に最大効果

#### ALT-2 (Java 21) × OBJ-5 (将来の柔軟性)
- **評価**: ◎
- **利点**: Virtual Threadsにより将来のアーキテクチャ選択肢が大幅拡大、次期LTSへの段階的移行が可能
- **欠点**: Java 25比で技術的負債蓄積リスクがやや高い（差は限定的）
- **根拠**: 並行処理モデルへの早期適応が将来の技術選択を広げる
- **CSD依存**: S2（Virtual Threadsの有効性）、D4（並行処理要件）

#### ALT-3 (Java 25) × OBJ-1 (長期的な保守性)
- **評価**: △
- **利点**: 最新LTSとして最長の将来サポート期間、技術的負債の蓄積リスクが最低
- **欠点**: リリース後半年で安定性未検証、トラブルシューティング情報不足、ディストリビューションのサポート開始時期が不確定
- **根拠**: 長期的なサポート期間は有利だが、短期的な安定性に不安
- **CSD依存**: D6（エコシステム成熟度）に強く依存。早期採用による未発見バグのリスクが高い

#### ALT-3 (Java 25) × OBJ-2 (エコシステム成熟度)
- **評価**: ×
- **利点**: 最新LTSとして長期的にはエコシステムが追従
- **欠点**: リリース半年未満で主要フレームワーク正式サポートが限定的、ライブラリ互換性検証不足、ドキュメント著しく不足
- **根拠**: エコシステム成熟には通常2-3年を要する
- **CSD依存**: D6（エコシステム成熟度）、D1（ライブラリ互換性）に依存し現時点での採用リスクが極めて高い

#### ALT-3 (Java 25) × OBJ-3 (学習コストと生産性)
- **評価**: ×
- **利点**: 最新機能を利用可能（習得後）
- **欠点**: 教育リソースがほぼ存在しない、累積的学習コストが極めて高い、未知の問題で生産性大幅低下リスク
- **根拠**: リリース後間もないため教育リソースが不足
- **CSD依存**: D6（エコシステム成熟度）が低く、S5（チーム未習熟）の場合に学習負荷が深刻化

#### ALT-3 (Java 25) × OBJ-4 (パフォーマンス)
- **評価**: ○
- **利点**: 理論上は最新の最適化を含む、Java 21の全改善を継承
- **欠点**: 実戦パフォーマンスデータが不足、性能チューニングのナレッジが未蓄積
- **根拠**: 理論上の優位性はあるがJava 21の実証済み性能改善と比較すると確実性が低い
- **CSD依存**: D6（エコシステム成熟度）に強く依存

#### ALT-3 (Java 25) × OBJ-5 (将来の柔軟性)
- **評価**: △
- **利点**: 最長サポート期間、最新機能で技術的負債最小化、新ライブラリとの将来互換性
- **欠点**: エコシステム未成熟により開発初期の選択肢が制限、フォールバック選択肢が限定的
- **根拠**: 長期的には有利だが短期的な柔軟性に制約
- **CSD依存**: D6（エコシステム成熟度）、D1（ライブラリ互換性）の不確実性が近い将来の柔軟性を損なう。S11（安定性優先）の場合は不利

## リスク分析

本セクションは省略（Level 3 で実施）

## 将来の意思決定への影響

本セクションは省略（Level 3 で実施）

## 決定

ALT-2: Java 21（LTS）を採用する。

## 根拠

パフォーマンスと技術的優位性（OBJ-4）とエコシステム成熟度と互換性（OBJ-2）のバランスで判断した。Java 21はパフォーマンスで◎評価を獲得しつつ、エコシステム成熟度でも○評価と実用的な水準を確保しており、両基準のバランスが最も優れている。

## 受け入れたトレードオフ

Java 17と比較して、長期的な保守性（OBJ-1: ○ vs ◎）、エコシステム成熟度（OBJ-2: ○ vs ◎）、学習コスト（OBJ-3: ○ vs ◎）でやや劣ることを受け入れる。具体的には、Java 17比でトラブルシューティング情報が少ないこと、Virtual Threadsの学習コストが追加で発生すること、NFTC版期限によりOpenJDKディストリビューション選択が必要になることをトレードオフとして許容する。
