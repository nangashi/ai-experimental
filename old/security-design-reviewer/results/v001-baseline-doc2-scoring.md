# 採点結果: v001-baseline (doc2)

## スコアサマリ
Run1=11.0(検出9.5+bonus3-penalty0), Run2=11.5(検出9.5+bonus4-penalty0)

## 検出マトリクス
| ID | カテゴリ | 深刻度 | Run1 | Run2 |
|----|---------|--------|------|------|
| P01 | 認証・認可設計 | 重大 | ○ | ○ |
| P02 | インフラ・依存関係・監査 | 重大 | ○ | ○ |
| P03 | 認証・認可設計 | 重大 | ○ | ○ |
| P04 | 入力検証・攻撃防御 | 中 | △ | △ |
| P05 | 入力検証・攻撃防御 | 中 | ○ | ○ |
| P06 | 脅威モデリング（DoS/Spoofing） | 中 | ○ | ○ |
| P07 | データ保護 | 中 | × | ○ |
| P08 | データ保護 | 軽微 | ○ | ○ |
| P09 | インフラ・依存関係・監査 | 軽微 | ○ | ○ |
| P10 | インフラ・依存関係・監査 | 軽微 | ○ | ○ |

## カテゴリ別検出率
| Category | Questions | Rate | Detail |
|----------|-----------|------|--------|
| 認証・認可設計 | 2 | 1.00 | Run1: ○○, Run2: ○○ (4○/4) |
| インフラ・依存関係・監査 | 3 | 1.00 | Run1: ○○○, Run2: ○○○ (6○/6) |
| 脅威モデリング | 1 | 1.00 | Run1: ○, Run2: ○ (2○/2) |
| 入力検証・攻撃防御 | 2 | 0.75 | Run1: △○, Run2: △○ (2○+2△ → 3.0/4) |
| データ保護 | 2 | 0.75 | Run1: ×○, Run2: ○○ (3○+0△ → 3.0/4) |

## ボーナス・ペナルティ詳細
### Run1
- Bonus:
  - B02相当: Stripe Webhookエンドポイントの署名検証未記述 (C-5) を独立問題として指摘し、偽イベントによる注文ステータス不正書き換えリスクを説明 (+0.5)
  - B03相当: 注文APIの認可チェック不備（buyerが自分以外の注文を参照できないかの設計欠如）を独立問題として指摘 (S-3) (+0.5)
  - スコープ内追加指摘: 商品更新APIのテナント所有権確認欠如 (M-4) — 正解キー未掲載、perspectiveスコープ合致、事実に基づく有益な指摘 (+0.5)
- Penalty: なし

### Run2
- Bonus:
  - B02相当: Stripe Webhookエンドポイントの署名検証未記述 (S-2) を独立問題として指摘し、偽イベントによる注文ステータス不正書き換えリスクを説明 (+0.5)
  - B03相当: 注文APIの認可設計の曖昧さ（buyerが自分の注文のみアクセスできることを保証する設計欠如）を独立問題として指摘 (M-5) (+0.5)
  - B05相当: ファイルアップロードのMIME型検証不足 (M-1) — Content-Typeヘッダー偽装可能性とサーバーサイドMIME検証の必要性を指摘 (+0.5)
  - スコープ内追加指摘: 商品更新APIのテナント所有権確認欠如 (Mi-3) — 正解キー未掲載、perspectiveスコープ合致、事実に基づく有益な指摘 (+0.5)
- Penalty: なし

## エラー分析（抽象的）

### Missed/Partial by Category
| Category | Problems | ○ | △ | × | Stability | Prompt Gap |
|----------|----------|---|---|---|-----------|------------|
| 認証・認可設計 | 2 | 4 | 0 | 0 | 高安定 | なし |
| インフラ・依存関係・監査 | 3 | 6 | 0 | 0 | 高安定 | なし |
| 脅威モデリング | 1 | 2 | 0 | 0 | 高安定 | なし |
| 入力検証・攻撃防御 | 2 | 2 | 2 | 0 | 高安定（両Run△一致） | CSRF対策の根拠不足という設計上の矛盾への掘り下げが不足。代替手段（CSRFトークン、SameSite）を付随的に言及するのみで、既存設計の論理的欠陥を独立問題として構造化するよう促す指示が弱い |
| データ保護 | 2 | 3 | 0 | 1 | 低安定（Run1×→Run2○） | RDS TDEの保護範囲の限界（論理的アクセスに対する無効性）に関するプロンプトの明示度が不足。DBレベル暗号化と列レベル暗号化の役割分担を評価軸として明示していないため、検出が確率的になっている |

### Improvement Directions

1. **CSRF対策の設計根拠への独立フォーカス**: 入力検証カテゴリにおいて、「既存のCSRF対策設計がJWTのみへの依存で根拠不足」という矛盾パターンを独立指摘対象として認識させる方向。他の問題（token storage等）への対策として付随させるのではなく、CSRF対策の設計根拠それ自体を独立問題として構造化するよう誘導する。

2. **多層データ保護モデルの評価フレーム強化**: データ保護カテゴリにおいて、「インフラ層暗号化（TDE）がアプリケーション層アクセスに対して保護を提供しない」という観点を評価フレームとして明示する方向。具体的なTDEの限界シナリオ（DBアクセス権限を持つ内部脅威、SQLインジェクション成功後の読み取り等）を評価スコープとして言及することで、検出の安定性を高める。

### Strengths to Preserve

- **重大問題の確実な検出**: 認証・認可設計（P01, P03）とインフラ・監査（P02, P09, P10）は全Run完全検出。シークレット管理の矛盾、ヘッダー信頼の設計リスク、既知脆弱性の識別が安定している。これはプロンプトがこれらのカテゴリに対する具体的なチェック項目（シークレット管理、テナント分離、依存関係管理）を明示していることが効いている。
- **構造化とSTRIDE整合**: STRIDE評価サマリー（Run1）と体系的な問題分類（Run2）により、脅威モデリングカテゴリの問題が安定して検出されている。脅威フレームワークへの言及がプロンプト上で有効に機能している。
- **ボーナス問題の高い検出率**: 両RunともWebhook署名検証や認可設計の欠如など、正解キー未掲載の有効な追加指摘を複数生成できている。スコープ内での探索的なレビュー行動が促進されている。
