# 採点結果: v004-pii-logical-access (doc1)

## スコアサマリ
Run1=9.5(検出8.0+bonus3-penalty0), Run2=10.0(検出8.5+bonus3-penalty0)

## 検出マトリクス
| ID | カテゴリ | 深刻度 | Run1 | Run2 |
|----|---------|--------|------|------|
| P01 | 認証・認可設計 | 重大 | ○ | ○ |
| P02 | 認証・認可設計 | 重大 | ○ | ○ |
| P03 | データ保護 | 中 | ○ | ○ |
| P04 | データ保護 | 軽微 | ○ | ○ |
| P05 | 入力検証・攻撃防御 | 中 | ○ | ○ |
| P06 | 入力検証・攻撃防御 | 中 | ○ | ○ |
| P07 | 脅威モデリング（DoS/ブルートフォース） | 中 | ○ | ○ |
| P08 | インフラ・依存関係・監査 | 軽微 | × | △ |
| P09 | 入力検証・攻撃防御 | 重大 | × | × |
| P10 | インフラ・依存関係・監査 | 軽微 | ○ | ○ |

## カテゴリ別検出率
| Category | Questions | Rate | Detail |
|----------|-----------|------|--------|
| 認証・認可設計 | 2 | 1.00 | P01:○○, P02:○○ |
| データ保護 | 2 | 1.00 | P03:○○, P04:○○ |
| 入力検証・攻撃防御 | 3 | 0.67 | P05:○○, P06:○○, P09:×× |
| 脅威モデリング（DoS/ブルートフォース） | 1 | 1.00 | P07:○○ |
| インフラ・依存関係・監査 | 2 | 0.63 | P08:×△, P10:○○ |

## ボーナス・ペナルティ詳細
### Run1
- Bonus: B04相当（アプリケーション層暗号化の欠如、フィールドレベル暗号化+KMS管理を詳述） +0.5
- Bonus: B03相当（リフレッシュトークンのユーザーIDキー管理リスク、複数デバイス問題・レースコンディションを指摘） +0.5
- Bonus: B05相当（ファイルアップロードの種別・サイズ制限未設計を設計段階での未定義として指摘） +0.5
- Penalty: なし

### Run2
- Bonus: B04相当（アプリケーション層暗号化の欠如、フィールドレベル暗号化+KMS管理を詳述） +0.5
- Bonus: B03相当（リフレッシュトークンのユーザーIDキー管理リスク、複数デバイスセッション問題を指摘） +0.5
- Bonus: B05相当（ファイルアップロードバリデーション未定義を設計段階での未定義として指摘） +0.5
- Penalty: なし

## エラー分析（抽象的）

### Missed/Partial by Category
| Category | Problems | ○ | △ | × | Stability | Prompt Gap |
|----------|----------|---|---|---|-----------|------------|
| 認証・認可設計 | 2 | 4 | 0 | 0 | 高安定 | なし |
| データ保護 | 2 | 4 | 0 | 0 | 高安定 | なし |
| 入力検証・攻撃防御 | 3 | 4 | 0 | 2 | P09のみ一貫未検出 | バックエンド層での独立検証要件の強調が不十分。フロントエンド依存という「信頼モデルの欠陥」への言及を促す指示が不足 |
| 脅威モデリング（DoS/ブルートフォース） | 1 | 2 | 0 | 0 | 高安定 | なし |
| インフラ・依存関係・監査 | 2 | 2 | 1 | 1 | P08が不安定（×→△） | セキュリティ監査ログと一般ログの区別、セキュリティイベント（認証失敗・権限変更・機密データアクセス）の特定記録要件を明示させる指示が不足 |

### Improvement Directions

1. **入力検証カテゴリの強化**: フロントエンド検証への依存というアンチパターン（クライアント側バリデーションのバイパス可能性）を明示的に検出させる方向。「フロントエンド/クライアント側の検証のみで十分とみなしている設計」をセキュリティ欠陥として識別するよう誘導する要素の追加を検討。

2. **セキュリティ監査ログの特定化**: 一般的なアプリケーションログと区別された「セキュリティイベントログ」の設計有無を確認するよう促す方向。特にセキュリティ領域固有のイベント（認証失敗、権限変更、機密データへのアクセス）の記録設計が明示されているかを検査させる要素の強化を検討。

### Strengths to Preserve

- **認証・認可設計の網羅性**: トークン保存方式（XSSリスク）、ロールベースアクセス制御の粒度問題をいずれも正確に特定できている。具体的な攻撃シナリオと代替手段の双方に言及する傾向が安定的に機能している。
- **データ保護（通信・保存）**: 内部ネットワークの「安全神話」に基づく平文通信設計、PIIログ出力の方針欠如をいずれも安定して検出。設計書の文言を忠実に引用しつつ問題の核心に到達するパターンが有効。
- **CORS/CSRF/レート制限**: いずれも高い精度で検出。「現フェーズのスコープ外」「必要に応じて検討」という先送り表現を設計上の欠陥として識別する能力が安定している。
