# 採点結果: v005-cors-stance-principle (doc2)

## スコアサマリ
Run1=10.5(検出9.0+bonus3-penalty0), Run2=12.5(検出10.0+bonus5-penalty0)

## 検出マトリクス
| ID | カテゴリ | 深刻度 | Run1 | Run2 |
|----|---------|--------|------|------|
| P01 | 認証・認可設計 | 重大 | ○ | ○ |
| P02 | インフラ・依存関係・監査 | 重大 | ○ | ○ |
| P03 | 認証・認可設計 | 重大 | △ | ○ |
| P04 | 入力検証・攻撃防御 | 中 | ○ | ○ |
| P05 | 入力検証・攻撃防御 | 中 | ○ | ○ |
| P06 | 脅威モデリング（DoS/Spoofing） | 中 | ○ | ○ |
| P07 | データ保護 | 中 | ○ | ○ |
| P08 | データ保護 | 軽微 | ○ | ○ |
| P09 | インフラ・依存関係・監査 | 軽微 | △ | ○ |
| P10 | インフラ・依存関係・監査 | 軽微 | ○ | ○ |

## カテゴリ別検出率
| Category | Questions | Rate | Detail |
|----------|-----------|------|--------|
| 認証・認可設計 | 2 | 0.875 | Run1: ○△=1.5/2, Run2: ○○=2.0/2 → 3.5/(2×2) |
| 入力検証・攻撃防御 | 2 | 1.000 | Run1: ○○=2.0/2, Run2: ○○=2.0/2 → 4.0/(2×2) |
| 脅威モデリング | 1 | 1.000 | Run1: ○=1.0/1, Run2: ○=1.0/1 → 2.0/(1×2) |
| データ保護 | 2 | 1.000 | Run1: ○○=2.0/2, Run2: ○○=2.0/2 → 4.0/(2×2) |
| インフラ・依存関係・監査 | 3 | 0.917 | Run1: ○△○=2.5/3, Run2: ○○○=3.0/3 → 5.5/(3×2) |

## ボーナス・ペナルティ詳細
### Run1
- Bonus:
  - [HIGH-04] Stripe Webhook署名検証設計の欠如（B02対応）: 偽イベントによる注文ステータス不正書き換えリスクを説明 +0.5
  - [HIGH-02] アクセストークンの即時無効化不可: perspective.mdの評価スコープ内（認証・認可設計）、正解キー外の有益な追加指摘 +0.5
  - [HIGH-05] テナント分離のアプリケーション層依存（RLS欠如）: perspective.mdの評価スコープ内（認証・認可設計）、正解キー外の有益な追加指摘 +0.5
- Penalty: なし
- Bonus合計: 3件 × 0.5 = 1.5

### Run2
- Bonus:
  - [S-04] Stripe Webhook署名検証設計の欠如（B02対応）: 偽イベントによる支払い偽装リスクを説明 +0.5
  - [S-05] アクセストークンの即時無効化不能: perspective.mdの評価スコープ内（認証・認可設計）、正解キー外の有益な追加指摘 +0.5
  - [S-01] テナント分離がアプリケーション層クエリフィルタリングのみに依存（RLS欠如）: perspective.mdの評価スコープ内（認証・認可設計）、正解キー外の有益な追加指摘 +0.5
  - [M-05] 商品API更新・削除エンドポイントのリソース所有権検証欠如: perspective.mdの評価スコープ内（認証・認可設計）、正解キー外の有益な追加指摘 +0.5
  - [N-01] 署名付きURL有効期限7日間の過長: perspective.mdの評価スコープ内（データ保護）、正解キー外の有益な追加指摘 +0.5
  - [N-02] KMSキーローテーション周期の設計記述: perspective.mdの評価スコープ内（インフラ・依存関係）、正解キー外の有益な追加指摘 +0.5（上限到達により計上済み5件まで）
  - [N-03] CSPディレクティブ不十分の可能性: perspective.mdの評価スコープ内（入力検証・攻撃防御）、正解キー外 +0.5（上限超過のため計上なし）
- Penalty: なし
- Bonus合計: 5件（上限）× 0.5 = 2.5

## エラー分析（抽象的）

### Missed/Partial by Category
| Category | Problems | ○ | △ | × | Stability | Prompt Gap |
|----------|----------|---|---|---|-----------|------------|
| 認証・認可設計 | 2 | 3 | 1 | 0 | 中（Run間で差あり） | 暗黙の前提型リスク（ゲートウェイ迂回経路）の検出が不安定。信頼境界の明示的なチェック指針が不足 |
| インフラ・依存関係・監査 | 3 | 5 | 1 | 0 | 中（Run1でのみ部分検出） | 特定バージョンの既知脆弱性を正確に捉えるための「具体的なバージョン番号を確認し既知脆弱性と照合せよ」という指示が不足 |
| 入力検証・攻撃防御 | 2 | 4 | 0 | 0 | 高 | なし（完全検出） |
| 脅威モデリング | 1 | 2 | 0 | 0 | 高 | なし（完全検出） |
| データ保護 | 2 | 4 | 0 | 0 | 高 | なし（完全検出） |

### Improvement Directions
1. **信頼境界チェックの強化**: 「暗黙の前提」型埋め込み（コンポーネントが外部からのヘッダー注入を防ぐ設計が明示されていない）への検出安定性を高めるため、「各コンポーネントが依存する信頼境界（ゲートウェイ、ネットワーク分離等）がバイパスされた場合のリスクを評価せよ」という観点をプロンプトに追加する方向性
2. **具体的バージョン照合の明示化**: ライブラリのバージョン番号を設計書に見つけた場合、既知の脆弱性（CVE等）と照合することを明示的に指示する方向性。「四半期ごとの確認計画」というコンテキスト情報に引きずられて頻度問題として処理されるパターンを防ぐ

### Strengths to Preserve
- **CORS・認証フロー・CSRFの横断的分析**: CORS設定の正規表現バイパスやCSRF対策の単一層依存など、設計書の複数セクションを横断して問題を構造的に把握する能力が高い。これを支えるプロンプトの「設計全体を俯瞰してから個別セクションを評価する」という指示は保持すべき
- **データ保護の体系的カバレッジ**: TDEの保護限界・PII保持方針・フィールドレベル暗号化という複層のデータ保護問題を漏れなく検出。「保護の前提が成立しない状況（不正アクセス、内部不正）を想定せよ」という指示が有効に機能している
- **ボーナス検出の高精度**: Webhook署名検証・アクセストークン無効化・テナント分離RLS欠如など、正解キー外の有益な指摘を高い精度で生成できている
