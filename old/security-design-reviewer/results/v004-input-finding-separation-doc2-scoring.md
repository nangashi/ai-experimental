# 採点結果: v004-input-finding-separation (doc2)

## スコアサマリ
Run1=12.0(検出9.5+bonus5-penalty0), Run2=11.0(検出9.5+bonus3-penalty0)

## 検出マトリクス
| ID | カテゴリ | 深刻度 | Run1 | Run2 |
|----|---------|--------|------|------|
| P01 | 認証・認可設計 | 重大 | ○ | ○ |
| P02 | インフラ・依存関係・監査 | 重大 | ○ | ○ |
| P03 | 認証・認可設計 | 重大 | ○ | ○ |
| P04 | 入力検証・攻撃防御 | 中 | ○ | ○ |
| P05 | 入力検証・攻撃防御 | 中 | △ | △ |
| P06 | 脅威モデリング（DoS/Spoofing） | 中 | ○ | ○ |
| P07 | データ保護 | 中 | ○ | ○ |
| P08 | データ保護 | 軽微 | ○ | ○ |
| P09 | インフラ・依存関係・監査 | 軽微 | ○ | ○ |
| P10 | インフラ・依存関係・監査 | 軽微 | ○ | ○ |

## カテゴリ別検出率
| Category | Questions | Rate | Detail |
|----------|-----------|------|--------|
| 認証・認可設計 | 2 | 1.00 | Run1: ○○, Run2: ○○ |
| 入力検証・攻撃防御 | 2 | 0.75 | Run1: ○△, Run2: ○△ |
| 脅威モデリング（DoS/Spoofing） | 1 | 1.00 | Run1: ○, Run2: ○ |
| データ保護 | 2 | 1.00 | Run1: ○○, Run2: ○○ |
| インフラ・依存関係・監査 | 3 | 1.00 | Run1: ○○○, Run2: ○○○ |

## ボーナス・ペナルティ詳細
### Run1
- Bonus:
  - B02: Stripe Webhook署名検証欠如の指摘（[HIGH-07]）
  - B05: Magic Bytesによるサーバーサイドファイル検証の必要性指摘（[HIGH-05]）
  - CRITICAL-05相当: PostgreSQL RLSによるDBレベルテナント分離強制の欠如指摘（[CRITICAL-05]）
  - CRITICAL-02相当: リフレッシュトークンCookieへのSameSite属性欠如を独立発見として指摘（[CRITICAL-02]）
  - HIGH-04相当: アクセストークン即時無効化不能設計の指摘（[HIGH-04]）
  - 合計: 5件 × 0.5 = +2.5（上限5件に到達、MOD-03相当の指摘は上限超過のため除外）
- Penalty: なし

### Run2
- Bonus:
  - B02: Stripe Webhook署名検証欠如の指摘（[CRITICAL-04]）
  - B05: Magic Bytesによるサーバーサイドファイル検証の必要性指摘（[MODERATE-01]）
  - SIGNIFICANT-06相当: アクセストークン即時無効化不能設計の指摘（[SIGNIFICANT-06]）
  - 合計: 3件 × 0.5 = +1.5
- Penalty: なし

## エラー分析（抽象的）

### Missed/Partial by Category
| Category | Problems | ○ | △ | × | Stability | Prompt Gap |
|----------|----------|---|---|---|-----------|------------|
| 認証・認可設計 | 2 | 4 | 0 | 0 | 高安定 | なし |
| 入力検証・攻撃防御 | 2 | 2 | 2 | 0 | 高安定 | 正規表現バイパスの具体的手法への踏み込み不足 |
| 脅威モデリング（DoS/Spoofing） | 1 | 2 | 0 | 0 | 高安定 | なし |
| データ保護 | 2 | 4 | 0 | 0 | 高安定 | なし |
| インフラ・依存関係・監査 | 3 | 6 | 0 | 0 | 高安定 | なし |

### Improvement Directions
- **入力検証カテゴリの部分検出（CORS正規表現バイパス）**: 両Runで一貫して△にとどまった。プロンプトが「CORS設定の問題」という上位カテゴリへの言及は促しているが、「正規表現が特定の攻撃者ドメインにマッチする」という具体的な構文解析への踏み込みを促す指示が不足している。正規表現ベースの検証設計に対して「バイパス可能なパターンの例示」を要求する観点を追加することで改善が見込まれる。

### Strengths to Preserve
- **認証・認可設計の完全検出（P01, P03）**: 認証フローのトークン保存方式とマルチテナントヘッダー信頼モデルに関する設計上のリスクを両Runで完全検出。設計書の「暗黙の前提」（ヘッダー注入経路の未記述）に対する感度が高い。
- **データ保護の完全検出（P07, P08）**: TDEの保護範囲の限界（ディスクレベルのみ）とPII保持ポリシーの法規制要件への言及を両Runで完全検出。「設計書が宣言する保護とその実際の保護範囲の矛盾」を検出する能力が機能している。
- **インフラ・依存関係・監査の完全検出（P02, P09, P10）**: リポジトリへの本番シークレット保存という埋め込み技法（矛盾）、既知脆弱性ライブラリの使用、監査ログ分離欠如をすべて完全検出。これらは設計書の記述に対する精読とセキュリティ知識の組み合わせで機能するパターンが安定している。
- **ボーナス発見の多さ**: 両RunともにWebhook署名検証（B02）・ファイルMagic Bytes検証（B05）・トークン即時無効化の3件以上のボーナスを生成。正解キーにない設計上のセキュリティリスクを積極的に発見する傾向が有効に機能している。
