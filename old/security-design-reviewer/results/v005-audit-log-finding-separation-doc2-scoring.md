# 採点結果: v005-audit-log-finding-separation (doc2)

## スコアサマリ
Run1=11.5(検出9.5+bonus4-penalty0), Run2=12.0(検出9.5+bonus5-penalty0)

## 検出マトリクス
| ID | カテゴリ | 深刻度 | Run1 | Run2 |
|----|---------|--------|------|------|
| P01 | 認証・認可設計 | 重大 | ○ | ○ |
| P02 | インフラ・依存関係・監査 | 重大 | ○ | ○ |
| P03 | 認証・認可設計 | 重大 | ○ | △ |
| P04 | 入力検証・攻撃防御 | 中 | × | ○ |
| P05 | 入力検証・攻撃防御 | 中 | △ | △ |
| P06 | 脅威モデリング（DoS/Spoofing） | 中 | ○ | ○ |
| P07 | データ保護 | 中 | ○ | ○ |
| P08 | データ保護 | 軽微 | ○ | ○ |
| P09 | インフラ・依存関係・監査 | 軽微 | ○ | △ |
| P10 | インフラ・依存関係・監査 | 軽微 | ○ | ○ |

## カテゴリ別検出率
| Category | Questions | Rate | Detail |
|----------|-----------|------|--------|
| 認証・認可設計 | 2 | 0.875 | Run1:○○, Run2:○△ |
| 入力検証・攻撃防御 | 2 | 0.500 | Run1:×△, Run2:○△ |
| 脅威モデリング | 1 | 1.000 | Run1:○, Run2:○ |
| データ保護 | 2 | 1.000 | Run1:○○, Run2:○○ |
| インフラ・依存関係・監査 | 3 | 0.917 | Run1:○○○, Run2:○△○ |

## ボーナス・ペナルティ詳細
### Run1
- Bonus: SIGNIFICANT-4（アクセストークン即時無効化不能 — 認証・認可設計スコープ内の有益な追加指摘）+0.5
- Bonus: SIGNIFICANT-5（Stripe Webhook署名検証欠如 — B02条件を満たす）+0.5
- Bonus: MODERATE-1（ファイルアップロードMIMEタイプ検証欠陥、サーバーサイドMIME検証の必要性指摘 — B05条件を満たす）+0.5
- Bonus: MINOR-1（署名付きURLの有効期限過長 — データ保護スコープ内の有益な追加指摘）+0.5
- Penalty: なし

### Run2
- Bonus: CRITICAL-03（アクセストークン即時無効化不能 — 認証・認可設計スコープ内の有益な追加指摘）+0.5
- Bonus: SIGNIFICANT-06（Stripe Webhook署名検証欠如 — B02条件を満たす）+0.5
- Bonus: SIGNIFICANT-05（ファイルアップロードMIME型検証不足、Magic Bytes検証の必要性 — B05条件を満たす）+0.5
- Bonus: MINOR-02（注文詳細APIの横断アクセス制御設計の不明確さ — B03条件を満たす）+0.5
- Bonus: MODERATE-04（S3署名付きURLの有効期限過長 — データ保護スコープ内の有益な追加指摘）+0.5
- Penalty: なし

## エラー分析（抽象的）

### Missed/Partial by Category
| Category | Problems | ○ | △ | × | Stability | Prompt Gap |
|----------|----------|---|---|---|-----------|------------|
| 認証・認可設計 | 2 | 3 | 1 | 0 | 高安定（Run1全○、Run2に△1） | 暗黙の前提型（設計書に明記されていない攻撃経路の存在）への感度がRunによって変動する。ヘッダー信頼モデルの検証経路を明示的に問うプロンプト要素が不足している可能性 |
| 入力検証・攻撃防御 | 2 | 1 | 2 | 1 | 低安定（Run間でP04が×→○と逆転、P05は両Runで△） | CSRFはRunによって検出が大きく変動しており、「JWTのみに依存したCSRF対策の根拠不十分」という設計上の矛盾を検出するための観点がプロンプトに明示されていないと推定される。正規表現バイパスについては、サブドメイン汚染観点（テナントサブドメイン）には到達するが、外部ドメインへのマッチという異なる攻撃経路への言及が両Runで欠如 |
| 脅威モデリング | 1 | 2 | 0 | 0 | 高安定 | ギャップなし |
| データ保護 | 2 | 4 | 0 | 0 | 高安定 | ギャップなし |
| インフラ・依存関係・監査 | 3 | 5 | 1 | 0 | 高安定（P09でRun2に△） | 具体的なバージョン問題の断定的な検出（「既知の脆弱性がある」vs「可能性がある」）において表現の強度がRunによって変動する。バージョン固定による脆弱性の断定指摘を促す要素が不足している可能性 |

### Improvement Directions
- **入力検証・攻撃防御カテゴリの安定化**: CSRFの検出が不安定（Run1で×）であり、「JWT依存のCSRF対策の根拠不足」という設計矛盾パターンを検出する観点を強化する方向性。「JWTをCSRF対策として十分とする根拠を明示しているか」を確認する評価軸の追加が有効と考えられる
- **正規表現バイパスの具体的攻撃手法への到達**: 両Runで正規表現CORS問題は△止まり。サブドメイン汚染（内部ドメイン）だけでなく、外部ドメインへのマッチ（末尾一致の罠）という観点を促す指示の追加が有効と考えられる
- **バージョン固定問題の断定指摘**: 特定バージョンの既知脆弱性について、「可能性がある」ではなく断定的な評価を促す指示の追加が有効と考えられる

### Strengths to Preserve
- **データ保護カテゴリの完全検出**: TDE（透明データ暗号化）の保護範囲の限界という細かな技術的区別に両Runで到達しており、暗号化設計の評価に関するプロンプト要素が有効に機能している
- **脅威モデリング（DoS/Spoofing）の完全検出**: 認証エンドポイントへのレート制限欠如を両Runで安定して検出しており、STRIDE観点からの評価フレームが機能している
- **インフラ・シークレット管理の高精度検出**: 設計書内の矛盾（Secrets Manager管理と宣言しながらリポジトリにも保存）を両Runで完全検出しており、整合性チェックの観点が有効
- **ボーナス指摘の豊富さ**: 両RunでボーナスB02（Webhook署名検証）、B05（MIME検証）を安定検出しており、perspectiveスコープ内の追加指摘能力が高い
