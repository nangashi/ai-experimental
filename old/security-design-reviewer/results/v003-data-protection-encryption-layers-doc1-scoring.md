# 採点結果: v003-data-protection-encryption-layers (doc1)

## スコアサマリ
Run1=10.5(検出9.5+bonus2-penalty0), Run2=10.0(検出8.5+bonus3-penalty0)

## 検出マトリクス
| ID | カテゴリ | 深刻度 | Run1 | Run2 |
|----|---------|--------|------|------|
| P01 | 認証・認可設計 | 重大 | ○ | ○ |
| P02 | 認証・認可設計 | 重大 | ○ | ○ |
| P03 | データ保護 | 中 | ○ | ○ |
| P04 | データ保護 | 軽微 | ○ | ○ |
| P05 | 入力検証・攻撃防御 | 中 | ○ | ○ |
| P06 | 入力検証・攻撃防御 | 中 | ○ | ○ |
| P07 | 脅威モデリング（DoS/ブルートフォース） | 中 | ○ | ○ |
| P08 | インフラ・依存関係・監査 | 軽微 | △ | △ |
| P09 | 入力検証・攻撃防御 | 重大 | ○ | × |
| P10 | インフラ・依存関係・監査 | 軽微 | ○ | ○ |

## カテゴリ別検出率
| Category | Questions | Rate | Detail |
|----------|-----------|------|--------|
| 認証・認可設計 | 2 | 1.00 | Run1: ○○ / Run2: ○○ → (4+0)/(2×2)=4/4 |
| データ保護 | 2 | 1.00 | Run1: ○○ / Run2: ○○ → (4+0)/(2×2)=4/4 |
| 入力検証・攻撃防御 | 3 | 0.83 | Run1: ○○○ / Run2: ○○× → (5+0)/(3×2)=5/6 |
| 脅威モデリング（DoS/ブルートフォース） | 1 | 1.00 | Run1: ○ / Run2: ○ → (2+0)/(1×2)=2/2 |
| インフラ・依存関係・監査 | 2 | 0.75 | Run1: △○ / Run2: △○ → (2+0.5×2)/(2×2)=3/4 |

## ボーナス・ペナルティ詳細
### Run1
- Bonus:
  - B04: CRIT-01 にてアプリケーション層フィールドレベル暗号化の欠如を指摘（診断結果・保険証番号等の高感度フィールドを明示） +0.5
  - B03: MOD-04 にてリフレッシュトークンをユーザーIDキーで管理した場合の複数デバイス問題・強制無効化の粒度問題を指摘 +0.5
- Penalty: なし

### Run2
- Bonus:
  - B04: C1 にてアプリケーション層フィールドレベル暗号化の欠如を指摘（診断結果・処方内容・保険証番号等を列挙） +0.5
  - B03: M4 にてリフレッシュトークンをユーザーIDキーで管理した場合の複数デバイス問題・トークンローテーション未設計を指摘 +0.5
  - B01: M3 にてデータ削除方針の未定義を指摘し、Crypto Shredding（暗号鍵廃棄による実質的削除）を含む削除ポリシー設計を求めている +0.5
- Penalty: なし

## エラー分析（抽象的）

### Missed/Partial by Category
| Category | Problems | ○ | △ | × | Stability | Prompt Gap |
|----------|----------|---|---|---|-----------|------------|
| 認証・認可設計 | 2 | 4 | 0 | 0 | 高安定 | なし（完全検出） |
| データ保護 | 2 | 4 | 0 | 0 | 高安定 | なし（完全検出） |
| 入力検証・攻撃防御 | 3 | 5 | 0 | 1 | 中安定（P09でRun2のみ未検出） | バックエンド入力検証方針の独立性に関する指摘が不安定。ファイルアップロード文脈のサーバーサイド検証とは区別して、入力検証全体のアーキテクチャ方針（フロントエンド信頼の排除）を明示的に求める要件が不足 |
| 脅威モデリング（DoS/ブルートフォース） | 1 | 2 | 0 | 0 | 高安定 | なし（完全検出） |
| インフラ・依存関係・監査 | 2 | 2 | 2 | 0 | 高安定（△で安定） | セキュリティ監査ログの区別（一般アプリログ vs. セキュリティイベントログ）に関する要件が弱い。認証失敗・権限変更・機密データアクセスといったセキュリティイベント特有の記録要件を明示的に指定するプロンプト要素が欠如しており、部分検出（△）に留まっている |

### Improvement Directions
1. **入力検証カテゴリの安定化**: バックエンド側での独立した入力検証（フロントエンドバイパスリスクの観点）を個別の評価観点として明示する方向性。ファイルアップロードのバリデーションとは区別して、APIレイヤー全般のインジェクション攻撃対策の設計有無を評価するよう誘導する。
2. **セキュリティ監査ログの明示化**: 一般的なアプリケーションログではなく、セキュリティイベント固有の記録（認証失敗・権限変更・機密データアクセス）の設計有無を確認することを評価要件として強調する方向性。「監査ログ」というキーワードだけでなく「セキュリティイベント記録」「認証失敗ログ」等の具体的な要件チェックを促す要素の追加が効果的と考えられる。

### Strengths to Preserve
- **認証・認可設計の確実な検出**: トークン保存方式のXSSリスク（localStorage vs HttpOnly Cookie）、ロールベースアクセス制御の過剰権限（担当患者限定vs全患者アクセス）を両Runで確実に検出。具体的なアクセス制御設計の評価を促すプロンプト要素が有効に機能している。
- **データ保護の安定検出**: VPC内部通信の平文化（内部ネットワーク安全神話の否定）、PIIログ出力方針の未定義を両Runで検出。「内部ネットワークの脅威」「PIIの取り扱い方針」に関する評価観点が明確に機能している。
- **ボーナス問題の高い検出率**: アプリケーション層暗号化欠如（B04）、リフレッシュトークン管理設計（B03）を両Runで検出。設計書の暗黙的なリスクを積極的に発掘する傾向は保持すべき強み。
