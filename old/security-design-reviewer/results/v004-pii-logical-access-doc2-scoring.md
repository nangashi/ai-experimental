# 採点結果: v004-pii-logical-access (doc2)

## スコアサマリ
Run1=12.0(検出9.5+bonus5-penalty0), Run2=12.0(検出10.0+bonus4-penalty0)

## 検出マトリクス
| ID | カテゴリ | 深刻度 | Run1 | Run2 |
|----|---------|--------|------|------|
| P01 | 認証・認可設計 | 重大 | ○ | ○ |
| P02 | インフラ・依存関係・監査 | 重大 | ○ | ○ |
| P03 | 認証・認可設計 | 重大 | △ | ○ |
| P04 | 入力検証・攻撃防御 | 中 | × | × |
| P05 | 入力検証・攻撃防御 | 中 | ○ | ○ |
| P06 | 脅威モデリング（DoS/Spoofing） | 中 | ○ | ○ |
| P07 | データ保護 | 中 | ○ | ○ |
| P08 | データ保護 | 軽微 | ○ | ○ |
| P09 | インフラ・依存関係・監査 | 軽微 | ○ | ○ |
| P10 | インフラ・依存関係・監査 | 軽微 | ○ | ○ |

## カテゴリ別検出率
| Category | Questions | Rate | Detail |
|----------|-----------|------|--------|
| 認証・認可設計 | 2 | 0.875 | Run1: P01○ P03△ / Run2: P01○ P03○ |
| インフラ・依存関係・監査 | 3 | 1.000 | Run1: P02○ P09○ P10○ / Run2: P02○ P09○ P10○ |
| 入力検証・攻撃防御 | 2 | 0.500 | Run1: P04× P05○ / Run2: P04× P05○ |
| 脅威モデリング | 1 | 1.000 | Run1: P06○ / Run2: P06○ |
| データ保護 | 2 | 1.000 | Run1: P07○ P08○ / Run2: P07○ P08○ |

## ボーナス・ペナルティ詳細
### Run1
- Bonus(5件):
  - [SIGNIFICANT-2] アクセストークン即時無効化不能（JTI無効化設計の欠如、認証・認可設計スコープ内）
  - [SIGNIFICANT-4] Stripe Webhook署名検証未記載（B02相当、偽イベントによる注文ステータス不正書き換えリスクを説明）
  - [MODERATE-4] テナント分離の単一防御線リスク（RLSによる二重防御提案、認証・認可設計スコープ内）
  - [MINOR-1] S3署名付きURLの有効期限7日（データ保護スコープ内の追加指摘）
  - [MINOR-2] JWT署名アルゴリズムの明示なし（認証・認可設計スコープ内）
- Penalty: なし

### Run2
- Bonus(4件):
  - [SIGNIFICANT-1] トークン即時無効化の欠如（JTI無効化設計の欠如、認証・認可設計スコープ内）
  - [SIGNIFICANT-3] Stripe Webhook署名検証未記載（B02相当、偽イベントによる注文ステータス不正書き換えリスクを説明）
  - [MINOR-1] 署名付きURLの有効期限7日（データ保護スコープ内の追加指摘）
  - [MINOR-2] KMSキーローテーション周期（データ保護・インフラスコープ内）
- Penalty: なし

## エラー分析（抽象的）

### Missed/Partial by Category
| Category | Problems | ○ | △ | × | Stability | Prompt Gap |
|----------|----------|---|---|---|-----------|------------|
| 入力検証・攻撃防御 | 2 | 1 | 0 | 1 | 高（両Run一致） | CSRF対策の評価軸が弱い。JWTのAuthorizationヘッダー依存型CSRF対策の十分性評価を誘導する視点が欠如している。 |
| 認証・認可設計 | 2 | 3 | 1 | 0 | 中（Run1で1件△） | 暗黙の前提による脆弱性（信頼境界の検証不足）の検出精度にばらつき。特定のヘッダー注入リスクのような「明示されていないが暗黙的に成立している前提」の検出が Run1 で不完全。 |

### Improvement Directions
- **入力検証・攻撃防御（CSRF）**: CSRF対策の評価を深化させる方向。既存の認証メカニズム（JWT等）に依存したCSRF対策の「十分性検証」を明示的に評価軸として追加する。JWTのみに依存するCSRF対策の根拠不十分性を指摘させるための誘導が必要。
- **認証・認可設計（暗黙的信頼境界）**: 「ゲートウェイ/プロキシが付与する内部ヘッダーを信頼する」設計パターンについて、バイパス経路の存在を明示的にチェックさせる評価軸の強化。ネットワーク分離の有無を確認するチェックポイントの追加。

### Strengths to Preserve
- **データ保護**: フィールドレベル暗号化設計の矛盾（全体暗号化の保護範囲限界）の検出が両Runで完全。TDE限界の論理アクセスへの無効性を具体的に説明できている。
- **インフラ・依存関係・監査**: シークレット管理の矛盾（Secrets Manager vs リポジトリ格納）、ライブラリバージョン問題、監査ログ分離問題の完全検出。具体的なパス名・バージョン番号への言及が正確。
- **脅威モデリング（DoS/Spoofing）**: 認証エンドポイントへのレート制限欠如をブルートフォース攻撃と結びつけて説明できている。
- **ボーナス検出**: スコープ内の追加問題（トークン無効化設計、Webhook署名検証、署名付きURL期限）を積極的に検出できており、depth-of-analysis が高い。
