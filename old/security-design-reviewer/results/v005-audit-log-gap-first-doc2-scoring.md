# 採点結果: v005-audit-log-gap-first (doc2)

## スコアサマリ
Run1=11.0(検出9.5+bonus3-penalty0), Run2=10.0(検出8.5+bonus3-penalty0)

## 検出マトリクス
| ID | カテゴリ | 深刻度 | Run1 | Run2 |
|----|---------|--------|------|------|
| P01 | 認証・認可設計 | 重大 | ○ | ○ |
| P02 | インフラ・依存関係・監査 | 重大 | ○ | ○ |
| P03 | 認証・認可設計 | 重大 | △ | △ |
| P04 | 入力検証・攻撃防御 | 中 | ○ | ○ |
| P05 | 入力検証・攻撃防御 | 中 | ○ | ○ |
| P06 | 脅威モデリング（DoS/Spoofing） | 中 | ○ | ○ |
| P07 | データ保護 | 中 | ○ | × |
| P08 | データ保護 | 軽微 | ○ | ○ |
| P09 | インフラ・依存関係・監査 | 軽微 | ○ | ○ |
| P10 | インフラ・依存関係・監査 | 軽微 | ○ | ○ |

## カテゴリ別検出率
| Category | Questions | Rate | Detail |
|----------|-----------|------|--------|
| 認証・認可設計 | 2 | 0.75 | P01:○○, P03:△△ |
| 入力検証・攻撃防御 | 2 | 1.00 | P04:○○, P05:○○ |
| 脅威モデリング | 1 | 1.00 | P06:○○ |
| データ保護 | 2 | 0.75 | P07:○×, P08:○○ |
| インフラ・依存関係・監査 | 3 | 1.00 | P02:○○, P09:○○, P10:○○ |

## ボーナス・ペナルティ詳細
### Run1
- Bonus: B02(Stripe Webhook署名検証欠如 +0.5), B03(注文APIのbuyer所有権検証欠如 +0.5), B05(S3アップロード後のMagic Bytes検証欠如 +0.5) = +1.5
- Penalty: なし

### Run2
- Bonus: B02(Stripe Webhook署名検証欠如 +0.5), B03(注文APIのbuyer所有権検証欠如 +0.5), B05(S3アップロード後のMagic Bytes検証欠如 +0.5) = +1.5
- Penalty: なし

## エラー分析（抽象的）

### Missed/Partial by Category
| Category | Problems | ○ | △ | × | Stability | Prompt Gap |
|----------|----------|---|---|---|-----------|------------|
| 認証・認可設計 | 2 | 2 | 2 | 0 | 高安定（両Run同△） | 外部からのヘッダー注入・内部サービスへの直接アクセス経路の評価指示が不足 |
| データ保護 | 2 | 3 | 0 | 1 | 低安定（Run間でP07が○↔×） | 各暗号化メカニズムの保護範囲と限界（何を守り何を守らないか）の評価指示が不足 |

### Improvement Directions
- **認証・認可設計**: 信頼境界の設計評価に「外部ヘッダー注入」「内部サービスへの直接アクセス経路の有無」を明示的にチェックする観点をプロンプトに追加する方向
- **データ保護（暗号化）**: 「暗号化の保護範囲の限界」を問う観点（ディスク暗号化 vs. 論理アクセスへの保護）をプロンプトに追加する方向。Run間でスコアが不安定なため、この観点を明示することで安定性も向上が見込まれる

### Strengths to Preserve
- **インフラ・依存関係・監査カテゴリ**: シークレット管理の矛盾・依存ライブラリの既知脆弱性・監査ログの混在設計を両Runで完全検出。設計書内の「宣言と実装の矛盾」「省略」を検出するプロンプト要素が有効に機能している
- **入力検証・攻撃防御カテゴリ**: CSRF/CORSの具体的な設計上の問題点（正規表現バイパス、単一レイヤー依存）を両Runで確実に検出。具体的な攻撃手法と設計の対応を問う観点が機能している
- **脅威モデリング（DoS/Spoofing）**: 認証エンドポイントのレート制限欠如を両Runで完全検出。認証関連のSTRIDE脅威チェックリストが有効に機能している
