# Round 005 Comparison Report: security-design-reviewer

## スコア比較テーブル

| Prompt | Mean | SD | cross_doc_gap | vs current-best |
|--------|------|----|---------------|-----------------|
| current-best (v004-input-finding-separation) | 11.625 | 0.41 | 0.25 | - |
| v005-audit-log-gap-first | 10.750 | 0.43 | 0.50 | -0.875pt |
| v005-cors-stance-principle | 10.625 | 1.14 | 1.75 | -1.000pt |

**スコア内訳:**
- v005-audit-log-gap-first: doc1(Run1=11.0, Run2=11.0) → doc1_mean=11.0; doc2(Run1=11.0, Run2=10.0) → doc2_mean=10.5
- v005-cors-stance-principle: doc1(Run1=10.0, Run2=9.5) → doc1_mean=9.75; doc2(Run1=10.5, Run2=12.5) → doc2_mean=11.5

---

## カテゴリ別検出率比較マトリクス

| Category | current-best | audit-log-gap-first | cors-stance-principle |
|----------|-------------|--------------------|-----------------------|
| 認証・認可設計 | 1.000 | 0.875 (-0.125) | 0.938 (-0.063) |
| データ保護 | 1.000 | 0.875 (-0.125) | 1.000 (±0) |
| 入力検証・攻撃防御 | 0.900 | 1.000 (+0.100) | 0.800 (-0.100) |
| 脅威モデリング | 1.000 | 1.000 (±0) | 1.000 (±0) |
| インフラ・依存関係・監査 | 0.900 | 1.000 (+0.100) | 0.850 (-0.050) |

**注記**: 回帰閾値 0.15 以上の低下を回帰と判定。いずれのカテゴリも閾値未満のため回帰なし。

### カテゴリ別検出率計算詳細

**v005-audit-log-gap-first:**
- 認証・認可設計: doc1(P01:○○, P02:○○)=4○; doc2(P01:○○, P03:△△)=2○+2△ → (4+2+0.5×2)/((2+2)×2) = 7/8 = 0.875
- データ保護: doc1(P03:○○, P04:○○)=4○; doc2(P07:○×, P08:○○)=3○+1× → (4+3)/((2+2)×2) = 7/8 = 0.875
- 入力検証・攻撃防御: doc1(P05:○○, P06:○○, P09:○○)=6○; doc2(P04:○○, P05:○○)=4○ → (6+4)/((3+2)×2) = 10/10 = 1.000
- 脅威モデリング: doc1(P07:○○)=2○; doc2(P06:○○)=2○ → (2+2)/((1+1)×2) = 4/4 = 1.000
- インフラ・依存関係・監査: doc1(P08:○○, P10:○○)=4○; doc2(P02:○○, P09:○○, P10:○○)=6○ → (4+6)/((2+3)×2) = 10/10 = 1.000

**v005-cors-stance-principle:**
- 認証・認可設計: doc1(P01:○○, P02:○○)=4○; doc2(P01:○○, P03:△○)=3○+1△ → (4+3+0.5×1)/((2+2)×2) = 7.5/8 = 0.938
- データ保護: doc1(P03:○○, P04:○○)=4○; doc2(P07:○○, P08:○○)=4○ → (4+4)/((2+2)×2) = 8/8 = 1.000
- 入力検証・攻撃防御: doc1(P05:○○, P06:○○, P09:××)=4○+2×; doc2(P04:○○, P05:○○)=4○ → (4+4)/((3+2)×2) = 8/10 = 0.800
- 脅威モデリング: doc1(P07:○○)=2○; doc2(P06:○○)=2○ → (2+2)/((1+1)×2) = 4/4 = 1.000
- インフラ・依存関係・監査: doc1(P08:○×, P10:○○)=3○+1×; doc2(P02:○○, P09:△○, P10:○○)=5○+1△ → (3+5+0.5×1)/((2+3)×2) = 8.5/10 = 0.850

---

## バリアント別分析

### v005-audit-log-gap-first

**変更内容と期待効果:**
- Change: Section 5にAudit Log Coverage Checkを追加し、セキュリティイベント記録要件の欠如を先行判定として確立
- Target: インフラ・依存関係・監査
- Rationale: Doc1-P08の問題（監査ログを肯定評価した後に補足として改善点を述べる構造）に対し、Output Guidelinesへの追加（R4: -0.125pt）が失敗したため、Section 5内に評価順序を明示する「先行判定ステップ」を埋め込む。チェックリスト再構成ではなく判定優先順位の明示化という異なるアプローチ。
- Predicted-regression: none

**実績スコアとカテゴリ別変化:**
- Mean=10.75 (SD=0.43), vs current-best -0.875pt
- 改善: 入力検証・攻撃防御 +0.100 (0.900→1.000), インフラ・依存関係・監査 +0.100 (0.900→1.000)
- 低下: 認証・認可設計 -0.125 (1.000→0.875), データ保護 -0.125 (1.000→0.875)

**回帰予測 vs 実際の回帰:**
- 予測: none
- 実際: 回帰なし（いずれの低下も 0.125 < 0.15 閾値）

**cross_doc_gap による汎化評価:**
- cross_doc_gap = 0.50pt（current-best 0.25pt より拡大）
- doc1では全カテゴリ完全検出（全問○）を達成したが、doc2では認証・認可設計（P03:△△）とデータ保護（P07:○×）に不安定性が残る
- cross_doc_gap < 1.5pt の閾値内であり過学習リスクは低い

**分析:**
- ターゲットのインフラ・依存関係・監査は改善（0.900→1.000）したが、doc1限定の効果が強い。doc2でも完全検出を達成しているが、これは構造変更の効果か元々の能力かの分離が難しい。
- 想定外の副作用として認証・認可設計とデータ保護の検出率が低下した。doc1では全問○を達成しているにも関わらず、doc2でのP03（認証・認可設計）とP07（データ保護）の検出が不安定になった。
- 全体スコアは current-best を -0.875pt 下回っており、推奨要件を満たさない。

---

### v005-cors-stance-principle

**変更内容と期待効果:**
- Change: Evaluation Stanceに「パターンベースのCORS設定を検出した場合、具体的な構文危険性（ワイルドカード・正規表現サフィックスマッチ等）を特定する」原則を追加
- Target: 入力検証・攻撃防御
- Rationale: Doc2-P05の問題（CORS設定の問題には言及するが具体的な正規表現バイパス手法への踏み込みが不足）に対し、R4のOutput Guidelinesへの追加（-0.500）が失敗したため、Evaluation Stance（「どう評価するか」の原則セクション）への1文追加というアプローチ。Section 4を変更しないため注意資源競合リスクが低い。
- Predicted-regression: none

**実績スコアとカテゴリ別変化:**
- Mean=10.625 (SD=1.14), vs current-best -1.000pt
- 改善: なし（全カテゴリ横ばいまたは低下）
- 低下: 入力検証・攻撃防御 -0.100 (0.900→0.800), 認証・認可設計 -0.063, インフラ・依存関係・監査 -0.050

**回帰予測 vs 実際の回帰:**
- 予測: none
- 実際: 回帰なし（最大低下は入力検証・攻撃防御 0.100 < 0.15 閾値）

**cross_doc_gap による汎化評価:**
- cross_doc_gap = 1.75pt（閾値 1.5pt を超過）
- doc1_mean=9.75 vs doc2_mean=11.5 という顕著な文書間差異が発生
- doc2ではRun2=12.5という突出したスコア（ボーナス5件上限達成）を記録したが、doc1ではP09（入力検証・攻撃防御）を両Runで未検出
- 汎化性能に問題あり。CORS原則の追加がdoc2のECプラットフォーム文書では有効だが、doc1の医療システム文書では逆効果（入力検証への注意資源を分散させた可能性）

**分析:**
- ターゲットのDoc2-P05（CORS正規表現バイパス）について、doc2での入力検証検出率は1.000を維持しているため、CORS具体化の改善効果は確認できない（元々P04:○○, P05:○○で検出済み）。
- 一方、doc1でP09（入力検証・攻撃防御・重大）が両Run未検出となった。Evaluation Stanceへの追加文がCORS評価への注意を向けたことで、医療システム文書の入力検証問題の検出が阻害された可能性がある。
- cross_doc_gap=1.75ptはバリアントとしての不安定性を示しており、推奨条件（cross_doc_gap < 1.5pt）を満たさない。

---

## リスク評価

### 過学習リスク
- **audit-log-gap-first**: doc1での全問○達成はターゲット文書への過適合リスクが低い（cross_doc_gap=0.50pt）。ただし認証・認可設計とデータ保護の全体的な低下は、Section 5への変更が注意資源を特定カテゴリへ集中させた副作用の可能性がある。
- **cors-stance-principle**: cross_doc_gap=1.75ptは明確な過学習/文書特異性を示す。CORS評価原則の追加がdoc2（ECプラットフォーム、CORS設定を明示的に含む）には有効だが、doc1（医療システム）への汎化に失敗している。

### 注意分散リスク
- **audit-log-gap-first**: Section 5に先行判定ステップを追加することで、インフラ・依存関係・監査への注意集中が強まり、認証・認可設計とデータ保護の検出率が低下した可能性が示唆される。ただし低下幅が小さく（0.125）、回帰閾値未満のため軽微。
- **cors-stance-principle**: Evaluation Stanceへの追加がCORS評価への注意を強め、特にdoc1でのP09（入力検証）未検出に繋がった可能性がある。これは「注意分散アンチパターン」が実際に発現した事例として記録すべき。

### 回帰リスク
- 両バリアントともに公式の回帰（0.15以上の低下）は発生していない。
- ただしcors-stance-principleの入力検証・攻撃防御低下（0.100）は、ターゲットカテゴリ自身が悪化したという逆効果パターンであり、設計アプローチの根本的な見直しが必要。

---

## 推奨判定と根拠

### 推奨: **current-best (v004-input-finding-separation)** を維持

### 判定根拠

**v005-audit-log-gap-first:**
- raw_mean_diff = 10.75 - 11.625 = **-0.875pt**
- 回帰なし → adjusted_diff = -0.875 - 0 = **-0.875pt**
- adjusted_diff < 0.5pt → **現在ベストを推奨**（scoring-rubric.md §4 推奨判定基準）

**v005-cors-stance-principle:**
- raw_mean_diff = 10.625 - 11.625 = **-1.000pt**
- 回帰なし → adjusted_diff = -1.000 - 0 = **-1.000pt**
- adjusted_diff < 0.5pt → **現在ベストを推奨**（scoring-rubric.md §4 推奨判定基準）

両バリアントともに現在ベストを下回っており、いずれも採用要件を満たさない。

---

## 考察

### 連続失敗パターンの分析

R4・R5（連続2ラウンド）ともに現在ベストを下回る結果となった。これは v004 のOutput Guidelines変更（「各防御レイヤーを独立したFindingとして報告する」+0.50pt）が天井効果に近い状態でスコア上限に達しており、追加の構造変更がむしろ干渉を生じさせていることを示唆する。

### 未達成の2つのエラーへのアプローチ再考

現在のエラー分析は以下の2問への改善を目標としている:
1. **Doc1-P08（インフラ・依存関係・監査・hard）**: audit-log-gap-first がdoc1での完全検出を達成したことは前進だが、全体スコアの改善には繋がらなかった。doc2での他カテゴリへの副作用が相殺している。
2. **Doc2-P05（入力検証・攻撃防御・medium）**: cors-stance-principleはターゲットカテゴリを改善できず、むしろdoc1での入力検証を悪化させた。

### 改善の方向性

R5の結果から以下が示唆される:
1. **単一セクション変更の限界**: Section 5への評価順序追加（audit-log-gap-first）はターゲット問題に有効だが、スコープを超えた副作用を制御しきれていない。Evaluation Stance追加（cors-stance-principle）はさらに広い影響範囲を持ち不安定性を増大させた。
2. **doc2-P03（認証・認可設計・hard）のブロッカー**: audit-log-gap-firstでdoc2の認証・認可設計が0.75（P03:△△）と低迷しており、これが全体スコアを引き下げている。P03は「外部ヘッダー注入・内部サービスへの直接アクセス経路」という高度な問題であり、現行プロンプトの信頼境界評価指示が不十分である可能性がある。
3. **天井への近接**: current-bestのSD=0.41で11.625という安定した高スコアを維持しており、1問あたりの改善余地が限定的。次ラウンドでは未解決エラー（doc1-P08, doc2-P05, doc2-P03）のうち最も改善確度の高い問題に絞り込んだアプローチを検討すべき。

---

## 収束判定

- R1: 改善幅 < 0.5pt（現在ベスト維持）
- R2: 改善幅 < 0.5pt（現在ベスト維持）
- R3: 改善幅 = +0.50pt（改善）← 連続カウントリセット
- R4: 改善幅 < 0.5pt（現在ベスト維持）
- R5: 改善幅 < 0.5pt（現在ベスト維持）

3ラウンド連続での改善幅 < 0.5pt という収束条件には R4+R5 の2ラウンドのみ該当（R3で連続が切れた）。

判定: **継続推奨**
