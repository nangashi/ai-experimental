# Round 3 Comparison Report: security-design-reviewer

Generated: 2026-02-18

---

## スコア比較テーブル

| Prompt | Mean | SD | cross_doc_gap | raw_mean_diff | adjusted_diff |
|--------|------|-----|---------------|--------------|---------------|
| v001-baseline (current best) | 11.125 | 0.41 | 0.25 | — | — |
| v004-input-finding-separation | 11.625 | 0.41 | 0.25 | +0.50 | +0.50 |
| v004-pii-logical-access | 10.875 | 1.14 | 2.25 | -0.25 | -0.775 |

---

## カテゴリ別検出率比較マトリクス

| Category | v001-baseline | v004-input-finding-separation | v004-pii-logical-access |
|----------|:---:|:---:|:---:|
| 認証・認可設計 | 1.000 | 1.000 (+0.000) | 0.9375 (-0.0625) |
| データ保護 | 0.875 | 1.000 (+0.125) | 1.000 (+0.125) |
| 入力検証・攻撃防御 | 0.800 | 0.900 (+0.100) | **0.600 (-0.200) [REGRESSION]** |
| 脅威モデリング | 1.000 | 1.000 (+0.000) | 1.000 (+0.000) |
| インフラ・依存関係・監査 | 1.000 | 0.900 (-0.100) | **0.850 (-0.150) [REGRESSION]** |

### 検出率計算詳細

**v004-input-finding-separation:**
- 認証・認可設計: doc1=(2q×2runs: ○○○○)=4/4=1.00, doc2=(2q×2runs: ○○○○)=4/4=1.00 → combined 8/8=1.000
- データ保護: doc1=(2q×2runs: 全○)=4/4=1.00, doc2=(2q×2runs: 全○)=4/4=1.00 → combined 8/8=1.000
- 入力検証・攻撃防御: doc1=(3q×2runs: 全○)=6/6=1.00, doc2=(2q×2runs: ○△○△)=3/4=0.75 → combined 9/10=0.900
- 脅威モデリング: doc1=2/2=1.00, doc2=2/2=1.00 → combined 4/4=1.000
- インフラ・依存関係・監査: doc1=(2q×2runs: △△○○)=3/4=0.75, doc2=(3q×2runs: 全○)=6/6=1.00 → combined 9/10=0.900

**v004-pii-logical-access:**
- 認証・認可設計: doc1=(2q×2runs: 全○)=4/4=1.00, doc2=(2q×2runs: ○△○○)=3.5/4=0.875 → combined 7.5/8=0.9375
- データ保護: doc1=(2q×2runs: 全○)=4/4=1.00, doc2=(2q×2runs: 全○)=4/4=1.00 → combined 8/8=1.000
- 入力検証・攻撃防御: doc1=(3q×2runs: P09=××)=4/6=0.667, doc2=(2q×2runs: P04=××)=2/4=0.500 → combined 6/10=0.600
- 脅威モデリング: doc1=2/2=1.00, doc2=2/2=1.00 → combined 4/4=1.000
- インフラ・依存関係・監査: doc1=(2q×2runs: P08=×△)=2.5/4=0.625, doc2=(3q×2runs: 全○)=6/6=1.00 → combined 8.5/10=0.850

---

## バリアント別分析

### v004-input-finding-separation

**変更内容と期待効果:**
- Change: Output Guidelinesに「各防御レイヤーは独立したFindingとして報告する」指示を追加
- Target: 入力検証・攻撃防御
- Rationale: P09（フロントエンド依存）とP04（JWT-only CSRF）は検出基準の追加では改善されなかった（R1/R2）。問題は「検出できているが独立した問題として分離報告されない」点にあると再解釈。出力段階での分離指示はチェックリスト変更と干渉せず、注意資源の競合も生じない。
- Predicted-regression: none

**実績スコアとカテゴリ別変化:**
- doc1: Run1=11.5, Run2=12.0 → doc1_mean=11.75
- doc2: Run1=12.0, Run2=11.0 → doc2_mean=11.5
- overall_mean=11.625, SD=0.41, cross_doc_gap=0.25
- vs current-best: raw_mean_diff=+0.50, adjusted_diff=+0.50
- カテゴリ変化:
  - 入力検証・攻撃防御: 0.800 → 0.900 (+0.100) — ターゲットカテゴリで改善
  - データ保護: 0.875 → 1.000 (+0.125) — 副次的改善
  - インフラ・依存関係・監査: 1.000 → 0.900 (-0.100) — 微低下だが回帰閾値(-0.15)未達のため回帰とは判定しない

**回帰予測 vs 実際:**
- 予測: none
- 実際: 回帰なし（全カテゴリで低下幅 < 0.15）

**cross_doc_gap評価:**
- cross_doc_gap=0.25pt。baseline(0.25)と同水準。doc1とdoc2で均一な性能を維持しており、汎化リスクなし。

**特記事項:**
- doc1でP09（フロントエンド依存・重大）が両Run○に改善（ベースラインではRun2で×）。出力層の分離指示がターゲット問題の独立検出に直接貢献している。
- doc2でP04（JWT-only CSRF）が引き続き△にとどまった点は残課題だが、doc1の完全検出により入力検証全体の検出率は向上した。
- ボーナス発見力はdoc1で4〜5件/Run、doc2で3〜5件/Runと高水準を維持。

---

### v004-pii-logical-access

**変更内容と期待効果:**
- Change: Data ProtectionセクションのEncryption Coverage Checklistの「At rest」項目に「ストレージ暗号化は論理的アクセスを保護しない」評価観点を追加
- Target: データ保護
- Rationale: P07（PIIを平文保存しRDS TDEで十分とする設計）はRun1×/Run2○の不安定パターン。R1でTDE限界記述を追加したが効果なし（+0.25, adj_diff<0.5）。今回はEncryption Coverage Checklistの「At rest」項目に評価観点を内包させ、チェックリスト構造を変えず文言追加のみで対応。
- Predicted-regression: none

**実績スコアとカテゴリ別変化:**
- doc1: Run1=9.5, Run2=10.0 → doc1_mean=9.75
- doc2: Run1=12.0, Run2=12.0 → doc2_mean=12.0
- overall_mean=10.875, SD=1.14, cross_doc_gap=2.25
- vs current-best: raw_mean_diff=-0.25, adjusted_diff=-0.775
- カテゴリ変化:
  - データ保護: 0.875 → 1.000 (+0.125) — ターゲットカテゴリは改善（P07がdoc2で両Run○に安定）
  - 入力検証・攻撃防御: 0.800 → 0.600 (-0.200) — **回帰**（閾値-0.15を超過）
  - インフラ・依存関係・監査: 1.000 → 0.850 (-0.150) — **回帰**（閾値-0.15に到達）
  - 認証・認可設計: 1.000 → 0.9375 (-0.0625) — 微低下、回帰未満

**回帰予測 vs 実際:**
- 予測: none
- 実際: 2カテゴリで回帰発生（予測と乖離）
  - 入力検証・攻撃防御(-0.20): doc1-P09（フロントエンド依存）が両Runで×、doc2-P04（JWT CSRF）が両Runで×
  - インフラ・依存関係・監査(-0.15): doc1-P08（セキュリティ監査ログ区別）がRun1×/Run2△と不安定

**cross_doc_gap評価:**
- cross_doc_gap=2.25pt（baseline 0.25ptから大幅拡大）。doc1_mean=9.75, doc2_mean=12.0と文書間で極端な性能差が生じており、過学習・汎化失敗のリスクが高い。doc2で高ボーナスを得ている一方、doc1で入力検証とインフラの主要問題を取りこぼしている。

**回帰加重差分の計算:**
```
adjusted_diff = -0.25 - 1.5 × (0.200 + 0.150)
              = -0.25 - 1.5 × 0.350
              = -0.25 - 0.525
              = -0.775
```

---

## リスク評価

### v004-input-finding-separation

| リスク種別 | 評価 | 詳細 |
|-----------|------|------|
| 過学習リスク | 低 | cross_doc_gap=0.25（baseline水準）。両文書で均一な改善。 |
| 注意分散リスク | 低 | 出力層への指示追加であり、評価基準本体への変更なし。インフラ検出率が-0.10低下しているが閾値未達。 |
| 回帰リスク | 低 | 全カテゴリの低下幅が0.15未満。回帰なし。 |

### v004-pii-logical-access

| リスク種別 | 評価 | 詳細 |
|-----------|------|------|
| 過学習リスク | 高 | cross_doc_gap=2.25pt（doc2偏重）。doc1での入力検証・インフラ検出の大幅低下が示す文書依存性。 |
| 注意分散リスク | 中 | At rest項目への観点追加がチェックリスト評価の重点配分を変化させ、入力検証の注意資源を圧迫した可能性。 |
| 回帰リスク | 高 | 入力検証(-0.20)・インフラ(-0.15)の2カテゴリで確定回帰。raw_mean_diffも負値(-0.25)。 |

---

## 推奨判定

**判定根拠:**

scoring-rubric.md の推奨判定基準に照合:

| バリアント | adjusted_diff | 回帰 | 適用ルール | 判定 |
|-----------|:---:|:---:|:---:|:---:|
| v004-input-finding-separation | +0.50 | なし | 0.5〜1.0pt AND 回帰なし → SDが小さい方を推奨 | **推奨** |
| v004-pii-logical-access | -0.775 | 2カテゴリ | 回帰あり → 現在ベストを推奨 | 非推奨 |

**v004-input-finding-separationについて:**
- adjusted_diff=+0.50は推奨閾値(≥0.5pt)に正確に到達
- SD=0.41（baseline同水準・高安定）
- cross_doc_gap=0.25（baseline同水準・汎化リスクなし）
- 回帰なし（全カテゴリ低下幅<0.15）
- ターゲットの入力検証・攻撃防御が0.800→0.900に改善し、doc1-P09（重大問題）の安定検出を達成
- scoring-rubric.mdのルール「adjusted_diff 0.5〜1.0pt AND 回帰なし → SDが小さい方を推奨」に該当。SD=0.41はbaseline SDと同値であり、他バリアント候補なし。

**v004-pii-logical-accessについて:**
- ターゲットのデータ保護では+0.125の改善を達成したが、入力検証(-0.20)・インフラ(-0.15)の2カテゴリで回帰が発生
- cross_doc_gap=2.25ptは極めて大きく、doc1への汎化失敗を示す
- adjusted_diff=-0.775により現在ベストに大きく劣る
- 「回帰あり（1カテゴリ以上）→ 現在ベストを推奨」ルールが適用される

**収束判定:**
- R1: 両バリアントともadjusted_diff<0.5（改善幅<0.5）
- R2: 両バリアントともadjusted_diff<0.5（改善幅<0.5）
- R3: v004-input-finding-separationのadjusted_diff=+0.50（≥0.5に到達）
- 3ラウンド連続で改善幅<0.5ptの条件を満たさない（R3で≥0.5に到達）→ **継続推奨**

---

## 推奨サマリ

```
recommended: v004-input-finding-separation
reason: adjusted_diff=+0.50（回帰なし）。scoring-rubric.mdのルール「0.5〜1.0pt AND 回帰なし → SDが小さい方を推奨」に該当。ターゲットの入力検証・攻撃防御が0.800→0.900に改善し、doc1-P09（バックエンド入力検証省略・重大）の完全検出を達成。SD=0.41（高安定）・cross_doc_gap=0.25（汎化リスクなし）。v004-pii-logical-accessは入力検証(-0.20)・インフラ(-0.15)の2カテゴリ回帰かつcross_doc_gap=2.25により非推奨。
adjusted_diff: +0.50pt
convergence: 継続推奨（R3で+0.50ptの改善があり3連続<0.5pt条件を満たさない）
scores: current-best=11.125(SD=0.41), v004-input-finding-separation=11.625(SD=0.41), v004-pii-logical-access=10.875(SD=1.14)
```

---

## 考察

### 成功要因の分析: v004-input-finding-separation

出力層への「防御レイヤー分離報告」指示は、R1/R2で試みた評価基準（チェックリスト）への追加と根本的に異なるアプローチであり、初めて効果を示した。

R1/R2の失敗パターン（チェックリスト追加）では、プロンプトが「何を評価すべきか」という検出基準を変えたが、モデルが複数の防御欠陥を1つのFindingに統合する出力習慣を変えるには至らなかった。今回の出力指示はまさにその統合習慣を直接制御した点で有効だった。

ただし、インフラ・依存関係・監査が0.900(-0.10)に微低下した点は注目に値する。doc1-P08（セキュリティ監査ログ区別）が引き続き△にとどまっており、次ラウンドの改善余地として残る。

### 次ラウンドの改善方向

現在の残存エラーパターン:
1. **入力検証・攻撃防御（残課題）**: doc2-P04（JWT-only CSRF対策の十分性評価）が△にとどまる。v004-input-finding-separationの分離報告ルールにより改善の可能性はあったが依然として部分検出。CORS正規表現バイパス（doc2）の踏み込み不足も継続。
2. **インフラ・依存関係・監査**: doc1-P08（セキュリティ監査ログと一般ログの区別、セキュリティイベント固有の記録要件）が高難易度問題として残存。

改善アプローチ案:
- 入力検証: JWTのAuthorizationヘッダー依存型CSRF対策の「十分性検証」を評価軸として明示（CSRF tokenやSameSite属性との比較基準）
- インフラ: セキュリティ監査ログの必須記録イベント（認証失敗・権限変更・機密データアクセス）をチェックリスト化し、一般ログとの区別を評価必須項目として明示

v004-pii-logical-accessの失敗から学ぶ教訓: Encryption Coverage Checklistへの文言追加（意図的にミニマルな変更）でも注意資源の配分が変化し、入力検証・インフラの検出に悪影響を及ぼした。評価基準の深化は単一カテゴリの改善でも他カテゴリの注意分散リスクを伴う。v004-input-finding-separationが示した「出力層制御」アプローチは評価基準を変えずに報告品質を向上させる低リスク手法として有効。
