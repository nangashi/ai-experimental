# 採点結果: v003-priority-queue

## スコアサマリ
Mean=9.7, SD=0.5
Run1=10.0(検出10.0+bonus0-penalty0), Run2=10.0(検出10.0+bonus0-penalty0), Run3=9.0(検出9.0+bonus0-penalty0)

## 検出マトリクス
| ID | カテゴリ | 深刻度 | Run1 | Run2 | Run3 |
|----|---------|--------|------|------|------|
| P01 | 認証・認可設計 | 重大 | ○ | ○ | ○ |
| P02 | 入力検証・攻撃防御 | 中 | × | × | × |
| P03 | 入力検証・攻撃防御 | 中 | △ | △ | × |
| P04 | 入力検証・攻撃防御 | 中 | △ | △ | △ |
| P05 | 脅威モデリング（Information Disclosure） | 中 | ○ | ○ | ○ |
| P06 | データ保護 | 重大 | ○ | ○ | ○ |
| P07 | データ保護 | 中 | × | × | × |
| P08 | データ保護 | 軽微 | × | × | × |
| P09 | データ保護 | 重大 | ○ | ○ | ○ |
| P10 | 脅威モデリング（Repudiation）、インフラ・依存関係・監査 | 中 | ○ | ○ | ○ |
| P11 | 認証・認可設計 | 重大 | ○ | ○ | ○ |
| P12 | インフラ・依存関係・監査 | 中 | ○ | ○ | △ |
| P13 | インフラ・依存関係・監査 | 軽微 | ○ | ○ | △ |
| P14 | 脅威モデリング（Tampering） | 軽微 | × | × | × |
| P15 | 入力検証・攻撃防御 | 軽微 | △ | △ | △ |

## ボーナス・ペナルティ詳細
### Run1
- Bonus: なし
- Penalty: なし

### Run2
- Bonus: なし
- Penalty: なし

### Run3
- Bonus: なし
- Penalty: なし

## エラー分析（抽象的）

### Missed/Partial by Category
| Category | Problems | ○ | △ | × | Stability | Prompt Gap |
|----------|----------|---|---|---|-----------|------------|
| 入力検証・攻撃防御 | 5 | 0 | 3 | 2 | 中 | CSRF対策（state-changing APIへの対策）とCORS設定の欠如が検出できていない。レート制限は部分検出のみ。プロンプトには「外部入力の検証方針」「インジェクション攻撃への対策」「CORS/オリジン制御」の記載があるが、CSRF対策とCORS設定の具体的な欠如を検出する指示が不足している。 |
| データ保護 | 4 | 2 | 0 | 2 | 高 | データ分類・保持期間方針（P07）と転送時の内部通信暗号化（P08）が未検出。プロンプトには「PII分類・保持期間・削除方針の設計」「機密データの保存・転送時の保護方式」の記載があるが、転送時暗号化については外部通信のみに焦点が当たっており、内部通信の暗号化欠如を検出する深度が不足。 |
| 脅威モデリング（Tampering） | 1 | 0 | 0 | 1 | 高 | データ完全性検証（P14）が未検出。プロンプトにはSTRIDE-T（改ざん）の記載があり「T=データ完全性検証」のチェック項目が明示されているが、診察記録の改ざん検知メカニズムの欠如を具体的に指摘する指示が不足している。 |
| インフラ・依存関係・監査 | 3 | 2 | 1 | 0 | 中 | シークレット管理（P12）と依存ライブラリの脆弱性管理（P13）はRun1/Run2で完全検出、Run3で部分検出。安定性は中程度。セキュリティ監査ログ（P10）は全Run完全検出。 |
| 認証・認可設計 | 2 | 2 | 0 | 0 | 高 | JWT localStorage保存（P01）とAPI認可チェック（P11）は全Run完全検出。強み。 |
| 脅威モデリング（Information Disclosure） | 1 | 1 | 0 | 0 | 高 | エラーメッセージの情報露出（P05）は全Run完全検出。強み。 |

### Improvement Directions
- **入力検証・攻撃防御**: CSRF対策（CSRFトークン、SameSite Cookie）とCORS設定（許可オリジン、ワイルドカード禁止）の具体的な欠如を検出する指示を追加する方向。認証エンドポイントのレート制限は部分検出できているが、ブルートフォース攻撃対策としての専用制限を強調する方向。
- **データ保護**: データ分類・保持期間方針（PII/PHI保持期間、削除ポリシー、プライバシー規制対応）の欠如を検出する深度を強化する方向。転送時の暗号化については、内部通信（バックエンド-DB間、マイクロサービス間）の暗号化欠如を明示的にチェックする指示を追加する方向。
- **脅威モデリング（Tampering）**: STRIDE-Tのデータ完全性検証チェック項目を、診察記録等の重要データの改ざん検知メカニズム（ハッシュ、デジタル署名、監査証跡）の具体的な欠如を指摘する指示に展開する方向。

### Strengths to Preserve
- **認証・認可設計**: JWT localStorage保存のXSS脆弱性とAPI認可チェック詳細の欠如を全Run完全検出。プロンプトの「認証フロー」「認可モデル」「APIアクセス制御」のチェック項目が有効。
- **脅威モデリング（Information Disclosure）**: エラーメッセージのスタックトレース露出を全Run完全検出。プロンプトの「データ分類・暗号化」のチェック項目が有効。
- **データ保護（暗号化）**: PII/PHIのログ出力（P06）と保存時暗号化（P09）を全Run完全検出。プロンプトの「機密データの保存・転送時の保護方式」「暗号化アルゴリズム、鍵管理」のチェック項目が有効。
- **インフラ・依存関係・監査**: セキュリティ監査ログ（P10）を全Run完全検出。プロンプトの「重要操作のセキュリティ監査ログ（認証失敗、権限変更、機密データアクセス等のセキュリティイベント記録）の設計」のチェック項目が非常に有効。
