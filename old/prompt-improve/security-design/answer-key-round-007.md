# 正解キー

## 実行条件
- **観点**: security
- **対象**: design
- **埋め込み問題数**: 9問

## 埋め込み問題一覧

### P01: JWTトークンのlocalStorage保存によるXSS脆弱性
- **カテゴリ**: 認証・認可設計
- **深刻度**: 重大
- **該当箇所**: セクション5「API設計」→「認証・認可方式」
- **問題の説明**: JWTトークンをlocalStorageに保存する設計は、XSS攻撃が成功した場合にトークンが盗まれるリスクが高い。localStorageはJavaScriptから容易にアクセス可能であり、HTTPOnlyクッキーに比べて脆弱である。
- **検出判定基準**:
  - ○（検出）: JWTトークンのlocalStorage保存がXSS脆弱性を生むこと、またはHTTPOnlyクッキーへの変更を推奨していることを明確に指摘している
  - △（部分検出）: JWTの保存方式に関するセキュリティリスクに言及しているが、具体的な対策（HTTPOnlyクッキー）に触れていない
  - ×（未検出）: 認証方式全般の問題には触れているが、トークン保存方式の脆弱性を指摘していない

### P02: プロジェクト削除APIにおける権限チェックの曖昧性
- **カテゴリ**: 認証・認可設計
- **深刻度**: 重大
- **該当箇所**: セクション5「API設計」→「プロジェクト管理」
- **問題の説明**: `DELETE /api/v1/projects/:id`の認可ルールが明示されていない。Organization roleベースとリソースごとのアクセスコントロールの両方が記載されているが、プロジェクト削除はどちらの権限で判定するのか、プロジェクトメンバー以外が削除できないかの仕様が不明確である。
- **検出判定基準**:
  - ○（検出）: プロジェクト削除などの重要操作における認可ルールが不明確であること、またはリソースレベルでの所有者チェックの必要性を明確に指摘している
  - △（部分検出）: 認可モデル全般の曖昧性や権限チェックの必要性に言及しているが、削除操作の具体例に触れていない
  - ×（未検出）: 認証・認可設計に触れているが、削除APIの権限チェックの曖昧性を指摘していない

### P03: ファイルアップロードにおけるファイル種別検証の欠如
- **カテゴリ**: 入力検証設計
- **深刻度**: 重大
- **該当箇所**: セクション5「API設計」→「ドキュメント管理」、セクション6「実装方針」→「セキュリティ要件」
- **問題の説明**: ドキュメントアップロードAPIでファイルサイズ制限（10MB）は記載されているが、ファイル種別（MIME type）の検証やマルウェアスキャンに関する記載がない。悪意のあるファイル（実行可能ファイル、スクリプト）のアップロードを防ぐ設計が欠如している。
- **検出判定基準**:
  - ○（検出）: ファイルアップロードにおけるMIME type検証、ホワイトリスト方式の必要性、またはマルウェアスキャンの欠如を明確に指摘している
  - △（部分検出）: ファイルアップロードのセキュリティリスク全般に言及しているが、具体的な検証手法（MIME type、ホワイトリスト）に触れていない
  - ×（未検出）: ファイル処理に関するセキュリティには触れているが、ファイル種別検証の欠如を指摘していない

### P04: S3バケットのアクセス制御方針が不明確
- **カテゴリ**: データ保護
- **深刻度**: 中
- **該当箇所**: セクション4「データモデル」→「Document」、セクション7「非機能要件」→「可用性・スケーラビリティ」
- **問題の説明**: ドキュメントファイルをS3に保存する設計だが、S3バケットのアクセス制御ポリシー（パブリックアクセス禁止、署名付きURL利用など）が明示されていない。プロジェクトvisibilityに応じたアクセス制御の実装方針も不明確である。
- **検出判定基準**:
  - ○（検出）: S3バケットのアクセス制御ポリシー（パブリックアクセス禁止、署名付きURL）の欠如、またはプロジェクトvisibilityに基づくアクセス制御の必要性を明確に指摘している
  - △（部分検出）: S3ストレージのセキュリティリスク全般に言及しているが、具体的なアクセス制御手法（署名付きURL、IAMポリシー）に触れていない
  - ×（未検出）: データ保護に触れているが、S3のアクセス制御方針の欠如を指摘していない

### P05: レート制限の具体的な設計が欠如
- **カテゴリ**: 脅威モデリング（DoS対策）
- **深刻度**: 中
- **該当箇所**: セクション3「アーキテクチャ設計」→「主要コンポーネントの責務」
- **問題の説明**: API Gatewayでレート制限を実装すると記載されているが、具体的なレート（リクエスト数/秒）、スロットリング方式（IPベース、ユーザーベース）、レート超過時のレスポンス形式が定義されていない。
- **検出判定基準**:
  - ○（検出）: レート制限の具体的な設計（リクエスト数/秒、スロットリング方式、ユーザー/IPベースの選定）が欠如していることを明確に指摘している
  - △（部分検出）: レート制限の必要性には言及しているが、具体的な設計要素（リクエスト数、スロットリング方式）に触れていない
  - ×（未検出）: DoS対策全般には触れているが、レート制限の具体設計の欠如を指摘していない

### P06: パスワードリセット機能の設計が存在しない
- **カテゴリ**: 認証・認可設計
- **深刻度**: 中
- **該当箇所**: セクション5「API設計」→「認証関連」
- **問題の説明**: 認証APIにlogin/logout/signupは定義されているが、パスワードリセット（forgot password）やメールアドレス検証のエンドポイントが存在しない。パスワードリセットフローがない場合、アカウント乗っ取りリスクが高まる。
- **検出判定基準**:
  - ○（検出）: パスワードリセット機能またはメールアドレス検証機能の欠如を明確に指摘している
  - △（部分検出）: 認証フロー全般の不足（MFA、アカウントロック等）に言及しているが、パスワードリセット機能の欠如を具体的に指摘していない
  - ×（未検出）: 認証設計に触れているが、パスワードリセット機能の欠如を指摘していない

### P07: 機密データの暗号化範囲が限定的
- **カテゴリ**: データ保護
- **深刻度**: 中
- **該当箇所**: セクション7「非機能要件」→「セキュリティ要件」
- **問題の説明**: パスワードのハッシュ化は明記されているが、データベース内の他の機密データ（ユーザーの個人情報、プロジェクトの機密ドキュメント）の暗号化（保存時暗号化: encryption at rest）に関する記載がない。HTTPS通信（転送時暗号化）のみでは不十分である。
- **検出判定基準**:
  - ○（検出）: データベース保存時の暗号化（encryption at rest）の欠如、またはパスワード以外の機密データ（個人情報、ドキュメント）の暗号化方針が不明確であることを明確に指摘している
  - △（部分検出）: 暗号化全般の必要性には言及しているが、保存時暗号化と転送時暗号化の区別、またはパスワード以外のデータの暗号化に触れていない
  - ×（未検出）: データ保護に触れているが、保存時暗号化の欠如を指摘していない

### P08: 外部サービス連携におけるOAuth2.0のスコープ管理方針が不明確
- **カテゴリ**: 認証・認可設計
- **深刻度**: 中
- **該当箇所**: セクション1「概要」→「主要機能の一覧」、セクション3「アーキテクチャ設計」→「外部連携サービス」
- **問題の説明**: Slack、GitHub、Google Workspaceとの連携にOAuth2.0を使用する記載があるが、取得するスコープの最小権限原則、トークンの保存方式、トークンリフレッシュ方針が定義されていない。過度な権限を要求するとプライバシーリスクが高まる。
- **検出判定基準**:
  - ○（検出）: OAuth2.0連携における最小権限原則（スコープの最小化）、トークン保存方式、またはトークンリフレッシュの必要性を明確に指摘している
  - △（部分検出）: OAuth2.0のセキュリティリスク全般には言及しているが、スコープ管理や最小権限原則に具体的に触れていない
  - ×（未検出）: 外部連携のセキュリティには触れているが、OAuth2.0のスコープ管理方針の欠如を指摘していない

### P09: 監査ログ（Audit Log）の設計が欠如
- **カテゴリ**: Repudiation（否認防止）
- **深刻度**: 軽微
- **該当箇所**: セクション6「実装方針」→「ロギング方針」
- **問題の説明**: ロギング方針にはAPI呼び出しや認証失敗のログは記載されているが、セキュリティ監査に必要な監査ログ（誰が、いつ、何をしたか）の設計が欠如している。特にプロジェクト削除、権限変更、機密ドキュメントアクセスなどの重要操作のログが定義されていない。
- **検出判定基準**:
  - ○（検出）: 監査ログ（Audit Log）の欠如、または重要操作（削除、権限変更、アクセス）のログ記録の必要性を明確に指摘している
  - △（部分検出）: ロギングの不足全般には言及しているが、監査ログや重要操作のログに具体的に触れていない
  - ×（未検出）: ロギング方針に触れているが、監査ログの欠如を指摘していない

## ボーナス問題リスト

正解キーに含めないが、検出された場合にボーナスとして加点する問題の候補:

| ID | カテゴリ | 内容 | ボーナス条件 |
|----|---------|------|------------|
| B01 | 認証・認可設計 | 多要素認証（MFA）の欠如 | MFAの必要性またはセキュリティ強化策としてMFAを推奨している |
| B02 | 認証・認可設計 | アカウントロックアウト機能の欠如 | ログイン試行回数制限やアカウントロックアウトの必要性を指摘している |
| B03 | データ保護 | データベース接続文字列やシークレットの管理方針が不明確 | AWS Secrets Manager、環境変数の暗号化、またはシークレット管理ツールの必要性を指摘している |
| B04 | 脅威モデリング | CSRF（Cross-Site Request Forgery）対策の欠如 | CSRFトークンやSameSite Cookie属性の必要性を指摘している |
| B05 | 入力検証設計 | APIのバリデーションエラー詳細の情報漏洩リスク | バリデーションエラーメッセージが詳細すぎることによる情報漏洩リスクを指摘している |
