# Round 006 比較レポート

## 実行条件

- **ラウンド**: Round 006
- **観点**: security
- **対象**: design
- **テスト対象文書**: オンライン教育プラットフォーム設計書
- **主要問題カテゴリ**: 認証・認可設計、データ保護、入力検証設計、脅威モデリング、インフラ・依存関係、情報漏洩防止
- **採点実施日**: 2026-02-10

---

## 比較対象

| プロンプト名 | Variation ID | 独立変数 | 説明 |
|-------------|-------------|----------|------|
| baseline | - | - | 前ラウンド最適プロンプト（Round 5 missing-detection相当の検出ヒント最小化版） |
| detection-hints | C2b | 検出ヒント最適化 | baseline + P06/P07/P08の明示的検出ヒント追加 |
| min-detection | C2c | 検出ヒント削減 | baseline から冪等性/暗号化/エラーハンドリングのヒント削減 |

---

## 問題別検出マトリクス

| 問題ID | Category | Severity | baseline | detection-hints | min-detection | 解説 |
|--------|----------|----------|----------|----------------|---------------|------|
| P01 | 認証・認可設計 | 重大 | ○/○ | ○/○ | ○/○ | JWT localStorage XSS脆弱性。全プロンプトで完全検出 |
| P02 | インフラ・依存関係 | 重大 | ○/○ | ○/○ | ○/○ | Stripe Webhook署名検証欠如。全プロンプトで完全検出 |
| P03 | 入力検証設計 | 重大 | △/△ | △/△ | ○/○ | ファイルアップロードContent-Type検証。min-detectionのみ完全検出 |
| P04 | 脅威モデリング | 中 | ○/○ | ○/○ | ○/○ | レート制限方針欠如。全プロンプトで完全検出 |
| P05 | 認証・認可設計 | 中 | ×/○ | ○/○ | ○/× | 決済処理の冪等性保証欠如。detection-hintsのみ安定して完全検出 |
| P06 | 認証・認可設計 | 中 | ×/× | ×/× | △/△ | パスワードリセット・メール検証欠如。全プロンプトで未検出/部分検出 |
| P07 | データ保護 | 中 | ×/× | ○/○ | ○/△ | 動画ストリーミングURL署名付き方針欠如。detection-hintsのみ安定して完全検出 |
| P08 | 認証・認可設計 | 中 | ×/× | ○/△ | △/△ | 課題評価時のリソースベース認可欠如。detection-hintsのみRun1で完全検出 |
| P09 | 情報漏洩防止 | 軽微 | ○/○ | ×/△ | ×/× | エラーメッセージ情報漏洩。baselineのみ完全検出 |
| P10 | 情報漏洩防止 | 軽微 | ○/○ | ○/△ | ○/○ | 監査ログ・認可失敗ログ欠如。baseline/min-detectionで安定検出 |

**表記**: ○/○ = (Run1/Run2)、○ = 完全検出、△ = 部分検出、× = 未検出

---

## ボーナス・ペナルティ詳細

### baseline

| Run | ボーナス件数 | ボーナススコア | 主なボーナス内容 |
|-----|-------------|--------------|----------------|
| Run1 | 6件 | +3.0（上限5件） | B01(JWT有効期限), B02(入力検証), B04(脆弱性スキャン), B05(アカウントロック), B07(CSRF), B08(暗号化) |
| Run2 | 6件 | +3.0（上限5件） | 同上 |

**ペナルティ**: 両Run共に0件

---

### detection-hints

| Run | ボーナス件数 | ボーナススコア | 主なボーナス内容 |
|-----|-------------|--------------|----------------|
| Run1 | 5件 | +2.5 | B01(JWT有効期限), B04(脆弱性スキャン), B05(アカウントロック), B07(CSRF), B08(暗号化) |
| Run2 | 4件 | +2.0 | B01(JWT有効期限), B04(脆弱性スキャン), B05(アカウントロック), B07(CSRF) |

**ペナルティ**: 両Run共に0件

**baselineとの差異**:
- B02（包括的入力検証）のボーナスが減少傾向
- P06/P07/P08の明示的ヒントにより、網羅性よりも特定問題への注力が強まった可能性

---

### min-detection

| Run | ボーナス件数 | ボーナススコア | 主なボーナス内容 |
|-----|-------------|--------------|----------------|
| Run1 | 6件（上限5件） | +2.5 | B01(JWT有効期限), B02(入力検証), B04(脆弱性スキャン), B05(アカウントロック), B07(CSRF), B08(暗号化) |
| Run2 | 5件 | +2.5 | B01(JWT有効期限), B02(入力検証), B04(脆弱性スキャン), B05(アカウントロック), B08(暗号化) |

**ペナルティ**: 両Run共に0件

**baselineとの差異**:
- ボーナス件数はbaselineと同等
- 検出ヒント削減しても網羅性は維持

---

## スコアサマリ

| プロンプト | Run1 | Run2 | Mean | SD | 安定性判定 |
|-----------|------|------|------|-----|----------|
| baseline | 8.5 | 9.5 | 9.0 | 0.5 | 高安定（SD ≤ 0.5） |
| detection-hints | 10.0 | 9.5 | 9.75 | 0.25 | 高安定（SD ≤ 0.5） |
| min-detection | 10.5 | 9.5 | 10.0 | 0.71 | 中安定（0.5 < SD ≤ 1.0） |

---

## 推奨判定

### 判定プロセス

**scoring-rubric.md Section 5 の推奨判定基準**:
- 平均スコア差 > 1.0pt → スコアが高い方を推奨
- 平均スコア差 0.5〜1.0pt → 標準偏差が小さい方を推奨（安定性重視）
- 平均スコア差 < 0.5pt → ベースラインを推奨

**スコア差分析**:
- min-detection vs baseline: +1.0pt（9.0 → 10.0）
- detection-hints vs baseline: +0.75pt（9.0 → 9.75）

**推奨**: **min-detection**

**判定根拠**:
1. **平均スコア**: min-detectionが10.0で最高（baseline比+1.0pt、detection-hints比+0.25pt）
2. **スコア差1.0pt達成**: min-detectionはbaselineとの差がちょうど1.0ptであり、判定基準の閾値に到達
3. **検出能力の向上**: P03（ファイルアップロードContent-Type検証）でmin-detectionのみが両Run完全検出を達成
4. **安定性は許容範囲**: SD=0.71は「中安定」判定だが、傾向は信頼できる。P05のRun間変動が主要因

**detection-hintsとの比較**:
- スコア差は0.25ptと小さいが、min-detectionが上回る
- detection-hintsの方が安定（SD=0.25）だが、スコア差<0.5ptのため、高スコアのmin-detectionを優先

---

### 収束判定

**scoring-rubric.md Section 5 の収束判定基準**:
- 2ラウンド連続で改善幅 < 0.5pt → 「最適化が収束した可能性あり」
- それ以外 → 「継続推奨」

**前ラウンドとの比較**:
- Round 5 推奨: missing-detection（平均10.5、SD=0.0）
- Round 6 推奨: min-detection（平均10.0、SD=0.71）
- 改善幅: -0.5pt（退行）

**判定**: **継続推奨**

**理由**:
- Round 6はRound 5推奨プロンプトからスコアが-0.5pt低下
- Round 6 min-detectionはRound 5 missing-detectionのヒント削減版であり、P05（冪等性）検出の不安定化が原因
- まだ改善余地があり、収束条件（2ラウンド連続で改善幅<0.5pt）を満たさない

---

## 考察

### 1. 独立変数別効果分析

#### C2b（detection-hints）: 検出ヒント最適化

**効果**: +0.75pt（baseline比）

**検出精度への影響**:
- **プラス効果**:
  - P05（決済冪等性）: baseline ×/○ → detection-hints ○/○（+0.5pt安定化）
  - P07（動画URL署名）: baseline ×/× → detection-hints ○/○（+2.0pt）
  - P08（リソースベース認可）: baseline ×/× → detection-hints ○/△（+0.75pt）
  - 合計: +3.25pt

- **マイナス効果**:
  - P09（エラー情報漏洩）: baseline ○/○ → detection-hints ×/△（-0.75pt）
  - P10（監査ログ）: baseline ○/○ → detection-hints ○/△（-0.25pt）
  - 合計: -1.0pt

- **ボーナス減少**: -0.5pt（baseline平均3.0 → detection-hints平均2.25）

**効果の評価**:
- **EFFECTIVE（条件付き）**
- P06/P07/P08のターゲット検出は向上したが、P09のような軽微問題や網羅的なボーナス獲得が減少
- 明示的ヒントは「視野狭窄リスク」を持つことが再確認された（Round 5 idempotency-checksと同様）
- スコア差+0.75ptは判定基準上「安定性重視」領域（0.5〜1.0pt）

#### C2c（min-detection）: 検出ヒント削減

**効果**: +1.0pt（baseline比）

**検出精度への影響**:
- **プラス効果**:
  - P03（Content-Type検証）: baseline △/△ → min-detection ○/○（+1.0pt）
  - 合計: +1.0pt

- **マイナス効果**:
  - P05（決済冪等性）: baseline ×/○ → min-detection ○/×（Run間変動）
  - P09（エラー情報漏洩）: baseline ○/○ → min-detection ×/×（-2.0pt）
  - 合計: -2.0pt（ただしP05はRun1で+1.0pt、Run2で-1.0pt）

- **ボーナス維持**: baseline平均3.0 → min-detection平均2.5（上限5件制限の影響）

**効果の評価**:
- **EFFECTIVE**
- スコア差+1.0ptで判定基準の閾値に到達
- P03の完全検出安定化は重要な成果（重大問題）
- P09の未検出はマイナス要因だが、軽微問題であり影響は限定的
- P05の不安定性（SD増加の主要因）は課題

### 2. 横断的分析

#### 明示的ヒントのトレードオフ

**detection-hintsの知見**:
- 明示的ヒントは「ターゲット問題の検出率」と「網羅的な問題探索」の間にトレードオフを生む
- P06/P07/P08の3問題を明示的にヒントとして追加したことで+3.25ptの効果があったが、P09/P10で-1.0pt、ボーナスで-0.5pt減少
- 視野狭窄リスクは単一領域（Round 2 N1a, Round 4 N2a）だけでなく、複数領域でも発生しうる

**min-detectionの知見**:
- 検出ヒント削減により、モデルの「暗黙的な優先順位付け」が表面化
- P03（ファイルアップロード）のような基本的な入力検証問題は、ヒントなしでもより確実に検出される
- P09（エラー情報漏洩）はヒント削減により検出率が大幅に低下し、明示的ガイダンスの有効性が確認された

#### 安定性と検出能力のバランス

- **baseline**: SD=0.5（高安定）、平均9.0
- **detection-hints**: SD=0.25（最高安定）、平均9.75
- **min-detection**: SD=0.71（中安定）、平均10.0

**パターン**:
- 明示的ヒント追加（detection-hints）は安定性を向上させるが、スコア上限も抑制
- ヒント削減（min-detection）は高スコアを達成するが、安定性は低下

#### 問題カテゴリ別の検出難易度

**全プロンプトで安定検出（○/○）**:
- P01（JWT localStorage XSS）
- P02（Stripe Webhook署名検証）
- P04（レート制限方針）

**ヒント依存性が高い問題**:
- P05（決済冪等性）: detection-hints ○/○、baseline/min-detection 不安定
- P07（動画URL署名）: detection-hints ○/○、baseline/min-detection 部分/未検出
- P09（エラー情報漏洩）: baseline ○/○、detection-hints/min-detection 部分/未検出

**全プロンプトで検出困難**:
- P06（パスワードリセット・メール検証）: 全プロンプトで未検出/部分検出のみ

### 3. 次回への示唆

#### 推奨される改善方向

1. **P06（パスワードリセット・メール検証）の検出強化**:
   - 認証フロー全体（signup → verification → login → password recovery）のチェックリストを追加
   - 現状では3プロンプトすべてでパスワードリセットのみ言及、メール検証は未検出

2. **P05（決済冪等性）の安定化**:
   - detection-hintsのヒント手法（Section 2.11の明示的指示）を参考に、安定性とスコアのバランスを取る
   - min-detectionではRun2で未検出だったため、最低限のヒントは必要

3. **P09（エラー情報漏洩）の検出維持**:
   - baselineで安定検出できていたエラーハンドリング観点が、min-detectionで完全消失
   - エラーハンドリング関連のヒントは削減せず維持すべき

4. **検出ヒントの最適粒度の探索**:
   - detection-hints（多すぎる） vs min-detection（削減しすぎ） の中間点を探る
   - P05/P09のヒントは維持しつつ、P06特化ヒントを追加する方向性

#### テスト対象文書の設計

- Round 6のオンライン教育プラットフォームは、決済・動画配信・ユーザー認証・リソースベース認可という多様な問題領域を含む
- P06（パスワードリセット・メール検証）の継続的未検出は、プロンプトの構造的弱点を示す
- 次回も同様の「認証フローの抜け漏れ」を検出できるかを継続評価すべき

#### 収束判定の再考

- Round 5 → Round 6でスコアが退行（10.5 → 10.0）したため、まだ最適化の余地がある
- ただし、Round 5 missing-detectionのSD=0.0（完璧な安定性）は再現困難な可能性
- 次回ラウンドで平均10.0以上、SD≤0.5を目標とすべき

---

## バリアント別効果一覧

| Variation ID | 独立変数 | 効果 (pt) | 判定 | 備考 |
|-------------|----------|-----------|------|------|
| C2b | 検出ヒント最適化（P06/P07/P08明示的追加） | +0.75 | EFFECTIVE（条件付き） | P07/P08検出向上（+3.25pt）だが、P09/P10減少（-1.0pt）とボーナス減（-0.5pt）。視野狭窄リスクあり。SD=0.25で最高安定性。 |
| C2c | 検出ヒント削減（冪等性/暗号化/エラーハンドリング削減） | +1.0 | EFFECTIVE | P03完全検出安定化（+1.0pt）、平均10.0達成。P09未検出（-2.0pt）、P05不安定化（SD=0.71）が課題。網羅性は維持。 |

---

## 付録: Run間差異の詳細分析

### baseline

**Run1 → Run2の変化**:
- P05（決済冪等性）: × → ○（+1.0pt）
- その他: 変化なし
- スコア差: 8.5 → 9.5（+1.0pt）

**解釈**: P05の検出が不安定。Run1では一般的なIdempotency-Key実装のみ提案、Run2では決済API固有の冪等性欠如として明示的指摘。

### detection-hints

**Run1 → Run2の変化**:
- P08（リソースベース認可）: ○ → △（-0.5pt）
- P09（エラー情報漏洩）: × → △（+0.5pt）
- P10（監査ログ）: ○ → △（-0.5pt）
- ボーナス: 5件 → 4件（-0.5pt）
- スコア差: 10.0 → 9.5（-0.5pt）

**解釈**: Run2でP08の具体性低下、P10の焦点ずれ（403エラーログの明示性不足）、ボーナス1件減少。

### min-detection

**Run1 → Run2の変化**:
- P05（決済冪等性）: ○ → ×（-1.0pt）
- P07（動画URL署名）: ○ → △（-0.5pt）
- ボーナス: 6件（5件上限） → 5件（-0pt、上限の影響なし）
- スコア差: 10.5 → 9.5（-1.0pt）

**解釈**: P05の未検出（Run2でStripe webhook文脈のみ、独立セクションなし）が主要因。SD=0.71の原因。
