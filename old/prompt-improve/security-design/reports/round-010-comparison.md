# Round 010 Comparison Report: security-design

## 実行条件

- **ラウンド**: Round 10
- **テスト対象文書**: 企業文書管理システム（9問題埋め込み: P01-P09）
- **比較対象プロンプト**:
  - `baseline` (現行プロンプト)
  - `v010-severity-anchor` (重大度階層化アプローチ)
  - `v010-free-table-hybrid` (自由形式出力+テーブル構造ハイブリッド)
- **評価実行**: 各プロンプト2回実行（Run1, Run2）
- **採点基準**: scoring-rubric.md Section 1-4 に基づく

---

## 問題別検出マトリクス

| Problem ID | Category | Severity | baseline | severity-anchor | free-table-hybrid |
|-----------|----------|----------|----------|-----------------|-------------------|
| P01 | 認証設計 | 重大 | ×/× (0%) | ○/× (50%) | ×/× (0%) |
| P02 | 認証設計 | 中 | ○/○ (100%) | ×/× (0%) | ○/○ (100%) |
| P03 | 認可設計 | 重大 | ○/○ (100%) | ○/○ (100%) | △/○ (75%) |
| P04 | 入力検証設計 | 中 | ○/○ (100%) | ○/○ (100%) | ○/○ (100%) |
| P05 | CSRF | 中 | ○/○ (100%) | ○/○ (100%) | ○/○ (100%) |
| P06 | データ保護 | 中 | △/× (25%) | ×/× (0%) | ○/○ (100%) |
| P07 | インフラ・依存関係 | 中 | ○/× (50%) | ×/× (0%) | ○/○ (100%) |
| P08 | データ保護 | 軽微 | ×/× (0%) | ×/× (0%) | ○/○ (100%) |
| P09 | データ保護 | 軽微 | △/○ (75%) | ×/○ (50%) | ○/× (50%) |

**検出率サマリ**:
- baseline: Run1=66.7%, Run2=55.6%, 平均=61.1%
- severity-anchor: Run1=55.6%, Run2=55.6%, 平均=55.6%
- free-table-hybrid: Run1=94.4%, Run2=88.9%, 平均=91.7%

---

## ボーナス/ペナルティ詳細

### Bonus検出状況

| Bonus ID | Category | baseline | severity-anchor | free-table-hybrid |
|----------|----------|----------|-----------------|-------------------|
| B01 | MFA設計の欠如 | ○/× | ×/○ | ×/× |
| B02 | エンドポイント別レート制限の欠如 | ○/× | ○/○ | ○/○ |
| B03 | 監査ログ設計の欠如 | ○/○ | ○/○ | ○/○ |
| B04 | セッション管理の不明確さ | ○/○ | △/△ | ○/○ |
| B05 | RDS/ElastiCacheの通信暗号化未記載 | ○/○ | △/○ | ○/○ |
| B06 | ライブラリ脆弱性スキャン方針の欠落 | ×/○ | ×/○ | ○/○ |
| B07 | PCI DSS要件の未言及 | ×/× | △/△ | ×/× |
| B08 | ファイルアップロード制限の欠落 | ×/○ | ×/× | ×/× |

**Bonus件数（上限5件）**:
- baseline: Run1=5件(+2.5), Run2=5件(+2.5)
- severity-anchor: Run1=7件→5件上限(+2.5), Run2=10件→5件上限(+2.5)
- free-table-hybrid: Run1=5件(+2.5), Run2=5件(+2.5)

### Penalty検出状況

- baseline: Run1=-0.5 (冪等性保証をCriticalとして過剰評価), Run2=0
- severity-anchor: Run1=0, Run2=0
- free-table-hybrid: Run1=0, Run2=0

---

## スコアサマリ

### 総合スコア

| Prompt | Run1 Detection | Run1 Bonus | Run1 Penalty | Run1 Total | Run2 Detection | Run2 Bonus | Run2 Penalty | Run2 Total | Mean | SD | Stability |
|--------|---------------|------------|-------------|-----------|---------------|------------|-------------|-----------|------|-----|-----------|
| baseline | 6.0 | +2.5 | -0.5 | **8.0** | 5.0 | +2.5 | 0 | **7.5** | **7.75** | **0.25** | 高安定 |
| severity-anchor | 5.0 | +2.5 | 0 | **7.5** | 5.0 | +2.5 | 0 | **7.5** | **7.5** | **0.0** | 高安定 |
| free-table-hybrid | 8.5 | +2.5 | 0 | **11.0** | 8.0 | +2.5 | 0 | **10.5** | **10.75** | **0.25** | 高安定 |

### スコア差分分析

- **free-table-hybrid vs baseline**: +3.0pt (10.75 vs 7.75) → **有意な改善**
- **severity-anchor vs baseline**: -0.25pt (7.5 vs 7.75) → 差<0.5ptのため有意差なし
- **free-table-hybrid vs severity-anchor**: +3.25pt (10.75 vs 7.5) → **有意な改善**

---

## 推奨判定

### 判定結果

**推奨プロンプト**: `free-table-hybrid`

**判定根拠**:
- 平均スコア差: +3.0pt (10.75 vs 7.75 baseline) → 1.0pt超の閾値を大幅に上回る
- 安定性: SD=0.25 → 高安定（SD ≤ 0.5）
- 検出能力: 平均91.7%の検出率（baseline 61.1%から+30.6pt向上）
- P06/P07/P08の完全検出を達成（baseline/severity-anchorでは0-50%検出率）

### 収束判定

**継続推奨**

Round 9（free-form）では+2.0pt改善（7.0→9.0）、Round 10（free-table-hybrid）では+3.0pt改善（7.75→10.75）を達成しており、改善幅は拡大傾向にある（0.5pt閾値を大幅に上回る）。インフラ系問題（P06/P07/P08）の検出突破により、さらなる最適化の余地が残されている。

---

## 考察

### 独立変数ごとの効果分析

#### 1. 重大度階層化（severity-anchor）の効果

**変更内容**:
- 重大度を3段階（Critical/Significant/Moderate）に分類
- 各レベルで「データベース直接検証」（設計書引用+欠落証明）を要求

**効果**: -0.25pt（有意差なし）、ただし完璧な安定性（SD=0.0）を達成

**詳細分析**:
- **正の効果**:
  - P01（JWT保存方式）Run1のみ検出（baseline/free-table-hybridでは0%）
  - Run2でボーナス10件検出（baseline 5件、上限適用後は同等）
  - 完璧な安定性（SD=0.0）
- **負の効果**:
  - P02（パスワードリセットトークン有効期限）両Run未検出（baseline 100%→0%、-1.0pt影響）
  - P06（Elasticsearch暗号化）両Run未検出（baseline 25%→0%）
  - P07（DB最小権限）両Run未検出（baseline 50%→0%）
  - P09（ログマスキング）不安定化（Run1未検出→Run2検出）
- **原因仮説**: 重大度フレームワークが「Critical優先」を強化し、中程度問題（P02/P06/P07）の検出優先度を低下させた可能性。Round 7での同アプローチ（+1.5pt）との相違は、問題セットの重大度分布に依存する可能性を示唆

**結論**: 重大度階層化は安定性を向上させるが、スコア向上効果は問題セット依存。中程度問題の検出低下リスクあり

#### 2. 自由形式出力+テーブル構造ハイブリッド（free-table-hybrid）の効果

**変更内容**:
- 重大度別自由形式出力（Critical/Significant/Moderate分離）
- インフラセキュリティ領域にテーブル構造評価を追加（各コンポーネント×評価軸のマトリクス）

**効果**: +3.0pt（大幅改善）、高安定性（SD=0.25）

**詳細分析**:
- **正の効果**:
  - P06（Elasticsearch暗号化）完全検出（baseline 25%→100%、+0.75pt）
  - P07（DB最小権限）完全検出（baseline 50%→100%、+0.5pt）
  - P08（JWTペイロード保護）完全検出（baseline 0%→100%、+1.0pt）
  - P03（認可チェック）Run2完全検出（baseline 100%維持、Run1は0.5だが平均75%）
  - 検出スコア: 8.5/8.0（平均8.25）vs baseline 6.0/5.0（平均5.5）→+2.75pt向上
- **負の効果**:
  - P01（JWT保存方式）両Run未検出（baseline同様0%）
  - P09（ログマスキング）不安定化（Run1検出→Run2未検出、baseline同様の不安定性）
- **原因仮説**:
  - テーブル構造がインフラコンポーネント（Elasticsearch/DB/JWT設計）の体系的カバレッジを促進
  - 自由形式出力がRound 9で示した「認知負荷軽減」効果を維持（P08検出向上）
  - P01未検出は「JWT保存方式」が認証設計とインフラ設計の境界領域にあり、どちらの構造にも明示的に含まれていない可能性

**結論**: 自由形式+テーブル構造ハイブリッドは、インフラ系問題の検出能力を大幅に向上させつつ、Round 9の認知負荷軽減効果を維持。最も効果的なアプローチ

### 問題カテゴリ別検出パターン

#### 認証設計（P01/P02）
- P01（JWT保存方式）: すべてのプロンプトで低検出率（0-50%）→ 明示的チェック項目の追加が必要
- P02（パスワードリセット有効期限）: baseline/free-table-hybridで100%検出、severity-anchorで0%検出→重大度フレームワークが中程度問題の検出を抑制

#### 認可設計（P03）
- baseline/severity-anchorで100%検出、free-table-hybridで75%検出→ 自由形式出力が若干の不安定性を導入（Run1: 0.5, Run2: 1.0）

#### データ保護（P06/P08/P09）
- P06（Elasticsearch暗号化）: free-table-hybridのみ100%検出（baseline 25%, severity-anchor 0%）→ テーブル構造の効果明確
- P08（JWTペイロード保護）: free-table-hybridのみ100%検出（baseline/severity-anchor 0%）→ 自由形式+テーブル構造の相乗効果
- P09（ログマスキング）: すべてのプロンプトで50-75%検出率→ 不安定性が共通

#### インフラ・依存関係（P07）
- free-table-hybridのみ100%検出（baseline 50%, severity-anchor 0%）→ テーブル構造によるインフラコンポーネントの体系的カバレッジ効果

### 次回への示唆

1. **JWT保存方式の明示的チェック項目追加**: P01は全プロンプトで低検出率（0-50%）を記録。認証設計セクションに「JWTのクライアント側保存方式（localStorage vs httpOnly cookie、XSS token theft防止）」を明示的チェック項目として追加すべき

2. **ログマスキング方針の検出安定化**: P09は全プロンプトで不安定（50-75%）。「ログ出力時のPII/機密情報マスキング方針」をデータ保護チェック項目として明示すべき

3. **自由形式+テーブル構造ハイブリッドの展開**: Round 10で+3.0pt改善を達成。この構造を他の観点（performance/consistency等）にも適用可能か検証すべき

4. **重大度階層化の適用条件明確化**: severity-anchorはRound 7で+1.5pt、Round 10で-0.25ptと問題セット依存の傾向。「重大度分布が偏っている問題セット」での適用を避けるべき

5. **認可設計の安定性改善**: P03はfree-table-hybridでRun間変動（0.5→1.0）を示した。認可チェックを明示的チェック項目として追加し、安定性を向上すべき

6. **ボーナス上限の影響評価**: severity-anchorはRun2で10件ボーナス検出（上限適用で5件）。ボーナス上限（5件）が検出努力のインセンティブを制限している可能性を次回検証すべき

---

## 結論

**Round 10推奨プロンプト**: `free-table-hybrid`（自由形式出力+テーブル構造ハイブリッド）

**主要改善点**:
- インフラ系問題（P06/P07/P08）の検出突破により+3.0pt改善
- テーブル構造によるインフラコンポーネントの体系的カバレッジ
- 自由形式出力による認知負荷軽減効果の維持
- 高安定性（SD=0.25）の達成

**継続課題**:
- JWT保存方式（P01）の検出率向上（0%）
- ログマスキング方針（P09）の検出安定化（50%）
- 認可設計（P03）のRun間変動削減（75%）

**次回方針**: free-table-hybridを baseline として、P01/P09の明示的チェック項目追加による検出率向上を試行
