# Security Architecture Review: Real Estate Rental Platform

## Score Summary Table

| Criterion | Score (1-5) | Main Reason |
|-----------|-------------|-------------|
| Threat Modeling (STRIDE) | 2 | Missing comprehensive threat analysis, especially for repudiation, tampering, and DoS scenarios in multi-party workflows |
| Authentication & Authorization Design | 2 | JWT stored in localStorage enables XSS-based token theft; missing session revocation, token rotation, and granular permission model |
| Data Protection | 2 | No encryption at rest specified for sensitive PII/financial data; missing data retention, deletion policies, and privacy controls |
| Input Validation Design | 2 | No input validation policy defined; missing injection prevention, file upload restrictions, and output escaping strategies |
| Infrastructure & Dependencies | 2 | Secrets management not specified; missing dependency vulnerability scanning, network security controls, and least-privilege IAM |
| **Overall** | **2.0** | Multiple critical gaps in security design across all categories requiring immediate attention |

## Findings Table (Severity-Priority Order)

| Severity | Issue | Impact | Recommended Countermeasures | Relevant Section |
|----------|-------|--------|----------------------------|------------------|
| Critical | JWT tokens stored in localStorage vulnerable to XSS attacks | If XSS vulnerability exists anywhere in React app, attackers can steal tokens and impersonate users, access sensitive tenant/owner data, approve fraudulent applications | Migrate to httpOnly secure SameSite cookies for token storage; implement token refresh mechanism with short-lived access tokens (5-15 min); consider HttpOnly cookie + CSRF token pattern | Section 5 (Authentication and Authorization) |
| Critical | No encryption at rest specified for highly sensitive PII | SSNs, background check results, payment history, and financial documents stored unencrypted in PostgreSQL/S3 could be exposed in breach scenarios | Enable encryption at rest: RDS encryption, S3 bucket encryption with KMS; implement application-layer field-level encryption for SSNs and sensitive PII using AWS KMS or similar | Section 2, 4 (Database, Data Model) |
| Critical | Missing input validation policy enables injection attacks | SQL injection via property search filters, XSS in property descriptions, command injection in maintenance requests could compromise database or execute malicious scripts | Define comprehensive input validation policy: parameterized queries/ORM for all DB access, HTML sanitization library (DOMPurify) for all user content, strict file type/size validation for uploads, input length limits | Section 5 (API Design), Section 6 (Implementation) |
| Critical | No session revocation mechanism | Compromised tokens remain valid for 24 hours with no way to invalidate; logout does not revoke server-side sessions | Implement server-side session tracking in Redis with unique session IDs; logout endpoint must invalidate session; add manual revocation API for compromised accounts; track active sessions per user | Section 5 (Authentication Endpoints) |
| Critical | Payment processing lacks idempotency guarantees | Duplicate payment submissions on network retry or user double-click could result in double-charging tenants | Implement idempotency keys for all payment operations: require client-generated UUID in request header, store processed keys in Redis with TTL, return cached response for duplicate requests; add Stripe idempotency key to prevent double-charges | Section 5 (Payment Endpoints) |
| Significant | Missing CSRF protection for state-changing operations | Application approval, payment processing, property deletion via forged requests from malicious sites | Implement CSRF tokens: generate per-session token, include in all forms and AJAX requests, validate server-side; configure SameSite=Strict/Lax cookie attribute for JWT if migrated to cookies | Section 5 (API Design) |
| Significant | No rate limiting specified for authentication endpoints | Brute-force attacks on /api/auth/login to crack passwords, account enumeration via registration endpoint | Implement stricter rate limiting for auth endpoints: 5 attempts per 15 minutes per IP for login, account lockout after 10 failed attempts, CAPTCHA after 3 failures; use Redis for distributed rate limiting | Section 7 (Security - API rate limiting) |
| Significant | Missing audit logging for sensitive operations | No traceability for application approvals, lease modifications, payment refunds, data access for compliance and fraud investigation | Implement comprehensive audit log: log all authentication events, application approvals/rejections, lease changes, payment transactions, admin actions with user ID, timestamp, IP, action details; store in immutable log storage (CloudWatch Logs with retention policy); enable log integrity verification | Section 6 (Logging) |
| Significant | No data retention and deletion policies defined | Violates GDPR/CCPA requirements; no mechanism for user data export or right-to-be-forgotten | Define data retention policy: specify retention periods for applications, background checks, payment records; implement automated deletion workflows; provide user data export API; design soft-delete with anonymization for referential integrity | Section 4 (Data Model) |
| Significant | Third-party API keys and secrets management not specified | Stripe, Checkr, DocuSign API keys hardcoded or in config files could be exposed in repository or logs | Store all secrets in AWS Secrets Manager or Parameter Store with encryption; use IAM roles for AWS SDK access; rotate API keys quarterly; implement secret rotation automation; never log secrets | Section 2 (Key Libraries) |
| Significant | Missing authorization for resource ownership validation | Horizontal privilege escalation: tenants could access other tenants' applications, owners could modify other owners' properties by guessing UUIDs | Implement ownership checks in every endpoint: verify requesting user owns the resource or has delegated access; for manager role, maintain explicit property-manager associations; log all access attempts | Section 5 (API Design - authorization note) |
| Significant | Background check results stored without access controls | Sensitive PII (SSN, criminal records, credit scores) accessible to any user with database access | Implement field-level access control: encrypt background check results separately, restrict decryption to authorized personnel only; implement access logging for all background check data retrieval; consider separate database with stricter controls | Section 4 (Applications table) |
| Moderate | JWT expiration too long (24 hours) | Increases attack window for stolen tokens | Reduce access token lifetime to 15 minutes; implement refresh token pattern with longer-lived refresh tokens (7 days) stored securely; require re-authentication for sensitive operations | Section 5 (Authentication and Authorization) |
| Moderate | No Content Security Policy (CSP) headers | Increases XSS attack surface by allowing inline scripts and external resources | Implement strict CSP headers: disallow inline scripts, whitelist trusted domains, enable nonce-based script execution; add X-Content-Type-Options, X-Frame-Options headers | Section 6 (Implementation Guidelines) |
| Moderate | File upload security not specified for property images/documents | Malicious file uploads could contain malware, XXE payloads, or executable scripts | Implement file upload restrictions: whitelist allowed MIME types (image/jpeg, image/png, application/pdf), scan uploads with antivirus, strip EXIF metadata, validate file signatures, enforce size limits (10MB max), use signed S3 URLs with expiration | Section 2 (AWS S3 storage) |
| Moderate | Error messages may leak sensitive information | Detailed validation errors and stack traces could reveal system internals to attackers | Implement error message sanitization: return generic errors to clients, log detailed errors server-side only; avoid exposing database schema, file paths, or library versions in responses | Section 6 (Error Handling) |
| Moderate | No specification for SQL injection prevention in search filters | Complex property search with multiple filters could be vulnerable if not using parameterized queries | Mandate ORM usage (Spring Data JPA) for all database access; explicitly prohibit string concatenation in queries; use named parameters for dynamic filters; implement query allowlisting for Elasticsearch | Section 5 (Property Endpoints - search) |
| Moderate | Missing security headers in API responses | Lack of security headers increases attack surface | Add security headers to all responses: Strict-Transport-Security, X-Content-Type-Options: nosniff, X-Frame-Options: DENY, Referrer-Policy: strict-origin-when-cross-origin | Section 5 (API Design) |
| Moderate | No mechanism for detecting duplicate application submissions | Tenants could spam applications to same property, causing notification flooding and workflow confusion | Implement duplicate detection: unique constraint on (property_id, tenant_id, status='pending'), reject new applications if pending exists; add idempotency check for application creation | Section 5 (Application Endpoints) |
| Moderate | Redis cache security not specified | Unencrypted Redis could expose session data and rate limiting state | Enable Redis AUTH, use TLS for Redis connections, enable encryption at rest if supported; isolate Redis in private subnet with security group restrictions | Section 2 (Cache: Redis) |
| Moderate | Missing specification for password complexity requirements | Weak passwords could be brute-forced | Define password policy: minimum 12 characters, require mix of uppercase, lowercase, numbers, symbols; implement password strength meter; block common passwords using breach database; enforce password change on first login | Section 4 (Users table - password_hash) |
| Moderate | No API versioning strategy | Breaking changes to API could break existing mobile apps without graceful degradation | Implement API versioning in URL path (/api/v1/properties) or header; maintain backward compatibility for at least 2 versions; provide deprecation timeline for old versions | Section 5 (API Design) |
| Minor | Database backup encryption not specified | Backup exposure could leak all historical data | Ensure RDS backups are encrypted; enable S3 backup bucket encryption; restrict backup access to DBA role only; test backup restoration regularly | Section 7 (Availability - database backups) |
| Minor | No specification for TLS certificate management | Expired certificates could cause service outage | Use AWS Certificate Manager for automatic renewal; configure expiration alerts 30 days before expiry; implement certificate pinning for mobile apps | Section 7 (Security - HTTPS/TLS) |
| Minor | Monitoring alerts for security events not specified | Delayed detection of attacks or breaches | Configure CloudWatch alerts for: repeated authentication failures, unusual API access patterns, admin privilege usage, database connection spikes, error rate increases | Section 2 (Monitoring) |
| Minor | No specification for secure session timeout | Long sessions increase risk from unattended devices | Implement absolute session timeout (24h) and idle timeout (30 minutes); require re-authentication for sensitive operations even within valid session | Section 5 (Authentication) |
| Minor | Missing environment separation for secrets | Production secrets could be exposed in staging/dev environments | Implement strict environment separation: separate AWS accounts or strict IAM policies for each environment; use different API keys for each environment; audit cross-environment access | Section 6 (Deployment - environment configuration) |

## Positive Evaluation Table

| Aspect | Evaluation |
|--------|------------|
| HTTPS/TLS enforcement | All data transmission over HTTPS with TLS 1.3 provides strong encryption in transit and prevents man-in-the-middle attacks |
| Password hashing | bcrypt with cost factor 12 is industry best practice, provides strong protection against rainbow table and brute-force attacks on password hashes |
| PCI-DSS compliance via Stripe | Payment card data handled exclusively by Stripe eliminates direct PCI-DSS compliance burden and reduces attack surface for card data theft |
| Sensitive data exclusion from logs | Explicit policy to exclude passwords, tokens, SSNs from logs prevents accidental exposure via log access |
| API rate limiting | 100 requests/minute per IP provides baseline DoS protection and prevents resource exhaustion attacks |
| Security testing integration | OWASP ZAP in testing pipeline enables automated vulnerability detection before production deployment |
| Role-based access control framework | Enumerated user roles (tenant, owner, manager, admin) provides foundation for least-privilege access control |
