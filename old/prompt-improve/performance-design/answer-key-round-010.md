# 正解キー

## 実行条件
- **観点**: performance
- **対象**: design
- **埋め込み問題数**: 10問

## 埋め込み問題一覧

### P01: NFR要件/SLAの未定義
- **カテゴリ**: レイテンシ・スループット設計（パフォーマンス要件/SLA定義）
- **深刻度**: 重大
- **該当箇所**: セクション7（非機能要件）
- **問題の説明**: パフォーマンス目標は記載されているが、実際のSLA（Service Level Agreement）定義、負荷条件下の具体的なスループット目標（秒間翻訳リクエスト数、同時WebSocket接続数上限）、ピーク時のレスポンスタイム保証が未定義。"翻訳レスポンスタイム平均500ms"は平時の目標であり、高負荷時の性能保証がない。
- **検出判定基準**:
  - ○（検出）: SLA定義の欠如、またはスループット目標（翻訳リクエスト数/秒、同時接続上限）の未定義を指摘している
  - △（部分検出）: パフォーマンス要件が曖昧であることに触れているが、SLA/スループット目標の具体的な欠如には言及していない
  - ×（未検出）: パフォーマンス要件に関する指摘がない

### P02: 翻訳履歴取得のN+1問題
- **カテゴリ**: I/O・ネットワーク効率（N+1問題）
- **深刻度**: 重大
- **該当箇所**: セクション5（API設計）、セクション4（データモデル）
- **問題の説明**: `GET /api/sessions/{id}/history` APIは TranslationHistory テーブルから履歴を取得するが、各レコードの speaker_id に対応する User 情報（名前、プロフィール画像等）を取得する際に N+1 クエリが発生する可能性が高い。セッション中に数百〜数千の翻訳が発生するため、深刻なパフォーマンス問題となる。
- **検出判定基準**:
  - ○（検出）: 翻訳履歴取得時のN+1問題を明示的に指摘している（User情報の結合漏れ、複数クエリ発行による非効率性）
  - △（部分検出）: データ取得の非効率性に触れているが、N+1問題の具体的なパターンには言及していない
  - ×（未検出）: 翻訳履歴取得に関するパフォーマンス問題の指摘がない

### P03: 翻訳結果キャッシュ戦略の不明瞭さ
- **カテゴリ**: キャッシュ・メモリ管理（キャッシュ対象の選定、有効期限、無効化戦略）
- **深刻度**: 重大
- **該当箇所**: セクション3（アーキテクチャ設計 - Translation Service）
- **問題の説明**: "翻訳結果のキャッシング"と記載されているが、キャッシュキーの設計（原文+言語ペア）、TTL設定、キャッシュ無効化条件（カスタム用語集更新時等）が未定義。同一セッション内で同じフレーズが繰り返される場合のキャッシュヒット戦略、カスタム用語集変更時のキャッシュ整合性確保が不明確。
- **検出判定基準**:
  - ○（検出）: キャッシュ戦略の詳細（キャッシュキー設計、TTL、無効化条件、用語集更新時の整合性）の不明瞭さを指摘している
  - △（部分検出）: キャッシュの活用に言及しているが、戦略の詳細化が必要であることには触れていない
  - ×（未検出）: キャッシュ戦略に関する指摘がない

### P04: セッション履歴検索の無制限クエリ
- **カテゴリ**: I/O・ネットワーク効率（バッチ処理設計）
- **深刻度**: 中
- **該当箇所**: セクション5（API設計 - `GET /api/sessions/{id}/history`）
- **問題の説明**: 翻訳履歴取得APIにページネーション、件数制限、期間フィルタの仕様が記載されていない。長時間セッション（8時間会議等）では数千〜数万の翻訳レコードが存在し、全量取得は非現実的。Elasticsearch検索も無制限クエリではタイムアウトリスクがある。
- **検出判定基準**:
  - ○（検出）: 翻訳履歴APIのページネーション欠如、または無制限クエリのリスクを指摘している
  - △（部分検出）: データ量に関する懸念に触れているが、ページネーション必須性には言及していない
  - ×（未検出）: 翻訳履歴取得のパフォーマンス問題に関する指摘がない

### P05: Google Translation API呼び出しのバッチ処理欠如
- **カテゴリ**: I/O・ネットワーク効率（API呼び出しの効率）
- **深刻度**: 中
- **該当箇所**: セクション3（データフロー - チャット翻訳フロー）
- **問題の説明**: チャット翻訳で「各参加者の言語に翻訳」とあるが、参加者ごとに個別のAPI呼び出しを実施する設計。Google Translation API v3はバッチ翻訳をサポートしており、複数言語への翻訳を1リクエストにまとめることで、ネットワークオーバーヘッド削減、レイテンシ改善、コスト削減が可能。多国籍会議（10言語 × 20参加者）では顕著な差が出る。
- **検出判定基準**:
  - ○（検出）: Google Translation APIのバッチ呼び出し活用の欠如、または個別API呼び出しによる非効率性を指摘している
  - △（部分検出）: API呼び出しの効率化に言及しているが、バッチ処理の具体的な適用には触れていない
  - ×（未検出）: Translation API呼び出しに関する効率性の指摘がない

### P06: 翻訳履歴データの長期増大対策欠如
- **カテゴリ**: キャッシュ・メモリ管理（データライフサイクル）
- **深刻度**: 中
- **該当箇所**: セクション4（データモデル - TranslationHistory テーブル）、セクション7（非機能要件 - セキュリティ要件）
- **問題の説明**: TranslationHistory テーブルは BIGSERIAL で無制限に増加する設計。「翻訳履歴は30日間保持」とあるが、データ削除・アーカイブ戦略、パーティショニング設計が未記載。リアルタイム翻訳サービスでは1日数百万レコードが生成される可能性があり、検索パフォーマンス劣化、ストレージコスト増大のリスクがある。
- **検出判定基準**:
  - ○（検出）: 翻訳履歴の長期増大に対するアーカイブ戦略、パーティショニング、または自動削除設計の欠如を指摘している
  - △（部分検出）: データ量増加への懸念に触れているが、具体的な対策（パーティショニング、アーカイブ）には言及していない
  - ×（未検出）: 翻訳履歴データの長期管理に関する指摘がない

### P07: TranslationHistory テーブルのインデックス設計欠如
- **カテゴリ**: レイテンシ・スループット設計（インデックス設計）
- **深刻度**: 中
- **該当箇所**: セクション4（データモデル - TranslationHistory テーブル）
- **問題の説明**: TranslationHistory テーブルで頻繁にクエリされる session_id、speaker_id、translated_at にインデックスが明示されていない。翻訳履歴検索（セッション別、発言者別、期間別）で全件スキャンが発生し、レスポンスタイム劣化のリスクがある。
- **検出判定基準**:
  - ○（検出）: TranslationHistory テーブルの session_id、speaker_id、translated_at へのインデックス追加必須性を指摘している
  - △（部分検出）: インデックスの重要性に言及しているが、具体的なカラムには触れていない
  - ×（未検出）: インデックス設計に関する指摘がない

### P08: WebSocket接続数のスケーラビリティ制約
- **カテゴリ**: スケーラビリティ設計（水平/垂直スケーリング方針）
- **深刻度**: 中
- **該当箇所**: セクション3（アーキテクチャ設計 - Session Management Service）、セクション7（非機能要件 - 可用性・スケーラビリティ）
- **問題の説明**: "セッション同時接続数: 1,000セッション対応"とあるが、WebSocket接続管理のスケーラビリティ設計（水平スケーリング時のセッション共有、ステートフル/ステートレス設計、ロードバランサー設定）が未記載。単一サーバーでのWebSocket接続数上限（通常1万接続程度）を超える場合の対処方針がない。
- **検出判定基準**:
  - ○（検出）: WebSocket接続の水平スケーリング設計、またはステートフル/ステートレス設計の欠如を指摘している
  - △（部分検出）: WebSocketのスケーラビリティに懸念を示しているが、具体的な設計要素には触れていない
  - ×（未検出）: WebSocket接続管理のスケーラビリティに関する指摘がない

### P09: 用語集取得の競合状態とキャッシュ整合性
- **カテゴリ**: キャッシュ・メモリ管理（無効化戦略）、レイテンシ・スループット設計（並列化）
- **深刻度**: 軽微
- **該当箇所**: セクション3（Translation Service）、セクション5（API設計 - 用語集管理）
- **問題の説明**: カスタム用語集は `GET /api/glossaries/{org_id}` で取得され、Translation Serviceに適用されるが、用語集更新（`PUT /api/glossaries/{id}`）とキャッシュ無効化のタイミングが未定義。複数の翻訳リクエストが並行実行される際、古い用語集がキャッシュから適用される競合状態が発生しうる。整合性保証の設計（キャッシュバージョニング、更新通知）が必要。
- **検出判定基準**:
  - ○（検出）: 用語集更新時のキャッシュ整合性問題、または競合状態（古い用語集の適用リスク）を指摘している
  - △（部分検出）: 用語集のキャッシュ管理に触れているが、競合状態や整合性保証には言及していない
  - ×（未検出）: 用語集のキャッシュ整合性に関する指摘がない

### P10: パフォーマンスメトリクス収集設計の欠如
- **カテゴリ**: レイテンシ・スループット設計（パフォーマンス要件/SLA定義）
- **深刻度**: 軽微
- **該当箇所**: セクション6（実装方針 - ロギング方針）
- **問題の説明**: ロギング方針に「翻訳リクエスト・レスポンスの全量ロギング」とあるが、パフォーマンス固有のメトリクス収集設計（翻訳レスポンスタイム、API呼び出しレイテンシ、WebSocket接続確立時間、同時接続数、スループット）が未記載。パフォーマンス目標達成の検証、ボトルネック特定に必要な観測可能性が不足。
- **検出判定基準**:
  - ○（検出）: パフォーマンスメトリクス（レスポンスタイム、スループット、接続数等）の収集設計欠如を指摘している
  - △（部分検出）: 監視の重要性に触れているが、パフォーマンス固有のメトリクスには言及していない
  - ×（未検出）: パフォーマンス監視に関する指摘がない

## ボーナス問題リスト

正解キーに含めないが、検出された場合にボーナスとして加点する問題の候補:

| ID | カテゴリ | 内容 | ボーナス条件 |
|----|---------|------|------------|
| B01 | API呼び出し効率 | Google Translation API のコネクションプール設計の欠如 | API連携におけるコネクションプール、接続再利用の必要性を指摘 |
| B02 | 非同期処理 | ドキュメント翻訳の非同期ジョブキュー設計の欠如 | 大容量ドキュメント翻訳を非同期処理すべきことを指摘 |
| B03 | CDN活用 | 静的アセット（フロントエンドバンドル、音声ファイル）のCDN配信戦略詳細化 | CDNキャッシュ戦略、エッジロケーション配置の最適化を指摘 |
| B04 | メモリ管理 | WebSocket接続のメモリリーク防止設計の欠如 | 長時間接続におけるメモリ管理、リソース解放の必要性を指摘 |
| B05 | レート制限 | Translation APIレート制限対策（バックプレッシャー、キューイング） | APIレート制限超過時の処理戦略欠如を指摘 |
| B06 | データベース分離 | 読み取り負荷の高い翻訳履歴検索用のリードレプリカ設計 | 読み書き分離、リードレプリカ活用の必要性を指摘 |
| B07 | 圧縮 | WebSocketメッセージの圧縮（Gzip、Brotli）設計 | リアルタイム通信のペイロードサイズ削減を指摘 |
| B08 | ウォームアップ | Cold Start対策（コネクションプール事前確立、キャッシュウォームアップ） | サービス起動時のパフォーマンス劣化防止を指摘 |
| B09 | バックオフ戦略 | Translation API失敗時のエクスポネンシャルバックオフの詳細化 | リトライ戦略の最適化（ジッター追加、最大リトライ時間）を指摘 |
| B10 | ロック戦略 | 同一セッションへの同時書き込みにおける楽観的ロック/悲観的ロック設計 | 並行更新の競合制御戦略を指摘 |
