# 正解キー

## 実行条件
- **観点**: performance
- **対象**: design
- **埋め込み問題数**: 9問

## 埋め込み問題一覧

### P01: パフォーマンス要件/SLA未定義
- **カテゴリ**: レイテンシ・スループット設計（パフォーマンス要件/SLA定義）
- **深刻度**: 重大
- **該当箇所**: セクション7 非機能要件
- **問題の説明**: ダッシュボードのレスポンスタイム目標、レポート生成時間上限、データ同期遅延許容値等の具体的なパフォーマンス目標値が定義されていない。非機能要件セクションにセキュリティ・可用性の記載はあるがパフォーマンス固有のSLA（レスポンスタイム、スループット等）が欠如している。
- **検出判定基準**:
  - ○（検出）: パフォーマンス目標値（レスポンスタイム、スループット、レイテンシ等の数値目標）の未定義を指摘している、またはSLA/NFRの具体性欠如を指摘している
  - △（部分検出）: 非機能要件セクションの記載が不十分と指摘しているが、パフォーマンス固有の目標値・SLAに言及していない
  - ×（未検出）: 指摘なし

### P02: ダッシュボードエンドポイントのN+1クエリ問題
- **カテゴリ**: I/O・ネットワーク効率（N+1問題）
- **深刻度**: 重大
- **該当箇所**: セクション5 API設計 - GET /api/dashboard/overview
- **問題の説明**: 実装説明で「fetches all user accounts from database, then retrieves post statistics for each account in a loop」と記載されており、アカウント数に比例したクエリ発行（N+1問題）が発生する設計。複数アカウント管理が主要ユースケースであるため深刻なパフォーマンス劣化を引き起こす。
- **検出判定基準**:
  - ○（検出）: ダッシュボードエンドポイントのループクエリ/N+1問題を指摘し、JOIN/集約クエリ/バッチ処理等の解決策に言及している
  - △（部分検出）: ダッシュボードエンドポイントのクエリ効率に言及しているが、N+1問題の具体的パターンまたは解決策に触れていない
  - ×（未検出）: 指摘なし

### P03: キャッシュ戦略の不明瞭さ
- **カテゴリ**: キャッシュ・メモリ管理（キャッシュ対象選定、無効化戦略）
- **深刻度**: 重大
- **該当箇所**: セクション6 実装方針 - キャッシュ戦略
- **問題の説明**: Redisが技術スタックに含まれているが、キャッシュ戦略がセッションとレート制限のみに限定されている。頻繁にアクセスされるダッシュボード集計データ、トレンドハッシュタグ分析結果、レポートデータ等の計算コストが高いデータに対するキャッシュ戦略が定義されていない。無効化戦略（データ同期時のキャッシュ更新）も未定義。
- **検出判定基準**:
  - ○（検出）: ダッシュボード集計/分析結果のキャッシュ不足を指摘し、キャッシュ対象の拡張（集計データ、トレンド分析等）およびキャッシュ無効化戦略（データ同期時の更新等）に言及している
  - △（部分検出）: キャッシュ戦略の拡張に言及しているが、具体的なキャッシュ対象（集計/分析結果）またはキャッシュ無効化戦略に触れていない
  - ×（未検出）: 指摘なし

### P04: レポート生成の同期処理とクエリ効率
- **カテゴリ**: レイテンシ・スループット設計（非同期処理）
- **深刻度**: 中
- **該当箇所**: セクション6 実装方針 - レポート生成
- **問題の説明**: レポート生成が同期処理で実装されており、大量データのクエリと集計計算がAPIリクエストをブロックする設計。特に長期間の日付範囲指定時に深刻なタイムアウトリスクがある。非同期ジョブキュー（RabbitMQ）が技術スタックにあるが活用されていない。
- **検出判定基準**:
  - ○（検出）: レポート生成の同期処理問題を指摘し、非同期処理/バックグラウンドジョブへの移行を提案している
  - △（部分検出）: レポート生成の処理時間/パフォーマンスリスクに言及しているが、同期vs非同期の具体的設計改善に触れていない
  - ×（未検出）: 指摘なし

### P05: データ同期処理の外部APIバッチ呼出し効率化
- **カテゴリ**: I/O・ネットワーク効率（API呼び出し効率、バッチ処理）
- **深刻度**: 中
- **該当箇所**: セクション6 実装方針 - データ同期戦略
- **問題の説明**: データ同期で「For each post, fetch engagement metrics (likes, comments, shares)」と記載され、個別投稿ごとにエンゲージメント指標を取得する設計。外部APIのバッチエンドポイント（複数投稿の指標一括取得）を活用せず、API呼出し回数が投稿数に比例して増加し、レート制限リスクと同期遅延を引き起こす。
- **検出判定基準**:
  - ○（検出）: データ同期の投稿ごとAPI呼出し非効率性を指摘し、バッチAPI活用/一括取得への改善を提案している
  - △（部分検出）: 外部API呼出しの効率性/レート制限リスクに言及しているが、バッチ処理/一括取得の具体的改善策に触れていない
  - ×（未検出）: 指摘なし

### P06: トレンドハッシュタグ分析のクエリ効率
- **カテゴリ**: アルゴリズム・データ構造の効率性
- **深刻度**: 中
- **該当箇所**: セクション5 API設計 - GET /api/analytics/trending-hashtags
- **問題の説明**: 「Queries all posts in the database and extracts hashtags from content field」と記載され、全投稿テーブルスキャン後にアプリケーション層でハッシュタグ抽出・集計を行う設計。投稿数増加に伴いO(n)でクエリコストが増大し、テキスト処理負荷も高い。ハッシュタグテーブル正規化や事前集計テーブル等の効率化が未検討。
- **検出判定基準**:
  - ○（検出）: トレンドハッシュタグ分析の全投稿スキャン非効率性を指摘し、ハッシュタグテーブル正規化/事前集計/マテリアライズドビュー等の効率化手法を提案している
  - △（部分検出）: ハッシュタグ分析のパフォーマンスリスクに言及しているが、具体的なデータ構造最適化/事前集計手法に触れていない
  - ×（未検出）: 指摘なし

### P07: データベースインデックス設計の欠如
- **カテゴリ**: I/O・ネットワーク効率（インデックス設計）
- **深刻度**: 中
- **該当箇所**: セクション4 データモデル
- **問題の説明**: 頻繁にクエリされるカラム（posts.account_id, posts.posted_at, engagement_metrics.post_id, reports.user_id等）に対するインデックス定義が欠如している。特に時系列範囲クエリ（posted_at, recorded_at）や外部キー結合が多用される設計であるにも関わらず、インデックス戦略が未定義。
- **検出判定基準**:
  - ○（検出）: 主要クエリパターンに対するインデックス不足を指摘し、具体的なインデックス候補（account_id, posted_at等の時系列カラム、外部キー）を提案している
  - △（部分検出）: インデックス設計の重要性に言及しているが、具体的なインデックス候補カラムまたはクエリパターンに触れていない
  - ×（未検出）: 指摘なし

### P08: 無期限データ保持による容量増大リスク
- **カテゴリ**: スケーラビリティ設計（データライフサイクル、長期容量戦略）
- **深刻度**: 軽微
- **該当箇所**: セクション7 非機能要件 - データ保持
- **問題の説明**: 「All social media posts and engagement metrics are stored indefinitely」と記載され、時系列データの無期限保持によりデータベース容量が線形増加する。パーティショニング、アーカイブ戦略、古いデータの削除ポリシー等が未定義で、長期運用時にクエリパフォーマンス劣化とストレージコスト増加を引き起こす。
- **検出判定基準**:
  - ○（検出）: 無期限データ保持による容量増大/パフォーマンス劣化リスクを指摘し、パーティショニング/アーカイブ戦略/データライフサイクルポリシーを提案している
  - △（部分検出）: データ増大リスクに言及しているが、具体的なパーティショニング/アーカイブ戦略に触れていない
  - ×（未検出）: 指摘なし

### P09: 競合分析APIの同期処理とタイムアウトリスク
- **カテゴリ**: レイテンシ・スループット設計（非同期処理、外部API呼出し効率）
- **深刻度**: 軽微
- **該当箇所**: セクション5 API設計 - POST /api/analytics/competitor-analysis
- **問題の説明**: 競合分析が「fetches all posts for user accounts and competitor accounts from social media APIs, calculates metrics, and returns comparison data synchronously」と記載され、複数アカウントの全投稿取得と指標計算を同期実行する設計。外部API応答時間に依存し、大量データ処理時にタイムアウトリスクがある。
- **検出判定基準**:
  - ○（検出）: 競合分析APIの同期処理問題を指摘し、非同期処理/バックグラウンドジョブへの移行を提案している
  - △（部分検出）: 競合分析の処理時間/タイムアウトリスクに言及しているが、同期vs非同期の設計改善に触れていない
  - ×（未検出）: 指摘なし

## ボーナス問題リスト

正解キーに含めないが、検出された場合にボーナスとして加点する問題の候補:

| ID | カテゴリ | 内容 | ボーナス条件 |
|----|---------|------|------------|
| B01 | コネクションプール | PostgreSQL/Redisのコネクションプール設定が未定義 | コネクションプール設定の必要性を指摘 |
| B02 | API Gateway最適化 | API Gatewayのキャッシュ設定やスロットリング戦略が未定義 | API Gatewayレベルのキャッシュ/最適化を提案 |
| B03 | 水平スケーリング | 単一ECSタスク前提の設計で自動スケーリング戦略が未定義 | ステートレス設計前提での自動スケーリング/ロードバランシング戦略を提案 |
| B04 | バックグラウンドジョブ並列化 | データ同期ワーカーの並列処理戦略が未定義 | 複数アカウント同期の並列化/ワーカー数調整戦略を提案 |
| B05 | 監視メトリクス | パフォーマンス固有の監視メトリクス（レスポンスタイム、スループット、外部API応答時間等）の収集戦略が未定義 | パフォーマンス監視メトリクスの具体的収集項目を提案 |
| B06 | レポート重複生成防止 | 同一条件のレポート重複生成によるリソース浪費リスク | レポート結果キャッシュ/重複リクエスト検出機構を提案 |
| B07 | CDN最適化 | CloudFront設定の最適化（キャッシュポリシー、圧縮、TTL等）が未定義 | CDNキャッシュポリシー/静的アセット最適化戦略を提案 |
