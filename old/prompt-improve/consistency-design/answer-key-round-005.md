# 正解キー

## 実行条件
- **観点**: consistency
- **対象**: design
- **埋め込み問題数**: 10問

## 埋め込み問題一覧

### P01: データモデルの命名規則の不統一（テーブル名）
- **カテゴリ**: 命名規約の既存パターンとの一致
- **深刻度**: 重大
- **該当箇所**: セクション4「データモデル」
- **問題の説明**: テーブル名の命名規則が不統一。`Patients`と`Questionnaires`は複数形の大文字始まりPascalCaseだが、`medical_institutions`と`appointment`はsnake_caseで、かつ`medical_institutions`は複数形、`appointment`は単数形となっている。この不統一により、既存コードベースにいずれかのパターンが支配的に存在する場合、一貫性が欠如することになる。
- **検出判定基準**:
  - ○（検出）: テーブル名の命名規則の不統一を明確に指摘しており、PascalCase/snake_caseの混在または複数形/単数形の混在のいずれかに言及している
  - △（部分検出）: データモデルの命名に関して何らかの問題を指摘しているが、具体的にどのテーブル名が不統一かを特定していない
  - ×（未検出）: テーブル名の命名規則について何も指摘していない

### P02: カラム名の命名規則の不統一
- **カテゴリ**: 命名規約の既存パターンとの一致
- **深刻度**: 中
- **該当箇所**: セクション4「データモデル」
- **問題の説明**: Patientsテーブルでは`family_name`, `given_name`など全てsnake_caseを使用している一方、medical_institutionsテーブルの`departments`やappointmentテーブルの`status`はcamelCaseとも取れる（ただし単語が1つなので判別不能）。しかしPatientsの`family_name_kana`などの複合語で明確にsnake_caseパターンが確立されているため、全テーブルで統一されるべき。既存コードベースがsnake_caseまたはcamelCaseのいずれかを採用している場合、一部カラムがそれに従っていない可能性がある。
- **検出判定基準**:
  - ○（検出）: カラム名の命名規則について、snake_caseの統一性または既存パターンとの一致を検証すべき点を指摘している
  - △（部分検出）: カラム名に関する何らかの命名問題を指摘しているが、具体的なケースや規則の特定がない
  - ×（未検出）: カラム名の命名規則について何も指摘していない

### P03: HTTPクライアントライブラリの既存パターンとの不一致
- **カテゴリ**: 依存管理の既存パターンとの一致
- **深刻度**: 中
- **該当箇所**: セクション2「主要ライブラリ」
- **問題の説明**: 設計書では`RestTemplate`を採用しているが、これはSpring Framework 5.0以降では非推奨（deprecated）とされており、Spring WebFluxの`WebClient`への移行が推奨されている。既存コードベースが`WebClient`を標準採用している場合、新規開発で`RestTemplate`を選択することは一貫性に欠ける。設計書に「既存システムがRestTemplateを使用しているため継続採用」といった記述がなく、一貫性の検証ができない。
- **検出判定基準**:
  - ○（検出）: RestTemplateの採用が既存システムのHTTPクライアント選定方針と一致しているかを検証すべき点、または既存で使用中のライブラリとの一貫性確認の必要性を明確に指摘している
  - △（部分検出）: HTTPクライアントライブラリに関して何らかの問題を指摘しているが、既存パターンとの一致検証の観点が欠けている
  - ×（未検出）: HTTPクライアントライブラリの選定について何も指摘していない

### P04: APIレスポンス形式が既存パターンとの一致を検証できない
- **カテゴリ**: API/インターフェース設計・依存関係の既存パターンとの一致（情報欠落）
- **深刻度**: 重大
- **該当箇所**: セクション5「リクエスト/レスポンス形式」
- **問題の説明**: 設計書ではレスポンス形式として`{success: true, data: {...}}`と`{success: false, errorMessage: "..."}`を定義しているが、既存APIが同一形式を採用しているかの記述がない。既存システムが`{data, error}`形式や`{result, message}`形式を採用している場合、新規APIが異なる形式を採用すると一貫性に欠ける。設計書に「既存APIのレスポンス形式」を明記すべき。
- **検出判定基準**:
  - ○（検出）: APIレスポンス形式が既存APIと統一されているかを検証すべき点、または既存APIのレスポンス形式が設計書に明記されていない点を指摘している
  - △（部分検出）: APIレスポンス形式に関する何らかの問題を指摘しているが、既存パターンとの一致検証の観点が弱い
  - ×（未検出）: APIレスポンス形式について何も指摘していない

### P05: エラーハンドリングパターンの情報欠落
- **カテゴリ**: 実装パターンの既存パターンとの一致（情報欠落）
- **深刻度**: 重大
- **該当箇所**: セクション6「エラーハンドリング方針」
- **問題の説明**: 設計書では「各Controllerでtry-catchを実装」としているが、既存システムがグローバルな`@ExceptionHandler`や`@ControllerAdvice`を使用している場合、この方針は一貫性に欠ける。設計書に「既存システムのエラーハンドリングパターン」および「なぜこの方式を採用するか」の記述がなく、一貫性を検証できない。
- **検出判定基準**:
  - ○（検出）: エラーハンドリングの実装方式（個別try-catch vs グローバルハンドラ）が既存システムと一致しているかを検証すべき点、または既存パターンが設計書に明記されていない点を指摘している
  - △（部分検出）: エラーハンドリングに関する何らかの情報不足を指摘しているが、既存パターンとの一致検証の観点が弱い
  - ×（未検出）: エラーハンドリングパターンの一貫性について何も指摘していない

### P06: ディレクトリ構造・ファイル配置の情報欠落
- **カテゴリ**: ディレクトリ構造・ファイル配置の既存パターンとの一致（情報欠落）
- **深刻度**: 中
- **該当箇所**: 設計書全体
- **問題の説明**: 設計書にはディレクトリ構造やファイル配置のルールが記載されていない。既存システムがレイヤー別（例: `controller/`, `service/`, `repository/`）またはドメイン別（例: `patient/`, `appointment/`）のいずれかのフォルダ構成を採用している場合、新規開発でそれに従わないと一貫性に欠ける。設計書に「ファイル配置方針」を明記すべき。
- **検出判定基準**:
  - ○（検出）: ディレクトリ構造・ファイル配置の方針が設計書に明記されていない、または既存システムの配置ルールとの一致を検証すべき点を指摘している
  - △（部分検出）: ファイル構成に関する何らかの情報不足を指摘しているが、具体的な配置ルールまで言及していない
  - ×（未検出）: ディレクトリ構造・ファイル配置について何も指摘していない

### P07: ロギングパターンの情報欠落
- **カテゴリ**: 実装パターンの既存パターンとの一致（情報欠落）
- **深刻度**: 軽微
- **該当箇所**: セクション6「ロギング方針」
- **問題の説明**: 設計書では「JSON形式で出力」「ログレベルはDEBUG、INFO、WARN、ERRORの4段階」と記載しているが、既存システムのログ出力パターン（構造化ログ vs 平文、ログレベルの種類、ログライブラリの選定等）が記載されていない。既存システムが異なるパターンを採用している場合、一貫性を検証できない。
- **検出判定基準**:
  - ○（検出）: ロギングパターン（構造化ログの形式、ログレベル等）が既存システムと一致しているかを検証すべき点、または既存パターンが設計書に明記されていない点を指摘している
  - △（部分検出）: ロギングに関する何らかの情報不足を指摘しているが、既存パターンとの一致検証の観点が弱い
  - ×（未検出）: ロギングパターンの一貫性について何も指摘していない

### P08: トランザクション管理パターンの情報欠落
- **カテゴリ**: 実装パターンの既存パターンとの一致（情報欠落）
- **深刻度**: 中
- **該当箇所**: セクション6「実装方針」
- **問題の説明**: 設計書にはトランザクション管理の実装方針が記載されていない。既存システムが`@Transactional`アノテーションベースまたは明示的なトランザクション管理のいずれかを採用している場合、新規開発でそれに従わないと一貫性に欠ける。特に予約作成などの重要な業務処理でトランザクション境界が不明確なことは問題。
- **検出判定基準**:
  - ○（検出）: トランザクション管理パターンが設計書に明記されていない、または既存システムのトランザクション管理方式との一致を検証すべき点を指摘している
  - △（部分検出）: トランザクション管理に関する何らかの情報不足を指摘しているが、既存パターンとの一致検証の観点が弱い
  - ×（未検出）: トランザクション管理について何も指摘していない

### P09: APIエンドポイント命名規則の情報欠落
- **カテゴリ**: API/インターフェース設計・依存関係の既存パターンとの一致（情報欠落）
- **深刻度**: 中
- **問題の説明**: 設計書のAPIエンドポイントは`/api/v1/patients/register`のようにkebab-caseと複数形を使用しているが、既存APIがcamelCaseや単数形を採用している場合、一貫性に欠ける。設計書に「既存APIのエンドポイント命名規則」および「本プロジェクトでの命名ルール」が明記されていない。
- **検出判定基準**:
  - ○（検出）: APIエンドポイントの命名規則（kebab-case/camelCase、複数形/単数形等）が既存APIと一致しているかを検証すべき点、または既存パターンが設計書に明記されていない点を指摘している
  - △（部分検出）: APIエンドポイント命名に関する何らかの情報不足を指摘しているが、既存パターンとの一致検証の観点が弱い
  - ×（未検出）: APIエンドポイント命名規則について何も指摘していない

### P10: 認証トークン保存先の情報欠落
- **カテゴリ**: 実装パターンの既存パターンとの一致（情報欠落）
- **深刻度**: 軽微
- **該当箇所**: セクション5「認証・認可方式」
- **問題の説明**: 設計書では「トークンはHTTP-only Cookieに保存」としているが、既存システムがlocalStorageやSessionStorageを採用している場合、フロントエンドの実装パターンと一貫性に欠ける。設計書に「既存システムの認証トークン保存先」および「なぜCookieを選択するか」の記述がない。
- **検出判定基準**:
  - ○（検出）: 認証トークンの保存先（Cookie vs localStorage vs SessionStorage）が既存システムと一致しているかを検証すべき点、または既存パターンが設計書に明記されていない点を指摘している
  - △（部分検出）: トークン保存に関する何らかの情報不足を指摘しているが、既存パターンとの一致検証の観点が弱い
  - ×（未検出）: 認証トークン保存先について何も指摘していない

## ボーナス問題リスト

正解キーに含めないが、検出された場合にボーナスとして加点する問題の候補:

| ID | カテゴリ | 内容 | ボーナス条件 |
|----|---------|------|------------|
| B01 | 命名規約 | クラス名・インターフェース名の命名規則が設計書に明記されていない（例: Service接頭辞/接尾辞、Impl接尾辞等） | クラス名・インターフェース名の命名規則の欠落または既存パターンとの一致検証を指摘している |
| B02 | 依存管理 | バリデーションライブラリとして Jakarta Validation を選定しているが、既存システムが Hibernate Validator または javax.validation を使用している場合の一貫性を検証すべき | バリデーションライブラリの選定が既存システムと一致しているかの検証を指摘している |
| B03 | API設計 | APIバージョニング方式（URLパスに`/v1`を含める方式）が既存APIと一致しているかの検証が必要 | APIバージョニング方式の一貫性検証を指摘している |
| B04 | 設定管理 | 環境変数の命名規則（大文字スネークケース vs camelCase等）が設計書に明記されていない | 環境変数の命名規則の欠落または既存パターンとの一致検証を指摘している |
| B05 | 実装パターン | 非同期処理パターン（async/await等）の方針が設計書に明記されていない | 非同期処理パターンの欠落または既存パターンとの一致検証を指摘している |
