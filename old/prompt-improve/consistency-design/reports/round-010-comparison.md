# Round 010 比較レポート: v010-baseline vs v010-variant-adversarial

## 実行条件

- **観点**: consistency
- **対象**: design
- **比較日時**: 2026-02-11
- **ラウンド**: Round 010
- **テスト文書**: E-commerce Order Tracking System 設計書
- **埋め込み問題数**: 10問
- **実行回数**: 2回/プロンプト

## 比較対象

| プロンプト名 | Variation ID | 変更内容 |
|-------------|--------------|----------|
| v010-baseline | C2a (専門家ペルソナ) | システムアーキテクチャの専門家としてのロール設定。検出と報告の分離構造 (M1b) を維持 |
| v010-variant-adversarial | C2b (攻撃者/敵対者視点) | 攻撃者/悪意ある設計者としてのロール設定。Adversarial Mode で一貫性の欠如を悪用するシナリオを分析 |

## 問題別検出マトリクス

| 問題ID | カテゴリ | 深刻度 | Baseline Run1 | Baseline Run2 | Adversarial Run1 | Adversarial Run2 | 検出率比較 |
|--------|---------|--------|---------------|---------------|-----------------|-----------------|-----------|
| P01 | 命名規約 | 重大 | ○ (1.0) | ○ (1.0) | ○ (1.0) | △ (0.5) | Baseline: 100%, Adversarial: 75% |
| P02 | 命名規約 | 中 | ○ (1.0) | ○ (1.0) | ○ (1.0) | ○ (1.0) | 同等 (100%) |
| P03 | 命名規約 | 中 | ○ (1.0) | ○ (1.0) | ○ (1.0) | ○ (1.0) | 同等 (100%) |
| P04 | API設計 | 中 | ○ (1.0) | ○ (1.0) | ○ (1.0) | ○ (1.0) | 同等 (100%) |
| P05 | API設計 | 軽微 | △ (0.5) | △ (0.5) | △ (0.5) | △ (0.5) | 同等 (部分検出) |
| P06 | 依存管理 | 中 | ○ (1.0) | ○ (1.0) | ○ (1.0) | ○ (1.0) | 同等 (100%) |
| P07 | 実装パターン | 重大 | ○ (1.0) | ○ (1.0) | ○ (1.0) | ○ (1.0) | 同等 (100%) |
| P08 | 実装パターン | 軽微 | ○ (1.0) | ○ (1.0) | ○ (1.0) | ○ (1.0) | 同等 (100%) |
| P09 | API設計 | 重大 | ○ (1.0) | ○ (1.0) | ○ (1.0) | ○ (1.0) | 同等 (100%) |
| P10 | 実装パターン | 中 | △ (0.5) | △ (0.5) | × (0.0) | × (0.0) | Baseline: 50%, Adversarial: 0% |

**検出スコア**:
- Baseline Run1: 9.0, Run2: 9.0 (平均9.0)
- Adversarial Run1: 9.5, Run2: 8.0 (平均8.75)
- **検出スコア差**: Baseline +0.25pt

## ボーナス・ペナルティ詳細

### Baseline ボーナス

**Run 1 (+0.5点)**:
- **B03** (実装パターン): Async processing pattern consistency - `LocationUpdateProcessor`が既存の`@Async` + `CompletableFuture`パターンに従うかの文書化欠落を指摘

**Run 2 (+0点)**:
- ボーナス検出なし

**Baseline ボーナス平均**: +0.25点

### Adversarial ボーナス

**Run 1 (+1.0点)**:
- **B-1** (実装パターン): Transaction management pattern documentation gap - 既存の`@Transactional`パターンが設計書に記載されていない
- **B-2** (依存管理): Configuration file format documentation gap - 設定ファイル形式（YAML/JSON）や環境変数命名規則が欠落

**Run 2 (+2.0点)**:
- **B-3** (命名規約): Class naming convention documentation gap - PascalCaseが暗黙的だが明記されていない
- **B-4** (命名規約): Method naming convention documentation gap - camelCaseが暗黙的だが明記されていない
- **B-5** (依存管理): Configuration file format documentation gap - Run 1と同様
- **B-6** (依存管理): Environment variable naming convention documentation gap - 環境変数の命名規則が欠落

**Adversarial ボーナス平均**: +1.5点

### ペナルティ

- **Baseline**: 両実行ともペナルティなし
- **Adversarial**: 両実行ともペナルティなし

## スコアサマリ

| プロンプト | Run1 | Run2 | 平均 | SD | 安定性 | スコア構成 |
|-----------|------|------|------|-----|--------|-----------|
| Baseline (C2a) | 9.5 | 9.0 | 9.25 | 0.25 | 高安定 | 検出97.3% + bonus2.7% |
| Adversarial (C2b) | 10.5 | 10.0 | 10.25 | 0.25 | 高安定 | 検出85.4% + bonus14.6% |
| **差分** | +1.0 | +1.0 | **+1.0** | **0.0** | 同等 | ボーナス主導型 (+1.25pt) |

## 推奨判定

**推奨**: v010-variant-adversarial (C2b)

**判定根拠**: 平均スコア差+1.0pt（>1.0pt基準）により、スコアが高い方を推奨。安定性は同等（SD=0.25）で両プロンプトともに高安定性を維持。

**scoring-rubric.md Section 5 推奨判定基準の適用**:
- 平均スコア差 = 10.25 - 9.25 = +1.0pt (> 1.0pt)
- 基準: 「平均スコア差 > 1.0pt → スコアが高い方を推奨」
- 結論: v010-variant-adversarial を推奨

## 収束判定

**継続推奨**

**判定根拠**: Round 009→010 の改善幅を算出すると以下の通り:
- Round 009 baseline: 8.0 (SD=1.0)
- Round 010 baseline: 9.25 (SD=0.25)
- 改善幅 = 9.25 - 8.0 = +1.25pt (> 0.5pt)

**scoring-rubric.md Section 5 収束判定基準の適用**:
- 改善幅 = +1.25pt (> 0.5pt)
- 基準: 「2ラウンド連続で改善幅 < 0.5pt → 収束の可能性あり」
- 結論: 収束条件を満たさないため継続推奨

## 考察

### 独立変数ごとの効果分析

**1. C2b (攻撃者/敵対者視点) の効果**

**ボーナス検出の大幅改善**:
- Baseline: 平均+0.25pt (1件→0件、Run間で変動)
- Adversarial: 平均+1.5pt (2件→4件、Run間で変動あり)
- **ボーナス差**: +1.25pt (Adversarial優位)

Adversarial視点は「一貫性の欠如を悪用するシナリオ」を想定することで、情報欠落の網羅性が向上。特に命名規約（クラス/メソッド）、依存管理（設定ファイル/環境変数）で細分化された指摘を行い、ボーナス検出件数を増加させた。

**埋め込み問題検出の微減**:
- P01 (テーブル名): Baseline 100% → Adversarial 75% (Run2で△)
- P10 (JWT保存先): Baseline 50% (△△) → Adversarial 0% (××)
- **検出スコア差**: Baseline +0.25pt (Adversarial微減)

Adversarial視点は「情報欠落の悪用可能性」に注目するため、P10のJWT保存先問題を「既存パターンの文書化欠落」として認識するものの、「既存パターンとの一貫性検証が必要」という明示的な指摘に到達しにくい。また、P01のRun2で「設計書の記述の曖昧性」を指摘するに留まり、`tracking_event`, `carrier`の単数形という核心的ポイントの明確化が不十分だった。

**スコア構成のシフト**:
- Baseline: 検出主導型 (97.3% 検出 + 2.7% bonus)
- Adversarial: ボーナス主導型 (85.4% 検出 + 14.6% bonus)

Adversarial視点は探索的な情報欠落検出に優れるが、埋め込み問題の検出精度でわずかに劣るトレードオフが確認された。

**2. レポート品質の違い**

**Baseline (C2a専門家ペルソナ)の特徴**:
- 既存パターンとの不整合を直接的に指摘
- 「システムアーキテクチャの専門家として」という視点により、命名規約・API設計・実装パターンの一貫性検証が核心
- レポート構成はシンプルで焦点が明確

**Adversarial (C2b攻撃者/敵対者視点)の特徴**:
- Run1: 「Adversarial Mode」を明示し、「Adversarial Risk」セクションで悪用シナリオを詳述（例: "enables database fragmentation", "forces client code to implement multiple strategies"）
- Run2: Phase 1で「Detection Strategy 5: Exploratory Detection (Adversarial Lens)」を設け、P17-P24として悪用シナリオを列挙、Phase 2で通常の報告形式に統合
- 技術的負債の蓄積メカニズムを明示的に分析

Adversarial視点は「一貫性の欠如がどう悪用されるか」という次元を追加し、単なる不整合の列挙を超えた洞察を提供する。ただし、レポート構造が複雑になり、核心的な問題の明確化がやや希薄になるリスクがある。

**3. 安定性の比較**

両プロンプトともSD=0.25で高安定性を維持。攻撃者視点の導入による実行間変動の増加は観察されなかった。

- Baseline: Run1=9.5, Run2=9.0 (差0.5、ボーナス検出のみで変動)
- Adversarial: Run1=10.5, Run2=10.0 (差0.5、P01検出とボーナス検出で変動)

Adversarial視点はP01のRun2で部分検出に悪化した点が安定性に影響しているが、標準偏差は同等。

### 次回への示唆

**1. C2b-v2: Adversarial視点 + 既存パターン照合の強化**

P10（JWT保存先）とP01（テーブル名Run2）の検出悪化を改善するため、以下のハイブリッド構造を提案:
- Step 1: 専門家視点で既存パターンを抽出
- Step 2: Adversarial視点で悪用シナリオを分析
- Step 3: 既存パターンとの不整合を報告

この構造により、ボーナス検出の探索性を維持しながら、埋め込み問題の検出精度を向上させる。

**2. P10検出の根本対策**

P10（JWT保存先）はRound 009 Baseline (C2a) で△△、Round 010 Baseline (C2a) で△△、Round 010 Adversarial (C2b) で××と継続的に検出困難を示している。

検出判定基準「JWTの保存先（localStorage）が既存システムのパターンと一致するかの検証が必要であることを指摘している、または既存システムのJWT保存パターンに関する情報が設計書に欠落していることを指摘している」の後半部分に到達するには、以下のアプローチが必要:

- 専門家視点: 「既存システムのJWT保存パターンとの一貫性検証が必要」という明示的な指摘を促す
- テスト文書の改善: 既存システムのJWT保存パターン（cookie、localStorage、sessionStorage、HttpOnly cookie等）を明記し、新設計がこれと一致するかを検証可能にする

**3. P05（動詞を含むエンドポイント）の検出改善**

P05は両プロンプトとも△△で部分検出に留まっている。「動詞使用 vs 名詞ベース（RESTfulリソース指向）」という核心的な対立軸を明確化するため、API設計の既存パターン照合指示を強化する必要がある。

**4. ボーナス検出とのバランス最適化**

現状のC2b Adversarial視点はボーナス検出で+1.25pt優位だが、埋め込み問題検出で-0.25pt劣る。総合スコアでは+1.0ptの優位性を維持しているが、埋め込み問題の検出率90%以上を目指す場合、C2a専門家視点の方が適切。

用途別の推奨:
- **探索的評価・初期段階**: C2b Adversarial視点（ボーナス主導型、広範な情報欠落検出）
- **精密評価・本番運用**: C2a専門家視点（検出主導型、埋め込み問題の高精度検出）

**5. 収束戦略の見直し**

Round 010で改善幅+1.25ptを達成したが、これはC2b Adversarial視点の導入によるボーナス検出増加が主要因。埋め込み問題の検出率は90%→87.5%とわずかに低下している。

次回は以下の戦略を推奨:
- C2b-v2（Adversarial + 既存パターン照合強化）でP10/P01/P05の検出改善を目指す
- 埋め込み問題検出率95%以上（9.5/10以上）を達成目標とする
- 達成後、ボーナス検出最大化のためのC2b-v3（探索的フェーズ追加）を検討

---

**生成日時**: 2026-02-11
**レポート作成者**: reviewer_optimize スキル Phase 5 analysis subagent
