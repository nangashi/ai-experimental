# 正解キー

## 実行条件
- **観点**: consistency
- **対象**: design
- **埋め込み問題数**: 10問

## 埋め込み問題一覧

### P01: テーブル名の命名規則の不一致
- **カテゴリ**: 命名規約の既存パターンとの一致（データモデル）
- **深刻度**: 重大
- **該当箇所**: セクション4「データモデル」- テーブル設計
- **問題の説明**: 既存コードベースではテーブル名は全て複数形（users, orders, products等）を使用しているが、新設計のテーブル名は単数形（reservation, customer, location, staff）を使用しており、命名規則が不一致である。
- **検出判定基準**:
  - ○（検出）: テーブル名が単数形と複数形で不一致であることを指摘し、既存が複数形を使用している点に言及している
  - △（部分検出）: テーブル名の命名規則に言及しているが、単数形/複数形の不一致について具体的に指摘していない
  - ×（未検出）: テーブル名の命名規則について言及がない

### P02: データアクセスパターン方針の情報欠落
- **カテゴリ**: 実装パターンの既存パターンとの一致（情報欠落）
- **深刻度**: 重大
- **該当箇所**: セクション3「アーキテクチャ設計」および セクション6「実装方針」
- **問題の説明**: 既存コードベースではRepository層でのトランザクション管理方式（@Transactional の配置場所、トランザクション境界の決定基準等）が統一されているが、新設計書にはデータアクセスパターンおよびトランザクション管理の具体的な方針が明記されておらず、既存パターンとの一貫性が検証できない。
- **検出判定基準**:
  - ○（検出）: データアクセスパターンまたはトランザクション管理の方針が設計書に明記されていないこと、および既存パターンとの一貫性が検証できないことを指摘している
  - △（部分検出）: データアクセスやトランザクション管理に言及しているが、既存パターンとの一貫性検証の観点での情報欠落に触れていない
  - ×（未検出）: データアクセスパターンまたはトランザクション管理について言及がない

### P03: 認証パターンの不一致
- **カテゴリ**: 実装パターンの既存パターンとの一致
- **深刻度**: 重大
- **該当箇所**: セクション5「API設計」- 認証・認可方式
- **問題の説明**: 既存コードベースでは認証はSpring Securityのフィルターチェーン（SecurityFilterChain）で一元管理されているが、新設計では「各コントローラーメソッド内で個別に実装する」としており、認証パターンが既存と異なる。個別実装は認証ロジックの重複を招き、既存の統一パターンから逸脱している。
- **検出判定基準**:
  - ○（検出）: 認証処理を各コントローラーメソッド内で個別実装する方針が、既存のフィルターチェーンによる一元管理パターンと不一致であることを指摘している
  - △（部分検出）: 認証パターンに言及しているが、既存の一元管理パターンとの不一致について具体的に指摘していない
  - ×（未検出）: 認証パターンについて言及がない

### P04: エラーハンドリングパターンの不一致
- **カテゴリ**: 実装パターンの既存パターンとの一致
- **深刻度**: 中
- **該当箇所**: セクション6「実装方針」- エラーハンドリング方針
- **問題の説明**: 既存コードベースではエラーハンドリングは@ControllerAdviceによるグローバルエラーハンドラーで一元管理されているが、新設計では「各コントローラーメソッド内でtry-catchブロックを使用し、例外を個別にハンドリングする」としており、エラー処理パターンが既存と異なる。
- **検出判定基準**:
  - ○（検出）: エラーハンドリングを各コントローラーメソッド内で個別実装する方針が、既存の@ControllerAdviceによるグローバルハンドラーパターンと不一致であることを指摘している
  - △（部分検出）: エラーハンドリングパターンに言及しているが、既存のグローバルハンドラーパターンとの不一致について具体的に指摘していない
  - ×（未検出）: エラーハンドリングパターンについて言及がない

### P05: HTTP通信ライブラリの不一致
- **カテゴリ**: 依存管理
- **深刻度**: 中
- **該当箇所**: セクション2「技術スタック」- 主要ライブラリ
- **問題の説明**: 既存コードベースでは外部API通信に`WebClient`（Spring WebFlux）を統一して使用しているが、新設計では`RestTemplate`を採用している。同機能のライブラリを混在させると、コードベース全体での一貫性が損なわれる。
- **検出判定基準**:
  - ○（検出）: HTTP通信ライブラリとして`RestTemplate`を採用していることが、既存の`WebClient`使用と不一致であることを指摘している
  - △（部分検出）: HTTP通信ライブラリに言及しているが、既存の`WebClient`との不一致について具体的に指摘していない
  - ×（未検出）: HTTP通信ライブラリについて言及がない

### P06: カラム名の命名規則の不一致
- **カテゴリ**: 命名規約の既存パターンとの一致（データモデル）
- **深刻度**: 中
- **該当箇所**: セクション4「データモデル」- テーブル設計
- **問題の説明**: 既存コードベースではカラム名は全てスネークケース（created_at, updated_at, customer_id等）を使用しているが、新設計のカラム名はキャメルケース（createdAt, updatedAt, customerId等）とスネークケース（first_name → firstName, last_name → lastName）が混在しており、命名規則が不一致である。特にcustomerテーブルのfirstName/lastNameはキャメルケース、reservationテーブルのcustomerId/locationIdもキャメルケースになっている。
- **検出判定基準**:
  - ○（検出）: カラム名がキャメルケースとスネークケースで不一致であることを指摘し、既存がスネークケースを使用している点に言及している
  - △（部分検出）: カラム名の命名規則に言及しているが、キャメルケース/スネークケースの不一致について具体的に指摘していない
  - ×（未検出）: カラム名の命名規則について言及がない

### P07: ログ形式の不一致
- **カテゴリ**: 実装パターンの既存パターンとの一致
- **深刻度**: 軽微
- **該当箇所**: セクション6「実装方針」- ロギング方針
- **問題の説明**: 既存コードベースではログ出力は構造化ログ（JSON形式）を使用しているが、新設計では「平文形式」としており、ログ出力パターンが既存と異なる。構造化ログは検索性・解析性の観点で優れており、既存システムとの一貫性を保つべきである。
- **検出判定基準**:
  - ○（検出）: ログ形式を平文形式とする方針が、既存の構造化ログ（JSON形式）と不一致であることを指摘している
  - △（部分検出）: ログ形式に言及しているが、既存の構造化ログとの不一致について具体的に指摘していない
  - ×（未検出）: ログ形式について言及がない

### P08: locationテーブルのカラム名の不統一
- **カテゴリ**: 命名規約の既存パターンとの一致（データモデル）
- **深刻度**: 軽微
- **該当箇所**: セクション4「データモデル」- locationテーブル
- **問題の説明**: customerテーブルではphoneカラムと命名されているのに対し、locationテーブルではphoneNumberと命名されており、同じ概念のカラムで命名が統一されていない。既存コードベースでは電話番号カラムは全て`phone`で統一されている。
- **検出判定基準**:
  - ○（検出）: locationテーブルのphoneNumberカラムが、他のテーブル（customerテーブル）のphoneカラムおよび既存パターンと命名が不統一であることを指摘している
  - △（部分検出）: 電話番号カラムの命名に言及しているが、テーブル間または既存パターンとの不統一について具体的に指摘していない
  - ×（未検出）: 電話番号カラムの命名について言及がない

### P09: エンドポイントパスの命名規則の曖昧性
- **カテゴリ**: API/インターフェース設計の既存パターンとの一致（情報欠落）
- **深刻度**: 軽微
- **該当箇所**: セクション5「API設計」- エンドポイント一覧
- **問題の説明**: 既存コードベースではAPIエンドポイントのパスパラメータ命名規則（例: `/api/reservations/customer/{customerId}` vs `/api/reservations/customer/{id}`）が統一されているが、新設計書にはパスパラメータの命名規則が明記されておらず、既存パターンとの一貫性が検証できない。
- **検出判定基準**:
  - ○（検出）: APIエンドポイントのパスパラメータ命名規則が設計書に明記されていないこと、および既存パターンとの一貫性が検証できないことを指摘している
  - △（部分検出）: APIエンドポイント設計に言及しているが、パスパラメータ命名規則の情報欠落に触れていない
  - ×（未検出）: APIエンドポイント設計について言及がない

### P10: Javaエンティティクラス命名規則の情報欠落
- **カテゴリ**: 命名規約の既存パターンとの一致（情報欠落）
- **深刻度**: 軽微
- **該当箇所**: セクション4「データモデル」
- **問題の説明**: 既存コードベースではJPAエンティティクラス名は全て単数形（User, Order, Product等）を使用しているが、新設計書にはエンティティクラス名の命名規則が明記されておらず、テーブル名が単数形であることからエンティティクラス名も単数形と推測されるが、明示的な記載がないため既存パターンとの一貫性が検証できない。
- **検出判定基準**:
  - ○（検出）: エンティティクラス名の命名規則が設計書に明記されていないこと、および既存パターン（単数形）との一貫性が検証できないことを指摘している
  - △（部分検出）: エンティティクラスの命名に言及しているが、既存パターンとの一貫性検証の観点での情報欠落に触れていない
  - ×（未検出）: エンティティクラス名の命名規則について言及がない

## ボーナス問題リスト

正解キーに含めないが、検出された場合にボーナスとして加点する問題の候補:

| ID | カテゴリ | 内容 | ボーナス条件 |
|----|---------|------|------------|
| B01 | API設計（情報欠落） | レスポンスのページネーション形式が設計書に明記されていない | 既存の統一ページネーション形式との一貫性検証ができない点を指摘 |
| B02 | 実装パターン（情報欠落） | 非同期処理パターン（通知送信等）の方針が設計書に明記されていない | 既存の非同期処理パターン（例: @Async使用方針）との一貫性検証ができない点を指摘 |
| B03 | 依存管理 | バリデーションライブラリとしてHibernate Validatorを使用しているが、既存では別の選択肢を使用 | 既存のバリデーションライブラリとの不一致を指摘 |
| B04 | ディレクトリ構造（情報欠落） | パッケージ構成（レイヤー別/ドメイン別）が設計書に明記されていない | 既存のパッケージ構成との一貫性検証ができない点を指摘 |
