# Scoring Report: v011-baseline

## Run1 Detection Matrix

| Problem ID | Category | Severity | Detection | Score | Notes |
|-----------|----------|----------|-----------|-------|-------|
| P01 | 命名規約（データモデル） | 重大 | △ | 0.5 | S-2で主キー命名の混在（`{table}_id` vs `id`）を検出しているが、「既存パターンとの不一致」ではなく設計書内部の一貫性欠如として指摘している |
| P02 | 命名規約（データモデル） | 重大 | ○ | 1.0 | S-3で外部キー命名の3パターン混在（`owner_id`, `PropertyID/TenantID`, `contract_fk/owner_fk`）を明確に検出している |
| P03 | 命名規約（データモデル） | 中 | △ | 0.5 | S-1でタイムスタンプ列命名の3パターン混在を検出しているが、「既存パターンとの不一致」ではなく設計書内部の一貫性として指摘している |
| P04 | API設計 | 中 | △ | 0.5 | S-5でAPI動詞使用（`/create`, `/update`）を検出しているが、「既存RESTful設計パターンとの不一致」という観点が弱い |
| P05 | API設計 | 中 | △ | 0.5 | S-6でレスポンス形式の不整合（`timestamp`フィールドとDBカラム名の不一致）に言及しているが、既存の`{data, error}`パターンとの不一致という観点での指摘ではない |
| P06 | 実装パターン | 中 | × | 0.0 | HTTP通信ライブラリ（Apache HttpClient vs RestTemplate）の選定について言及がない |
| P07 | 実装パターン（情報欠落） | 中 | ○ | 1.0 | C-2でエラーハンドリングパターンが設計書に明記されておらず、既存パターンとの一貫性が検証できないことを指摘している |
| P08 | 実装パターン（情報欠落） | 軽微 | ○ | 1.0 | C-1でトランザクション管理パターン、C-2でデータアクセスパターンが明記されておらず、既存パターンとの一貫性が検証できないことを指摘している |
| P09 | ディレクトリ構造（情報欠落） | 軽微 | ○ | 1.0 | C-3でファイル配置方針（レイヤー別 vs ドメイン別）が設計書に明記されておらず、既存パターンとの一貫性が検証できないことを指摘している |
| P10 | 実装パターン（情報欠落） | 軽微 | × | 0.0 | JWTトークンのフロントエンド保存方式について言及がない |

### Run1 検出スコア: 6.0 / 10.0

### Run1 ボーナス/ペナルティ分析

**ボーナス候補**:
1. C-4: 非同期処理パターン（`@Async`, PDF生成等）の未文書化 - perspective.mdの「非同期処理パターン」に該当、既存パターンとの一貫性検証が必要 → **+0.5**
2. C-5: ORM Query Pattern（Repository層の複雑クエリ戦略）の未定義 - perspective.mdの「データアクセスパターン」に該当、既存パターンとの一貫性検証が必要 → **+0.5**
3. S-4: Status column naming（`status` vs `{table}_status`）の混在 - 正解キーに未掲載だがconsistency観点で有益 → **+0.5**
4. M-1: Configuration Management（環境変数命名規則、設定ファイル形式）の未定義 - perspective.mdの「設定ファイル形式、環境変数命名規則」に該当 → **+0.5**
5. M-2: Dependency Injection Pattern（DI方式）の未定義 - perspective.mdの実装パターンに該当 → **+0.5**

**ボーナス合計**: 5件 → **+2.5**（上限5件のため）

**ペナルティ候補**:
1. I-1: Audit Trail Pattern（created_by/updated_by追加提案） - consistencyではなくstructural-qualityの範囲（設計原則の遵守） → **-0.5**
2. I-2: Soft Delete Pattern（論理削除 vs 物理削除の提案） - consistencyではなくstructural-qualityの範囲 → **-0.5**

**ペナルティ合計**: 2件 → **-1.0**

### Run1 総合スコア: 6.0 + 2.5 - 1.0 = **7.5**

---

## Run2 Detection Matrix

| Problem ID | Category | Severity | Detection | Score | Notes |
|-----------|----------|----------|-----------|-------|-------|
| P01 | 命名規約（データモデル） | 重大 | △ | 0.5 | S-2で主キー命名の混在を検出しているが、「既存パターンとの不一致」という観点が明確でない |
| P02 | 命名規約（データモデル） | 重大 | ○ | 1.0 | S-3で外部キー命名の3パターン混在を明確に検出している |
| P03 | 命名規約（データモデル） | 中 | △ | 0.5 | S-1でタイムスタンプ列命名の3パターン混在を検出しているが、「既存パターンとの不一致」という観点が弱い |
| P04 | API設計 | 中 | △ | 0.5 | S-5でAPI動詞使用を検出しているが、「既存RESTful設計パターンとの不一致」という観点が弱い |
| P05 | API設計 | 中 | △ | 0.5 | S-6でレスポンス形式のタイムスタンプ命名不整合に言及しているが、既存の`{data, error}`パターンとの不一致という観点での指摘ではない |
| P06 | 実装パターン | 中 | × | 0.0 | HTTP通信ライブラリの選定について言及がない |
| P07 | 実装パターン（情報欠落） | 中 | ○ | 1.0 | C-2でエラーハンドリングパターンが設計書に明記されておらず、既存パターンとの一貫性が検証できないことを指摘している |
| P08 | 実装パターン（情報欠落） | 軽微 | ○ | 1.0 | C-1でトランザクション管理、C-2でデータアクセス層の抽象化レベルが未定義であることを指摘している |
| P09 | ディレクトリ構造（情報欠落） | 軽微 | ○ | 1.0 | C-3でファイル配置方針が設計書に明記されておらず、既存パターンとの一貫性が検証できないことを指摘している |
| P10 | 実装パターン（情報欠落） | 軽微 | × | 0.0 | JWTトークンのフロントエンド保存方式について言及がない |

### Run2 検出スコア: 6.0 / 10.0

### Run2 ボーナス/ペナルティ分析

**ボーナス候補**:
1. C-4: 非同期処理パターンの未定義 - perspective.mdの「非同期処理パターン」に該当 → **+0.5**
2. C-5: ORM Query Pattern（複雑クエリ戦略）の未定義 - perspective.mdの「データアクセスパターン」に該当 → **+0.5**
3. S-4: Status column naming（`status` vs `{table}_status`）の混在 - 正解キーに未掲載だがconsistency観点で有益 → **+0.5**
4. M-1: Configuration Management（環境変数命名、設定ファイル形式）の未定義 - perspective.mdの「設定ファイル形式、環境変数命名規則」に該当 → **+0.5**
5. M-2: Dependency Injection Patternの未定義 - perspective.mdの実装パターンに該当 → **+0.5**

**ボーナス合計**: 5件 → **+2.5**（上限5件のため）

**ペナルティ候補**:
1. I-1: Audit Trail Pattern（created_by/updated_by追加提案） - consistencyではなくstructural-qualityの範囲 → **-0.5**
2. I-2: Soft Delete Pattern（論理削除 vs 物理削除の提案） - consistencyではなくstructural-qualityの範囲 → **-0.5**

**ペナルティ合計**: 2件 → **-1.0**

### Run2 総合スコア: 6.0 + 2.5 - 1.0 = **7.5**

---

## Summary Statistics

- **v011-baseline Mean**: 7.5
- **v011-baseline SD**: 0.0
- **Run1**: 7.5 (検出6.0+bonus5-penalty2)
- **Run2**: 7.5 (検出6.0+bonus5-penalty2)

---

## Detailed Analysis

### 検出できた問題 (6/10)
- P02: 外部キー命名規則の混在（完全検出）
- P07: エラーハンドリングパターンの未文書化（完全検出）
- P08: データアクセス/トランザクション管理パターンの不完全な文書化（完全検出）
- P09: ディレクトリ構造・ファイル配置方針の未文書化（完全検出）
- P01: 主キー命名規則の混在（部分検出、既存パターンとの不一致という観点が弱い）
- P03: タイムスタンプ列命名規則の混在（部分検出、既存パターンとの不一致という観点が弱い）
- P04: API設計 - 動詞使用の混在（部分検出、既存パターンとの不一致という観点が弱い）
- P05: API設計 - レスポンス形式の不整合（部分検出、既存の`{data, error}`パターンとの不一致という観点での指摘ではない）

### 検出できなかった問題 (2/10)
- P06: HTTP通信ライブラリの不一致（Apache HttpClient vs RestTemplate）
- P10: JWTトークン保存方式の未文書化

### ボーナス検出（5件、上限到達）
1. 非同期処理パターン（`@Async`, PDF生成等）の未定義
2. ORM Query Pattern（Repository層の複雑クエリ戦略）の未定義
3. Status column naming（`status` vs `{table}_status`）の混在
4. Configuration Management（環境変数命名規則、設定ファイル形式）の未定義
5. Dependency Injection Pattern（DI方式）の未定義

### ペナルティ検出（2件）
1. Audit Trail Pattern（created_by/updated_by追加提案） - structural-qualityの範囲
2. Soft Delete Pattern（論理削除 vs 物理削除の提案） - structural-qualityの範囲

---

## 強みと弱み

### 強み
1. **情報欠落系の問題検出が優秀**: P07, P08, P09のような「既存パターンとの一貫性を検証するための情報が欠落している」問題を的確に検出している
2. **ボーナス検出が豊富**: 正解キーに含まれない有益な指摘（非同期処理、ORM Query Pattern、Configuration Management等）を多数検出している
3. **命名規則の混在検出**: P02（外部キー命名）、P03（タイムスタンプ列命名）等の命名規則の混在を検出している

### 弱み
1. **「既存パターンとの不一致」という観点が弱い**: P01, P03, P04, P05で部分検出に留まった理由は、「設計書内部の一貫性欠如」として指摘しているが、「既存コードベースのパターンとの不一致」という観点が明確でないため
2. **P06（HTTP通信ライブラリ）の検出漏れ**: 既存の RestTemplate パターンと新設計の Apache HttpClient 5.2 の不一致を検出できていない
3. **P10（JWTトークン保存方式）の検出漏れ**: 認証パターンについては C-4で指摘があるが、フロントエンドでのトークン保存方式（localStorage/sessionStorage/HttpOnly Cookie）という具体的な観点での指摘がない
4. **スコープ外の指摘**: I-1（Audit Trail）、I-2（Soft Delete）はconsistencyではなくstructural-qualityの範囲であるため、ペナルティが発生している

---

## 改善提案

1. **「既存パターンとの不一致」の強調**:
   - 観点定義の冒頭で「既存コードベースとの一貫性」を強調する
   - 各カテゴリの検出基準で「既存パターンとの不一致」を明示的に記載する

2. **具体的な技術要素のチェックリスト追加**:
   - HTTP通信ライブラリ（RestTemplate, Apache HttpClient, WebClient等）
   - 認証トークン保存方式（localStorage, sessionStorage, HttpOnly Cookie）
   - 具体的なライブラリ選定の一貫性チェック項目を追加

3. **スコープ境界の明確化**:
   - consistency: 既存パターンとの一致
   - structural-quality: 設計原則の遵守、改善提案
   - 観点定義で「改善提案はstructural-qualityに委ねる」という記載を強調
