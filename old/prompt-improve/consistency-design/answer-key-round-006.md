# 正解キー

## 実行条件
- **観点**: consistency
- **対象**: design
- **埋め込み問題数**: 10問

## 埋め込み問題一覧

### P01: テーブル命名規則の混在（snake_case と camelCase）
- **カテゴリ**: 命名規約の既存パターンとの一致（データモデル）
- **深刻度**: 重大
- **該当箇所**: セクション4.2 テーブル設計
- **問題の説明**: 既存テーブル（`PatientAccount`, `medical_institution`, `doctor`）はsnake_caseで命名されているが、`appointment`テーブルの主キーカラムのみ`appointmentId`（camelCase）を使用しており、既存の命名パターンと不一致。他のテーブルは全て`patient_id`, `institution_id`, `doctor_id`のようにsnake_caseを採用している。
- **検出判定基準**:
  - ○（検出）: `appointment`テーブルの`appointmentId`カラムが既存のsnake_case命名規則と異なることを指摘し、`appointment_id`への統一を推奨している
  - △（部分検出）: テーブル命名に不統一があると指摘しているが、具体的なカラム名（`appointmentId`）に言及していない、または既存パターン（`patient_id`等）との比較がない
  - ×（未検出）: この問題に触れていない、または一般的な命名規則の推奨のみで既存パターンとの不一致を指摘していない

### P02: 外部キーカラム命名の不統一
- **カテゴリ**: 命名規約の既存パターンとの一致（データモデル）
- **深刻度**: 中
- **該当箇所**: セクション4.2 テーブル設計（`appointment`テーブル）
- **問題の説明**: `appointment`テーブルの外部キーカラムが`patientId`, `institutionId`, `doctorId`（camelCase）で命名されているが、同じテーブル内の他のカラムおよび既存テーブル（`PatientAccount.patient_id`等）はsnake_caseを使用している。
- **検出判定基準**:
  - ○（検出）: `appointment`テーブルの外部キーカラム（`patientId`, `institutionId`, `doctorId`）が既存のsnake_case命名規則と異なることを指摘し、`patient_id`, `institution_id`, `doctor_id`への統一を推奨している
  - △（部分検出）: 外部キーカラムの命名に不統一があると指摘しているが、具体的なカラム名に言及していない、または既存パターンとの比較がない
  - ×（未検出）: この問題に触れていない

### P03: API命名規則の情報欠落
- **カテゴリ**: 実装パターンの既存パターンとの一致（情報欠落）
- **深刻度**: 重大
- **該当箇所**: セクション5.1 エンドポイント一覧
- **問題の説明**: API設計でエンドポイント一覧を記載しているが、既存APIの命名規則（動詞の使用パターン、リソース名の複数形/単数形、パスセグメントの命名スタイル等）が設計書に明記されておらず、新規エンドポイント（`/api/appointments/create`等）が既存パターンと一致しているかを検証できない。
- **検出判定基準**:
  - ○（検出）: API命名規則が設計書に明記されていないこと、および既存APIのエンドポイント命名パターンとの一貫性が検証できないことを指摘している
  - △（部分検出）: API設計に関する情報が不足していると指摘しているが、既存APIの命名規則との一貫性検証の観点が欠けている
  - ×（未検出）: この問題に触れていない

### P04: APIレスポンス形式の既存パターンとの不一致
- **カテゴリ**: API/インターフェース設計の既存パターンとの一致
- **深刻度**: 中
- **該当箇所**: セクション5.2 リクエスト/レスポンス形式
- **問題の説明**: 既存のプロジェクトではREST APIのレスポンス形式が`{data, error}`構造を採用しているが、一般的なSpring Bootプロジェクトでは`{success, data, message}`や単純なデータ返却が多い。設計書では既存システムのレスポンス形式を明示しておらず、`{data, error}`構造が既存パターンと一致しているか不明。
- **検出判定基準**:
  - ○（検出）: 既存APIのレスポンス形式が設計書に明記されていないこと、および`{data, error}`構造が既存パターンと一致しているかを検証する必要があることを指摘している
  - △（部分検出）: APIレスポンス形式に関する情報が不足していると指摘しているが、既存パターンとの一貫性検証の観点が欠けている
  - ×（未検出）: この問題に触れていない

### P05: エラーハンドリングパターンの既存パターンとの不一致
- **カテゴリ**: 実装パターンの既存パターンとの一致（エラー処理）
- **深刻度**: 重大
- **該当箇所**: セクション6.1 エラーハンドリング方針
- **問題の説明**: 設計書ではServiceレベルで個別にcatchしてControllerにthrowする方式を採用しているが、Spring Bootプロジェクトの一般的なパターンは`@ControllerAdvice`によるグローバルエラーハンドラの使用。既存プロジェクトのエラーハンドリングパターン（グローバルハンドラ vs 個別catch）が設計書に明記されておらず、新設計が既存方式と一致しているか不明。
- **検出判定基準**:
  - ○（検出）: 既存プロジェクトのエラーハンドリングパターンが設計書に明記されていないこと、およびServiceレベルでの個別catch方式が既存パターンと一致しているかを検証する必要があることを指摘している
  - △（部分検出）: エラーハンドリング方針に関する情報が不足していると指摘しているが、既存パターンとの一貫性検証の観点が欠けている
  - ×（未検出）: この問題に触れていない

### P06: ロギング形式の既存パターンとの不一致
- **カテゴリ**: 実装パターンの既存パターンとの一致（ログ出力）
- **深刻度**: 軽微
- **該当箇所**: セクション6.2 ロギング方針
- **問題の説明**: 設計書では`[timestamp] [level] [thread] [class] - message`の平文形式を採用しているが、既存プロジェクトのロギング形式（平文 vs 構造化ログ(JSON)）が設計書に明記されておらず、新設計が既存方式と一致しているか不明。
- **検出判定基準**:
  - ○（検出）: 既存プロジェクトのロギング形式が設計書に明記されていないこと、および平文形式が既存パターンと一致しているかを検証する必要があることを指摘している
  - △（部分検出）: ロギング形式に関する情報が不足していると指摘しているが、既存パターンとの一貫性検証の観点が欠けている
  - ×（未検出）: この問題に触れていない

### P07: API動詞使用パターンの既存との不一致
- **カテゴリ**: API/インターフェース設計の既存パターンとの一致
- **深刻度**: 中
- **該当箇所**: セクション5.1 エンドポイント一覧
- **問題の説明**: 新規API設計で`/api/appointments/create`のようにパスに動詞（`create`）を含めているが、RESTful設計の一般的なパターンでは`POST /api/appointments`のように動詞をHTTPメソッドに委ねる。既存APIの動詞使用パターン（パスに含む vs HTTPメソッドのみ）が設計書に明記されておらず、新設計が既存方式と一致しているか不明。
- **検出判定基準**:
  - ○（検出）: 既存APIの動詞使用パターンが設計書に明記されていないこと、および`/api/appointments/create`が既存パターンと一致しているかを検証する必要があることを指摘している
  - △（部分検出）: API設計に関する情報が不足していると指摘しているが、動詞使用パターンの一貫性検証の観点が欠けている
  - ×（未検出）: この問題に触れていない

### P08: トランザクション管理パターンの情報欠落
- **カテゴリ**: 実装パターンの既存パターンとの一致（情報欠落）
- **深刻度**: 重大
- **該当箇所**: セクション6 実装方針
- **問題の説明**: データアクセスパターンとして「Spring Data JPA」の使用は明記されているが、トランザクション管理の方針（`@Transactional`の配置レイヤー、伝播レベル、分離レベル等）が設計書に記載されておらず、既存プロジェクトのトランザクション管理パターンとの一貫性が検証できない。
- **検出判定基準**:
  - ○（検出）: トランザクション管理の方針が設計書に明記されていないこと、および既存プロジェクトのトランザクション管理パターンとの一貫性が検証できないことを指摘している
  - △（部分検出）: 実装パターンに関する情報が不足していると指摘しているが、トランザクション管理の具体的な観点が欠けている
  - ×（未検出）: この問題に触れていない

### P09: ディレクトリ構造・ファイル配置方針の情報欠落
- **カテゴリ**: ディレクトリ構造・ファイル配置の既存パターンとの一致（情報欠落）
- **深刻度**: 中
- **該当箇所**: セクション3 アーキテクチャ設計
- **問題の説明**: レイヤー構成は記載されているが、ファイル配置方針（ドメイン別フォルダ vs レイヤー別フォルダ、パッケージ構造等）が設計書に明記されておらず、既存プロジェクトのディレクトリ構造との一貫性が検証できない。
- **検出判定基準**:
  - ○（検出）: ファイル配置方針が設計書に明記されていないこと、および既存プロジェクトのディレクトリ構造との一貫性が検証できないことを指摘している
  - △（部分検出）: アーキテクチャ設計に関する情報が不足していると指摘しているが、ディレクトリ構造の具体的な観点が欠けている
  - ×（未検出）: この問題に触れていない

### P10: JWTトークン保存先の既存パターンとの不一致
- **カテゴリ**: 実装パターンの既存パターンとの一致（認証・認可）
- **深刻度**: 中
- **該当箇所**: セクション5.3 認証・認可方式
- **問題の説明**: 設計書では認証トークンの保存先として「localStorage」を採用しているが、既存プロジェクトの認証トークン保存方式（localStorage vs httpOnly Cookie vs sessionStorage）が設計書に明記されておらず、新設計が既存方式と一致しているか不明。
- **検出判定基準**:
  - ○（検出）: 既存プロジェクトの認証トークン保存方式が設計書に明記されていないこと、およびlocalStorageの使用が既存パターンと一致しているかを検証する必要があることを指摘している
  - △（部分検出）: 認証方式に関する情報が不足していると指摘しているが、トークン保存方式の一貫性検証の観点が欠けている
  - ×（未検出）: この問題に触れていない

## ボーナス問題リスト

正解キーに含めないが、検出された場合にボーナスとして加点する問題の候補:

| ID | カテゴリ | 内容 | ボーナス条件 |
|----|---------|------|------------|
| B01 | 命名規約 | テーブル名の複数形/単数形の混在（`PatientAccount`は単数形、`appointment`も単数形だが、通常は複数形`appointments`を採用） | テーブル名の単数形/複数形の不統一を指摘し、既存パターンとの一貫性を確認する必要があることを述べている |
| B02 | 依存管理 | HTTP通信ライブラリとして「Spring WebFlux (WebClient)」を採用しているが、既存プロジェクトでの使用状況が不明（既存が`RestTemplate`の場合は不一致） | HTTP通信ライブラリの選定が既存プロジェクトと一致しているかを検証する必要があることを指摘している |
| B03 | 設定管理 | 環境変数の命名規則が設計書に明記されていない | 環境変数の命名規則が設計書に記載されていないことを指摘している |
| B04 | 命名規約 | カラム名の混在（`PatientAccount`テーブルの`email_address`, `full_name`, `date_of_birth`, `phone_number`はsnake_caseだが、`appointment`テーブルの`appointmentId`等はcamelCase） | カラム命名規則の混在を包括的に指摘している（P01/P02で個別に指摘済みのため、全体的な視点での指摘がある場合にボーナス） |
