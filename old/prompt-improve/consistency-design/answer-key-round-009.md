# 正解キー

## 実行条件
- **観点**: consistency
- **対象**: design
- **埋め込み問題数**: 10問

## 埋め込み問題一覧

### P01: データモデル命名規約の混在（テーブル名）
- **カテゴリ**: 命名規約の既存パターンとの一致
- **深刻度**: 重大
- **該当箇所**: セクション4（データモデル）
- **問題の説明**: テーブル名の命名パターンが混在している。`delivery`, `driver`, `customer` は単数形、`warehouse` は単数形だがPKカラム名が `id` で他テーブルと異なる規則を使用。既存システムでテーブル名の単数/複数形のパターンが統一されている場合、新テーブルもそれに従う必要がある。
- **検出判定基準**:
  - ○（検出）: テーブル名の単数/複数形の不統一、または `warehouse.id` が他テーブルの `{table}_id` パターンと異なることを指摘し、既存パターンとの一貫性検証が必要と推奨している
  - △（部分検出）: テーブル命名に言及しているが、既存パターンとの比較が明示されていない、またはPKカラム名の不統一のみを指摘している
  - ×（未検出）: テーブル命名規約の不整合に言及していない

### P02: データモデル命名規約の混在（タイムスタンプ列名）
- **カテゴリ**: 命名規約の既存パターンとの一致
- **深刻度**: 重大
- **該当箇所**: セクション4（データモデル）
- **問題の説明**: タイムスタンプ列の命名パターンが4種類混在している（`created_at/updated`, `created_date/last_updated`, `createdAt/updatedAt`, `created/modified`）。既存システムで統一されたタイムスタンプ命名規則がある場合、新テーブルもそれに従う必要がある。
- **検出判定基準**:
  - ○（検出）: タイムスタンプ列の命名パターンが複数種類混在していることを指摘し、既存パターンとの一貫性検証が必要と推奨している
  - △（部分検出）: タイムスタンプ列の命名に言及しているが、具体的なパターン混在を特定していない、またはスネークケース/キャメルケースの混在のみを指摘している
  - ×（未検出）: タイムスタンプ列の命名不整合に言及していない

### P03: 外部キー列命名規約の混在
- **カテゴリ**: 命名規約の既存パターンとの一致
- **深刻度**: 中
- **該当箇所**: セクション4（データモデル）delivery テーブル
- **問題の説明**: 外部キー列の命名パターンが混在している。`customer_id`, `driver_id` は `{entity}_id` パターンだが、`warehouse_id` は参照先が `warehouse.id`（`warehouse.warehouse_id` ではない）。既存システムで外部キー命名規則が統一されている場合、それに従う必要がある。
- **検出判定基準**:
  - ○（検出）: 外部キー列と参照先PKの命名パターンの不整合を指摘し、既存パターンとの一貫性検証が必要と推奨している
  - △（部分検出）: 外部キー命名に言及しているが、参照先PKとの関係を含めた分析ができていない
  - ×（未検出）: 外部キー命名規約の不整合に言及していない

### P04: API設計（HTTPメソッド使用パターンの混在）
- **カテゴリ**: API/インターフェース設計の既存パターンとの一致
- **深刻度**: 中
- **該当箇所**: セクション5（API設計）
- **問題の説明**: 更新系APIで `PATCH` と `PUT` が混在している（`PATCH /deliveries/{id}/status` と `PUT /drivers/{id}/location`）。既存APIエンドポイントで部分更新に統一的なHTTPメソッドを使用している場合、新APIもそれに従う必要がある。
- **検出判定基準**:
  - ○（検出）: HTTPメソッド選択（PATCH vs PUT）の不統一を指摘し、既存APIパターンとの一貫性検証が必要と推奨している
  - △（部分検出）: HTTPメソッド使用に言及しているが、既存パターンとの比較が明示されていない
  - ×（未検出）: HTTPメソッドの不統一に言及していない

### P05: API設計（エンドポイント命名規則の不整合）
- **カテゴリ**: API/インターフェース設計の既存パターンとの一致
- **深刻度**: 中
- **該当箇所**: セクション5（API設計）
- **問題の説明**: トラッキングAPIエンドポイント `/track/{orderNumber}` が他のAPI（`/api/v1/...`）と異なるパスプレフィックスを使用している。既存APIで統一的なパスプレフィックス規則がある場合、新APIもそれに従う必要がある。
- **検出判定基準**:
  - ○（検出）: トラッキングAPIのパスプレフィックスが他のエンドポイントと異なることを指摘し、既存パターンとの一貫性検証が必要と推奨している
  - △（部分検出）: エンドポイント構造に言及しているが、パスプレフィックスの不統一の具体的指摘がない
  - ×（未検出）: エンドポイント命名規則の不整合に言及していない

### P06: 実装パターン（HTTP通信ライブラリ選定）
- **カテゴリ**: 実装パターンの既存パターンとの一致
- **深刻度**: 中
- **該当箇所**: セクション2（技術スタック）
- **問題の説明**: 新設計は `RestTemplate` を使用しているが、Spring Boot 3.x系では `WebClient` が推奨されており、既存プロジェクトで `WebClient` を標準採用している場合は一貫性を保つべき。HTTP通信ライブラリの選定が既存パターンと異なる可能性がある。
- **検出判定基準**:
  - ○（検出）: `RestTemplate` の使用が既存プロジェクトのHTTP通信ライブラリ選定パターンと一致しているか検証が必要と指摘している
  - △（部分検出）: HTTP通信ライブラリに言及しているが、既存パターンとの一貫性検証の必要性を明示していない
  - ×（未検出）: HTTP通信ライブラリの選定に言及していない

### P07: 実装パターン（データアクセス・トランザクション管理方針の情報欠落）
- **カテゴリ**: 実装パターンの既存パターンとの一致（情報欠落）
- **深刻度**: 重大
- **該当箇所**: セクション6（実装方針）
- **問題の説明**: データアクセスパターン（Repository直接呼び出し/サービス層での複数Repository呼び出し等）およびトランザクション管理の方針（`@Transactional` の配置ルール、トランザクション境界）が設計書に明記されていない。既存コードベースでこれらのパターンが統一されている場合、新実装もそれに従う必要があるが、現状では検証不可能。
- **検出判定基準**:
  - ○（検出）: データアクセスパターンおよびトランザクション管理の方針が設計書に明記されておらず、既存パターンとの一貫性が検証できないと指摘している
  - △（部分検出）: データアクセスまたはトランザクション管理のいずれか一方のみに言及している、または既存パターンとの一貫性検証の必要性を明示していない
  - ×（未検出）: データアクセスパターン・トランザクション管理方針の欠落に言及していない

### P08: ディレクトリ構造・ファイル配置方針の情報欠落
- **カテゴリ**: ディレクトリ構造・ファイル配置の既存パターンとの一致（情報欠落）
- **深刻度**: 軽微
- **該当箇所**: 全体（セクション6に含まれるべき内容が欠落）
- **問題の説明**: ファイル配置ルール（ドメイン別/レイヤー別フォルダ構成）が設計書に明記されていない。既存コードベースで統一的なディレクトリ構造規則がある場合、新実装もそれに従う必要があるが、現状では検証不可能。
- **検出判定基準**:
  - ○（検出）: ファイル配置方針・ディレクトリ構造が設計書に明記されておらず、既存パターンとの一貫性が検証できないと指摘している
  - △（部分検出）: ディレクトリ構造に言及しているが、既存パターンとの一貫性検証の必要性を明示していない
  - ×（未検出）: ディレクトリ構造・ファイル配置方針の欠落に言及していない

### P09: 実装パターン（非同期処理パターンの情報欠落）
- **カテゴリ**: 実装パターンの既存パターンとの一致（情報欠落）
- **深刻度**: 軽微
- **該当箇所**: セクション6（実装方針）
- **問題の説明**: リアルタイム位置情報更新やルート最適化などの非同期処理パターン（`@Async` アノテーション使用、CompletableFuture、メッセージキュー等）が設計書に明記されていない。既存コードベースで統一的な非同期処理パターンがある場合、新実装もそれに従う必要があるが、現状では検証不可能。
- **検出判定基準**:
  - ○（検出）: 非同期処理パターンが設計書に明記されておらず、既存パターンとの一貫性が検証できないと指摘している
  - △（部分検出）: 非同期処理に言及しているが、既存パターンとの一貫性検証の必要性を明示していない
  - ×（未検出）: 非同期処理パターンの欠落に言及していない

### P10: 依存管理（設定管理・環境変数命名規則の情報欠落）
- **カテゴリ**: API/インターフェース設計・依存関係の既存パターンとの一致（情報欠落）
- **深刻度**: 軽微
- **該当箇所**: 全体（セクション6に含まれるべき内容が欠落）
- **問題の説明**: 設定ファイル形式（application.yml vs application.properties）、環境変数命名規則（大文字スネークケース vs キャメルケース等）が設計書に明記されていない。既存プロジェクトでこれらのパターンが統一されている場合、新実装もそれに従う必要があるが、現状では検証不可能。
- **検出判定基準**:
  - ○（検出）: 設定管理方針・環境変数命名規則が設計書に明記されておらず、既存パターンとの一貫性が検証できないと指摘している
  - △（部分検出）: 設定管理または環境変数命名のいずれか一方のみに言及している、または既存パターンとの一貫性検証の必要性を明示していない
  - ×（未検出）: 設定管理・環境変数命名規則の欠落に言及していない

## ボーナス問題リスト

正解キーに含めないが、検出された場合にボーナスとして加点する問題の候補:

| ID | カテゴリ | 内容 | ボーナス条件 |
|----|---------|------|------------|
| B01 | 命名 | Boolean列 `is_active` のプレフィックスパターンが他テーブルで統一されていない可能性を指摘 | 既存パターンとの一貫性検証の必要性を推奨 |
| B02 | API設計 | レスポンス構造内のタイムスタンプフィールド命名（`timestamp` vs `createdAt/updatedAt`）が統一されていない可能性を指摘 | 既存APIレスポンス形式との一貫性検証の必要性を推奨 |
| B03 | 実装パターン | JWT保存方式（HTTP-only Cookie）が既存認証パターンと一致しているか検証が必要 | 既存認証実装パターンとの一貫性検証を推奨 |
| B04 | データモデル | ENUM値の命名規則（`PENDING`, `IN_TRANSIT` 等の大文字スネークケース）が既存パターンと一致しているか検証が必要 | 既存ENUM命名パターンとの一貫性検証を推奨 |
| B05 | 命名 | 外部キー制約名、インデックス名の命名規則が設計書に明記されていない | 既存パターンとの一貫性が検証できないことを指摘 |
| B06 | 実装パターン | WebSocket通信のメッセージフォーマット・プロトコルが設計書に明記されていない | 既存リアルタイム通信パターンとの一貫性が検証できないことを指摘 |
