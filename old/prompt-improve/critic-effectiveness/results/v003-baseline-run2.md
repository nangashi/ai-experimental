# 有効性レビュー結果 - Round 003 Run 2

## レビュー対象
- テスト文書: test-document-round-003.md (SmartHealth IoT Platform システム設計書)
- プロンプト: v003-baseline.md
- 実行日時: 2026-02-11

---

## ステップ1: 文書の理解

### 主要目的
医療機関向けリアルタイムバイタルモニタリングシステムの設計書。ウェアラブルデバイスからバイタルデータを収集し、医療スタッフに異常アラートを提供する。

### 評価スコープ（設計文書全体）
1. アーキテクチャ設計の実現可能性と整合性
2. データモデルとAPI設計の完全性
3. 非機能要件の具体性と測定可能性
4. セキュリティとコンプライアンス要件の妥当性
5. 運用・保守の考慮事項

---

## ステップ2: 有効性の分析

### この観点で検出される問題（修正可能な具体的改善）

**問題1: 保存データの暗号化欠如（7.2節）**
- 現状: 「患者データは暗号化せずにRDS上に保存（VPC内なので問題ない）」
- 問題: 医療データは HIPAA/個人情報保護法の対象。VPC内でも保存時暗号化は必須
- 具体的改善: RDS暗号化有効化、KMSキー管理の追加

**問題2: 手動スケーリング依存（7.3節）**
- 現状: 「CPU使用率が70%を超えたら手動でタスク数を増やす」
- 問題: バイタルデータのスパイク時に手動対応では遅延発生リスク
- 具体的改善: ECS Auto Scaling設定（Target Tracking Policy: CPU 70%）

**問題3: JWT保存場所のセキュリティリスク（5.2節）**
- 現状: 「トークンはlocalStorageに保存」
- 問題: XSS攻撃でトークン漏洩リスク。医療データアクセスには不適切
- 具体的改善: httpOnly Cookie + CSRF対策または secure sessionStorage + 短期有効期限

**問題4: エラーハンドリングの具体性欠如（6.1節）**
- 現状: 「共通のエラーレスポンス形式を使用」のみ記載
- 問題: リトライ可能エラー/不可能エラーの判定基準なし。クライアント側実装が不明確
- 具体的改善: エラーコード体系定義（4xx/5xx詳細）、リトライポリシー明記

**問題5: 災害復旧の実効性欠如（8.3節）**
- 現状: 「RTO: 4時間、RPO: 24時間」だが「DR環境は未構築」
- 問題: DR環境なしでRTO 4時間達成不可能。宣言と実装の矛盾
- 具体的改善: DR環境構築計画または現実的なRTO/RPO値への修正（例: RTO 48時間）

**問題6: 監査ログの不完全性（8.1節）**
- 現状: API呼び出しのみ記録。データ項目は `{timestamp, userId, action, resource, result}`
- 問題: デバイスからのデータ取り込み（MQTT → Kafka → InfluxDB）は監査対象外。患者データ変更の追跡不能
- 具体的改善: InfluxDB書き込みイベントの監査ログ追加、変更前後の値記録

**問題7: デバイス通信途絶検知の遅延（7.4節）**
- 現状: 「デバイスの通信途絶は5分後に検知」
- 問題: バイタルモニタリングで5分遅延は生命リスク。緊急アラートが機能不全
- 具体的改善: last_heartbeat監視間隔を30秒に短縮、critical患者は10秒間隔

**問題8: InfluxDBバックアップの信頼性不足（8.2節）**
- 現状: 「週次手動バックアップ」
- 問題: RPO 24時間に対して週次は不整合。手動運用は人的エラーリスク
- 具体的改善: InfluxDB自動バックアップ（日次）、S3へのエクスポート自動化

---

## ステップ3: 境界明確性の検証

（注: プロンプトは既存観点との照合を要求しているが、本レビューはスタンドアロン実行のため省略）

---

## ステップ4: 結論の導出

### 有効性批評結果

#### 重大な問題（根本的な再設計が必要）

- **[問題5] 災害復旧の実効性欠如**: RTO/RPO宣言とDR環境未構築の矛盾。医療システムとして信頼性要件を満たさない。DR環境構築または現実的なRTO/RPO再定義が必須。

- **[問題1] 保存データの暗号化欠如**: 医療データをVPC内でも平文保存は法令違反リスク。RDS暗号化とKMS管理は設計段階での必須要件。

#### 改善提案（品質向上に有効）

- **[問題3] JWT保存のセキュリティリスク**: localStorage使用はXSS攻撃耐性なし。httpOnly Cookie移行で実装変更は軽微だが効果大。

- **[問題2] 手動スケーリング依存**: バイタルスパイク時の手動対応は非現実的。ECS Auto Scaling設定で運用負荷軽減とレスポンス改善。

- **[問題7] デバイス通信途絶検知遅延**: 5分間隔は医療モニタリングとして不適切。30秒/10秒への短縮で早期異常検知が可能。

- **[問題6] 監査ログの不完全性**: データ取り込みパス（MQTT → InfluxDB）が監査対象外。InfluxDB書き込みイベントログ追加で追跡性向上。

- **[問題8] InfluxDBバックアップの信頼性不足**: 週次手動バックアップはRPO不整合。日次自動化でデータ損失リスク低減。

- **[問題4] エラーハンドリング詳細欠如**: エラーコード体系とリトライポリシー明記でクライアント実装の一貫性向上。

#### 確認（良い点）

- **技術スタック選定の妥当性**: Spring Boot/FastAPI/InfluxDBの組み合わせは時系列データ処理に適切。
- **アーキテクチャの明確性**: IoTゲートウェイ → Kafka → 取り込みサービスの責務分離が明示的。
- **監査ログ保持期間**: 7年保存は医療法令要件に準拠。
- **テスト方針の具体性**: JUnit/TestContainers/Cypressの3層テスト戦略が明確。
- **認証機構の基本設計**: JWT + ロールベースアクセス制御の枠組みは妥当（保存場所改善要）。
