# 改善計画: agent_audit_new

## 変更対象ファイル
| # | ファイル | 変更種別 | 変更概要 | 対応フィードバック |
|---|---------|---------|---------|------------------|
| 1 | templates/apply-improvements.md | 修正 | 二重適用チェックにおける保持変数の更新ロジック明示化 | architecture: I-3 |

## 各ファイルの変更詳細

### 1. templates/apply-improvements.md（修正）
**対応フィードバック**: architecture: I-3: apply-improvements 二重適用チェック実装の補強

**変更内容**:
- **行21の二重適用チェックセクション**: 現在の記述「Edit 前に対象箇所の現在の内容が findings の前提と一致するか確認する。手順1で Read した {agent_path} の内容を保持し、適用時の二重適用チェックではその保持内容を使用する。再度 Read する必要はない。一致しない場合（既に改善済みまたは別の変更あり）はその変更をスキップし、skipped リストに理由を記録する」 → 「Edit 前に対象箇所の現在の内容が findings の前提と一致するか確認する。手順1で Read した {agent_path} の内容を保持し、適用時の二重適用チェックではその保持内容を使用する。再度 Read する必要はない。各 finding 適用後は保持内容を変更後の内容に更新し、次の finding の二重適用チェックでは更新後の保持内容を使用する。一致しない場合（既に改善済みまたは別の変更あり）はその変更をスキップし、skipped リストに理由を記録する」

**具体的な追加箇所**:
- 二重適用チェックの説明の中に「各 finding 適用後は保持内容を変更後の内容に更新し、次の finding の二重適用チェックでは更新後の保持内容を使用する」という1文を挿入
- これにより、複数 findings が同一箇所に影響する場合の検証手順が明示される

## 新規作成ファイル
（該当なし）

## 削除推奨ファイル
（該当なし）

## 実装順序
1. templates/apply-improvements.md の修正（単一ファイル変更のため依存関係なし）

依存関係の検出方法:
- 今回は単一ファイルの修正のため依存関係は存在しない
- apply-improvements.md は Phase 2 Step 4 で使用されるテンプレートであり、他のファイルから参照されているが、このテンプレート内部のロジック改善は他のファイルに影響を与えない

## 注意事項
- 変更は二重適用チェックの動作ロジックを明示化するものであり、既存のワークフローには影響しない
- SKILL.md の Phase 2 Step 4 の説明（行243）では apply-improvements.md を読み込むだけであり、参照箇所の更新は不要
- 二重適用チェックの動作が明確になることで、複数 findings が同一箇所を変更する際のサブエージェントの実装品質が向上する
