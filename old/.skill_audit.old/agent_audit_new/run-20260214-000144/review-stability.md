### 安定性レビュー結果

#### 重大な問題
- [参照整合性: 外部ファイルパスの不一致]: [SKILL.md] [line 64, 221, 115] SKILL.md内で `.claude/skills/agent_audit/` 配下のファイルを参照しているが、スキル本体は `.claude/skills/agent_audit_new/` に配置されている。具体的には: (1) line 64: `group-classification.md` の参照先が `/agent_audit/` (2) line 221: `templates/apply-improvements.md` の参照先が `/agent_audit/` (3) line 115: `agents/{dim_path}.md` の参照先が `/agent_audit/agents/` → すべての参照を `.claude/skills/agent_audit_new/` に修正する。または、group-classification.md と apply-improvements.md をスキルディレクトリ内にコピーする [impact: high] [effort: low]
- [参照整合性: agent_bench配下ファイルのスコープ外参照]: [SKILL.md] [line なし（スキル全体構造の問題）] スキルディレクトリ内に `agent_bench/` サブディレクトリが存在し、別スキル（agent_benchスキル）の全ファイルが含まれている。analysis.md (line 72) の注記によれば「agent_bench配下のファイルは外部スキルとして独立しているため、本スキルの外部参照には含めない」とあるが、実際にはスキルディレクトリ内に配置されている。これはスキル境界が曖昧であり、参照整合性の判定基準が不明確 → agent_bench ファイルをスキルディレクトリ外に移動するか、スキル構造を明確に分離する [impact: medium] [effort: high]
- [冪等性: Phase 1再実行時のfindingsファイル重複]: [SKILL.md] [line 111-122] Phase 1でサブエージェントが `.agent_audit/{agent_name}/audit-{ID_PREFIX}.md` にfindingsを Write で保存するが、再実行時に既存ファイルが存在する場合の処理が定義されていない。サブエージェントがファイル上書き（Write）を使用する場合、再実行は冪等だが、Edit や追記を使用する場合は重複する。テンプレート（agents/*/md）で Write を使用することが保証されていない → Phase 1開始時に既存の audit-*.md ファイルを削除するステップを追加するか、サブエージェントテンプレートで Write 使用を明示する [impact: medium] [effort: low]
- [条件分岐の欠落: Phase 2 改善適用失敗時のelse節]: [SKILL.md] [line 213-227] Phase 2 Step 4 でサブエージェントに改善適用を委譲するが、サブエージェント実行失敗時の処理が定義されていない。検証ステップ（line 228-236）は改善適用が完了した前提で構造検証を行うが、サブエージェント自体の失敗（Task ツールのエラー、サブエージェントのクラッシュ等）への対応が欠落している → サブエージェント失敗時の動作（エラー出力 + Phase 3 へスキップ、またはユーザー確認）を明示する [impact: high] [effort: medium]
- [参照整合性: Phase 1サブエージェント返答フォーマットの不一致]: [SKILL.md] [line 118-123] Phase 1のサブエージェント返答は「`dim: {次元名}, critical: {N}, improvement: {M}, info: {K}`」と定義されているが、line 126 で「findings ファイル内の `## Summary` セクションから抽出する（抽出失敗時は findings ファイル内の `### {ID_PREFIX}-` ブロック数から推定する）」とある。これは返答フォーマットとfindings ファイルフォーマットの2つの情報源が存在し、一貫性が保証されていない。サブエージェントが返答を誤った場合、親がfindings ファイルから再抽出するフォールバック機構だが、この動作は曖昧 → 件数取得はfindings ファイルの Summary セクションのみに一本化し、サブエージェント返答からの抽出を削除する [impact: medium] [effort: low]

#### 改善提案
- [出力フォーマット決定性: Phase 2 Step 4サブエージェント返答フォーマットの曖昧性]: [SKILL.md] [line 226] 「返答内容（変更サマリ）をテキスト出力する」とあるが、サブエージェントが返すべき具体的なフォーマットが定義されていない。テンプレート（apply-improvements.md）には返答フォーマット定義があるが、SKILL.md 側には「複数行（`modified: {N}件 ... skipped: {K}件 ...`）」という曖昧な記述のみ（line 123）。親がどのように返答を処理するか不明確 → テンプレート側の返答フォーマットとSKILL.md の期待フォーマットを一致させる [impact: medium] [effort: low]
- [冪等性: Phase 2バックアップファイルの重複生成]: [SKILL.md] [line 217] バックアップファイル名に `$(date +%Y%m%d-%H%M%S)` を使用しているため、再実行時に毎回新規ファイルが生成される。バックアップが累積し、ディスク容量を圧迫する可能性がある。また、Phase 3 で最新バックアップのパスを返すが、複数存在する場合の扱いが未定義 → 既存バックアップの削除条件（最新N件のみ保持、または再実行時は前回バックアップを上書き）を定義する [impact: low] [effort: low]
- [条件分岐の適正化: Phase 1サブエージェント失敗判定の過剰分岐]: [SKILL.md] [line 125-129] Phase 1の成否判定で「findings ファイルが存在し、空でない → 成功」「存在しない、または空 → 失敗。Task ツールの返答から例外情報を抽出」とあるが、Task ツールのエラー処理は LLM が自然に実行できる。また、findings ファイル内の Summary セクション抽出失敗時の段階的リカバリ（ブロック数から推定）は階層2の過剰処理に該当する → 成否判定をシンプルに「findings ファイルが存在し、Summary セクションが含まれる → 成功」のみに簡素化し、抽出失敗時のフォールバックを削除する [impact: low] [effort: medium]
- [指示の具体性: Phase 0 グループ分類の判定基準参照の曖昧性]: [SKILL.md] [line 62-72] グループ分類の判定ルール（概要）が記載されているが、「分類基準の詳細は `.claude/skills/agent_audit/group-classification.md` を参照」とある。親エージェントがこの判定を直接行う（サブエージェント不要、line 72）ため、判定に必要な全情報をSKILL.md に記載すべき。外部ファイル参照は親のコンテキストを増加させる → group-classification.md の全内容をSKILL.md の Phase 0 に埋め込むか、判定ルールを完全に記述する [impact: low] [effort: medium]
- [条件分岐の欠落: Phase 0 frontmatter不在時の動作方針]: [SKILL.md] [line 58] frontmatter 不在時に「警告を出力するが処理は継続する」とあるが、エージェント定義でないファイル（README、ドキュメント等）を誤って指定された場合、Phase 1 以降の処理が無意味な分析を実行する。ユーザーに確認するか中止するかのフォールバックがない → AskUserQuestion で「エージェント定義ではない可能性があります。続行しますか？」の確認を追加する [impact: low] [effort: low]
- [参照整合性: SKILL.md内のパス変数リスト欠落]: [SKILL.md] [全体] テンプレート（apply-improvements.md）および各エージェントファイル（agents/*/md）で使用されているパス変数（`{agent_path}`, `{approved_findings_path}`, `{findings_save_path}`, `{agent_name}`）がSKILL.md に一覧として定義されていない。Phase 1（line 115-122）で個別に説明されているが、統一された変数リストが存在しないため、テンプレート側との整合性確認が困難 → SKILL.md の冒頭または Phase 0 の後に「パス変数リスト」セクションを追加し、全変数を一覧化する [impact: low] [effort: low]
- [参照整合性: Phase 2 Step 3 保存ファイルのフォーマット定義の冗長性]: [SKILL.md] [line 189-209] `audit-approved.md` のフォーマットが詳細に定義されているが、このファイルは Phase 2 Step 4 のサブエージェント（apply-improvements.md）が読み込む。サブエージェントテンプレート側にもフォーマット期待値があるべきだが、SKILL.md にのみ記載されているため、両者の一致を保証する仕組みがない → audit-approved.md のフォーマット定義をテンプレート側に移動するか、共有ドキュメントを作成する [impact: low] [effort: medium]

#### 良い点
- [冪等性: Phase 2バックアップ作成]: Phase 2 Step 4 で改善適用前にバックアップを作成し（line 217）、検証失敗時のロールバック手順を明示している（line 235）。データ損失リスクを低減する適切な設計
- [出力フォーマット決定性: Phase 1サブエージェント返答の厳密な定義]: Phase 1 のサブエージェント返答フォーマットが1行の具体的なテンプレート（`dim: {次元名}, critical: {N}, improvement: {M}, info: {K}`）として定義されており（line 118）、親のパース処理が安定する
- [条件分岐の適正化: Phase 2承認方針の明確な分岐]: Phase 2 Step 2（line 163-166）で「全て承認」「1件ずつ確認」「キャンセル」の3分岐が明示され、Phase 2a のper-item承認ループ（line 168-185）では4つの選択肢が定義されており、ユーザー入力に対する動作が予測可能
