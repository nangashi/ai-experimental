### 安定性レビュー結果

#### 重大な問題
- [E. 参照整合性: プレースホルダの未定義]: [SKILL.md] [行244-247] Task promptでテンプレートに渡す `{approved_findings_path}` が、apply-improvements.mdでは定義されているが、SKILL.md内のパス変数リスト（行8-13の「## パス変数」セクションに該当する箇所が存在しない）に記載されていない → SKILL.mdに「パス変数」セクションを追加し、全プレースホルダを明示的に定義する [impact: medium] [effort: low]
- [D. 冪等性: 再実行時の状態破壊]: [SKILL.md] [行81] 出力ディレクトリ作成 `mkdir -p .agent_audit/{agent_name}/` のみ記載があり、既存ディレクトリがある場合の挙動（上書き、スキップ、エラー）が未定義 → 「既存ディレクトリが存在する場合はそのまま使用する」と明記し、既存ファイル（findings, approved）の扱いを定義する [impact: medium] [effort: low]
- [C. 条件分岐の完全性: デフォルト処理の欠落]: [SKILL.md] [行227-231] 改善適用の確認でキャンセル選択時の処理は記載されているが、AskUserQuestionの返答タイムアウトや不正入力時の処理が未定義 → タイムアウト/不正入力時は「キャンセル」として扱うことを明記する [impact: medium] [effort: low]
- [B. 出力フォーマット決定性: サブエージェント返答の不完全検証]: [SKILL.md] [行125] 返答バリデーションで「フォーマット不正時は件数を '?' として表示」とあるが、'?' を保持したまま後続処理（Phase 2のソート、一覧表示）で数値演算や比較が必要な場合の処理が未定義 → '?' の場合は件数を0として扱うか、該当次元を失敗として扱うかを明記する [impact: medium] [effort: low]
- [E. 参照整合性: ファイル不在時の挙動]: [SKILL.md] [行64] `group-classification.md` を参照しているが、このファイルが存在しない場合の処理（エラー終了、スキップ、組み込みルールで継続）が未定義 → 「スキル内部ファイルが不在の場合はエラー終了する」と明記する [impact: high] [effort: low]

#### 改善提案
- [C. 条件分岐の完全性: 部分成功条件の曖昧性]: [SKILL.md] [行131-136] 部分成功判定で「グループ固有次元（CE, SA, DC, WC, OF）が全て失敗した場合」とあるが、グループ固有次元の範囲が各グループで異なるため、判定ロジックが曖昧。例: unclassifiedの場合、固有次元はSA+WCの2つだが、producerの場合はWC+OF+SAの3つ → 各グループごとの固有次元リストを明示し、「該当グループの固有次元すべて」と記載する [impact: low] [effort: low]
- [D. 冪等性: バックアップの重複生成]: [SKILL.md] [行234-236] 既存バックアップがあれば再利用するロジックはあるが、Phase 2を複数回実行した場合、最初のバックアップが後続の適用後の状態を保存していない → 「バックアップは初回実行時のみ作成し、改善適用後は新規バックアップを作成しない」という方針を明記するか、「毎回タイムスタンプ付きバックアップを作成する」に変更する [impact: medium] [effort: low]
- [B. 出力フォーマット決定性: テキスト出力の一貫性]: [SKILL.md] [行109, 151] テキスト出力で `## Phase N: ...` 形式を使用しているが、Phase 0（行96-103）では `##` レベル、Phase 1（行109）では `##` レベル、Phase 2（行151）も `##` レベルと一貫している一方、サブセクション（Step 1, Step 2等）のマークダウンレベルが未指定 → Step 1-4も `###` レベルで統一することを明記する [impact: low] [effort: low]
- [C. 条件分岐の完全性: ユーザー確認選択肢の不足]: [SKILL.md] [行190-195] per-item承認で「残りすべて承認」はあるが、「残りすべてスキップ」がない → 対称性を保ち、「残りすべてスキップ」選択肢を追加する [impact: low] [effort: medium]
- [E. 参照整合性: 次元エージェントの返答フォーマット整合性]: [SKILL.md] [行118] Task promptで要求する返答フォーマット `dim: {次元名}, critical: {N}, improvement: {M}, info: {K}` だが、analysis.mdのサブエージェント一覧（行83-91）では返答行数を「4行」としている → フォーマットは1行だが、実際の返答が複数行になる可能性があるため、「1行（サマリ行のみ）」と明記する [impact: low] [effort: low]
- [D. 冪等性: findings ファイルの上書き挙動]: [SKILL.md] [行115-118] 次元サブエージェントが findings を保存する際、既存ファイルの扱い（上書き、追記、エラー）が未定義 → 「既存ファイルは上書きする（冪等性を保つため）」と各次元エージェントテンプレートに記載する [impact: low] [effort: low]
- [B. 出力フォーマット決定性: 変更詳細の表示条件]: [SKILL.md] [行293-295] 変更詳細セクションで「適用成功」「適用スキップ」を表示しているが、改善適用がキャンセルされた場合の表示内容が未定義 → キャンセル時は「変更詳細」セクションを非表示にするか、「改善適用はキャンセルされました」とのみ表示することを明記する [impact: low] [effort: low]

#### 良い点
- [D. 冪等性: バックアップ機構の存在]: Phase 2 Step 4でエージェント定義の自動バックアップを作成し、ロールバック手順を明示している（行234-236, 265, 296）
- [E. 参照整合性: 全ファイル参照が内部]: 外部参照の検出（analysis.md, 行30-38）で確認された通り、スキル外部への依存がなく、全参照がスキルディレクトリ内で完結している
- [C. 条件分岐の完全性: 多段階エラーハンドリング]: Phase 1のサブエージェント失敗時に部分成功判定を行い、全失敗/IC失敗/固有次元全失敗の3パターンで適切に処理を分岐している（行127-136）
