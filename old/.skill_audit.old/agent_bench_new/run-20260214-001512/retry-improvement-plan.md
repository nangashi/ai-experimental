# 改善計画: agent_bench_new

## 変更対象ファイル
| # | ファイル | 変更種別 | 変更概要 | 対応フィードバック |
|---|---------|---------|---------|------------------|
| 1 | templates/phase1b-variant-generation.md | 修正 | プロンプトファイル保存前の存在確認・条件分岐を追加 | Completeness: C-3 - バリアント再実行時の重複 |

## 各ファイルの変更詳細

### 1. templates/phase1b-variant-generation.md（修正）
**対応フィードバック**: Completeness: C-3 - バリアント再実行時の重複 - Phase 1B未対応

**変更内容**:
- **ステップ3（ベースライン保存前）**: 存在確認ロジックを追加
  - 現在: `3. ベースライン（比較用コピー）を {prompts_dir}/v{NNN}-baseline.md として保存する（NNN = 累計ラウンド数 + 1）`
  - 改善後: `3. ベースライン（比較用コピー）を保存する前に、{prompts_dir}/v{NNN}-baseline.md が既に存在するか確認する。存在する場合は警告を出力し、保存をスキップする。存在しない場合は {prompts_dir}/v{NNN}-baseline.md として保存する（NNN = 累計ラウンド数 + 1）`

- **ステップ4（バリアント保存前）**: 存在確認ロジックを追加
  - 現在: `4. 2個のバリアントを生成し {prompts_dir}/v{NNN}-variant-{name}.md として保存する`
  - 改善後: `4. 2個のバリアントを生成する。各バリアントについて、{prompts_dir}/v{NNN}-variant-{name}.md が既に存在するか確認する。存在する場合は警告を出力し、保存をスキップする。存在しない場合は {prompts_dir}/v{NNN}-variant-{name}.md として保存する`

## 新規作成ファイル
（なし）

## 削除推奨ファイル
（なし）

## 実装順序
1. templates/phase1b-variant-generation.md — Phase 1Bテンプレートにプロンプトファイル保存前の存在確認を追加（Phase 1Aと同様の処理）

依存関係の検出方法:
- 単一ファイルの修正であり、依存関係なし

## 注意事項
- Phase 1Aで実装された存在確認ロジックと一貫性を保つこと
- 警告メッセージは Phase 1A と同様の形式にすること（例: 「警告: {ファイルパス} は既に存在します。保存をスキップします。」）
- 存在確認は保存処理の直前で実行し、生成処理自体は通常通り実行すること
- ステップ5の返答フォーマットは変更しないこと
