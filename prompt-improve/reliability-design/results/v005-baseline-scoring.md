# Scoring Results: v005-baseline

## Run 1 Detection Matrix

| Problem ID | Detection | Score | Analysis |
|------------|-----------|-------|----------|
| **P01** | ○ | 1.0 | C1, C4明確にサーキットブレーカー、リトライ戦略、タイムアウト、フォールバック戦略の欠如を指摘。Slack API、SendGrid、Google Calendar API、GitHub APIに対する具体的な記述あり。 |
| **P02** | ○ | 1.0 | S4でPostgreSQL write → SQS publishの一貫性問題を明示的に指摘し、Outbox Patternを推奨している。 |
| **P03** | ○ | 1.0 | C3でWebSocketサーバー障害時のクライアント再接続、メッセージ配信保証、sticky sessionによる単一障害点のリスクを明示的に指摘。 |
| **P04** | ○ | 1.0 | M3でS3アップロード後の確認API失敗による孤児ファイル問題を明示的に指摘。ライフサイクルポリシーによるクリーンアップを推奨。 |
| **P05** | △ | 0.5 | S1で楽観的ロックの競合応答フォーマット、リトライ戦略、クライアントUIの改善を提案しているが、リトライ時のべき等性確保の方針が明示されていない。 |
| **P06** | △ | 0.5 | M2でバックグラウンドジョブのモニタリング、ハートビート、タイムアウトに言及しているが、具体的なリトライポリシーやDLQ設計の欠如を明示していない。 |
| **P07** | ○ | 1.0 | S6でECS Auto Scaling時のPostgreSQL接続プール枯渇リスクを明示的に指摘し、接続プール設定の計算式を提示。 |
| **P08** | ○ | 1.0 | S1でSLO/SLA定義の不足、REDメトリクス相当のSLI定義、アラート戦略、エスカレーションポリシーの欠如を指摘。C5でも分散トレーシング・SLOダッシュボードに言及。 |
| **P09** | △ | 0.5 | S5でBlue-Green Deployment時のヘルスチェックとデータベースマイグレーションの調整に言及しているが、expand-contractパターンなど後方互換性戦略を明示していない。 |
| **P10** | × | 0.0 | ロールバック時のデータ整合性問題（新バージョンで作成されたデータの旧バージョンとの互換性）についての指摘なし。 |

**検出スコア合計: 7.5**

## Run 1 Bonus/Penalty Analysis

### Bonus Items (+0.5 each, max 5 items)

1. **C5: ALBのSPOF分析** - 単一ALBの可用性リスクとマルチリージョンフェイルオーバーの欠如を指摘（perspectiveのSPOF特定に合致）
2. **C6: データベース接続プール枯渇** - 複数サービスによるPostgreSQL接続プール枯渇リスクを指摘（正解キーに未掲載の運用問題）
3. **S2: ファイルアップロードのレート制限** - 署名付きURL生成や同時アップロードに対するレート制限・バックプレッシャーの欠如（自己保護目的のレート制限はスコープ内）
4. **M1: PostgreSQL Multi-AZ レプリケーション遅延監視** - フェイルオーバー時のデータロスリスクとレプリケーション遅延監視の欠如（運用上の盲点）
5. **M4: WebSocketサーバーヘルスチェック** - WebSocket専用のヘルスチェック設計とALBターゲットグループ設定の欠如（監視の盲点）

**ボーナス件数: 5件**

### Penalty Items (-0.5 each, no max)

なし - 全ての指摘はreliabilityスコープ内（障害回復、データ整合性、可用性、監視、デプロイ）に該当

**ペナルティ件数: 0件**

## Run 1 Total Score

```
検出スコア: 7.5
ボーナス:  +2.5 (5件)
ペナルティ: -0.0 (0件)
-------------------
Run1合計:  10.0
```

---

## Run 2 Detection Matrix

| Problem ID | Detection | Score | Analysis |
|------------|-----------|-------|----------|
| **P01** | ○ | 1.0 | C-1で外部API（Auth0、Slack、SendGrid、Google Calendar、GitHub）のリトライロジック・サーキットブレーカーの欠如を明示。C-2でタイムアウト設計の欠如も指摘。 |
| **P02** | ○ | 1.0 | C-6でPostgreSQL→SQS→WebSocketの分散状態更新における一貫性保証の欠如を明示し、Transactional Outbox Patternを推奨。 |
| **P03** | ○ | 1.0 | C-4でWebSocketタスククラッシュ時の影響、sticky sessionによるSPOF、再接続ロジック・メッセージバッファリングの欠如を明示。 |
| **P04** | ○ | 1.0 | M-5でS3アップロード後の確認API未到達による孤児オブジェクト問題を指摘し、S3ライフサイクルポリシーによるクリーンアップを推奨。 |
| **P05** | ○ | 1.0 | S-2で楽観的ロックの競合時のリトライ戦略、クライアント側エラーハンドリング、衝突解決UIの不明確さを指摘。高競合シナリオでの運用設計も言及。 |
| **P06** | △ | 0.5 | M-2でバックグラウンドジョブの成功/失敗率、スタック検出、ハートビートメカニズムに言及しているが、具体的なタイムアウト・リトライポリシー・DLQ設計の欠如を明示していない。 |
| **P07** | ○ | 1.0 | S-6でECS Auto Scalingとデータベース接続プール枯渇の整合性問題を明示。接続プール設定の計算式と監視指標を提示。 |
| **P08** | ○ | 1.0 | S-1でSLO/SLA定義不足、REDメトリクス相当のSLI定義、アラート戦略、エラーバジェット計算の欠如を指摘。 |
| **P09** | △ | 0.5 | S-5でBlue-Green Deployment時のヘルスチェックとデータベースマイグレーション調整に言及しているが、expand-contractパターンなど後方互換性戦略を明示していない。 |
| **P10** | × | 0.0 | ロールバック時のデータ整合性問題（新バージョンで作成されたデータの旧バージョンとの互換性）についての指摘なし。 |

**検出スコア合計: 8.0**

## Run 2 Bonus/Penalty Analysis

### Bonus Items (+0.5 each, max 5 items)

1. **C-3: タスク更新とSQS通知のべき等性** - SQSメッセージ重複処理のべき等性メカニズム欠如を指摘（正解キーP02の焦点とは異なるべき等性問題）
2. **C-5: 分散トレーシングの欠如** - request_idのみでは不十分、SQS・WebSocketを含む分散トレーシング（X-Ray/Datadog APM）の必要性を指摘（障害調査のための運用ツール）
3. **C-7: レート制限・バックプレッシャーの欠如** - API、SQS、WebSocketに対する包括的なレート制限とバックプレッシャーメカニズムの欠如（自己保護目的のレート制限はスコープ内）
4. **S-3: 災害復旧ランブックとフェイルオーバーテスト** - RPO/RTOは定義されているが、具体的な手順書・テスト戦略・マルチリージョン設計の欠如（災害復旧計画の盲点）
5. **S-4: キャパシティプランニングとロードテスト戦略** - Auto-scalingは定義されているが、トラフィックモデル・リソースヘッドルーム計算・ボトルネック分析の欠如（運用上の問題）

**ボーナス件数: 5件**

### Penalty Items (-0.5 each, no max)

なし - 全ての指摘はreliabilityスコープ内（障害回復、データ整合性、可用性、監視、デプロイ、分散トレーシング）に該当

**ペナルティ件数: 0件**

## Run 2 Total Score

```
検出スコア: 8.0
ボーナス:  +2.5 (5件)
ペナルティ: -0.0 (0件)
-------------------
Run2合計:  10.5
```

---

## Overall Statistics

| Metric | Value |
|--------|-------|
| **Mean** | 10.25 |
| **Standard Deviation** | 0.35 |
| **Run1 Score** | 10.0 (検出7.5 + bonus5 - penalty0) |
| **Run2 Score** | 10.5 (検出8.0 + bonus5 - penalty0) |

## Key Observations

### Strengths
- 両実行とも正解キーの10問中7.5-8.0問を検出（75-80%検出率）
- 外部API障害回復設計（P01）、データ一貫性（P02）、WebSocketフェイルオーバー（P03）、ファイルアップロード整合性（P04）を安定して検出
- ECS Auto Scalingと接続プール整合性（P07）、SLO/監視設計（P08）も両実行で完全検出
- 各実行で5件のボーナス問題を検出し、正解キー以外の重要な運用上の問題も幅広くカバー

### Weaknesses
- **P10（ロールバック時のデータ整合性）**: 両実行とも未検出。新バージョンで作成されたデータの旧バージョンとの互換性問題に言及なし
- **P05（楽観的ロックの運用設計）**: Run1は△（リトライ時のべき等性未言及）、Run2は○（より包括的）
- **P06（Background Jobsのタイムアウト・リトライ設計）**: 両実行とも△（モニタリングやハートビートに言及するが、リトライポリシー・DLQ設計の明示的な欠如指摘なし）
- **P09（スキーマ変更の後方互換性）**: 両実行とも△（マイグレーション調整に言及するが、expand-contractパターンなど具体的戦略未明示）

### Consistency Analysis
- **標準偏差0.35（高安定）**: 2回の実行で非常に一貫した結果
- **検出パターンの一貫性**: P01-P04, P07-P08は両実行で完全検出、P05-P06, P09は両実行で△、P10は両実行で×
- **ボーナス問題の多様性**: Run1は接続プール・レプリケーション遅延・WebSocketヘルスチェック、Run2はべき等性・分散トレーシング・DRランブックと異なる視点を補完
