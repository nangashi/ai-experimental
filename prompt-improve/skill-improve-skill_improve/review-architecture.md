### アーキテクチャレビュー結果

#### 重大な問題
なし

#### 改善提案
- [テンプレート外部化の不一致]: [SKILL.md Phase 3] SKILL.md の Phase 3（Step 1-4）は約35行の密な処理ロジックを含む。フィードバック分類、コンフリクト検出・解決、判定基準ヒントの適用、複数の条件分岐が混在しており、7行超のサブエージェント指示に該当する。テンプレート `reviewer-feedback-consolidation.md` への外部化を推奨。理由: 親コンテキストの大幅削減（-30行）、処理の明示的な委譲、再利用性の向上。
- [テンプレート外部化の不一致]: [SKILL.md Phase 0] Phase 0 Step 7 の実行モード選択の説明（Standard/Fast の違い）は8行に及ぶ。ユーザー向けのテキスト出力として適切だが、今後の機能追加で肥大化するリスクあり。現状は改善提案レベルだが、15行を超えた場合はテンプレート化を検討すべき。
- [サブエージェントモデル指定]: 全サブエージェントで `model: "sonnet"` を指定している。Phase 1（構造分析）、Phase 2（レビュー）、Phase 4（改善計画）、Phase 6（検証）は複雑な判断を要するため sonnet は適切。一方、Phase 5（改善適用）は Edit/Write の機械的な実行であり、haiku で十分な可能性がある。特に改善計画が詳細な場合、haiku によるコスト削減が見込める。検証: 改善計画の詳細度を確認し、Edit 指示が曖昧でない場合は haiku への変更を検討すべき。
- [エラー耐性の不足]: [SKILL.md Phase 1, 4, 5, 6] サブエージェント失敗時の処理は「リトライ/中止」をユーザーに確認するが、失敗原因の診断やリトライ回数の上限が定義されていない。同じ失敗が繰り返される可能性がある。改善案: retry_count を Phase 6 のみでなく全サブエージェント呼び出しで管理し、2回失敗時は自動的に中止を推奨するメッセージを出力する。
- [批判的レビューの組込み不足]: [SKILL.md Phase 3] コンフリクト解決後、findings.md に保存される内容の妥当性検証が不在。親が解決した結果について、解決ロジックが適切か（判定基準ヒントを正しく適用したか）を確認するステップがない。改善案: Phase 3 完了後、findings.md の内容を簡易レビューするサブエージェント（haiku）を導入し、明らかな論理矛盾や解決漏れを検出させる。
- [ナレッジ蓄積の欠如]: skill_improve スキルは反復的な最適化ループを持つ（同一スキルに対して繰り返し適用可能）。現状、ラウンド間で改善パターンや失敗事例の知見を蓄積する仕組みがない。改善案: `{skill_path}/.skill_improve_knowledge.md` に以下を記録する仕組みを導入する: (1) 適用した改善パターンと効果（改善前/後のSKILL.md行数、検出問題数等）、(2) 失敗したサブエージェントタスクの原因、(3) ユーザーが拒否した改善提案とその理由。サイズ有界性: 最大100行、超過時は古いラウンドから統合/削除。保持+統合方式: 上書きではなく追記し、5ラウンド毎にパターンを一般化して統合。
- [ファイルスコープの潜在リスク]: quality-criteria.md が `.claude/skills/skill_improve/quality-criteria.md` として全レビューアーから参照されている。現在はスキルディレクトリ内のため問題ないが、もし他のスキルの quality-criteria.md を参照する場合（外部参照）が発生した場合、スコープ違反となる。改善案: 参照パスの構築時に、必ず `{skill_path}` プレフィックスを付けるよう SKILL.md で明示する（現在は暗黙的に `.claude/skills/skill_improve/` を前提としている）。

#### パターン準拠サマリ
| パターン | 状態 | 備考 |
|---------|------|------|
| テンプレート外部化 | 部分的 | Phase 1, 2, 4, 5, 6 は外部化済み。Phase 3（約35行）が未外部化 |
| サブエージェント委譲 | 準拠 | 全サブエージェントで「Read template + follow instructions + path variables」パターンを使用 |
| ナレッジ蓄積 | 非準拠 | 反復ループが存在するが、知見蓄積の仕組みが未実装 |
| エラー耐性 | 部分的 | 失敗時のユーザー確認は実装済み。リトライ回数上限が Phase 6 のみ定義 |
| 批判的レビュー | 部分的 | Phase 2 で4観点並列レビュー、Phase 6 で検証を実施。Phase 3 のコンフリクト解決結果の自己検証がない |
| ファイルスコープ | 準拠 | 全参照がスキルディレクトリ内（analysis.md に外部参照0件と記載）|

#### 良い点
- [テンプレート委譲の一貫性]: Phase 1, 2, 4, 5, 6 で「Read template + follow instructions + path variables」パターンを統一的に使用。各テンプレートでパス変数の定義と手順が明確に分離されており、サブエージェントが必要な情報を確実に取得できる設計。
- [サブエージェントの粒度]: Phase 2 で4つのレビューアーを並列実行し、各レビューアーが独立した観点（stability, efficiency, ux, architecture）を担当する設計。失敗時の部分完了処理（3/4成功で続行可）により、過度に粗い委譲によるやり直しリスクを回避している。
- [外部参照の排除]: analysis.md に記載の通り、全ての参照（テンプレート、quality-criteria.md 等）がスキルディレクトリ内の相対パスで解決されており、他スキルへの依存がない。スキル単体で完結する設計。
