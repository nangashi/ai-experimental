# 正解キー

## 実行条件
- **観点**: consistency
- **対象**: design
- **埋め込み問題数**: 10問

## 埋め込み問題一覧

### P01: テーブル名の命名規約混在（複数形使用）
- **カテゴリ**: 命名規約の既存パターンとの一致
- **深刻度**: 重大
- **該当箇所**: セクション4.1（データモデル）
- **問題の説明**: テーブル名が一部複数形（article, user, media, review）で定義されているが、既存システムでは単数形スネークケース（例: `user`, `media_file`）が支配的パターン。既存の70%以上が単数形を採用しており、新設計が複数形を使用することで一貫性が損なわれる。
- **検出判定基準**:
  - ○（検出）: テーブル名が既存の単数形パターンと異なることを指摘し、「article → article」「media → media」等の具体例を挙げている
  - △（部分検出）: テーブル名の命名規約について言及しているが、既存パターン（単数形）との不一致を明示していない
  - ×（未検出）: テーブル名の命名規約について指摘がない

### P02: タイムスタンプカラム名の不統一
- **カテゴリ**: 命名規約の既存パターンとの一致
- **深刻度**: 重大
- **該当箇所**: セクション4.1（データモデル）
- **問題の説明**: タイムスタンプカラム名が複数パターン混在（article: `created`/`updated`, user: `createdAt`/`updatedAt`, media: `created_at`/`updated_at`, review: `created`/`modified`）。既存システムでは `created_at`/`updated_at` が支配的パターン（70%以上採用）。新設計内でも統一されておらず、既存パターンとも不一致。
- **検出判定基準**:
  - ○（検出）: タイムスタンプカラム名の混在を指摘し、既存パターン `created_at`/`updated_at` との不一致を明示している
  - △（部分検出）: タイムスタンプカラム名の不統一を指摘しているが、既存パターンとの比較がない、または一部のテーブルのみ指摘
  - ×（未検出）: タイムスタンプカラム名について指摘がない

### P03: 主キーカラム名の不統一
- **カテゴリ**: 命名規約の既存パターンとの一致
- **深刻度**: 重大
- **該当箇所**: セクション4.1（データモデル）
- **問題の説明**: 主キーカラム名がテーブルごとに異なる（article/user/review: `id`, media: `media_id`）。既存システムでは全テーブルで `id`（プレフィックスなし）が支配的パターン。mediaテーブルのみ `media_id` を使用することで一貫性が損なわれる。
- **検出判定基準**:
  - ○（検出）: 主キーカラム名の不統一を指摘し、既存パターン `id`（プレフィックスなし）との不一致を明示している
  - △（部分検出）: 主キーカラム名の不統一を指摘しているが、既存パターンとの比較がない
  - ×（未検出）: 主キーカラム名について指摘がない

### P04: APIエンドポイントのパスプレフィックス不統一
- **カテゴリ**: API/インターフェース設計の既存パターンとの一致
- **深刻度**: 中
- **該当箇所**: セクション5.1（エンドポイント一覧）
- **問題の説明**: 記事管理API（`/api/articles/...`）のみバージョンプレフィックスが欠落しており、メディア管理・レビューワークフローAPI（`/api/v1/...`）と不統一。既存システムでは全APIに `/api/v1/` プレフィックスが必須（既存の100%が採用）。
- **検出判定基準**:
  - ○（検出）: 記事管理APIのパスプレフィックス欠落を指摘し、既存パターン `/api/v1/` との不一致を明示している
  - △（部分検出）: パスプレフィックスの不統一を指摘しているが、既存パターンとの比較がない
  - ×（未検出）: パスプレフィックスについて指摘がない

### P05: APIエンドポイントのアクション動詞使用
- **カテゴリ**: API/インターフェース設計の既存パターンとの一致
- **深刻度**: 中
- **該当箇所**: セクション5.1（エンドポイント一覧）
- **問題の説明**: 記事管理APIの一部エンドポイント（`/api/articles/new`, `/api/articles/{id}/edit`, `/api/articles/list`）がURLパスに動詞を含んでいる。既存システムのAPIは全てRESTfulな名詞ベース設計（HTTPメソッドで操作を表現）を採用しており、パスに動詞を含まない。
- **検出判定基準**:
  - ○（検出）: エンドポイントパスの動詞使用（`/new`, `/edit`, `/list`）を指摘し、既存のRESTful名詞ベース設計との不一致を明示している
  - △（部分検出）: エンドポイントパスの設計について言及しているが、既存パターンとの不一致を明示していない、または一部のエンドポイントのみ指摘
  - ×（未検出）: エンドポイントパスの動詞使用について指摘がない

### P06: APIレスポンス形式の不一致
- **カテゴリ**: API/インターフェース設計の既存パターンとの一致
- **深刻度**: 中
- **該当箇所**: セクション5.2（レスポンス形式）
- **問題の説明**: 成功レスポンスの形式が `{success, data, message}` となっているが、既存システム（セクション8.1.3に明記）およびエラーレスポンスでは `{data, error}` 形式を採用。レスポンス形式が統一されておらず、既存パターンとも不一致。
- **検出判定基準**:
  - ○（検出）: 成功レスポンス形式が既存の `{data, error}` 形式と異なることを指摘し、設計書内の矛盾（既存パターン明記セクションとの不一致）を明示している
  - △（部分検出）: レスポンス形式の不統一を指摘しているが、既存パターンとの比較がない
  - ×（未検出）: レスポンス形式について指摘がない

### P07: HTTP通信ライブラリの選定不一致
- **カテゴリ**: 依存管理の既存パターンとの一致
- **深刻度**: 中
- **該当箇所**: セクション2.2（主要ライブラリ）
- **問題の説明**: HTTP通信ライブラリとしてOkHttpを採用しているが、既存システム（セクション8.1.3に明記）ではRestTemplateを使用。同機能の別ライブラリを新規導入することで依存関係の複雑化とパターン分断を引き起こす。
- **検出判定基準**:
  - ○（検出）: OkHttpの採用が既存のRestTemplateパターンと異なることを指摘している
  - △（部分検出）: HTTP通信ライブラリについて言及しているが、既存パターンとの不一致を明示していない
  - ×（未検出）: HTTP通信ライブラリの選定について指摘がない

### P08: エラーハンドリングパターンの明記不足（情報欠落）
- **カテゴリ**: 実装パターンの既存パターンとの一致（情報欠落）
- **深刻度**: 中
- **該当箇所**: セクション6.1（エラーハンドリング）
- **問題の説明**: セクション6.1でエラーハンドリングの実装例（個別catch）が示されているが、これが既存システムのパターンと一致しているかの検証情報が欠落。既存システムがグローバルエラーハンドラパターンを採用している場合、新設計の個別catchアプローチは一貫性を損なう可能性があるが、既存パターンとの比較検証が設計書に明記されていない。
- **検出判定基準**:
  - ○（検出）: エラーハンドリング方針が設計書に記載されているものの、既存システムのパターンとの一貫性検証が欠落していることを指摘している
  - △（部分検出）: エラーハンドリングについて言及しているが、情報欠落の観点が不明確
  - ×（未検出）: エラーハンドリングパターンの一貫性検証について指摘がない

### P09: トランザクション管理方針の明記不足（情報欠落）
- **カテゴリ**: 実装パターンの既存パターンとの一致（情報欠落）
- **深刻度**: 軽微
- **該当箇所**: セクション6.3（データアクセス）
- **問題の説明**: データアクセス方針として「複数エンティティの更新が必要な場合は、各Repositoryメソッドを個別に呼び出す」と記載されているが、トランザクション管理の方針（@Transactional使用の有無、宣言的/手動制御等）が明記されていない。既存システムのトランザクション管理パターンとの一貫性が検証できない。
- **検出判定基準**:
  - ○（検出）: トランザクション管理方針が設計書に明記されておらず、既存パターンとの一貫性が検証できないことを指摘している
  - △（部分検出）: トランザクション管理について言及しているが、情報欠落の観点が不明確
  - ×（未検出）: トランザクション管理方針の一貫性検証について指摘がない

### P10: JWT保存先のセキュリティリスク
- **カテゴリ**: 実装パターンの既存パターンとの一致
- **深刻度**: 軽微
- **該当箇所**: セクション5.3（認証・認可方式）
- **問題の説明**: JWTトークンの保存先としてlocalStorageを使用しているが、これはXSS攻撃に対して脆弱。既存システムがhttpOnlyクッキーを採用している場合（より安全な方式）、新設計のlocalStorage使用は一貫性を損なう。ただし、既存システムの保存先パターンが設計書に明記されていないため、一貫性の検証が不完全。
- **検出判定基準**:
  - ○（検出）: JWT保存先のlocalStorage使用について、既存システムのパターンとの一貫性検証が必要であることを指摘している（セキュリティリスクへの言及は任意）
  - △（部分検出）: JWT保存先について言及しているが、既存パターンとの一貫性検証の観点が不明確、またはセキュリティリスクのみを指摘（一貫性の観点なし）
  - ×（未検出）: JWT保存先の一貫性検証について指摘がない

## ボーナス問題リスト

正解キーに含めないが、検出された場合にボーナスとして加点する問題の候補:

| ID | カテゴリ | 内容 | ボーナス条件 |
|----|---------|------|------------|
| B01 | 命名規約 | 外部キー列名の命名パターン不統一（article.author_id、media.uploaded_by、review.reviewer は全て user.id を参照するが、列名パターンが不統一） | 外部キー列名の命名パターン不統一を指摘し、既存パターン `{参照先テーブル名}_id` との整合性について言及 |
| B02 | 命名規約 | カラム名のケース不統一（user.user_name はスネークケース、user.createdAt/updatedAt はキャメルケース） | カラム名のケース混在を指摘し、既存のスネークケースパターンとの不一致を明示 |
| B03 | ディレクトリ構造 | セクション8.1.4で既存のレイヤー別構成を明記しているにもかかわらず、セクション3.2のモジュール説明がドメイン別構成を暗示している矛盾 | ディレクトリ構造の記載矛盾を指摘し、既存パターン（レイヤー別）との一貫性検証が必要と言及 |
| B04 | 実装パターン | ログ出力パターン（フォーマット、構造化ログの有無）が明記されておらず、既存システムとの一貫性が検証できない | ログ出力パターンの明記不足を指摘し、既存パターンとの一貫性検証が必要と言及 |
| B05 | API設計 | エラーレスポンスの `error.code` 形式（例: "VALIDATION_ERROR"）が既存システムと一致しているかの検証情報が欠落 | エラーコード形式の一貫性検証が必要であることを指摘 |
| B06 | データモデル | review.status の値（pending/approved/rejected）とarticle.status の値（draft/review/published/archived）で命名スタイルが異なる（review系のstatusは過去分詞形、article系は名詞形）という内部パターン不整合 | ステータス値の命名スタイル不統一を指摘 |
