# 正解キー

## 実行条件
- **観点**: consistency
- **対象**: design
- **埋め込み問題数**: 10問

## 埋め込み問題一覧

### P01: テーブル名の命名規約混在（単数形と複数形）
- **カテゴリ**: 命名規約
- **深刻度**: 重大
- **該当箇所**: セクション4.1（データモデル）
- **問題の説明**: 既存システムではテーブル名は複数形（`delivery_routes`, `tracking_events`, `carriers`）を使用しているが、新設計では `DeliveryOrder`, `tracking_event`, `carrier` のように単数形と複数形が混在している。`tracking_event` と `carrier` は単数形であり、既存の複数形パターンに従っていない。
- **検出判定基準**:
  - ○（検出）: テーブル名の単数形/複数形の不整合（`tracking_event`, `carrier` が単数形で既存パターン（複数形）と異なる）を指摘している、または既存システムが複数形を使用しているのに対して新設計に単数形が含まれていることを指摘している
  - △（部分検出）: テーブル名の命名規約に関して何らかの指摘があるが、単数形/複数形の不整合という核心的ポイントに触れていない
  - ×（未検出）: テーブル名の命名規約の不整合に関する指摘がない

### P02: タイムスタンプ列の命名規約混在（created_at/createdAt、updated_at/updatedAt）
- **カテゴリ**: 命名規約
- **深刻度**: 中
- **該当箇所**: セクション4.1.1（DeliveryOrderテーブル）、セクション4.1.3（carrierテーブル）
- **問題の説明**: 既存システムではタイムスタンプ列は `created_at`, `updated_at` を標準としているが、新設計の `DeliveryOrder` テーブルでは `createdAt`, `updatedAt` とcamelCaseを使用、`carrier` テーブルでは `created_timestamp`, `updated_timestamp` と異なる命名を使用しており、既存パターンと一致していない。
- **検出判定基準**:
  - ○（検出）: タイムスタンプ列の命名規約の不整合（`createdAt`/`updatedAt` または `created_timestamp`/`updated_timestamp` が既存の `created_at`/`updated_at` と異なる）を指摘している
  - △（部分検出）: タイムスタンプ列の命名に関して何らかの指摘があるが、既存パターン（`created_at`/`updated_at`）との不整合という点に触れていない
  - ×（未検出）: タイムスタンプ列の命名規約の不整合に関する指摘がない

### P03: 外部キー列の命名規約混在（_id/_fk）
- **カテゴリ**: 命名規約
- **深刻度**: 中
- **該当箇所**: セクション4.1.2（tracking_eventテーブル）
- **問題の説明**: 既存システムでは外部キー列名は `{参照先テーブル名}_id` 形式（例: `carrier_id`, `route_id`）を使用しているが、新設計の `tracking_event` テーブルでは `delivery_order_fk` という `_fk` サフィックスを使用しており、既存パターンと一致していない。
- **検出判定基準**:
  - ○（検出）: 外部キー列の命名規約の不整合（`delivery_order_fk` が既存の `_id` サフィックスパターンと異なる、または `_fk` サフィックスの使用が既存システムと一致しない）を指摘している
  - △（部分検出）: 外部キー列の命名に関して何らかの指摘があるが、`_id` vs `_fk` サフィックスの不整合という核心的ポイントに触れていない
  - ×（未検出）: 外部キー列の命名規約の不整合に関する指摘がない

### P04: APIエンドポイントの命名規約混在（kebab-case/camelCase）
- **カテゴリ**: API設計
- **深刻度**: 中
- **該当箇所**: セクション5.1.1（配送オーダー管理API）
- **問題の説明**: 既存システムのAPIエンドポイントはリソース名をkebab-caseで表現（例: `/api/v1/delivery-routes`, `/api/v1/tracking-events`）しているが、新設計では `/api/v1/deliveryOrders` とcamelCaseを使用しており、既存パターンと一致していない。
- **検出判定基準**:
  - ○（検出）: APIエンドポイントの命名規約の不整合（`/deliveryOrders` がcamelCaseで既存のkebab-case（`/delivery-routes`, `/tracking-events`）と異なる）を指摘している
  - △（部分検出）: APIエンドポイントの命名規約に関して何らかの指摘があるが、kebab-case vs camelCaseの不整合という点に触れていない
  - ×（未検出）: APIエンドポイントの命名規約の不整合に関する指摘がない

### P05: APIエンドポイントに動詞を含む設計（/updateLocationパス）
- **カテゴリ**: API設計
- **深刻度**: 軽微
- **該当箇所**: セクション5.1.2（トラッキングAPI）
- **問題の説明**: 既存システムのAPIエンドポイントはRESTful設計に従いリソース指向（名詞ベース）だが、新設計では `/api/v1/tracking/updateLocation` のように動詞（`updateLocation`）を含むパスを使用しており、既存のエンドポイント設計パターンと異なる。既存は `/api/v1/delivery-routes`, `/api/v1/tracking-events` のように名詞ベースである。
- **検出判定基準**:
  - ○（検出）: `/updateLocation` パスが動詞を含んでおり、既存のリソース指向（名詞ベース）パターンと一致しないことを指摘している
  - △（部分検出）: トラッキングAPIのパス設計に関して何らかの指摘があるが、動詞使用と既存パターン（名詞ベース）との不整合という点に触れていない
  - ×（未検出）: `/updateLocation` パスの設計パターンの不整合に関する指摘がない

### P06: HTTP通信ライブラリの選定が既存と異なる（Spring WebFlux vs RestTemplate）
- **カテゴリ**: 依存管理
- **深刻度**: 中
- **該当箇所**: セクション2.4（主要ライブラリ）
- **問題の説明**: 既存システムではHTTP通信にRestTemplateを使用しているが、新設計ではSpring WebFluxを採用している。同機能のライブラリを新たに導入することで一貫性が失われる。
- **検出判定基準**:
  - ○（検出）: HTTP通信ライブラリの選定が既存（RestTemplate）と異なる（Spring WebFlux）ことを指摘している、または既存システムとの一貫性のためにRestTemplateの使用を推奨している
  - △（部分検出）: HTTP通信ライブラリに関して何らかの指摘があるが、既存システム（RestTemplate）との不整合という点に触れていない
  - ×（未検出）: HTTP通信ライブラリの選定の不整合に関する指摘がない

### P07: エラーハンドリングパターンが既存と異なる（個別try-catch vs グローバルハンドラ）
- **カテゴリ**: 実装パターン
- **深刻度**: 重大
- **該当箇所**: セクション6.1（エラーハンドリング方針）
- **問題の説明**: 既存システムではグローバル例外ハンドラ（`@ControllerAdvice` + `@ExceptionHandler`）を使用しているが、新設計では各コントローラーで個別にtry-catch文を実装する方針となっており、既存パターンと一致していない。
- **検出判定基準**:
  - ○（検出）: エラーハンドリングパターンの不整合（個別try-catchが既存のグローバル例外ハンドラパターンと異なる）を指摘している、または既存システムとの一貫性のためにグローバル例外ハンドラの使用を推奨している
  - △（部分検出）: エラーハンドリング方針に関して何らかの指摘があるが、既存パターン（グローバルハンドラ）との不整合という核心的ポイントに触れていない
  - ×（未検出）: エラーハンドリングパターンの不整合に関する指摘がない

### P08: ロギング形式が既存と異なる（平文 vs 構造化ログJSON）
- **カテゴリ**: 実装パターン
- **深刻度**: 軽微
- **該当箇所**: セクション6.2（ロギング方針）
- **問題の説明**: 既存システムでは構造化ログ（JSON形式）をLogbackで出力しているが、新設計では平文形式でログを出力する方針となっており、既存パターンと一致していない。
- **検出判定基準**:
  - ○（検出）: ロギング形式の不整合（平文が既存の構造化ログJSON形式と異なる）を指摘している、または既存システムとの一貫性のために構造化ログ（JSON形式）の使用を推奨している
  - △（部分検出）: ロギング方針に関して何らかの指摘があるが、既存パターン（構造化ログJSON）との不整合という点に触れていない
  - ×（未検出）: ロギング形式の不整合に関する指摘がない

### P09: APIレスポンス形式が既存と異なる（success/result vs data/error）
- **カテゴリ**: API設計
- **深刻度**: 重大
- **該当箇所**: セクション5.2（リクエスト/レスポンス形式）
- **問題の説明**: 既存システムのAPIレスポンス形式は `{data: {...}, error: null}` または `{data: null, error: {...}}` の統一形式を使用しているが、新設計では `{success: true, result: {...}}` または `{success: false, message: "...", errorCode: "..."}` という異なる形式を使用しており、既存パターンと一致していない。
- **検出判定基準**:
  - ○（検出）: APIレスポンス形式の不整合（`success`/`result`/`message` フィールドが既存の `data`/`error` 形式と異なる）を指摘している、または既存システムとの一貫性のために `{data, error}` 形式の使用を推奨している
  - △（部分検出）: APIレスポンス形式に関して何らかの指摘があるが、既存パターン（`{data, error}` 形式）との不整合という核心的ポイントに触れていない
  - ×（未検出）: APIレスポンス形式の不整合に関する指摘がない

### P10: JWTの保存先が既存パターンと異なる可能性（情報欠落）
- **カテゴリ**: 実装パターン（情報欠落）
- **深刻度**: 中
- **該当箇所**: セクション5.3（認証・認可方式）
- **問題の説明**: 新設計ではJWTをlocalStorageに保存すると明記しているが、既存システムのJWT保存パターンに関する記述がなく、既存システムとの一貫性が検証できない。既存システムがhttpOnly Cookieを使用している場合、XSS脆弱性の観点から不整合となる可能性がある。
- **検出判定基準**:
  - ○（検出）: JWTの保存先（localStorage）が既存システムのパターンと一致するかの検証が必要であることを指摘している、または既存システムのJWT保存パターンに関する情報が設計書に欠落していることを指摘している
  - △（部分検出）: JWTの保存先に関して何らかの指摘があるが、既存システムとの一貫性検証が必要という点に触れていない
  - ×（未検出）: JWTの保存先の一貫性検証に関する指摘がない

## ボーナス問題リスト

正解キーに含めないが、検出された場合にボーナスとして加点する問題の候補:

| ID | カテゴリ | 内容 | ボーナス条件 |
|----|---------|------|------------|
| B01 | 命名規約 | Boolean列の命名規約（`is_active` vs 既存パターンの不整合） | `is_active` のBoolean列命名が既存システムの規約と一致するかの検証が必要という指摘 |
| B02 | データモデル | Primary KeyのUUID生成戦略が既存と異なる可能性（文書化欠落） | Primary KeyのUUID生成戦略（アプリケーション生成 vs DB生成）が既存パターンと一致するかの検証が必要という指摘 |
| B03 | 実装パターン | 非同期処理パターン（CompletableFuture）が既存パターンと一致するかの検証欠落 | 非同期処理パターンが既存システムと一致するかの検証が必要という指摘 |
| B04 | データモデル | Enum値の命名規約（`PENDING`, `ASSIGNED` 等のステータス値）が既存と異なる可能性 | Enum値の命名規約（大文字スネークケース vs camelCase等）が既存パターンと一致するかの検証が必要という指摘 |
| B05 | APIレスポンス | エラーレスポンスの `errorCode` フィールドが既存パターンにあるかの検証欠落 | エラーレスポンスの構造（`errorCode` フィールドの有無）が既存パターンと一致するかの検証が必要という指摘 |
