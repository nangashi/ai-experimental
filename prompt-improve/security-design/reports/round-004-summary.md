# Round 4 Summary: security-design

## スコア一覧

| Prompt | Mean | SD | 安定性 | 検出スコア (Avg) | ボーナス (Avg) | ペナルティ (Avg) |
|--------|------|----|---------:|----------------:|---------------:|----------------:|
| **baseline** | 8.25 | 0.25 | 高安定 | 5.75 | +2.5 | -0.0 |
| **english** | 11.0 | 0.0 | 高安定 | 8.5 | +2.5 | -0.0 |
| **explicit-checks** | 9.5 | 0.5 | 高安定 | 7.25 | +2.25 | -0.0 |

---

## 推奨判定

**推奨プロンプト**: **english**

**判定根拠**:
- baselineに対して+2.75ptの大幅改善（8.25 → 11.0）
- 完璧な安定性（SD=0.0、baselineはSD=0.25）
- P04（API入力検証方針の欠如）とP06（監査ログ範囲不足）の両問題を両ラン共に完全検出（baselineは両方とも未検出または部分検出）
- 全ボーナス項目（B01-B05）を両ラン共に検出（baselineはRun1でB02未検出）
- scoring-rubric.md Section 5の推奨判定基準「平均スコア差 > 1.0pt → スコアが高い方を推奨」を満たす

---

## バリアント別効果

| Variation ID | 独立変数 | 効果 (pt) | 判定 | 主な貢献 |
|-------------|---------|-----------|------|---------|
| english | 言語: 英語化 | +2.75 | **EFFECTIVE** | P04検出 (+0.75pt), P06検出 (+2.0pt), 完璧な安定性 (SD=0.0) |
| explicit-checks | 新規アプローチ: 明示的チェックリスト（入力検証・冪等性・ログマスキング） | +1.25 | **EFFECTIVE** | P05検出 (+2.0pt), P04検出 (+0.75pt), ただしP03で-0.25pt、視野狭窄リスクあり |

### 詳細分析

**english**:
- **検出能力の飛躍的向上**: 検出スコア 5.75 → 8.5 (+2.75pt)
  - P04（API入力検証方針の欠如）: baseline ×/△ → english ○/○
  - P06（監査ログ範囲不足）: baseline ×/× → english ○/○
- **完璧な再現性**: SD=0.0（両ランで完全に同一の結果）
- **ボーナスの完全カバー**: B01-B05の全項目を両ランで検出

**explicit-checks**:
- **冪等性検出の成功**: P05（勤怠打刻APIの冪等性欠如）を両ランで検出（englishでも未検出）
- **入力検証方針の強化**: P04を両ランで完全検出
- **副作用**: P03（CSRF保護）でRun1完全未検出、チェックリスト外の問題（P06）は未検出のまま
- **安定性低下**: SD=0.5（baseline SD=0.25より悪化）

---

## 収束判定

**判定**: **継続推奨**

**根拠**:
- Round 3推奨プロンプト（baseline）: 平均9.0pt
- Round 4推奨プロンプト（english）: 平均11.0pt
- **改善幅**: +2.0pt（scoring-rubric.md Section 5の収束判定基準「2ラウンド連続で改善幅 < 0.5pt」に該当せず）

---

## 問題別検出状況

### 全バリアント共通で検出成功（5問）

- **P01** (データ保護・重大): マイナンバー・口座番号の暗号化欠如
- **P02** (インフラ・重大): JWT署名鍵の環境変数平文保存
- **P07** (データ保護・中): 個人情報のログ出力
- **P08** (脅威モデリング・中): レート制限・DoS対策の欠如
- **P10** (認証・認可・軽微): JWTの有効期限が長すぎる

### バリアント間で差が出た問題

| 問題ID | カテゴリ | baseline | english | explicit-checks | 最良 |
|--------|----------|----------|---------|-----------------|------|
| **P04** | 入力検証設計・中 | ×/△ (0.25) | ○/○ (1.0) | ○/○ (1.0) | english, explicit-checks |
| **P05** | 入力検証設計・中 | ×/× (0.0) | ×/× (0.0) | ○/○ (1.0) | **explicit-checks** |
| **P06** | 脅威モデリング・中 | ×/× (0.0) | ○/○ (1.0) | ×/× (0.0) | **english** |

### 全バリアント共通で未検出（2問）

- **P09** (認証・認可・軽微): データベースエラーメッセージの詳細出力
- **P03** (入力検証・重大): CSRF保護の欠如（全バリアントで部分検出△のみ、explicit-checksはRun1で完全未検出×）

---

## 次回提案

**推奨方針**: englishバリアントをベースラインとし、explicit-checksで有効だった「冪等性チェック項目」を統合。未解決問題（P09, P03）に対処。

**具体的バリアント案**:
1. **english + 冪等性チェック項目** (english-idempotency): P05検出を維持しつつenglishの高性能を活用
2. **english + エラーハンドリング明示化** (english-error-handling): P09（エラーメッセージ露出）に対処

**目標スコア**: 12.0pt以上（P05とP09の完全検出により+1.5pt追加）
