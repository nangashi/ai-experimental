# TaskFlow システム設計書 - セキュリティ評価レポート

## 評価サマリー

| 評価項目 | スコア (1-5) | 主な理由 |
|-----------|-------------|-------------|
| 脅威モデリング (STRIDE) | 2 | STRIDE各脅威に対する設計レベルの対策が明示されていない |
| 認証・認可設計 | 2 | JWT の localStorage 保存、24時間有効期限、リフレッシュトークン未設計など重大な問題あり |
| データ保護 | 2 | 保存データの暗号化、データ保持・削除ポリシー、プライバシー要件が未定義 |
| 入力検証設計 | 3 | express-validator 使用は明記されているが、具体的な検証ルールやポリシーが不明確 |
| インフラ・依存関係 | 3 | シークレット管理方式、依存ライブラリの脆弱性管理プロセスが未定義 |
| **総合** | **2.4** | |

---

## 1. 重大な問題（設計変更が必要）

### 1-1. JWT トークンの localStorage 保存とセッション管理設計の欠陥

**問題**:
- JWT を localStorage に保存する設計（5.認証・認可方式）は XSS 攻撃による盗取リスクが高い
- トークン有効期限が 24 時間と長すぎるため、盗取後の悪用期間が長い
- リフレッシュトークン設計が存在せず、長期トークンを直接使用している
- トークン失効メカニズム（ログアウト時の無効化、強制失効）が未設計

**影響**:
- 単一の XSS 脆弱性が存在するだけで、攻撃者は 24 時間有効なトークンを盗取可能
- トークン盗取後、管理者が気づいても強制的に無効化する手段がない
- パスワード変更やロール変更後も旧トークンが 24 時間有効なまま残る

**推奨対策**:
- JWT を HttpOnly + Secure + SameSite=Strict 属性付きクッキーに保存
- アクセストークン有効期限を 15 分に短縮
- リフレッシュトークン（有効期限 7 日、ローテーション機能付き）を導入し、Redis に保存して失効管理を可能にする
- ログアウト時・パスワード変更時・ロール変更時にリフレッシュトークンを Redis から削除する失効メカニズムを追加

**該当箇所**: 5. API設計 > 認証・認可方式

---

### 1-2. 認証エンドポイントのレート制限・アカウントロック設計の欠如

**問題**:
- `/api/v1/auth/login`, `/api/v1/auth/signup` エンドポイントにレート制限設計が明記されていない
- ブルートフォース攻撃への防御策（アカウントロック、IP制限）が未設計
- API Gateway層にレート制限機能があると記載されているが、具体的な制限値・適用範囲が不明

**影響**:
- 攻撃者がログインエンドポイントに対して無制限にパスワード推測攻撃を実行可能
- 自動化された大量アカウント作成（signup スパム）を防げない
- クレデンシャルスタッフィング攻撃に無防備

**推奨対策**:
- express-rate-limit を導入し、以下の制限を設定:
  - `/api/v1/auth/login`: IP ごとに 5 回/15 分、同一メールアドレスごとに 3 回/15 分
  - `/api/v1/auth/signup`: IP ごとに 3 回/1 時間
- 同一アカウントへの 5 回連続ログイン失敗で 30 分間アカウントロック
- ロック解除は時間経過またはメール認証経由のみ
- 異常な回数のログイン失敗を検知した場合の管理者アラート機能

**該当箇所**: 3. アーキテクチャ設計 > 主要コンポーネントの責務（API Gateway）、5. API設計 > 認証関連

---

### 1-3. ファイルアップロードの検証・マルウェア対策の欠如

**問題**:
- ファイルアップロード（`POST /api/v1/projects/:projectId/documents`）でファイルサイズ制限（10MB）のみ明記
- ファイル種別検証（MIME type、拡張子、マジックバイト）の方針が未定義
- マルウェアスキャン、実行ファイルのブロック、ファイル名サニタイズの設計が存在しない
- アップロード後の S3 保存時のアクセス制御・暗号化設定が不明

**影響**:
- 悪意ある実行ファイル（.exe, .sh, .bat）のアップロードを阻止できない
- HTML/SVG ファイル経由の Stored XSS 攻撃が可能
- ファイル名にパストラバーサル文字（`../`）や特殊文字が含まれる場合の処理が未定義
- S3 バケットの公開設定ミスにより機密文書が漏洩するリスク

**推奨対策**:
- MIME type ホワイトリスト方式を採用（許可: `image/*, application/pdf, text/plain, application/vnd.openxmlformats-officedocument.*` など）
- ファイル先頭バイトでのマジックバイトチェックを実装（MIME type 偽装対策）
- 実行ファイル拡張子（.exe, .sh, .bat, .ps1, .app, .dmg）を明示的にブロック
- ファイル名を UUID ベースにリネームし、元のファイル名は metadata として DB に保存
- S3 バケットポリシーで Public Access を完全に無効化
- S3 オブジェクトに SSE-S3 または SSE-KMS による暗号化を強制
- ClamAV 等のマルウェアスキャンを非同期ジョブで実行し、検出時はファイル削除 + 管理者通知

**該当箇所**: 5. API設計 > ドキュメント管理、7. 非機能要件 > セキュリティ要件

---

### 1-4. CSRF 保護メカニズムの未設計

**問題**:
- 状態変更を伴う API（POST, PUT, DELETE）に対する CSRF 保護設計が明記されていない
- JWT をリクエストヘッダーに含める実装なのか、Cookie ベースなのかが不明確（localStorage 保存と記載されているため、おそらく Authorization ヘッダー方式）
- Cookie ベース認証に移行する場合、CSRF トークン検証が必須になる

**影響**:
- 現在の設計（localStorage + Authorization ヘッダー）では CSRF は発生しにくいが、推奨対策として Cookie ベースに移行する場合、CSRF 脆弱性が発生
- 外部サイトから TaskFlow の API を呼び出し、ログイン中ユーザーの権限でプロジェクト削除・タスク変更が可能になる

**推奨対策**:
- Cookie ベース認証に移行する際、以下の CSRF 対策を実装:
  - SameSite=Strict 属性をクッキーに設定（最優先）
  - Double Submit Cookie パターンまたは Synchronizer Token パターンを採用
  - すべての状態変更エンドポイントに CSRF トークン検証ミドルウェアを適用
- csurf ミドルウェア（Express 用）を利用し、トークン生成・検証を自動化

**該当箇所**: 5. API設計 > 認証・認可方式

---

### 1-5. 機密情報の暗号化設計の欠如

**問題**:
- PostgreSQL に保存されるデータの暗号化仕様が未定義（保存時暗号化、カラムレベル暗号化）
- パスワードハッシュ以外の機密情報（OAuth トークン、API キー、個人情報）の保護方針が不明
- S3 に保存されるドキュメントの暗号化設定が明記されていない
- データベース接続文字列、AWS クレデンシャル等のシークレット管理方式が未定義

**影響**:
- DB バックアップファイルの漏洩時、すべてのユーザー情報・プロジェクトデータが平文で露出
- S3 バケットの権限設定ミスにより、ドキュメントが暗号化なしで第三者に閲覧される
- 環境変数やコード内にハードコードされたシークレットが Git リポジトリに混入するリスク

**推奨対策**:
- PostgreSQL RDS で「保存時の暗号化」（Encryption at Rest）を有効化
- 特に機密性の高いカラム（外部 API キー、OAuth リフレッシュトークン）は AES-256-GCM で個別に暗号化し、暗号化キーは AWS KMS で管理
- S3 バケットポリシーで SSE-KMS による暗号化を強制（`s3:x-amz-server-side-encryption: aws:kms` 条件付き）
- アプリケーションシークレット（DB パスワード、JWT 署名鍵）は AWS Secrets Manager または AWS Systems Manager Parameter Store に保存し、起動時に取得
- `.env` ファイルを `.gitignore` に追加し、GitHub Secrets を使って CI/CD に注入

**該当箇所**: 2. 技術スタック > データベース、2. 技術スタック > インフラ・デプロイ環境、7. 非機能要件 > セキュリティ要件

---

### 1-6. 監査ログ・セキュリティイベントロギング設計の不足

**問題**:
- 現在のロギング方針（6. 実装方針 > ロギング方針）は主に技術的エラーに焦点を当てており、セキュリティ監査ログが不十分
- 記録対象に「認証失敗」はあるが、以下の重要イベントが欠落:
  - 認証成功（ログイン成功）
  - 権限昇格イベント（role 変更）
  - 機密リソースへのアクセス（プロジェクト削除、ドキュメント削除）
  - 設定変更（組織設定変更、ユーザー招待）
- ログの改ざん防止策（署名、外部転送）が未設計
- ログ保持期間・削除ポリシーが未定義

**影響**:
- セキュリティインシデント発生時、攻撃者の行動履歴を追跡できない
- 内部不正（管理者による不正なデータアクセス・削除）を検知・証明できない
- コンプライアンス要件（GDPR、SOC 2 等）を満たせない可能性

**推奨対策**:
- 以下のセキュリティイベントを監査ログとして記録:
  - 認証成功/失敗（ユーザーID、IP アドレス、User-Agent、タイムスタンプ）
  - ロール変更・権限昇格（変更者、対象ユーザー、変更前後のロール）
  - 機密操作（プロジェクト削除、ドキュメント削除、組織設定変更）
  - アクセス制御違反（403 エラー時の詳細）
- CloudWatch Logs に加えて、監査ログ専用の S3 バケットに JSON Lines 形式で保存
- S3 バケットで Object Lock（WORM モード）を有効化し、改ざん防止
- ログ保持期間: 監査ログは最低 1 年間、コンプライアンス要件に応じて延長
- 異常検知アラート: 短時間での大量ログイン失敗、深夜の管理者操作、大量削除操作を CloudWatch Alarms で検知

**該当箇所**: 6. 実装方針 > ロギング方針

---

### 1-7. 外部サービス連携の OAuth 2.0 セキュリティ設計の欠如

**問題**:
- 外部連携サービス（Slack、GitHub、Google Workspace）の OAuth 2.0 実装詳細が未定義
- state パラメータによる CSRF 防止、PKCE（Proof Key for Code Exchange）の使用有無が不明
- OAuth トークンの保存場所（DB カラム暗号化、有効期限管理、失効処理）が未設計
- リダイレクト URI のホワイトリスト検証が明記されていない

**影響**:
- OAuth フロー中の CSRF 攻撃により、攻撃者が被害者のアカウントに攻撃者の外部サービスアカウントを紐付け可能
- OAuth トークンが平文で DB に保存される場合、DB 侵害時に外部サービスへの不正アクセスが可能
- リダイレクト URI 検証不足により、認可コードが攻撃者に送信される（Open Redirect 脆弱性）

**推奨対策**:
- OAuth 2.0 フロー実装時、以下を必須とする:
  - state パラメータに暗号論的にセキュアなランダム値を使用し、セッションまたは Redis に保存して検証
  - 可能であれば PKCE（RFC 7636）を使用（特にモバイルアプリ連携時）
  - リダイレクト URI を厳格にホワイトリスト検証（完全一致、プロトコル・ドメイン・ポート含む）
- OAuth トークン（アクセストークン、リフレッシュトークン）を DB に保存する際、AES-256-GCM で暗号化
- トークン有効期限を DB に記録し、期限切れトークンを自動削除する cron ジョブを実装
- 外部サービス連携解除時、該当トークンを即座に削除し、可能であれば外部サービス側でも revoke API を呼び出す

**該当箇所**: 1. 概要 > 主要機能の一覧（外部サービス連携）、3. アーキテクチャ設計 > 主要コンポーネントの責務（外部連携サービス）

---

## 2. 改善提案（設計品質向上に効果的）

### 2-1. パスワードポリシーの明確化

**提案**:
- 現在「bcrypt でハッシュ化（コスト係数 10）」とあるが、パスワード要件（最小長、複雑性）が未定義
- パスワードポリシーを以下のように明示:
  - 最小長 12 文字（推奨は 16 文字以上）
  - 英大文字・小文字・数字・記号のうち 3 種類以上を含む
  - よく使われるパスワード（Have I Been Pwned API、または自前ブラックリスト）を拒否
  - パスワード変更時、過去 5 世代のハッシュと重複チェック

**理由**:
- 短いパスワードや脆弱なパスワードはハッシュ化しても brute-force で破られるリスクがある
- bcrypt のコスト係数 10 は 2026 年時点ではやや低い（12 以上が推奨される）

**推奨対策**:
- bcrypt のコスト係数を 12 に引き上げ
- zxcvbn ライブラリでパスワード強度を評価し、スコア 3 以上を要求
- 定期的なパスワード変更は強制せず、侵害検知時のみ変更を促す（NIST SP 800-63B に準拠）

**該当箇所**: 7. 非機能要件 > セキュリティ要件

---

### 2-2. SQL インジェクション対策の多層化

**提案**:
- 現在「Sequelize ORM 使用」により SQL インジェクション対策としているが、生 SQL 実行時の方針が不明
- Raw Query 使用時のパラメータ化・プレースホルダー使用を義務化
- コードレビューチェックリストに「Raw Query の検証」項目を追加

**理由**:
- ORM を使用していても、パフォーマンス最適化や複雑なクエリで Raw Query を使用するケースがある
- 開発者が `sequelize.query()` に文字列結合でパラメータを埋め込むと SQL インジェクションが発生

**推奨対策**:
- 生 SQL 使用時は必ず Prepared Statement またはパラメータバインディングを使用: `sequelize.query('SELECT * FROM users WHERE id = ?', { replacements: [userId] })`
- ESLint カスタムルールで文字列リテラル連結を検出
- セキュリティテストに SQL インジェクション検査（SQLMap、手動テスト）を含める

**該当箇所**: 7. 非機能要件 > セキュリティ要件

---

### 2-3. Content Security Policy (CSP) の導入

**提案**:
- XSS 対策として「React のデフォルトエスケーピング」のみに依存しているが、多層防御として CSP ヘッダーを設定
- 特に `dangerouslySetInnerHTML` 使用箇所や外部スクリプト読み込みを制限

**理由**:
- React のエスケーピングは強力だが、開発者が `dangerouslySetInnerHTML` を誤用すると XSS が発生
- CSP により、インライン script タグや外部ドメインからのスクリプト実行を制限できる

**推奨対策**:
- CSP ヘッダーを以下のように設定（Helmet.js 使用）:
  ```
  Content-Security-Policy:
    default-src 'self';
    script-src 'self';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: https:;
    connect-src 'self' wss://taskflow.example.com;
    object-src 'none';
  ```
- nonce または hash ベースのインラインスクリプト許可方式を検討
- CSP 違反レポートを収集するエンドポイント（`report-uri`）を設定

**該当箇所**: 7. 非機能要件 > セキュリティ要件

---

### 2-4. 依存ライブラリの脆弱性管理プロセスの明確化

**提案**:
- npm パッケージの脆弱性を定期的にスキャンするプロセスを設計に明記
- `npm audit`, Snyk, Dependabot 等のツール使用を義務化

**理由**:
- 2026 年時点で多くの npm パッケージには既知の脆弱性が存在
- 定期的なスキャンとアップデートがなければ、古い脆弱性が放置される

**推奨対策**:
- GitHub Dependabot を有効化し、脆弱性検出時に自動的に PR を作成
- CI/CD パイプラインに `npm audit --audit-level=moderate` を組み込み、中レベル以上の脆弱性があればビルド失敗
- 月次で依存ライブラリのバージョン棚卸しを実施し、EOL（End of Life）パッケージを特定
- Critical/High の脆弱性は検出後 7 日以内、Moderate は 30 日以内に修正

**該当箇所**: 2. 技術スタック > 主要ライブラリ、6. 実装方針 > デプロイメント方針

---

### 2-5. データ削除・保持ポリシーの設計

**提案**:
- GDPR 等のプライバシー規制に対応するため、個人データの保持期間・削除方針を明確化
- ユーザーアカウント削除時の関連データ（タスク、ドキュメント、ログ）の扱いを定義

**理由**:
- GDPR「忘れられる権利」により、ユーザーからデータ削除要求があった場合、30 日以内に対応が必要
- 組織解約時のデータ削除遅延はコンプライアンスリスクとなる

**推奨対策**:
- データ保持ポリシーを以下のように定義:
  - アクティブユーザーのデータ: 無期限保持
  - 退会ユーザーのデータ: 30 日間の猶予期間後、完全削除
  - 監査ログ: 最低 1 年間保持、その後匿名化または削除
- ユーザー削除時、関連する Task の `assigned_to` を NULL に設定、Document の `uploaded_by` を匿名化ユーザーに置換
- S3 に保存されたファイルも削除ジョブで完全削除（バージョニング有効時は全バージョン削除）
- 削除リクエストを削除キュー（SQS）に追加し、非同期ジョブで処理

**該当箇所**: 4. データモデル、7. 非機能要件 > 可用性・スケーラビリティ（バックアップ）

---

### 2-6. リアルタイム通信（Socket.IO）のセキュリティ対策

**提案**:
- Socket.IO を使用したリアルタイム通信の認証・認可方式を明示
- WebSocket 接続時の JWT 検証、接続後のメッセージ単位での権限チェックを設計

**理由**:
- WebSocket は HTTP とは異なるプロトコルのため、接続確立時だけでなく、メッセージごとに権限を検証する必要がある
- 認証なし WebSocket 接続は、プロジェクトチャンネルへの不正参加、他ユーザーへのなりすましメッセージ送信のリスクがある

**推奨対策**:
- Socket.IO 接続時、クエリパラメータまたは handshake auth に JWT を含め、接続確立前に検証
- 接続後も、メッセージ送信時に「送信者が該当プロジェクトのメンバーか」を毎回検証
- Socket.IO の namespace 機能を使い、プロジェクトごとに `/project/:projectId` namespace を分離
- メッセージレート制限（同一ユーザーからの 1 秒あたりのメッセージ数を制限）を実装
- XSS 対策として、チャットメッセージを表示前にサニタイズ（DOMPurify 等）

**該当箇所**: 2. 技術スタック > 言語・フレームワーク（Socket.IO）、3. アーキテクチャ設計 > 主要コンポーネントの責務（通知サービス）

---

### 2-7. 本番環境へのデプロイ前セキュリティチェックリスト

**提案**:
- デプロイフロー（6. 実装方針 > デプロイメント方針）にセキュリティゲートを追加
- 本番デプロイ前に必須となるセキュリティチェック項目を定義

**理由**:
- CI/CD で自動化されていても、セキュリティ設定ミス（環境変数の誤設定、IAM ロールの過剰権限）は発生しうる
- 手動チェックリストにより、最終防衛線を設ける

**推奨対策**:
- 本番デプロイ前チェックリスト:
  - [ ] すべての環境変数がシークレット管理サービス経由で取得されている
  - [ ] RDS、S3、Redis の公開アクセスが無効化されている
  - [ ] IAM ロールが最小権限の原則に従っている
  - [ ] HTTPS 以外の接続が拒否されている（HTTP → HTTPS リダイレクト）
  - [ ] セキュリティヘッダー（HSTS、X-Frame-Options、X-Content-Type-Options）が設定されている
  - [ ] デフォルトアカウント・パスワードが変更されている
  - [ ] ログ収集が正常に動作している（CloudWatch Logs への送信確認）
- 四半期ごとに外部のペネトレーションテストを実施

**該当箇所**: 6. 実装方針 > デプロイメント方針

---

## 3. 確認事項（ユーザー確認が必要）

### 3-1. 外部パートナーとの情報共有のアクセス制御方式

**確認理由**:
- 1. 概要 > 利用シナリオに「外部パートナーとの限定的な情報共有」とあるが、その実装方式が不明
- 外部ユーザー（組織外）に対してどのようにアクセス権を付与するか（招待リンク、ゲストアカウント、匿名共有リンク等）が未設計

**選択肢とトレードオフ**:
1. **ゲストユーザー招待方式**: 外部ユーザーにメール招待を送り、ゲストロールでアカウント作成
   - メリット: 細かいアクセス制御が可能、監査ログで誰がアクセスしたか追跡可能
   - デメリット: 外部ユーザーにアカウント作成の手間が発生
2. **匿名共有リンク方式**: プロジェクトやドキュメントごとに一時的な共有 URL を生成（認証不要）
   - メリット: 外部ユーザーの手間が少ない
   - デメリット: URL 漏洩時に誰でもアクセス可能、アクセス者の追跡が困難
3. **パスワード保護付き共有リンク**: 匿名共有リンクにパスワードを追加
   - メリット: URL 漏洩時の被害を軽減
   - デメリット: パスワード管理の手間、パスワードも一緒に送信される場合は効果薄

**推奨確認事項**:
- どの共有方式を採用するか決定し、設計書に明記してください
- 共有リンクの有効期限、アクセス回数制限、パスワード保護の有無を定義してください

---

### 3-2. マルチテナント環境での組織間データ分離の保証

**確認理由**:
- SaaS プラットフォームとして複数組織（Organization）が同一 DB を共有する設計
- 組織 A のユーザーが組織 B のプロジェクト・タスクにアクセスできないことを保証する仕組みが明示されていない

**選択肢とトレードオフ**:
1. **アプリケーションレベルでの分離**: すべてのクエリに `WHERE organization_id = ?` を含める
   - メリット: 実装が容易、スケーラビリティが高い
   - デメリット: 開発者のミス（WHERE 句の付け忘れ）により他組織データが漏洩するリスク
2. **データベーススキーマ分離**: 組織ごとに PostgreSQL スキーマまたは DB を分離
   - メリット: DB レベルで分離されるため、アプリケーションのバグがあっても漏洩しにくい
   - デメリット: スキーマ数増加に伴う管理コスト、クエリパフォーマンスへの影響
3. **Row-Level Security (RLS)**: PostgreSQL の RLS 機能を使い、DB 側で行レベルアクセス制御
   - メリット: DB レベルで強制されるため、アプリケーションバグの影響を軽減
   - デメリット: RLS 設定の複雑さ、パフォーマンスオーバーヘッド

**推奨確認事項**:
- 組織間データ分離の方式を明確に選択し、実装方針に記載してください
- 選択した方式に基づき、テスト方針に「組織間データ漏洩テスト」を追加してください

---

### 3-3. コンプライアンス要件（GDPR、SOC 2 等）の適用範囲

**確認理由**:
- 設計書にプライバシー・コンプライアンス要件が明記されていない
- 対象地域（EU、米国、日本）やコンプライアンス基準（GDPR、SOC 2、HIPAA）により、必要なセキュリティ対策が大きく異なる

**選択肢とトレードオフ**:
1. **GDPR 準拠を前提とする**:
   - 必須対策: データ保持期限、削除権、データポータビリティ、同意管理、DPO 設置
   - 追加コスト: プライバシー影響評価、データ処理記録、定期監査
2. **SOC 2 Type II 取得を目指す**:
   - 必須対策: アクセス制御、変更管理、監視・アラート、インシデント対応プロセス
   - 追加コスト: 外部監査費用、継続的なコンプライアンスモニタリング
3. **最低限のセキュリティ基準のみ**:
   - 特定のコンプライアンス基準に縛られず、一般的なセキュリティ対策のみ実施
   - リスク: 大企業顧客が SOC 2 レポートを要求した場合に対応できない

**推奨確認事項**:
- ターゲット顧客の業種・地域に基づき、準拠すべきコンプライアンス基準を特定してください
- 該当する基準に応じて、7. 非機能要件 > セキュリティ要件にコンプライアンス項目を追加してください

---

## 4. 良好な評価（優れた点）

### 4-1. bcrypt によるパスワードハッシュ化の採用

- パスワードを平文保存せず、bcrypt（コスト係数 10）でハッシュ化している点は適切
- bcrypt は計算コストが高く、Rainbow Table 攻撃や GPU によるブルートフォース攻撃に強い
- ただし、前述の通りコスト係数を 12 に引き上げることを推奨

### 4-2. すべての通信を HTTPS 経由に限定

- 7. 非機能要件 > セキュリティ要件で「すべての API 通信は HTTPS 経由」と明記
- 中間者攻撃（MITM）やトラフィック盗聴を防ぐ基本的な対策として評価できる

### 4-3. Sequelize ORM による SQL インジェクション対策の基本実装

- ORM 使用により、大部分のクエリは自動的にパラメータ化され、SQL インジェクションリスクが低減
- ただし、生 SQL 使用時の方針を明確化することでさらに強化可能（改善提案 2-2 参照）

### 4-4. ファイルサイズ制限の設定

- ドキュメントアップロードに 10MB 制限を設けることで、DoS 攻撃（大量ファイルアップロード）のリスクを軽減
- ただし、MIME type 検証やマルウェアスキャンを追加することで多層防御が実現可能（重大な問題 1-3 参照）

### 4-5. 多層アーキテクチャによる責務分離

- API Gateway、ビジネスロジック層、データアクセス層が明確に分離されており、セキュリティ制御を層ごとに適用可能
- 各層で独立したセキュリティ対策（Gateway でレート制限、ビジネスロジック層で認可チェック、データ層で暗号化）を実装できる設計

---

## 総合所見

TaskFlow システムは基本的なセキュリティ対策（HTTPS、bcrypt、ORM 使用）を採用していますが、**設計レベルで明示されていないセキュリティ対策が多数存在**し、本番環境での運用には重大なリスクがあります。

特に以下の 3 点は早急な設計変更が必要です:

1. **JWT の localStorage 保存とセッション管理の脆弱性**（重大な問題 1-1）
2. **認証エンドポイントへのレート制限・ブルートフォース対策の欠如**（重大な問題 1-2）
3. **ファイルアップロードの検証・マルウェア対策の不足**（重大な問題 1-3）

また、設計書には「何を実装するか」は記載されていますが、**「何を実装しないか（何が欠けているか）」の明示が不足**しています。例えば、CSRF 保護、監査ログ、OAuth セキュリティ、データ暗号化といった業界標準のセキュリティ対策が「明示的に不要」なのか「検討漏れ」なのかが判断できません。

本レポートで指摘した重大な問題および改善提案を設計に反映し、確認事項についてはステークホルダーと協議の上、方針を決定することを強く推奨します。
