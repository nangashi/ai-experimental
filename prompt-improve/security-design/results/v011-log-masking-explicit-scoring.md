# Scoring Results: v011-log-masking-explicit

## Scoring Summary

**Prompt Name**: log-masking-explicit
**Mean Score**: 7.25
**Standard Deviation**: 0.25
**Stability**: 高安定 (SD ≤ 0.5)

- **Run1**: 7.5点 (検出7.0 + bonus1 - penalty0)
- **Run2**: 7.0点 (検出6.0 + bonus2 - penalty0)

---

## Run1 Detection Matrix

| Problem ID | Category | Severity | Detection | Score | Notes |
|-----------|----------|----------|-----------|-------|-------|
| P01 | 認証設計（データ保護） | 重大 | ○ | 1.0 | C3で検出。localStorage保存によるXSSリスク、httpOnlyクッキーへの移行を提案 (line 175-177) |
| P02 | 認証設計 | 中 | × | 0.0 | パスワードリセットトークンの有効期限に関する直接的な指摘なし |
| P03 | 認可設計 | 重大 | ○ | 1.0 | C4で検出。予約操作の所有者チェック欠如、リソース所有権検証の実装を提案 (line 123-153) |
| P04 | データ保護（シークレット管理） | 重大 | ○ | 1.0 | C5で検出。シークレット管理設計欠如、AWS Secrets Managerの使用を推奨 (line 155-185) |
| P05 | 入力検証設計 | 中 | ○ | 1.0 | C6で検出。入力検証方針の欠如、検証ルールとサニタイゼーションの必要性を指摘 (line 189-227) |
| P06 | データ保護（プライバシー） | 中 | ○ | 1.0 | C2で検出。ログマスキングポリシーの欠如、PII/機密データのマスキング方針を詳細に提案 (line 52-89) |
| P07 | インフラ・依存関係のセキュリティ | 中 | △ | 0.5 | M2で検出。Elasticsearchのアクセス制御に言及しているが、部分的 (line 496-524) |
| P08 | 脅威モデリング（DoS防止） | 中 | ○ | 1.0 | C7で検出。レート制限設計欠如、決済API含む各種レート制限の必要性を指摘 (line 229-261) |
| P09 | 脅威モデリング（DoS防止） | 軽微 | △ | 0.5 | S4で検出。サプライヤーAPIのタイムアウトとサーキットブレーカーに言及しているが、遅延攻撃やリソース枯渇の観点が弱い (line 397-422) |

**検出スコア合計**: 7.0点

### Run1 ボーナス

| ID | Category | Content | Score | Notes |
|----|----------|---------|-------|-------|
| B01 | 監査ログ設計 | 重要操作の監査ログ設計が欠如 | +0.5 | M1で検出。セキュリティ重要イベントの監査ログ仕様欠如を指摘 (line 453-483) |

**ボーナス合計**: +0.5点 (1件)

### Run1 ペナルティ

なし

**ペナルティ合計**: 0点

**Run1 総合スコア**: 7.0 + 0.5 - 0 = **7.5点**

---

## Run2 Detection Matrix

| Problem ID | Category | Severity | Detection | Score | Notes |
|-----------|----------|----------|-----------|-------|-------|
| P01 | 認証設計（データ保護） | 重大 | ○ | 1.0 | Issue 4で検出。localStorage保存によるXSS攻撃脆弱性、httpOnlyクッキーへの移行を提案 (line 165-177) |
| P02 | 認証設計 | 中 | △ | 0.5 | Issue 4で部分検出。パスワードリセットセキュリティに言及し1時間有効期限を提案しているが、設計欠如という観点が弱い (line 187-192) |
| P03 | 認可設計 | 重大 | × | 0.0 | 認可モデル全体の欠如は指摘されているが、予約キャンセルAPIの所有者確認という具体的な問題への言及なし |
| P04 | データ保護（シークレット管理） | 重大 | × | 0.0 | Issue 1でデータ暗号化・鍵管理の指摘はあるが、データベース接続文字列やクレデンシャルの保管方法に特化した指摘なし |
| P05 | 入力検証設計 | 中 | ○ | 1.0 | Issue 5で検出。入力検証ポリシー欠如、SQLインジェクション/XSS対策の検証ルールを詳細に提案 (line 189-240) |
| P06 | データ保護（プライバシー） | 中 | ○ | 1.0 | Issue 2で検出。ログマスキングポリシーの完全欠如、PII/クレデンシャル/決済情報のマスキング方針を詳細に提案 (line 52-114) |
| P07 | インフラ・依存関係のセキュリティ | 中 | ○ | 1.0 | Issue 6で検出。Elasticsearchの認証・アクセス制御・ネットワーク制限設計欠如、X-Pack Securityの実装を提案 (line 250-294, table line 254) |
| P08 | 脅威モデリング（DoS防止） | 中 | ○ | 1.0 | Issue 7で検出。レート制限ポリシー欠如、決済トランザクション制限を含む詳細なレート制限設計を提案 (line 301-339) |
| P09 | 脅威モデリング（DoS防止） | 軽微 | △ | 0.5 | Issue 12で部分検出。サプライヤーAPIのタイムアウト・サーキットブレーカーに言及しているが、遅延攻撃やリソース枯渇の具体的観点が弱い (line 471-500) |

**検出スコア合計**: 6.0点

### Run2 ボーナス

| ID | Category | Content | Score | Notes |
|----|----------|---------|-------|-------|
| B03 | CSRF対策 | state-changingなAPIにCSRF対策の記載がない | +0.5 | Issue 8で検出。CSRF保護メカニズム欠如、double-submit cookieパターンとトークン検証を提案 (line 345-372) |
| B02 | データ保護 | PostgreSQL/Redisの暗号化（保存時暗号化）設計が未定義 | +0.5 | Issue 6で検出。PostgreSQL/Redis/Elasticsearchの保存時暗号化設計欠如を指摘 (line 250-294) |

**ボーナス合計**: +1.0点 (2件)

### Run2 ペナルティ

なし

**ペナルティ合計**: 0点

**Run2 総合スコア**: 6.0 + 1.0 - 0 = **7.0点**

---

## 総合評価

### スコア統計
- **Mean**: (7.5 + 7.0) / 2 = **7.25点**
- **SD**: sqrt(((7.5-7.25)² + (7.0-7.25)²) / 2) = sqrt((0.0625 + 0.0625) / 2) = sqrt(0.0625) = **0.25**

### 安定性判定
- SD = 0.25 ≤ 0.5 → **高安定** (結果が信頼できる)

### 検出パターン分析

#### Run1の強み
- P07 (Elasticsearch) を部分検出
- 監査ログ設計の欠如をボーナスで検出

#### Run2の強み
- P02 (パスワードリセット有効期限) を部分検出
- P07 (Elasticsearch) を完全検出
- CSRF対策とDB暗号化をボーナスで検出（計2件）

#### 両Run共通の弱点
- **P02**: パスワードリセットトークンの有効期限設計欠如の検出が弱い
  - Run1: 未検出
  - Run2: 部分検出（有効期限の提案はあるが設計欠如としての指摘が弱い）
- **P03**: 予約キャンセルAPIの認可チェック欠如
  - Run1: 一般的なリソース所有権検証として検出
  - Run2: 未検出
- **P04**: データベース接続文字列の保管方法
  - Run1: AWS Secrets Managerの使用を提案
  - Run2: 暗号化・鍵管理の一般論として扱い、接続文字列の保管に特化していない

#### 共通の強み
- **P06 (ログマスキング)**: 両Run共に完全検出、詳細な提案（パスワード、トークン、カード、PII）
- **P05 (入力検証)**: 両Run共に完全検出、SQLインジェクション/XSS対策を含む詳細な提案
- **P08 (レート制限)**: 両Run共に完全検出、決済API含む各種レート制限の提案

### 推奨判定への影響
- 安定性が高い（SD=0.25）ため、このバリアントの結果は信頼できる
- 平均スコア7.25点は高評価であり、ベースラインとの比較で推奨判定が可能

---

## 採点者コメント

### バリアントの特徴
このバリアント (v011-log-masking-explicit) は、P06（ログ出力における個人情報マスキング）の検出を明示的に強化した設計。

### 検出品質の評価

**優れている点:**
1. **P06の完全検出**: 両Run共にC2/Issue 2で詳細な検出
   - パスワード、JWT、カード、メール、電話のマスキング方針を具体的に提案
   - 構造化ログとマスキングライブラリの実装例を含む
2. **P08の安定検出**: 両Run共に決済APIのレート制限を含む詳細な提案
3. **高い安定性**: SD=0.25と非常に低く、検出結果のばらつきが小さい

**改善の余地:**
1. **P02の検出弱点**: パスワードリセットトークンの有効期限設計が明示的な問題として認識されていない
2. **P03の検出不足**: 予約キャンセルAPIの所有者確認という具体的な認可問題への言及が弱い
3. **P04の焦点のズレ**: データベース接続文字列の保管に特化せず、一般的なシークレット管理として扱われている

### 総合所見
このバリアントは、ログマスキング（P06）の検出を明示的に強化した結果、P06の完全検出を達成し、かつ安定性も高い（SD=0.25）。ただし、認証・認可関連の問題（P02, P03, P04）の検出に若干の弱点が見られる。全体として高いスコア（Mean=7.25）を維持しており、ログセキュリティの観点を重視するユースケースには適している。
