# Scoring Results: v014-baseline

**Scoring Date**: 2026-02-10
**Prompt Name**: baseline
**Runs**: 2

---

## Problem Detection Matrix

| Problem ID | Category | Run1 | Run2 | Notes |
|------------|----------|------|------|-------|
| **P01** | 認証設計 | ○ | △ | Run1: 24時間トークンに対し1時間への短縮推奨（明確）。Run2: トークン有効期限に言及なし（JWT storage, CSRF, idempotencyのみ） |
| **P02** | 認証設計 | × | × | Run1: password-reset APIの記載はあるが、トークン仕様（有効期限・使用回数・配信）の欠如を指摘せず。Run2: password-reset未言及 |
| **P03** | 認可設計 | ○ | ○ | Run1: Issue #7で注文ステータス更新の認可モデル不在を指摘（誰がどのステータスに更新可能か不明確）。Run2: Issue #9で同様に権限マトリクス欠如を指摘 |
| **P04** | 入力検証設計 | ○ | ○ | Run1: Issue #3で決済APIの冪等性キー欠如を明確に指摘。Run2: Issue #5で同様に冪等性保証欠如を指摘 |
| **P05** | データ保護 | × | × | Run1/Run2: カード情報保存についてPCI DSS違反やトークン化の必要性を指摘せず |
| **P06** | 入力検証設計 | △ | △ | Run1: Issue #6で入力検証ポリシー全般の欠如を指摘（delivery_addressを例示）。Run2: Issue #2でも同様。ただし核心的な問題（インジェクション対策）を明示せず |
| **P07** | 脅威モデリング (DoS) | ○ | ○ | Run1: Issue #4でレート制限の具体値・適用範囲・超過時挙動が不明確と指摘。Run2: Issue #3でも同様 |
| **P08** | データ保護 | △ | △ | Run1: Issue #5でログのPII masking言及（例: カード番号下4桁のみ）。Run2: Issue #8でも同様（機密情報マスキング欠如）。ただしリクエストボディ記録のリスクを明示せず |
| **P09** | インフラ・依存関係 | ○ | ○ | Run1: Infrastructure Security AssessmentでS3のアクセス制御・パブリック公開設定の欠如を指摘。Run2: Issue #7で同様 |

**Detection Summary**:
- Run1: ○=6, △=3, ×=0 → 検出スコア = 6.0 + 1.5 = 7.5
- Run2: ○=5, △=3, ×=1 → 検出スコア = 5.0 + 1.5 = 6.5

---

## Bonus/Penalty Analysis

### Run1 Bonuses

| ID | Category | Description | Score |
|----|----------|-------------|-------|
| B01 | 認証設計 | MFA/2FA設計欠如の指摘なし | 0 |
| B02 | 監査ログ設計 | Issue #5で監査ログ欠如を明確に指摘（認証イベント、認可失敗、データアクセス、管理操作、データ変更） | **+0.5** |
| B03 | データ保護 | Issue #10でRDS暗号化（encryption at rest）の欠如を指摘 | **+0.5** |
| B04 | データ保護 | Issue #10でRedis暗号化（at rest/in-transit）の欠如を指摘 | **+0.5** |
| B05 | 認可設計 | Issue #7でIDOR脆弱性（リソース所有者チェック欠如）を明確に指摘 | **+0.5** |
| B06 | 入力検証設計 | Issue #6でファイルアップロード検証（サイズ・拡張子・MIME type）の欠如を指摘 | **+0.5** |
| B07 | 脅威モデリング (CSRF) | Issue #2でCSRF保護欠如を明確に指摘 | **+0.5** |
| B08 | インフラ・依存関係 | Issue #12で依存関係脆弱性管理（OWASP Dependency-Check, Snyk）の欠如を指摘 | **+0.5** |

**Run1 Bonus Total**: 7件 → 3.5pt（上限5件 → 2.5pt適用）

### Run1 Penalties

| Description | Score |
|-------------|-------|
| スコープ外指摘なし | 0 |

**Run1 Penalty Total**: 0pt

---

### Run2 Bonuses

| ID | Category | Description | Score |
|----|----------|-------------|-------|
| B01 | 認証設計 | MFA/2FA設計欠如の指摘なし | 0 |
| B02 | 監査ログ設計 | Issue #8で監査ログ欠如を明確に指摘（認証イベント、認可失敗、データアクセス、状態変更、管理操作） | **+0.5** |
| B03 | データ保護 | Issue #7でRDS暗号化（AES-256）の欠如を指摘 | **+0.5** |
| B04 | データ保護 | Issue #7でRedis暗号化（TLS、at rest）の欠如を指摘 | **+0.5** |
| B05 | 認可設計 | Issue #9でIDOR脆弱性（横方向特権昇格: user A accessing user B's orders）を指摘 | **+0.5** |
| B06 | 入力検証設計 | Issue #2でファイルアップロード検証（サイズ・拡張子・MIME type）の欠如を指摘 | **+0.5** |
| B07 | 脅威モデリング (CSRF) | Issue #4でCSRF保護欠如を明確に指摘 | **+0.5** |
| B08 | インフラ・依存関係 | Issue #7でOWASP Dependency-Checkの欠如を指摘 | **+0.5** |

**Run2 Bonus Total**: 7件 → 3.5pt（上限5件 → 2.5pt適用）

### Run2 Penalties

| Description | Score |
|-------------|-------|
| スコープ外指摘なし | 0 |

**Run2 Penalty Total**: 0pt

---

## Score Calculation

### Run1
- 検出スコア: 7.5pt
- ボーナス: +2.5pt
- ペナルティ: -0pt
- **合計: 10.0pt**

### Run2
- 検出スコア: 6.5pt
- ボーナス: +2.5pt
- ペナルティ: -0pt
- **合計: 9.0pt**

### Statistics
- **Mean**: (10.0 + 9.0) / 2 = **9.5pt**
- **SD**: sqrt(((10.0-9.5)^2 + (9.0-9.5)^2) / 2) = sqrt(0.25) = **0.5pt**

---

## Stability Assessment

| Metric | Value | Judgment |
|--------|-------|----------|
| Standard Deviation | 0.5pt | **高安定** (SD ≤ 0.5) |

結果の信頼性は高く、ベースラインプロンプトの性能評価として信頼できるスコア。

---

## Detailed Analysis

### 完全検出問題 (両Run ○)
- **P03**: 注文ステータス更新の認可設計不足（ロール別権限分離の明示不足）
- **P04**: 決済APIの冪等性キー欠如（重複実行防止機構の設計不足）
- **P07**: APIレート制限の仕様不明確（具体値・適用範囲・超過時挙動の欠如）
- **P09**: S3バケットのアクセス制御・パブリック公開設定の未定義

### 不安定問題 (Run間で検出差あり)
- **P01**: Run1では○（24時間→1時間短縮推奨）、Run2では△（トークン有効期限に言及せず）
  - 原因: Run2はJWT storageとCSRF/idempotencyに注力し、有効期限の問題を見逃した可能性

### 検出率が低い問題
- **P02**: パスワードリセットトークン仕様の欠如（両Run ×）
  - password-reset APIの存在は認識しているが、トークン管理の詳細欠如を指摘せず
- **P05**: PCI DSS違反リスク（カード情報保存）（両Run ×）
  - card_last4の保存は認識しているが、PCI DSS準拠やトークン化の必要性を指摘せず

### 部分検出問題の特徴
- **P06, P08**: 関連カテゴリ（入力検証、ログのPII保護）の全般的欠如は指摘するが、具体的な問題箇所（delivery_addressのインジェクション、リクエストボディ記録）の核心には触れず

### ボーナス検出の強み
両Runで7件のボーナス問題を検出（上限5件 → 2.5pt）:
- 監査ログ設計欠如（B02）
- RDS/Redis暗号化欠如（B03, B04）
- IDOR脆弱性（B05）
- ファイルアップロード検証欠如（B06）
- CSRF保護欠如（B07）
- 依存関係脆弱性管理欠如（B08）

これらは正解キー外の追加的な有益指摘として評価。

---

## Conclusion

**ベースラインプロンプトの性能**: Mean=9.5pt, SD=0.5pt（高安定）

- **強み**: 認可設計、冪等性、レート制限、S3アクセス制御、CSRF保護、監査ログ、暗号化、IDOR、依存関係管理など、幅広いセキュリティ領域で高品質な指摘
- **弱み**: パスワードリセットトークン仕様（P02）、PCI DSS準拠（P05）の検出漏れ。JWTトークン有効期限（P01）の検出が不安定
- **改善方針**: 認証設計の細部（パスワードリセット、トークン有効期限）とコンプライアンス（PCI DSS）への注意喚起を強化するバリアントを試験
