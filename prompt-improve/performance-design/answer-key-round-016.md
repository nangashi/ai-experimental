# 正解キー

## 実行条件
- **観点**: performance
- **対象**: design
- **埋め込み問題数**: 9問

## 埋め込み問題一覧

### P01: パフォーマンス要件/SLAの未定義
- **カテゴリ**: パフォーマンス要件
- **深刻度**: 重大
- **該当箇所**: セクション7.1
- **問題の説明**: 想定負荷は記載されているが、具体的なパフォーマンス目標値（レスポンスタイム、スループット）やSLA定義が欠如している。「同時接続ユーザー500名」に対する許容レスポンスタイムが明示されていないため、設計の妥当性が検証できない。
- **検出判定基準**:
  - ○（検出）: レスポンスタイム目標（例: API応答時間200ms以内）またはスループット目標（例: 1000 req/sec）の未定義を指摘し、SLA/パフォーマンス要件の明示が必要と述べている
  - △（部分検出）: 「想定負荷の記載はあるが目標値が不明確」と指摘しているが、具体的なレスポンスタイム/スループット目標の必要性に触れていない
  - ×（未検出）: 指摘なし

### P02: ダッシュボード統計取得のN+1問題
- **カテゴリ**: I/O・ネットワーク効率
- **深刻度**: 重大
- **該当箇所**: セクション6.2 getEventStats実装
- **問題の説明**: ダッシュボード統計取得時にregistrationsとusersのJOINクエリで全レコードを取得した後、survey_responsesを別クエリで取得している。イベントごとに2回のクエリ実行が必要で、複数イベントのダッシュボード表示時にN+1問題が発生する可能性がある。
- **検出判定基準**:
  - ○（検出）: ダッシュボード統計取得におけるクエリ分離（registrations+users JOINとsurvey_responses別クエリ）がN+1問題またはクエリ非効率を引き起こすと指摘し、JOINによる一括取得またはバッチクエリの必要性を述べている
  - △（部分検出）: ダッシュボードのクエリ効率に言及しているが、N+1問題の具体的特定または解決策（JOIN統合、バッチ化）に触れていない
  - ×（未検出）: 指摘なし

### P03: キャッシュ戦略の未定義
- **カテゴリ**: キャッシュ・メモリ管理
- **深刻度**: 重大
- **該当箇所**: セクション2（技術スタック）、セクション5.1（API設計）
- **問題の説明**: Redis（ElastiCache）が技術スタックに含まれているが、具体的なキャッシュ対象、有効期限、無効化戦略が未定義。イベント一覧取得、ダッシュボード統計など頻繁にアクセスされるデータに対するキャッシュ活用方針が明示されていない。
- **検出判定基準**:
  - ○（検出）: Redisが利用可能だがキャッシュ戦略（キャッシュ対象、有効期限、無効化戦略）が未定義であることを指摘し、イベント一覧やダッシュボード統計などの具体的キャッシュ対象候補を提示している
  - △（部分検出）: キャッシュ戦略の重要性に言及しているが、Redis利用可能なのに戦略未定義という不在検出（absence detection）ができていない
  - ×（未検出）: 指摘なし

### P04: 参加申込処理の並行制御欠如
- **カテゴリ**: レイテンシ・スループット設計
- **深刻度**: 中
- **該当箇所**: セクション6.1 createRegistration実装
- **問題の説明**: 定員チェック（registrations.length >= event.capacity）と申込登録の間にトランザクション制御やロック機構がない。複数ユーザーが同時に申込した場合、定員超過登録が発生する競合状態（race condition）のリスクがある。
- **検出判定基準**:
  - ○（検出）: 参加申込処理における定員チェックと登録の間の競合状態（race condition）を指摘し、トランザクション分離レベル、行ロック、または楽観的ロックの必要性を述べている
  - △（部分検出）: 並行申込への対応が必要と指摘しているが、競合状態の具体的特定または解決策（トランザクション、ロック）に触れていない
  - ×（未検出）: 指摘なし

### P05: リマインダー送信バッチのN+1問題
- **カテゴリ**: I/O・ネットワーク効率
- **深刻度**: 中
- **該当箇所**: セクション6.3 sendReminders実装
- **問題の説明**: リマインダー送信バッチで、各registrationに対してuserRepository.findById()を個別に実行している。参加者数が多い場合、大量のデータベースクエリが発生し、バッチ処理時間が増大する。
- **検出判定基準**:
  - ○（検出）: リマインダー送信バッチにおけるuserRepository.findById()の繰り返し実行がN+1問題を引き起こすと指摘し、JOINまたはIN句によるバッチ取得の必要性を述べている
  - △（部分検出）: リマインダーバッチのクエリ効率に言及しているが、N+1問題の具体的特定または解決策（JOIN、バッチ取得）に触れていない
  - ×（未検出）: 指摘なし

### P06: メール送信の同期処理
- **カテゴリ**: レイテンシ・スループット設計
- **深刻度**: 中
- **該当箇所**: セクション6.1（参加申込）、セクション6.3（リマインダー）
- **問題の説明**: 参加申込確認メール送信とリマインダーメール送信が同期処理として実装されている。SESの送信時間がAPI応答時間に直接影響し、メール送信遅延時にユーザー体験が悪化する。
- **検出判定基準**:
  - ○（検出）: メール送信（申込確認、リマインダー）が同期処理であることを指摘し、非同期処理（キュー、バックグラウンドジョブ）への変更またはSQS活用の必要性を述べている
  - △（部分検出）: メール送信の非同期化の重要性に言及しているが、現在の同期実装の問題点（API応答時間への影響、遅延リスク）を具体的に指摘していない
  - ×（未検出）: 指摘なし

### P07: データベースインデックス設計の欠如
- **カテゴリ**: レイテンシ・スループット設計
- **深刻度**: 中
- **該当箇所**: セクション4.1（データモデル）
- **問題の説明**: registrations.event_id、registrations.user_id、survey_responses.event_id など頻繁にクエリされるカラムにインデックス定義が明示されていない。データ量増加時にクエリパフォーマンスが劣化する。
- **検出判定基準**:
  - ○（検出）: registrations.event_id、registrations.user_id、survey_responses.event_idなど頻繁にクエリされる外部キーカラムのインデックス欠如を指摘し、インデックス設計の必要性を述べている
  - △（部分検出）: インデックス設計の重要性に言及しているが、具体的な対象カラム（event_id、user_id）を特定していない
  - ×（未検出）: 指摘なし

### P08: 履歴データ増大対策の欠如
- **カテゴリ**: スケーラビリティ設計
- **深刻度**: 軽微
- **該当箇所**: セクション7.4
- **問題の説明**: registrations、survey_responsesなどの履歴データが無期限保持される。月間10,000件の申込が継続的に蓄積されると、1年で120,000件、5年で600,000件に達し、クエリパフォーマンスやストレージコストに影響する。
- **検出判定基準**:
  - ○（検出）: 履歴データ（registrations、survey_responses）の無期限保持が長期的にクエリパフォーマンスやストレージコストに影響すると指摘し、アーカイブ戦略、パーティショニング、またはデータ保持期限の必要性を述べている
  - △（部分検出）: データ増大への対応が必要と指摘しているが、具体的な影響（クエリパフォーマンス劣化、ストレージコスト）または解決策（アーカイブ、パーティショニング）に触れていない
  - ×（未検出）: 指摘なし

### P09: パフォーマンス監視・メトリクス収集の欠如
- **カテゴリ**: 監視
- **深刻度**: 軽微
- **該当箇所**: セクション7.1（パフォーマンス）
- **問題の説明**: パフォーマンス固有のメトリクス収集設計（APIレスポンスタイム、スループット、データベースクエリ時間、キャッシュヒット率）が明示されていない。パフォーマンス劣化の早期検知ができない。
- **検出判定基準**:
  - ○（検出）: パフォーマンス固有のメトリクス（APIレスポンスタイム、スループット、DBクエリ時間、キャッシュヒット率など）の収集設計欠如を指摘し、監視・アラート設計の必要性を述べている
  - △（部分検出）: パフォーマンス監視の重要性に言及しているが、具体的なメトリクス種類（レスポンスタイム、スループット、クエリ時間、キャッシュヒット率）を特定していない
  - ×（未検出）: 指摘なし

## ボーナス問題リスト

正解キーに含めないが、検出された場合にボーナスとして加点する問題の候補:

| ID | カテゴリ | 内容 | ボーナス条件 |
|----|---------|------|------------|
| B01 | I/O効率 | イベント一覧取得API（GET /api/events）にページネーション・カーソルベース取得がない | 月間500イベント蓄積時の一覧取得効率悪化を指摘 |
| B02 | キャッシュ | イベント一覧取得結果のキャッシュ戦略（category/statusフィルタ別キャッシュキー設計） | フィルタ別キャッシュ戦略の具体的提案 |
| B03 | 並行処理 | リマインダー送信バッチの並行処理化（Promise.all、ワーカースレッド活用） | バッチ処理時間短縮のための並行化提案 |
| B04 | スケーラビリティ | QRコードチェックイン時のスパイク負荷対策（イベント開始直前に参加者が一斉にチェックインする状況） | チェックインAPIのスパイク負荷シナリオと対策提案 |
| B05 | API効率 | ダッシュボード統計取得の集計クエリ最適化（GROUP BY、COUNT、集約関数活用） | SQL集約関数による効率化提案 |
| B06 | リソース管理 | データベース接続プール設定の未定義 | 接続プール設定（最大接続数、タイムアウト）の明示必要性指摘 |
| B07 | スケーラビリティ | ECS Auto Scaling条件（CPU 70%閾値）の妥当性検証不足 | レスポンスタイムベースのスケーリングまたは閾値検証の提案 |
