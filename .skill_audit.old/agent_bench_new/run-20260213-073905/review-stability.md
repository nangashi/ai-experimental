### 安定性レビュー結果

#### 重大な問題
- [出力フォーマット決定性: サブエージェント返答の行数指定に曖昧性]: [phase0-perspective-generation.md] [line 61-63] [「検証成功 → 以下の**1行のみ**を返答する（他のテキストは含めない）」と記述されているが、phase0-perspective-generation-simple.md には同様の指示が存在する（line 25-28）一方で、SKILL.md では「サブエージェント返答: 1行」と記載されている。しかしSTEP 2とSTEP 3で中間サブエージェントを起動しており、最終返答が1行であることは明示されているが、中間サブエージェント（generate-perspective.md）の返答行数が未定義] → [generate-perspective.md に「サマリ」としか記載がなく行数・フォーマットが不明確。「以下の1行のみを返答:」と明示すべき] [impact: medium] [effort: low]
- [参照整合性: 存在しないディレクトリへの参照]: [SKILL.md] [line 210-213] [agent_audit の出力ディレクトリ `.agent_audit/{agent_name}/audit-*.md` への参照があるが、agent_audit スキルが実行されていない場合はディレクトリ自体が存在しない。Phase 1B では `test -d .agent_audit/{agent_name}` で確認しているが、ディレクトリが存在してもファイルが存在しない場合のハンドリングが不明確] → [Glob 実行時にファイルが見つからない場合のデフォルト動作を明記すべき（空文字列として扱う旨を明示）] [impact: medium] [effort: low]
- [冪等性: knowledge.md 更新時の並行実行リスク]: [phase6-step2-workflow.md] [line 51-67] [Step 3 で「以下の2つを Task ツールで並列実行する」とあり、A) proven-techniques.md 更新と B) 次アクション選択を並列実行する。しかし A) は knowledge.md を Read する（phase6b-proven-techniques-update.md line 4）ため、Step 2 で knowledge.md が更新された直後に並列読み込みが発生し、ファイルシステムの遅延により古い内容を読む可能性がある] → [Step 2 の knowledge.md 更新完了を明示的に待機してから Step 3 を開始するか、A) と B) の並列実行を直列化すべき] [impact: medium] [effort: medium]
- [条件分岐の完全性: フォールバック検索失敗時のエラーメッセージ不足]: [phase0-perspective-resolution.md] [line 22-23, 29] [Step 2 でパターン一致しない場合とStep 3 で読み込み失敗時に「失敗として返答し終了」とあるが、具体的なエラーメッセージ内容が定義されていない。SKILL.md line 71-72 では「サブエージェント失敗時: パースペクティブ自動生成（後述）を実行する」とあるため、失敗の種類（パターン不一致 vs ファイル不在）を区別できる返答が必要] → [失敗理由を明示した返答フォーマットを定義すべき（例: 「失敗: パターン不一致」「失敗: ファイル不在 - {path}」）] [impact: medium] [effort: low]
- [参照整合性: SKILL.md で定義されていない変数を使用]: [phase0-perspective-generation.md] [line 11-12] [エージェント定義が不足している場合に AskUserQuestion でヒアリングして `{user_requirements}` に追加するとあるが、この変数は SKILL.md の Phase 0 で「Phase 0 の perspective 自動生成で `{user_requirements}` を参照する」と言及されているものの、パス変数リストには含まれていない（line 66-69）。またこのテンプレートに渡される user_requirements は Phase 0 で収集したものだが、phase0-perspective-generation.md はその後にさらに AskUserQuestion で追加収集する動作が定義されており、変数のスコープが不明確] → [user_requirements のスコープと更新フローを SKILL.md のパス変数セクションで明確化すべき] [impact: medium] [effort: medium]

#### 改善提案
- [指示の具体性: 曖昧表現の検出]: [perspectives/design/reliability.md, templates/perspective/critic-effectiveness.md, templates/perspective/critic-clarity.md] [「適切に」「適切なフォーカス」等の曖昧表現が使用されている。critic-clarity.md では「主観的表現が、具体的な判断基準なしで使われていないか」を評価項目としているが、critic-effectiveness.md 自身が「適切にフォーカス」という曖昧表現を使用している] [impact: low] [effort: low]
- [出力フォーマット決定性: Phase 3 の並列実行完了後の集計方法が不明確]: [SKILL.md] [line 271-290] [「全サブエージェント完了後、親が templates/phase3-error-handling.md を Read で読み込み」とあるが、並列実行の成功数をどのように集計するのか（Task ツールの返答形式、エラー検出方法）が明記されていない。「成功数を集計し分岐する」とあるだけで、成功/失敗の判定基準が不明] [impact: medium] [effort: low]
- [冪等性: バリアント生成時の既存ファイル確認のタイミング]: [SKILL.md] [line 142-154, 185-197] [Phase 1A/1B でサブエージェント実行前に Glob で既存ファイルを確認し、AskUserQuestion で上書き確認を行うが、「上書き」選択後にサブエージェントが失敗した場合、次回実行時に再度上書き確認が表示される。サブエージェント失敗時のリトライフローが定義されていないため、ユーザーは手動で再実行する必要があり、同じ確認を繰り返すことになる] [impact: medium] [effort: medium]
- [条件分岐の完全性: Phase 6 Step 2 の knowledge.md 更新承認で却下後の再承認フローが不明確]: [phase6-step2-workflow.md] [line 48-49] [「却下の場合: AskUserQuestion で修正内容を確認し、手動で knowledge.md を Edit で修正する。再度サマリを提示し、承認を得る（1回のみ）」とあるが、再承認で再び却下された場合の動作が定義されていない。「1回のみ」が「修正の試行回数」を指すのか「再承認の試行回数」を指すのか曖昧] → [再承認で却下された場合は警告を出力して元の内容を維持するか、スキルを終了するか、明示的に定義すべき] [impact: medium] [effort: low]
- [参照整合性: テンプレート内のファイルパス参照が動的]: [phase0-perspective-generation.md] [line 38] [「`.claude/skills/agent_bench_new/templates/perspective/{テンプレート名}` を Read で読み込み」とあるが、{テンプレート名} が変数として使用されている。実際には critic-clarity.md 等のファイル名が動的に決定されるが、4並列で起動するファイル名のリストが明示されていない。SKILL.md の分析ドキュメント（G. サブエージェント一覧）では「4並列批評」と記載されているが、具体的なファイル名の列挙が必要] [impact: low] [effort: low]
- [指示の具体性: Phase 1B の「ベースライン選定」の表現が不正確]: [phase1b-variant-generation.md] [line 12-15] [「knowledge.md の「バリエーションステータス」テーブルを使い、バリアントを選定する」とあるが、実際にはベースラインは常に {agent_path} から読み込むことが line 5 で定義されており、選定対象は「バリアント」である。タイトルは「ベースラインコピーとバリアントを生成」だが、「ベースライン選定（Broad/Deep）」という誤解を招く表現が使われている] [impact: low] [effort: low]
- [出力フォーマット決定性: Phase 5 の7行サマリのフォーマット詳細が不明確]: [SKILL.md] [line 332-343] [「サブエージェントの返答（7行サマリ）をテキスト出力してユーザーに提示する」とあり、phase5-analysis-report.md では「推奨判定基準に基づく7行サマリ返答」と記載されているが、7行の具体的なフィールド名と順序が SKILL.md の line 391-393 でしか定義されていない（recommended, reason, convergence, scores, variants, deploy_info, user_summary）。テンプレート側にフォーマット定義がないため、サブエージェントが異なる順序で返答する可能性がある] [impact: medium] [effort: low]

#### 良い点
- [冪等性: knowledge.md 更新後の構造検証]: [phase6a-knowledge-update.md] [line 26-40] [knowledge.md 更新後に Grep で必須セクション（効果テーブル、バリエーションステータス、改善のための考慮事項、最新ラウンドサマリ、ラウンド別スコア推移）を検証し、不足時にエラーメッセージと対処法を出力する設計。最終成果物の構造検証が明示的に定義されている]
- [条件分岐の完全性: Phase 3 のエラーハンドリング分岐が詳細に定義]: [phase3-error-handling.md] [line 7-36] [全成功、ベースライン全失敗、ベースライン成功・バリアント部分失敗、バリアント全失敗の4パターンで分岐ロジックが明示されており、各パターンで再試行/除外/中断の選択肢とベースライン必須条件が明確に定義されている]
- [参照整合性: パス変数が一貫してテンプレートに渡されている]: [SKILL.md] [全フェーズ] [各サブエージェント起動時にパス変数をリストアップし、テンプレート側でも「## パス変数」セクションで受け取り側の定義を記載している。変数の受け渡しパターンが統一されており、参照整合性が高い]
