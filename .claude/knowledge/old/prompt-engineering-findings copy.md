# プロンプト工学の実験的知見

LLMプロンプト設計時の判断基準。9観点+4critic・130+ラウンドの構造最適化実験および外部研究に基づく。

---

## 1. 満足化バイアス（Satisficing Bias）

明示的な構造が「指定項目の完了で十分」というシグナルを送り、探索的思考を抑制するメカニズム。全観点で最も頻繁に観察された失敗原因。

### 知見と定量データ

- **チェックリスト統合は探索を破壊する**: リスト内80%は検出するがリスト外ボーナス検出が完全喪失（0項目）。スコープ逸脱も発生（-1.75pt）
- **ヒントは2件が最適閾値**: 3件以上で満足化バイアスが起動。方向性だけ示す軽量ヒント（例: "Consider scalability implications"）が有効。具体的チェック項目の列挙（例: "Check reconnection strategy, message delivery guarantees"）は固着効果で逆効果（2件 +2.25pt、4件 -2.75pt。5ラウンドで再現確認）
- **NFRセクション明示レビューは逆効果**: セクション存在確認に依存し、セクション外の探索が消失（-3.75pt）
- **剛性的CoTはステップ完了バイアスを誘発**: 番号付き手順（"Step 1:... Step 2:..."）で分析順序を拘束すると、ボーナス発見が大幅減少。テスト文書にボーナス機会が多いほど損失が拡大（-4.5pt）
- **Scoring Rubricは「評価モード」を誘発**: 問題を探す探索ではなく既存記述の評価に退化（-0.5〜-1.5pt）
- **Few-shot 2例以上は複雑タスクで逆効果**: テンプレートバイアスで注意が偏り基本検出すら低下。6例で重大検出率100%→0%（-0.5〜-3.75pt）。CoT内蔵型の推論モデル（DeepSeek-R1, OpenAI o1等。セクション4で詳述）でも5-shotでベースライン劣化が確認されている

### 対策原則

1. **制約削除型プロンプト**（明示的構造をすべて除去しパースペクティブ定義のみ残す）が構造化アプローチと同等以上の場合がある。102.8%検出率を構造なしで達成した実績あり
2. **カテゴリ別分解**は満足化バイアスを回避しつつ系統性を維持する。各カテゴリ内で独立した包括的分析を促進するため、「リスト完了で十分」シグナルが発生しない（詳細→セクション3）

---

## 2. 注意バジェット制約（Attention Budget Constraint）

モデルの注意リソースは有限であり、特定領域の検出を強化すると他領域が犠牲になるゼロサムトレードオフ。

### 知見と定量データ

- **マトリクス構造の代償**: 特定カテゴリの検出強化→マトリクス外のフローベース問題（認証フロー全体の整合性等）の検出低下
- **言語混合は安定性を4倍悪化**: 日本語カテゴリ名追加は該当カテゴリ改善+他カテゴリ低下+安定性SD 4倍悪化を引き起こす。完全英語 or 完全日本語が優位
- **フォーマット制約は推論能力を独立に低下させる**: 出力フォーマット（JSON/XML等）の厳格な制約が推論能力を低下させる。制約が厳しいほど劣化が大きい。対策は自然言語先行の2ステップ方式 — 構造制約なしのプロンプトでまず自然言語回答を生成させ、後続プロンプトまたはパーサーで所定のフォーマットに変換する。推論精度が最優先のタスクで有効

### 例外: スピルオーバー効果

概念的に関連する問題間では注意が波及する。JWT保管チェック→ログPIIマスキング検出が改善（「クレデンシャル処理」概念クラスタ内の活性化）。マトリクス構造（コンポーネント×評価軸）はこのクラスタリングを体系化し、トレードオフを緩和できる。

---

## 3. 分解と構造化

### 分解軸の選択が安定性を決定する

| 分解軸 | 安定性 | メカニズム | 推奨度 |
|--------|--------|-----------|--------|
| **カテゴリ分解**（domain別: SOLID→API→Error→Test等） | SD=0.0 | 各カテゴリで決定論的に分析完了。判断の揺れが発生しない | 基本として推奨 |
| **プロセス分解**（検出→報告 / Critical→Minor） | SD=0.5〜1.25 | 優先度判定が確率的フィルタとして機能。Run間で判断が揺れる | 補助的に使用 |
| **フェーズ分解**（Phase1→Phase2→...） | SD高 | フェーズ境界が認知リソース配分を固定化。横断的パターン認識を断片化 | 非推奨 |

推奨構成: 検出と報告の分離（+2.0〜+2.5pt, SD=0.0）を外枠とし、検出フェーズ内をカテゴリ分解する。

### 構造化度合いの逆U字カーブ

構造化の量と性能は逆U字の関係。カテゴリ分解が系統性と探索性を両立する最適点。統合チェックリスト/厳格カテゴリ分類は一貫して逆効果（-1.75〜-4.5pt）。制約なしベースラインが構造化バリアントを上回る場合もある（performance観点で5連続確認）。

---

## 4. テクニック別の効果

### 一貫して有効

| テクニック | 効果 | 適用時の注意点 | エビデンス |
|-----------|------|--------------|----------|
| 英語化 | +1.5〜+2.75pt, SD=0.0 | 日英混合は逆効果(-0.75pt)。完全英語 or 完全日本語に統一する | 技術用語のLLM事前学習データとの整合 |
| テーブル/マトリクス構造 | +1.24〜+3.0pt, SD=0.0〜0.25 | 実装品質により効果差が大きい（同じ手法でもスコア9.93 vs 8.42） | コンポーネント×評価軸のマトリクスが網羅的カバレッジを強制 |
| 検出と報告の分離 | +2.0〜+2.5pt, SD=0.0 | 検出時に出力整形を考慮させない | 早期フィルタリング（出力整形のため重要度の低い項目を落とす）を防止 |
| ドメイン固有チェックリスト | +2.0〜+3.0pt, SD=0.0〜0.5 | チェックリストに含める領域は3-4個まで効果的。それ以上は満足化バイアスのリスク増大 | 該当ドメインの検出精度が向上 |
| 重大度優先検出 | +1.5〜+2.0pt, SD=0.0〜0.25 | 出力長に制限がある場合に特に有効 | Critical問題の切り捨て防止+ボーナス発見促進 |
| Self-Consistency（多数決） | Best-of-N比4倍の効率改善 | N回分のコスト増。正解が一意に定まるタスク（数式計算、コード構文チェック等）で有効。判断が主観的なタスク（デザイン評価、創造的提案等）では正解が一意でないため多数決が成立せず不適 | — |
| 感情的刺激（EmotionPrompt） | BIG-Bench +115%, Instruction Induction +8% | ポジティブ刺激はユーザーの期待に沿うよう答えを歪める傾向（追従的行動, sycophancy）も増加。正確性重要タスクでは注意 | — |

### 一貫して逆効果

| テクニック | 効果 | 失敗メカニズム |
|-----------|------|--------------|
| Few-shot 2例以上（複雑タスク） | -0.5〜-3.75pt | テンプレートバイアスで注意偏向。6例で重大検出率100%→0% |
| 厳格なカテゴリ分類 | -4.25〜-4.5pt | 横断的思考を抑制し中程度問題を系統的に見逃す |
| 明示的スコープ境界制約 | -4.25pt | 境界ケース検出を不安定化。スコープ内で扱える角度を探すbaselineの方が有効 |
| Scoring Rubric（プロンプト内） | -0.5〜-1.5pt | 「評価モード」を誘発し探索的思考を抑制 |
| 明示的重み付け採点 | -2.5pt | 「存在確認」モードに退化。部分的対処済み仕様を肯定的に扱うポジティブフレーミングバイアス |

### 条件依存テクニック

| テクニック | 有効条件 → 効果 | 逆効果条件 → 効果 | 判断基準 |
|-----------|----------------|------------------|---------|
| タスクチェックリスト | 網羅性が重要（critic-clarity/completeness/effectiveness） → +1.15〜+3.64pt | 判断の深さが重要（critic-generality） → -1.04pt | 「何をチェックするか」が列挙可能なタスクでは効果的。判断の質が問われるタスクではチェックボックス思考を誘発 |
| 専門家ペルソナ | パターン照合タスク → +3.0pt, SD=0.0 | スコープ判断が必要 → -0.75pt | 「何を比較するか」が明確な観点では有効、スコープ判断が必要な場面では過信が問題。正確性タスク全般では効果なし〜劣化 |
| CoT段階的分析 | 柔軟なガイダンス → +0.25pt | 剛性的ステップ指定 → -4.5pt | 方向性を示す（例: "Think through the design holistically"）か、手順を拘束するか。CoT内蔵型の推論モデル（CoTを内蔵し明示的指示なしで段階的推論を行うモデル。DeepSeek-R1, OpenAI o1等）では明示的CoTの効果が限界的（+2.9-3.1%）に対し時間コストが+20-80% |
| 軽量ヒント2件 | 汎用ドメイン → +2.25pt | ドメイン複雑性高 → -0.75pt | ヒントの特異性とドメインの問題分布の適合度 |
| アンチパターンカタログ | ドメイン横断 → +0.5〜+1.5pt | — | ボーナス多様性が40%減少。構造的検出は改善するが創造的指摘が減少 |

---

## 5. 実装上の注意点

### 不在検出（Absence Detection）は困難

「設定が存在しない」問題（SLA未定義、キャッシュ戦略未定義等）は「誤設定」より検出が難しい。全バリアントで不安定なまま改善困難。カタログ参照は設定パターンに焦点するため基本的利用定義の欠如を見逃しやすい。

### 技術固有の盲点には条件分岐型チェックリストが必要

WebSocket回復、TimescaleDB集約メンテナンス等はgenericなチェックリスト（"database consistency"等）では検出不能。「IF TimescaleDB THEN check aggregate refresh strategy」のような条件分岐型が必要。

### 定量的根拠提示で検出精度向上

一貫性検証で支配的パターンの採用率を明示させる（"83% vs 17%"等）と、部分検出（△）を完全検出（○）に引き上げられる。


