# Output Schemas

## ADRテンプレート

以下のテンプレートに従い、審議結果とユーザーの決定を統合してADRを生成する。

### テンプレート

```markdown
# ADR-{NNNN}: {title}

## ステータス

Proposed

## 日付

{YYYY-MM-DD}

## コンテキスト

{decision-statement.md の内容を元に、なぜこの決定が必要になったかを記述。
スコープ（対象と対象外）も含める。}

## 関連する既存決定

{prior-decisions.md が存在しない場合はこのセクション全体を省略する}

- **ADR-{NNNN}: {title}** — {決定の要約}。{今回の決定への影響の要約}

## 前提条件

{Level 1 の場合: 「CSD分類は実施していません（Level 1）」と記載}

### 確実（Certainty）

{csd-final.md の Certainty セクション。各制約に根拠を付記。}

### 仮定（Supposition）

{csd-final.md の Supposition セクション。崩れる可能性と検証方法を付記。}

### 不確実（Doubt）

{csd-final.md の Doubt セクション。影響範囲とリスクを付記。}

## 判断基準

{objectives.md の内容をリスト化。各目的の定義と評価の視点を含める。
優先度は「決定者（人間）が設定」と注記。}

## 検討した選択肢

### {選択肢A の名称}

{概要、特徴、どの目的の観点から提案されたか}

### {選択肢B の名称}

{同上}

### 除外した選択肢

{Phase 3+4 で制約により除外された選択肢。名称と除外理由のリスト。
該当なしの場合は「なし」}

## トレードオフ分析

{evaluation-matrix.md のマトリクスをテーブル化}

| 判断基準 | {選択肢A} | {選択肢B} | ... |
|----------|-----------|-----------|-----|
| {OBJ-1}  | {◎/○/△/× 要約} | {◎/○/△/× 要約} | ... |
| {OBJ-2}  | ... | ... | ... |

{各セルの詳細: 評価記号、利点、欠点、根拠を記述。
Supposition/Doubt に依存する評価は明示する。}

## リスク分析

{Level 3 のみ。Level 1/2 の場合: 「本セクションは省略（Level 3 で実施）」}

{premortem.md の内容。有力選択肢ごとに:}
- 失敗シナリオ
- 原因（CSD の Supposition/Doubt との関連を含む）
- 深刻度（high/medium/low）
- 軽減策

## 将来の意思決定への影響

{Level 3 のみ。Level 1/2 の場合: 「本セクションは省略（Level 3 で実施）」}

{linked-decisions.md の内容。将来の決定ポイントごとに:}
- 将来の決定内容と想定時期
- 各選択肢がその決定にどう影響するか（選択肢が広がる/狭まる/中立）

## 決定

{selected_alternative} を採用する。

## 根拠

{user_rationale: ユーザーが提供した選択理由。
どの判断基準を優先し、なぜその優先順位にしたかを記録。}

## 受け入れたトレードオフ

{accepted_tradeoffs: ユーザーが明示した、この決定により受け入れるリスク・欠点。
evaluation-matrix の該当セルと対応づけて記述。}
```

### レベル別セクション省略ルール

| セクション | Level 1 | Level 2 | Level 3 |
|-----------|---------|---------|---------|
| 関連する既存決定 | 存在時は全記載、なければ省略 | 同左 | 同左 |
| 前提条件 | 「CSD分類は実施していません」 | 全記載 | 全記載 |
| リスク分析 | 省略注記 | 省略注記 | 全記載 |
| 将来の意思決定への影響 | 省略注記 | 省略注記 | 全記載 |
| その他全セクション | 全記載 | 全記載 | 全記載 |

---

## 中間ファイルフォーマット

### research.md

```markdown
# リサーチ結果

## 調査日
{YYYY-MM-DD}

## 調査観点

{決定ステートメントから特定した、時間経過で変化しうる事実の観点を列挙}

1. {観点1の説明}
2. {観点2の説明}
...

## 調査結果

### {観点1}

- 検索クエリ: {使用したクエリ}
- 主要な知見:
  - {知見1}
  - {知見2}
  ...

### {観点2}

- 検索クエリ: {使用したクエリ}
- 主要な知見:
  - {知見1}
  - {知見2}
  ...

## サマリー

{全体を通じて、この決定に特に影響する主要な事実を3-5件で要約}
```

---

### prior-decisions.md

```markdown
# 関連する既存決定

## 関連ADR

### ADR-{NNNN}: {title}
- 決定: {decision セクションの要約}
- 今回の議題との関連: {なぜ関連するか}
- 制約への影響: {今回の決定で確実（Certainty）として扱うべき事項}

### ADR-{MMMM}: {title}
...

## 関連なし
- ADR-{PPPP}: {title} — 関連なしの理由: {簡潔な説明}
```

---

### decision-statement.md

```markdown
# 決定ステートメント

## 議題
{「〜としてどの方式/技術/方針を採用するか」形式の明確な問い}

## スコープ
- 対象: {この決定で扱う範囲}
- 対象外: {明示的に除外する範囲}

## 可逆性
{high / medium / low}
{判断根拠を1-2文で}
```

### csd-draft.md / csd-final.md

```markdown
# CSD分類

## 確実（Certainty）
- C1: {制約内容} — 根拠: {なぜ確実と言えるか}
- C2: ...

## 仮定（Supposition）
- S1: {制約内容} — 根拠: {なぜ仮定と分類するか}、検証方法: {どう確かめるか}
- S2: ...

## 不確実（Doubt）
- D1: {不確実な要素} — 影響範囲: {何に影響するか}、リスク: {具体的なリスク}
- D2: ...
```

### csd-challenges.md

```markdown
# レッドチーム検証結果

## 再分類提案
- {元のID}: {元の分類} → {提案する分類} — 理由: {なぜ再分類すべきか}

## 暗黙の仮定の検出
- {検出した仮定} — 推奨分類: {Supposition/Doubt}、理由: {根拠}

## 検証不要と判断した項目
- {ID}: {確認内容と判断理由}
```

### objectives.md

```markdown
# 判断基準（Objectives）

## OBJ-1: {目的名}
- 種別: fundamental（根本目的）
- 定義: {この目的が意味すること}
- 評価の視点:
  - {具体的な評価属性1}
  - {具体的な評価属性2}

## OBJ-2: {目的名}
...

（最大5件）

## 手段目的→根本目的の変換記録
{変換を行った場合のみ記載}
- 手段: {元の手段目的} → 根本: {変換後の根本目的} — 理由: {なぜ変換したか}
```

### eval-obj-{N}.md

```markdown
# {OBJ-N}: {目的名} — 評価結果

## 提案した代替案
{Level 2/3 のみ。Level 1 では省略。}
- {代替案名}: {この目的を最適化する場合にこの選択肢が適している理由}

## 評価

### {代替案A}
- 評価: {◎/○/△/×}
- 利点: {この目的の観点からの利点}
- 欠点: {この目的の観点からの欠点}
- 根拠: {評価の具体的な根拠}
- CSD依存: {Supposition/Doubt に依存する場合はその内容。依存なしの場合は「なし」}

### {代替案B}
...
```

### alternatives.md

```markdown
# 代替案一覧

## 採用候補

### ALT-1: {代替案名}
- 概要: {1-2文の説明}
- 提案元: {どの目的の評価で提案されたか。Level 1 ではユーザー提供}

### ALT-2: {代替案名}
...

## 除外した代替案
- {名称}: 除外理由 — {制約ID（CSD分類）との対応}
```

### evaluation-matrix.md

```markdown
# トレードオフ行列

## マトリクス

| 判断基準 | ALT-1: {名} | ALT-2: {名} | ALT-3: {名} |
|----------|-------------|-------------|-------------|
| OBJ-1: {名} | {◎/○/△/×} | {◎/○/△/×} | {◎/○/△/×} |
| OBJ-2: {名} | ... | ... | ... |

## 各セルの詳細

### ALT-1 × OBJ-1
- 評価: {◎/○/△/×}
- 利点: {要約}
- 欠点: {要約}
- 根拠: {要約}

### ALT-1 × OBJ-2
...
```

### premortem.md

```markdown
# プレモーテム分析

## {代替案A}

### 失敗シナリオ 1: {タイトル}
- 状況: {1年後に何が起きたか}
- 原因: {なぜ失敗したか}
- CSD関連: {Supposition/Doubt のどれが崩壊したか。関連なしの場合は「なし」}
- 深刻度: {high/medium/low}
- 発生確率: {high/medium/low}
- 軽減策: {この失敗を防ぐ/緩和するために何ができるか}

### 失敗シナリオ 2: ...

## {代替案B}
...
```

### linked-decisions.md

```markdown
# 連鎖する意思決定

## 関連する将来の決定

### LD-1: {将来の決定内容}
- 想定時期: {いつ頃この決定が必要になるか}
- 影響:
  - ALT-1: {選択肢が広がる/狭まる/中立} — {具体的にどう影響するか}
  - ALT-2: ...
  - ALT-3: ...

### LD-2: ...

## 可逆性評価
| 代替案 | 可逆性 | 理由 |
|--------|--------|------|
| ALT-1 | {可逆/部分可逆/不可逆} | {根拠} |
| ALT-2 | ... | ... |
```

### deliberation-summary.md

```markdown
# 審議サマリー

## 決定ステートメント
{decision-statement.md から}

## 関連する既存決定
{prior-decisions.md から。存在しない場合はこのセクション全体を省略}

## 前提条件（CSD）
{csd-final.md から。Level 1 では「スキップ」}

## 判断基準
{objectives.md から}

## 検討した選択肢
{alternatives.md から}

## トレードオフ行列
{evaluation-matrix.md から}

## リスク分析
{premortem.md から。Level 3 のみ}

## 将来の意思決定への影響
{linked-decisions.md から。Level 3 のみ}

## 判断ガイド

以下は条件付きの帰結の提示であり、推奨ではない。
最終的な優先順位の決定は判断者に委ねられる。

- {OBJ-1} を最優先するなら → {ALT-X} が適している。ただし {OBJ-Y} にリスクがある。
- {OBJ-2} を最優先するなら → {ALT-Y} が適している。ただし {OBJ-Z} にリスクがある。
- バランスを取るなら → {ALT-Z}。ただし {プレモーテムで指摘されたリスク} に注意。

## 不確実性の影響

{Level 2/3 かつ CSD の Doubt 項目が存在する場合。Level 1 または Doubt なしの場合は省略}

以下の不確実性が判明した場合、選択肢の評価が変化する可能性がある:

- **{D1の内容}が判明した場合**: {各選択肢の評価への具体的な影響}
- **{D2の内容}が判明した場合**: {各選択肢の評価への具体的な影響}
...
```
