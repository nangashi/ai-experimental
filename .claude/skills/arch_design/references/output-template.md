# Output Template

Phase 2 で設計文書を生成する際に参照するテンプレート。
Phase 1 で確定した情報をこのテンプレートに当てはめて `docs/project-definition/architecture.md` を生成する。

## テンプレート

```markdown
# {タイトル}: システム設計書

## ステータス

Draft

## 日付

{YYYY-MM-DD}

## 入力文書

- 要件定義書: `{requirements_path}` ({日付})
- ADR: `{adr_dir}` ({N}件)

## 1. システム概要

{システムの目的と全体像。問題定義・アプローチ選定の結果を踏まえた1-2段落の説明}

## 2. アーキテクチャスタイル・パターン

### 2.1 アーキテクチャスタイル

{選択したアーキテクチャスタイルとその根拠。関連するNFR/制約への対応を含む}

### 2.2 設計パターン

{採用する主要な設計パターンのリスト。各パターンの適用箇所と理由}

## 3. 技術スタック

| レイヤー | 技術 | ADR | 選定理由 | 検討した代替案と棄却理由 |
|---------|------|-----|---------|----------------------|
| フロントエンド | {技術名} | {ADR-NNNN または「—」} | {理由} | {ADRありなら「ADR-NNNN参照」、なしなら代替案名+棄却理由を簡潔に} |
| バックエンド | {技術名} | {ADR-NNNN または「—」} | {理由} | {同上} |
| データベース | {技術名} | {ADR-NNNN または「—」} | {理由} | {同上} |
| ホスティング | {技術名} | {ADR-NNNN または「—」} | {理由} | {同上} |
| 認証 | {技術名} | {ADR-NNNN または「—」} | {理由} | {同上} |
| {その他} | {技術名} | {ADR-NNNN または「—」} | {理由} | {同上} |

## 4. コンポーネントアーキテクチャ

### 4.1 コンポーネント一覧

| コンポーネント | 責務 | 技術 | 関連SR |
|--------------|------|------|--------|
| {名前} | {責務の説明} | {使用技術} | SR-XXX, SR-YYY |

### 4.2 コンポーネント間の依存関係

{mermaid図で依存関係を記述する。subgraphでレイヤー（フロントエンド/バックエンド/インフラ等）を分離する。制御フローは実線矢印（-->）、横断的関心事（グローバルエラーハンドラー・ミドルウェア等）は破線矢印（-.->）またはnote記法で表現し、制御フローと混在させない}

## 5. データアーキテクチャ

### 5.1 エンティティ一覧

| エンティティ | 概要 | 関連SR |
|-------------|------|--------|
| {名前} | {概要} | SR-XXX |

### 5.2 スキーマ定義

{各エンティティの属性・型・制約を記述}

### 5.3 データフロー

{主要なデータフローの説明}

## 6. API設計

### 6.1 エンドポイント一覧

| メソッド | パス | 概要 | 関連SR |
|---------|------|------|--------|
| {HTTP method} | {path} | {説明} | SR-XXX |

### 6.2 リクエスト/レスポンス形式

{主要エンドポイントのリクエスト/レスポンスの詳細}

### 6.3 エラーハンドリング

{エラーレスポンスの形式と共通パターン}

## 7. インフラアーキテクチャ

### 7.1 ホスティング構成

{ホスティング先の構成}

### 7.2 デプロイメント

{デプロイ方式・手順}

### 7.3 環境構成

{開発環境・本番環境の構成}

## 8. セキュリティアーキテクチャ

### 8.1 認証

{認証方式の詳細設計}

### 8.2 認可

{認可モデルの設計}

### 8.3 データ保護

{通信暗号化・保存時暗号化・シークレット管理}

## 9. 横断的関心事

### 9.1 ログ・監視

{ロギング方針・監視構成}

### 9.2 エラーハンドリング方針

{グローバルなエラーハンドリング方針}

### 9.3 バックアップ・リカバリ

{バックアップ方式・復旧手順の方針}

## 10. ディレクトリ構造

{プロジェクトのディレクトリツリー}

## 要件トレーサビリティ

### 機能要件カバレッジ

| SR-ID | 対応コンポーネント | 対応API | 対応データ |
|-------|-------------------|---------|-----------|
| SR-001 | {コンポーネント名} | {エンドポイント} | {エンティティ} |

### 非機能要件への対応

| NFR-ID | 対応する設計要素 | 実現方法 |
|--------|----------------|---------|
| NFR-1 | {設計要素} | {具体的な実現方法} |
```

## 記入ガイダンス

- **トレーサビリティ**: 全SR/NFRに対応する設計要素を明記する。未対応のSR/NFRがあってはならない。対応なしの場合は「対応なし」と明記し省略しない
- **ADR参照**: 技術選定にADRが存在する場合は必ずADR番号を参照する。ADRが存在しない技術選定は「検討した代替案と棄却理由」列に代替案名と棄却理由を簡潔に記載し、判断根拠を残す
- **具体性**: 「適切に処理する」等の曖昧な記述を避け、具体的な方式・パターンを記述する
- **該当なしのセクション**: 省略せず「該当なし」または「対象外」と明記する
- **データモデル**: スキーマは具体的な型・制約を含める
- **API**: エンドポイントはHTTPメソッド・パス・リクエスト/レスポンス形式を含める
- **代替案の排除**: 「AまたはB」「A（またはB）」のような未確定の選択肢を設計文書に残さない。Phase 1の対話で確定した1つの方式のみ記載する
