# Improvement Approach Catalog

プロンプト改善アプローチの階層的カタログ。
カテゴリ → テクニック → バリエーション の3階層で管理し、全プロジェクト横断の検証実績を蓄積する。

## ID 命名規則

- カテゴリ: 大文字1文字 (S, C, N, M)
- テクニック: カテゴリ文字 + 番号 (S1, C2, ...)
- バリエーション: テクニック + 小文字 (S1a, S1b, ...)
- 新規追加時: 親テクニック内の次のアルファベットを使用する

## 共通ルール

全アプローチ適用時の制約:

- YAML frontmatter、ロール定義、ドメイン固有用語、核心的な目的は保持する
- 元プロンプトの言語（日本語/英語）を維持する
- 改善の目的はフォーマット制約を緩和しモデルの自律的分析能力を引き出すこと（ドメイン知識の削除ではない）

## 推奨プロンプト構成

全戦略を適用した場合の理想的なセクション順序:

```
[YAML frontmatter]
[ロール定義（簡潔に）]
[原則 / 評価項目（骨格のみ — S4）]
  └ 問題検出指示を含む（S5）
[スコアリング基準（S2）]
[出力フォーマット（セクション名のみ — S3）]
[出力例 — Few-shot × 2-3個（S1）]
[注意事項（最小限、3-4項目）]
```

---

## Category: Structural (S) — プロンプト構造の変更

プロンプトのセクション構成、フォーマット、テンプレート等の構造的変更。

### S1: Few-shot Examples

具体的な出力例が存在しないプロンプトに適用。2-3個の出力例（異なるカテゴリ・深刻度）を追加する。

**実装指針**:
- 各例の構造: シチュエーション → 発見/判断 → 出力例 → 根拠
- リアルで具体的（技術名、パラメータ値を含む）、例同士で内容が重複しない
- 出力フォーマットセクションの直後に「## 出力例」として挿入

**バリエーション**:
- **S1a**: 基本 — 深刻度多様な入出力例を2-3個追加
- **S1b**: ドメイン特化 — 対象観点の典型的問題に特化した例
- **S1c**: 敵対的 — 見落としやすい微妙な問題の検出例
- **S1d**: 否定例 — 検出すべきでないもの(偽陽性回避の例)
- **S1e**: 段階的難易度 — 易→難の順で思考過程を示す例

### S2: Scoring Criteria

定量的な評価基準が存在しないプロンプトに適用。5段階スコアリング表を追加する。

**実装指針**:
- 元プロンプトの評価カテゴリを特定し、カテゴリごとの5段階評価基準を生成
- 原則セクションの直後（出力フォーマットの前）に挿入
- 5=問題なし、4=軽微、3=中程度、2=重要、1=重大

**バリエーション**:
- **S2a**: 基本5段階スコアリング表
- **S2b**: カテゴリ重み付き — 観点ごとに異なる重み設定
- **S2c**: 深刻度アンカリング — 各レベルに具体的な事例を紐付け

### S3: Output Format

詳細なテンプレート（コードブロック内のサブ項目指定が複数行にわたるもの）を簡素化する。

**実装指針**:
- コードブロックテンプレートを削除
- 各セクションはセクション名 + 括弧書き1行説明のみ
- 全体指示（「以下のセクション構成で出力してください」等）は維持

**バリエーション**:
- **S3a**: セクション名のみ(テンプレート削除)
- **S3b**: 最小自由記述(セクション構造なし)
- **S3c**: テーブル中心(表形式で統一)

### S4: Sub-item Reduction

評価項目・原則セクション内に1項目あたり2行以上の説明が含まれる場合に適用。

**実装指針**:
- 各評価項目の見出し名を維持し、説明を核心の1行のみに削減
- 詳細な箇条書き、確認用の問い、アンチパターン例、判断基準を削除
- 原則自体（項目名 + 核心説明）は必ず維持

**バリエーション**:
- **S4a**: 1行要約化 — 各項目の説明を核心1行に削減
- **S4b**: 階層簡略化 — 見出し維持+内容フラット化

### S5: Detection Hints

「問題を検出し出力に反映する」旨の明示的指示が存在しないプロンプトに適用。

**実装指針**:
- 原則/評価セクションに「問題がある場合は問題点を指摘し改善案を出力に反映すること」を追加
- 検出すべき問題カテゴリのリストを元プロンプトのドメインに合わせて記載

**バリエーション**:
- **S5a**: カテゴリリスト — 検出すべき問題カテゴリの列挙
- **S5b**: アンチパターン — 具体的な問題パターンのリスト
- **S5c**: 欠落検出 — 「存在すべきだが欠けているもの」の確認指示

---

## Category: Cognitive (C) — 推論方法の変更

モデルの分析・推論プロセスを変える手法。

### C1: Chain-of-Thought (CoT)

- **C1a**: 基本段階的分析 — 「まず〜、次に〜」の手順指示
  実装: 分析を3段階（1.全体構造把握 2.セクション別詳細分析 3.横断的問題検出）に分ける指示を追加
- **C1b**: 構造化分析フレームワーク — 「各セクションに対してX問を自問する」
  実装: 各セクションに対して「何が欠けているか」「どう悪用されうるか」等の自問リストを付与
- **C1c**: マルチパスレビュー — 1回目:全体把握、2回目:詳細分析
  実装: 「最初に全体を読んで構造を把握し、次に各セクションを詳細に分析せよ」の2パス指示

### C2: Role Framing

- **C2a**: 専門家ペルソナ — 分野の権威としてのロール設定
  実装: 「あなたは{観点}の専門家として10年以上の経験を持つ」等のペルソナ設定を冒頭に追加
- **C2b**: 攻撃者/敵対者視点 — 「攻撃者/悪意ある利用者として考える」
  実装: 「攻撃者の視点でこのシステムの弱点を探せ」という指示フレームに変更
- **C2c**: 二重役割 — レビュアー+レッドチームの両面
  実装: 「まずレビュアーとして問題を列挙し、次にレッドチームとして追加の攻撃ベクトルを探せ」

### C3: Priority Ordering

- **C3a**: 深刻度優先 — 重大な問題から報告する指示
  実装: 「重大度の高い問題から順に報告すること」の明示的指示を追加
- **C3b**: リスクベース — 発生確率×影響度で順序付け
  実装: 各指摘に「発生確率」「影響度」を付記させ、積でソートさせる指示
- **C3c**: カテゴリ→深刻度 — カテゴリ別にグループ化してから深刻度順
  実装: 出力形式をカテゴリ見出しで構造化し、各カテゴリ内で深刻度順にする指示

---

## Category: Content (N) — ドメイン知識・内容の変更

プロンプトに含まれるドメイン知識や言語の変更。

### N1: Checklist Enrichment

- **N1a**: 標準ベース — 業界標準(OWASP, NIST等)のチェック項目追加
  実装: 該当観点の業界標準チェックリストを「確認すべき項目」セクションとして追加
- **N1b**: アンチパターン集 — 対象観点の典型的なアンチパターンリスト
  実装: 「以下のアンチパターンが存在しないか確認せよ」のリストを追加
- **N1c**: 観点間境界 — 隣接観点との境界ケースの扱いを明示
  実装: 「隣接観点（例: セキュリティとパフォーマンス）の境界にある問題も検出対象とする」の注記追加

### N2: Prompt Language

- **N2a**: 全文英語 — プロンプト全体を英語に変換
  実装: プロンプト全体を英語に翻訳（技術的正確性を維持）
- **N2b**: 混合言語 — カテゴリ名・技術用語は英語、説明は日本語
  実装: セクション名・カテゴリ名を英語にし、説明文は日本語のまま維持
- **N2c**: 全文日本語 — 現状のベースライン
  実装: 変更なし（対照群）

### N3: Prompt Length

- **N3a**: 最小化 — 全体を50%程度に圧縮
  実装: 冗長な説明を削除し、箇条書きに変換。核心的指示のみ残す
- **N3b**: 拡張 — 詳細説明・判断基準を50%程度増量
  実装: 各評価項目に「なぜ重要か」「具体的に何を見るか」の説明を追加
- **N3c**: 選択的最適化 — 低価値セクションのみ削除
  実装: knowledge.md の検出率データを基に、検出に寄与していないセクションを特定して削除

---

## Category: Meta (M) — プロンプト構成方法の変更

プロンプトの組み立て方や制約の与え方の変更。

### M1: Prompt Decomposition

- **M1a**: 事前分析+本レビュー分離 — 最初に構造分析、次に問題検出
  実装: 「Step 1: 全体構造を分析し要約せよ → Step 2: 問題を検出せよ」の2段階指示
- **M1b**: 検出と報告の分離 — 検出フェーズと出力整形フェーズを明示的に分ける
  実装: 「まず全ての問題を箇条書きで列挙し、次に重要度順に整形して報告せよ」

### M2: Constraint Manipulation

- **M2a**: 最低検出数制約 — 「最低N個の問題を見つけること」
  実装: 「最低{N}個の問題を検出すること。見つからない場合は潜在的リスクも含めよ」の制約追加
- **M2b**: 制約緩和 — 出力制限の削除(自由度を上げる)
  実装: 出力形式の制約をすべて削除し、自由な形式でレビュー結果を記述させる
- **M2c**: 確信度注釈 — 各指摘に確信度(高/中/低)を付与させる
  実装: 各指摘に「確信度: 高/中/低」の注釈を付記させる指示を追加

---

## クロスリファレンス: 検証済みバリエーション

全プロジェクト横断の検証結果（手動メンテナンス）。

| Variation ID | Perspective-Target | Round | Effect (pt) | SD | Notes |
|-------------|-------------------|-------|-------------|-----|-------|
| S3a | security-design | 1 | +0.75 | 0.25 | 出力形式簡素化。平均11.0→11.75。CSRF・監査ログ検出率向上、安定性改善 |
| S4a | security-design | 1 | -1.0 | 0.0 | サブ項目削減。平均11.0→10.0。横断的セキュリティ要件の見落とし増加 |
