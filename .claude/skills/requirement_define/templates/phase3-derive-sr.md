# UC → SR 分解

ユーザー要求書の Must ユースケースからシステム要件（SR）を EARS 記法で導出する。
Nice ユースケース（スコープ外）は導出対象外とする。

## 入力の読み込み

1. Read で以下のファイルを読み込む:
   - `{input_path}`: ユーザー要求書
   - `{ears_guide_path}`: EARS 記法ガイド

2. 以下の情報を確認する:
   - `{actors_and_interfaces}`: Phase 2 で確定したアクター/インターフェース情報
   - `{gap_resolutions}`: Phase 1 で解決した情報ギャップのQ&Aリスト。UC の曖昧性解消の参考にする

## SR導出

ユースケース一覧の Must UC（優先度が Must のもの）について以下を実行する。Nice UC はスキップする。

### 1. UC の分析

- UC の概要文からアクターの目標と主要動作を特定する
- `{actors_and_interfaces}` と照合し、関連するアクターとインターフェースを特定する
- `{gap_resolutions}` の内容が UC の解釈に影響する場合、それを反映する（例: データ入力方法が明確化されている場合、保存操作の SR に反映する）

### 2. EARS パターンの適用

EARS 記法ガイドの5パターンと分解の観点チェックリストを参照し、以下の観点で SR を導出する:

- **基本フロー**: UC の主要動作 → Event-Driven または Ubiquitous パターン
- **前提条件**: UC の前提状態 → State-Driven パターン
- **異常系/エッジケース**: UC の種別が「異常系」「エッジ」→ Unwanted Behaviour パターン

### 3. 品質確認

各 SR について以下を確認する:
- EARS 記法ガイドの禁止表現リストに該当する用語が含まれていないこと
- 1つの SR が単一の関心事のみを扱っていること（複数の動作が AND で結合されていないこと）
- 具体的な技術名・製品名が含まれていないこと（制約由来を除く）

### 4. ID付与

各 SR に一意の ID（SR-001 から連番）を付与する。テーブル内の並び順はトレース元の UC 順とする。

## トレーサビリティの確認

- 全 Must UC が少なくとも1つの SR にマッピングされていることを確認する
- マッピングされていない UC があれば SR を追加導出する
- 異常系・エッジケースの UC についてもカバレッジを確認する

## 保存

`{sr_save_path}` に Write で以下の形式で保存する:

```markdown
# 機能要件（SR）ドラフト

## SR一覧

| SR-ID | 要件 | EARS型 | トレース元 |
|-------|------|--------|-----------|
| SR-001 | {EARS記法の要件文} | {Ubiquitous/Event-Driven/State-Driven/Unwanted} | {UC-N} |
```

## 返答

以下のフォーマットのみ返答する（本文は含めない）:

```
total_sr: {SR総数}
uc_coverage_summary: Must UC {M}/{N} カバー, 異常系UC {M}/{N} カバー
ears_patterns_used: {使用したEARSパターンの種類リスト}
```
