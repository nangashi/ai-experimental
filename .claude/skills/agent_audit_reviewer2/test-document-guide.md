# テスト対象文書生成ガイド

---

## 1. 入力型の判定

perspective の概要からエージェントの入力型を判定する。

| 入力型 | 判定基準 | 文書形式 |
|--------|---------|---------|
| **設計書** | 設計レビュー、アーキテクチャ評価に関するエージェント | システム設計書 |
| **コード** | コードレビュー、実装評価に関するエージェント | ソースコードファイル |
| **要件** | 計画・設計生成に関するエージェント | 要件定義書 |
| **エージェント定義** | メタ評価、定義レビューに関するエージェント | エージェント/観点定義ファイル |
| **汎用** | 上記に該当しない場合 | perspective の概要に基づく入力形式 |

---

## 2. テスト対象文書の基本構成

### 入力型 = 設計書

```
# {プロジェクト名} システム設計書

## 1. 概要
## 2. 技術スタック
## 3. アーキテクチャ設計
## 4. データモデル
## 5. API設計
## 6. 実装方針
## 7. 非機能要件
```

**分量目安**: 150-250行

### 入力型 = コード

- **言語**: プロジェクトの主要言語に合わせる（不明な場合は TypeScript または Java）
- **構成**: 1-3ファイルのコードを含む
- **分量**: 100-200行（合計）

### 入力型 = 要件

- **分量**: 80-150行
- **構成**: プロジェクト概要、機能要件（5-8件）、非機能要件（3-5件）、制約条件

### 入力型 = エージェント定義

- **分量**: 50-120行
- **構成**: YAML frontmatter、ロール定義、評価基準、出力形式、行動姿勢

### 入力型 = 汎用

- **分量**: 80-200行
- perspective の評価スコープに対応する要素を含む

---

## 3. 問題埋め込みガイドライン

### 問題数と分布（1文書あたり）

| 項目 | 基準 |
|------|------|
| **総数** | 10問 |
| **深刻度分布** | 重大 3個 / 中 4個 / 軽微 3個 |
| **カテゴリ分布** | 主要観点 6-7個 + 隣接領域 2個 + 微妙な問題 1-2個 |
| **検出難易度分布** | easy 2-3個 / medium 4-5個 / hard 2-3個 |
| **カテゴリ最低配分** | perspective の評価スコープの各カテゴリに最低1問を配分 |

### 埋め込みの原則

1. **自然さ**: 露骨なヒントは避ける
2. **多様性**: 同カテゴリでも異なるパターン
3. **深さのバリエーション**: 表面的〜深い分析が必要な問題を混在
4. **文脈依存**: 他セクションとの関連で問題になるケースを含める
5. **隣接領域**: スコープ外だが検出できると有益な問題を含める

### 埋め込みの具体的技法

| 技法 | 説明 | 例 |
|------|------|-----|
| **省略** | 本来あるべき要素を記載しない | 認証設計の節でCSRF対策に触れない |
| **矛盾** | 異なるセクション間で矛盾する記述 | 概要で「暗号化」を挙げつつAPI設計で平文通信 |
| **不十分な実装** | 正しい方向だが不完全な記述 | 「パスワードをハッシュ化」とだけ記載（ソルト・アルゴリズム不明） |
| **暗黙の前提** | 明示されていない重要な前提条件 | 「社内ネットワークのみ」前提だがクラウドデプロイ |
| **過剰な信頼** | 外部要素を無条件に信頼 | 「フロントエンドで検証済み」として入力検証を省略 |

**5種のうち少なくとも3種を使用すること**

### 禁止パターン

- 括弧内で弱い判断を正当化する記述（例: 「〜は行わない（Xで十分と判断）」）
- 明示的にアンチパターンを推奨する記述
- 問題を目立たせるための機密データの不自然な列挙

### 深刻度の定義

| 深刻度 | 定義 |
|-------|------|
| **重大** | 即時対応が必要。重大なリスクがある |
| **中** | 本番環境で問題を引き起こす可能性が高い |
| **軽微** | 改善が望ましいが、直接的なリスクは低い |

### 検出難易度の定義

| 難易度 | 定義 |
|--------|------|
| **easy** | 文書を通読すれば発見できる明示的な問題 |
| **medium** | 複数セクションの関連付けや専門知識が必要 |
| **hard** | 暗黙の前提の認識、不在の検出、深い専門分析が必要 |

---

## 4. 正解キーのフォーマット

```markdown
# 正解キー

## 実行条件
- **観点**: {perspective名}
- **入力型**: {設計書/コード/要件/エージェント定義/汎用}
- **埋め込み問題数**: 10問

## 埋め込み問題一覧

### P01: {問題タイトル}
- **カテゴリ**: {perspective の評価項目に対応}
- **深刻度**: 重大 / 中 / 軽微
- **検出難易度**: easy / medium / hard
- **該当箇所**: セクション{N} または 行{N}-{M}
- **問題の説明**: {何が問題で、なぜ問題なのか}
- **検出判定基準**:
  - ○: {具体的な検出条件}
  - △: {部分検出条件 — 「関連カテゴリの言及はあるが、{核心}に触れていない」形式}
  - ×: {未検出条件}

...

## ボーナス問題リスト
| ID | カテゴリ | 内容 | ボーナス条件 |
|----|---------|------|------------|
| B01 | ... | ... | ... |
```

---

## 5. 2文書間のドメイン多様性

2つのテスト文書は**異なるドメイン**から選択すること。

ドメイン例: 教育 / 医療 / EC / 金融 / SaaS / IoT / メディア / 物流 / 公共

同じ脆弱性カテゴリでもドメインに応じて異なる具体的表現を使用する。
