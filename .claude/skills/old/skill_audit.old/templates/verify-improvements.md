# 改善検証テンプレート

改善適用後のスキルが元のフィードバックを適切に反映しているかを検証してください。

## パス変数
- `{skill_path}`: スキルディレクトリの絶対パス
- `{skill_name}`: スキル名
- `{plan_path}`: 改善計画ファイルのパス
- `{analysis_path}`: 元の構造分析ドキュメントのパス
- `{quality_criteria_path}`: 品質基準ファイルのパス
- `{findings_path}`: 分類済みフィードバックファイルのパス
- `{verification_save_path}`: 検証レポートの保存先パス
- `{resolved_issues_path}`: 解決済み指摘ファイルのパス
- `{timestamp}`: 現在の実行タイムスタンプ

## 手順

1. Read で `{plan_path}` を読み込み、改善計画の全変更内容を確認する
2. Read で `{findings_path}` を読み込み、元のフィードバック一覧を把握する
3. 改善計画で変更されたファイルを Read で読み込む
4. 以下の 4a〜4b を順に実施する

### 4a. フィードバック対応判定

各フィードバック（重大な問題 + 改善提案）について以下を判定する:

- **解決済み**: 改善計画に対応する変更があり、変更後のファイルで問題が確認できない
- **部分的解決**: 改善計画に対応する変更があるが、問題の一部が残存している
- **未対応**: 改善計画に対応する変更がない、または変更が問題を解決していない

### 4b. リグレッションチェック

改善によってワークフローの断絶が発生していないか確認する:

- ワークフローの断絶（フェーズ間のデータフロー切断: あるフェーズが生成するファイルを次のフェーズが参照できない等）

上記以外の品質問題（外部参照、テンプレート変数不整合、曖昧表現、条件分岐、参照整合性等）は次回runのレビューアーが検出するため、検証フェーズでは確認しない。

5. 以下の構造で検証レポートを生成し、Write で `{verification_save_path}` に保存する

```markdown
# 改善検証レポート: {skill_name}

## フィードバック対応状況
| # | レビューアー | 指摘内容 | 判定 | 備考 |
|---|------------|---------|------|------|

## リグレッション
| # | 種類 | 詳細 | 影響度 |
|---|------|------|--------|
（新規問題がなければ「なし」）

## 総合判定
- 解決済み: {N}/{total}
- 部分的解決: {N}
- 未対応: {N}
- リグレッション: {N}
- 判定: PASS / ISSUES_FOUND

判定ルール:
- ISSUES_FOUND: 未対応 >= 1 または リグレッション >= 1
- PASS: 上記いずれにも該当しない（部分的解決のみは PASS とする）
```

### 5b. resolved-issues.md の更新

「解決済み」判定の各指摘を `{resolved_issues_path}` に記録する。「部分的解決」「未対応」の指摘は記録しない（次回 run で再検出させるため）。

各解決済み指摘について:
1. `{findings_path}` から対象ファイル名（`- 対象:` 行）と指摘タイトルを取得する
2. `{plan_path}` から改善内容の要約（1行）を取得する
3. 指摘内容から問題カテゴリを以下から1つ選択する: `ambiguity`, `format-stability`, `condition-branch`, `idempotency`, `reference-integrity`, `redundant-process`, `data-passing`, `ux-guard`, `template-scope`, `error-resilience`, `data-flow`, `edge-case`, `scope-boundary`
4. 対象ファイル名をセクション見出し（`## {ファイル名}`）として使い、その配下にエントリを追記する

Read で `{resolved_issues_path}` を読み込み、同一の (ファイル名, セクション, カテゴリ) エントリが既に存在する場合は Edit で上書きする。存在しない場合は該当ファイルの見出しの末尾に追記する。ファイル見出し自体が存在しない場合は見出しごと追記する。

エントリのフォーマット:
```
### {セクション} | {カテゴリ}
- 指摘: {指摘タイトル}
- 対応: {改善内容の要約}
- run: {timestamp}
```

6. 以下のフォーマットで**サマリのみ**返答する:
```
resolved: {N}/{total}
partial: {N}
not_addressed: {N}
new_issues: {N}
verdict: PASS / ISSUES_FOUND
details: {未対応項目またはリグレッションがある場合にカンマ区切りで列挙（例: "C-1未対応, I-5部分的解決, リグレッション1件"）。なければ「none」}
```
