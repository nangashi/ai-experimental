# Skill Quality Criteria

全レビューアーが共有する評価基準。各レビューアーは自身の担当観点のセクションを重点的に評価する。

## 報告対象の判定基準（関連性ゲート）

以下に該当する問題のみ報告する:
- 実行時エラー・例外を引き起こす（参照整合性、未定義変数、ファイル不在）
- ワークフローが完了不能になる（データフロー断絶、条件分岐未定義）
- 出力結果が不正になる（フォーマット不定、暗黙的依存）
- データ損失・破壊が起きる（冪等性違反、バックアップ不備）

以下は報告対象外とする:
- 進捗表示の追加・改善
- ユーザー確認ポイントの追加（不可逆操作のガード欠落は報告対象）
- エラーメッセージの文面改善（処理フローの欠落は報告対象）
- SKILL.md の行数目標
- エッジケース処理の**追加**提案（後述の「エッジケース処理方針」の階層2に該当するケース）
- ドキュメント・コメントの補完
- サブエージェント返答のフォーマット詳細・解析方法・抽出パターンの曖昧性（返答がファイルに保存される場合、フォーマット解析はサブエージェント側の責務。出力**先**の未定義は報告対象）
- 既にエラーハンドリングが1段定義されている箇所への追加のエラーハンドリング提案（二次的・三次的フォールバック）
- 仕様の詳細度に関する曖昧さの指摘（「適切に」「必要に応じて」等の表現や、数値基準の未定義。ワークフロー分岐の条件欠落は報告対象）
- Write 前のファイル存在確認の欠落（Write は上書き動作のため冪等性違反にならない）
- 既に構造検証が1段存在する成果物への追加検証の提案

以下は報告対象とする（削除提案として報告する）:
- 過剰なエッジケース処理の存在（後述の「エッジケース処理方針」の階層2に該当する処理がプロンプトに記述されている場合）

## エッジケース処理方針（3階層原則）

エッジケースの処理方針は以下の3階層で判断する。レビューアーは階層2に該当するエッジケース処理の追加を提案してはならない。逆に、階層2に該当する処理が既に存在する場合は削除を提案する。

### 階層1: 明示定義（プロンプトに記述する）
メインワークフローの成否に直結する条件分岐:
- 成功/失敗の主要パス
- データ整合性・正確性に影響する分岐
- 不可逆操作の前のガード
- LLMが推測できない設計上の意図（リトライ回数、部分失敗時の続行閾値、代替処理への切り替え）

### 階層2: LLM委任（プロンプトに記述しない）
LLMが自然に適切な行動を取れるケース。これらを明示的に処理する記述がプロンプトに存在する場合、削除を提案する。**レビューアーはこれらの処理の追加を提案してはならない**:
- サブエージェント失敗時の「中止してエラー報告」
- パース失敗・フォーマット不正時のスキップまたは再試行
- Read 対象ファイルの不在時のエラー報告
- サブエージェント返答の抽出失敗時の段階的リカバリ処理
- エラーハンドリングに対する追加のエラーハンドリング（二次的・三次的フォールバック）
- 表示形式・メッセージ文面の厳密な定義
- 返答のフィールド順序・区切り文字の厳密な指定
- サマリヘッダの正規表現パターンの定義
- 返答の解析手順・抽出方法の詳細記述
- 既に定義された条件分岐のさらに細かい分岐（例: 再試行後も失敗の場合、再試行カウンタの明示化、部分成功時の集計方法）
- Bash コマンド（cp, mv, rm 等）の失敗時の処理（LLM はコマンド失敗時に自然にエラー報告する）
- ファイル名のタイムスタンプ衝突（同一秒内の複数回実行等、発生確率が極めて低いケース）

**2次分岐テスト**: 「この分岐が未定義の場合、LLMはどう振る舞うか？」→「エラー報告して停止する」または「自然に適切な行動を取る」であれば、その分岐の追加は不要（階層2に該当）

### 階層3: ユーザー確認（AskUserQuestion のフォールバックを記述する）
LLMが正しい方向を推測できない設計判断。「動作が未定義の状況では AskUserQuestion で方針を確認する」旨の記述があるべき箇所:
- リトライか中止かの選択が設計意図に依存する場合
- データを破棄するか保持するかの選択
- 複数の有効な代替方針がある場合

## 重大度定義

- **重大（Critical）**: スキルが正しく機能しない、またはエラーや不正な出力を引き起こす問題（関連性ゲートを通過したもののみ）
- **改善（Improvement）**: スキルは動作するが、動作安定性または処理性能の測定可能な向上が見込める問題（関連性ゲートを通過したもののみ）
- **良い点（Positive）**: 品質基準を満たしている、または優れた設計が確認できた点

## 影響度・修正コスト定義

レビューアーは各指摘（重大な問題・改善提案）に以下の評価を付与する:

### Impact（影響度）
- **high**: 2つ以上のフェーズの正常動作が阻害される、または実行時エラーを引き起こす。ユーザーに直接的な不利益（データ損失、不正出力）がある
- **medium**: 特定のフェーズ・条件下で問題が発生する。スキルは動作するが品質が低下する
- **low**: 稀なケースでのみ発生、または改善効果が限定的

### Effort（修正コスト）
- **high**: 複数ファイルの構造変更が必要。新規テンプレート作成やワークフロー再設計を伴う
- **medium**: 1-2ファイルの修正が必要。既存構造内での変更
- **low**: 1ファイル内の局所的な修正で対応可能

## 評価観点

### 1. 指示品質・安定性
- サブエージェントの出力先（ファイル保存 vs 返答）が明示されていること。フォーマット詳細（フィールド名・区切り等）の曖昧性は報告対象外
- 条件分岐（if/else）の主要分岐（成功パス + 主要な失敗パス）が明示されていること。LLM が自然に対応できる二次的分岐の明示は不要（エッジケース処理方針の階層2を参照。2次分岐テストを適用）
- クリティカルパスでないエッジケースの詳細な処理定義が過剰に記述されていないこと（過剰な場合は削除を提案）
- 再実行で状態破壊・ファイル重複が起きない設計であること
- テンプレート内の `{variable}` プレースホルダが全て SKILL.md で定義されていること
- SKILL.md/テンプレートで言及されたファイルパスがスキルディレクトリ内に実在すること

### 2. 効率性・コンテキスト最適化
- 削除・統合可能な冗長ステップがないこと
- サブエージェント間のデータ受け渡しがファイル経由であること（3ホップ禁止）
- サブエージェントが不要なファイルを読み込んでいないこと
- サブエージェントの粒度が適切であること（過度に細かい/粗い委譲がない）

### 3. UX・ワークフロー設計
- 不可逆操作（ファイル上書き・削除、外部アクセス、大規模変更）の前に AskUserQuestion が配置されていること
- 複数の独立した提案を一括承認させず、個別承認が行われること

### 4. アーキテクチャ・パターン
- 7行超のサブエージェント指示がテンプレートファイルに外部化されていること
- 「Read template + follow instructions + path variables」パターンが一貫して使用されていること
- 反復的な最適化ループがある場合、知見蓄積の仕組みが有界サイズ・保持+統合方式で管理されていること
- サブエージェント失敗・部分完了時に「中止して報告」以外の動作が必要な箇所（リトライ、代替処理、部分続行）で、その動作が定義されていること。「中止して報告」がデフォルト動作として十分な箇所の明示は不要。過剰なエラー耐性記述（二次的・三次的フォールバック定義）が存在する場合は削除を提案する
- 最終成果物に対する構造検証（必須セクション・フィールドの存在確認）の記述があること
- スキルディレクトリ外のファイルへの参照がないこと（外部参照がある場合はスキル内へのコピーを推奨）

### 5. 有効性・目的達成度
- スキルの宣言された目的が具体的・境界明確・成功基準推定可能であること
- 「使い方」セクションで言及された成果物が、いずれかのフェーズで実際に生成されること（欠落ステップがないこと）
- フェーズ間のデータフローに情報欠落・暗黙的依存がないこと
- スキルのクリティカルパスに影響する入力条件（引数の不正・欠落）に対する処理が記述されていること。二次的なエッジケース（パース失敗、フォーマット不正等）の明示的処理は不要（エッジケース処理方針を参照）
