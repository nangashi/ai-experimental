# Scoring Rubric

`agent_bench` スキルにおけるエージェント出力の採点基準。has_perspective（true / false）により判定基準とスコア計算式が異なる。

---

## 1A. Answer Key 判定（scenario モード）

各テストシナリオの Answer Key（○/△/×）に対し、以下の3段階で判定する:

| 記号 | 判定 | スコア | 基準 |
|-----|------|-------|------|
| **○** | 完全達成 | 2 | Answer Key の ○ 条件を **すべて** 満たす |
| **△** | 部分達成 | 1 | 関連する内容に触れているが、核心的な条件を完全には満たしていない |
| **×** | 未達成 | 0 | 当該基準に関する内容が出力に全くない |

## 1B. 検出判定基準（detection モード）

各埋め込み問題に対する検出状況を以下の3段階で判定する:

| 記号 | 判定 | スコア | 基準 |
|-----|------|-------|------|
| **○** | 検出 | 1.0 | 正解キーの検出判定基準を **すべて** 満たす指摘がある |
| **△** | 部分検出 | 0.5 | 関連するカテゴリの指摘はあるが、核心的な問題点を正確に捉えていない |
| **×** | 未検出 | 0.0 | 当該問題に関する指摘が全くない |

**△の判定例**: 関連カテゴリの指摘はあるが具体的な問題箇所が異なる、問題の存在は指摘しているが根本原因の分析が不十分

---

## 2A. スコア計算式（scenario モード）

```
criterion_score = judge_rating (○=2, △=1, ×=0) × weight
scenario_score = (Σ(criterion_scores) + bonus - penalty) / max_possible_score × 10  (0-10 に正規化)
run_score = mean(全 scenario_scores)
variant_mean = mean(run1_score, run2_score)
variant_sd = stddev(run1_score, run2_score)
```

- `max_possible_score` = Σ(2 × weight) for all Answer Key items in a scenario
- `run_score` は全シナリオの平均（0-10スケール）
- ボーナス: Answer Key に未掲載かつスコープ内の有益な追加発見（+0.5/件、上限5件）
- ペナルティ: スコープ外の指摘、事実誤認（-0.5/件）

## 2B. スコア計算式（detection モード）

```
run_score = Σ(検出スコア) + (ボーナス件数 × 0.5) - (ペナルティ件数 × 0.5)
mean = (run1_score + run2_score) / 2
sd = stddev(run1_score, run2_score)
```

### ボーナス・ペナルティ（detection モード）

| 種別 | 条件 | スコア | 上限 |
|-----|------|-------|------|
| ボーナス | 正解キーに未掲載かつ `perspective.md` の評価スコープに合致する事実に基づいた有益な追加指摘 | +0.5/件 | 5件 |
| ペナルティ | スコープ外の指摘、事実に反する指摘、または明らかに誤った分析 | -0.5/件 | なし |

- スコープ境界の判定は `perspective.md` のボーナス/ペナルティ判定指針に従う
- 判断に迷う場合はペナルティを付与しない（疑わしきは罰せず）

---

## 3. 安定性閾値

| 標準偏差 (SD) | 判定 | 意味 |
|--------------|------|------|
| SD ≤ 0.5 | 高安定 | 結果が信頼できる |
| 0.5 < SD ≤ 1.0 | 中安定 | 傾向は信頼できるが、個別の実行で変動がある |
| SD > 1.0 | 低安定 | 結果にばらつきが大きく、追加実行で確認が必要 |

---

## 4. 推奨判定基準

全採点完了後、バリアントの平均スコアとベースラインの平均スコアの差に基づき推奨プロンプトを判定する:

| 条件 | 判定 |
|------|------|
| 平均スコア差 > 1.0pt | スコアが高い方を **推奨** |
| 平均スコア差 0.5〜1.0pt | 標準偏差が小さい方を **推奨**（安定性重視） |
| 平均スコア差 < 0.5pt | **ベースラインを推奨**（ノイズによる誤判定を回避） |

- 「平均スコア差」= バリアントの平均スコア - ベースラインの平均スコア
- 複数バリアントがベースラインを上回る場合は、最も平均スコアが高いバリアントを推奨

### 収束判定

| 条件 | 判定 |
|------|------|
| 2ラウンド連続で改善幅 < 0.5pt | 「最適化が収束した可能性あり」 |
| それ以外 | 「継続推奨」 |
