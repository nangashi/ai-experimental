# 改善適用テンプレート

改善計画に基づいてスキルファイルを修正してください。

## パス変数
- `{skill_path}`: スキルディレクトリの絶対パス
- `{skill_name}`: スキル名
- `{plan_path}`: 改善計画ファイルのパス

## 手順

1. Read で `{plan_path}` を読み込み、改善計画の全内容を確認する
2. 「実装順序」セクションに従い、順番に変更を適用する
3. 各変更について以下を実行する:

### 既存ファイルの修正
a. 対象ファイルを Read で読み込む。Read 失敗時は skipped リストに追加し「ファイル読み込みエラー」と理由を記録する
b. 改善計画の「変更詳細」に記載された変更箇所を Edit で修正する
c. 変更が広範囲に及ぶ場合（改善計画に記載された変更対象行数 ÷ Read で取得したファイル総行数 > 0.5 の場合）は Write で全体を書き換える

### 新規ファイルの作成
a. 改善計画の「新規作成ファイル」セクションに記載された内容で Write する
b. テンプレート外部化の場合: SKILL.md から該当するインライン指示を抽出し、テンプレートファイルとして整形する

### 削除推奨ファイル
- ファイルの削除は**実行しない**
- 削除推奨ファイルのリストを返答に含める（ユーザーが手動で削除する）

## 変更適用ルール
- **二重適用チェック**: Edit 前に対象箇所の現在の内容が改善計画の「現在の記述」と一致するか確認する。一致しない場合（既に改善済みまたは別の変更あり）はその変更をスキップし、skipped リストに理由を記録する
- Edit を優先する（部分的な変更は必ず Edit）
- Write はファイル全体の書き換えまたは新規作成時のみ使用する
- 変更前にファイルの Read を必ず実行する（Read なしの Edit/Write は禁止）
- 改善計画に記載されていない変更は行わない

## 返答フォーマット

以下のフォーマットで**結果のみ**返答する:
```
modified: {N}件
  - {ファイルパス1}: {変更概要}
  - {ファイルパス2}: {変更概要}
created: {M}件
  - {ファイルパス1}: {目的}
skipped: {K}件
  - {ファイルパス1}: {スキップ理由}
delete_recommended: {L}件
  - {ファイルパス1}: {削除理由}
```
