# 改善検証テンプレート

改善適用後のスキルが元のフィードバックを適切に反映しているかを検証してください。

## パス変数
- `{skill_path}`: スキルディレクトリの絶対パス
- `{skill_name}`: スキル名
- `{plan_path}`: 改善計画ファイルのパス
- `{analysis_path}`: 元の構造分析ドキュメントのパス
- `{quality_criteria_path}`: 品質基準ファイルのパス
- `{findings_path}`: 分類済みフィードバックファイルのパス
- `{verification_save_path}`: 検証レポートの保存先パス

## 手順

1. Read で `{plan_path}` を読み込み、改善計画の全変更内容を確認する
2. Read で `{findings_path}` を読み込み、元のフィードバック一覧を把握する
3. 改善計画で変更されたファイルを Read で読み込む
4. 以下の 4a〜4c を順に実施する

### 4a. フィードバック対応判定

各フィードバック（重大な問題 + 改善提案）について以下を判定する:

- **解決済み**: 改善計画に対応する変更があり、変更後のファイルで問題が確認できない
- **部分的解決**: 改善計画に対応する変更があるが、問題の一部が残存している
- **未対応**: 改善計画に対応する変更がない、または変更が問題を解決していない

### 4b. リグレッションチェック

改善によって新たに発生した問題がないか確認する:

- 外部参照の新規追加（改善前になかったスキルディレクトリ外への参照）
- ワークフローの断絶（フェーズ間のデータフロー切断: あるフェーズが生成するファイルを次のフェーズが参照できない等）
- テンプレート変数の不整合（SKILL.md で定義されているがテンプレートに存在しない変数、またはその逆）
- 新たな曖昧表現の追加
- 条件分岐の不完全化（改善により分岐パスが欠落）

### 4c. 参照整合性チェック

改善適用後のスキル全体に対して以下の整合性を再検証する:

1. **テンプレート変数チェック**: Glob で `{skill_path}/templates/*.md` を列挙し、各テンプレート内の `{variable}` プレースホルダを抽出する。SKILL.md 内のパス変数定義と照合し、未定義変数を検出する
2. **ファイル参照チェック**: SKILL.md およびテンプレート内で参照されているファイルパス（テンプレート名、補助ファイル名）が実在するか Glob で確認する
3. **パス変数の過不足チェック**: SKILL.md で定義されているがテンプレートで未使用のパス変数、テンプレートで使用されているがSKILL.mdで未定義のパス変数を検出する

検出された不整合はリグレッションセクションに「参照整合性」種類として記録する。1件以上の不整合がある場合は verdict を NEEDS_ATTENTION とする。

5. 以下の構造で検証レポートを生成し、Write で `{verification_save_path}` に保存する

```markdown
# 改善検証レポート: {skill_name}

## フィードバック対応状況
| # | レビューアー | 指摘内容 | 判定 | 備考 |
|---|------------|---------|------|------|

## リグレッション
| # | 種類 | 詳細 | 影響度 |
|---|------|------|--------|
（新規問題がなければ「なし」）

## 総合判定
- 解決済み: {N}/{total}
- 部分的解決: {N}
- 未対応: {N}
- リグレッション: {N}
- 判定: PASS / NEEDS_ATTENTION

判定ルール:
- NEEDS_ATTENTION: 未対応 >= 1 または リグレッション >= 1 または 参照整合性の不整合 >= 1
- PASS: 上記いずれにも該当しない（部分的解決のみは PASS とする）
```

6. 以下のフォーマットで**サマリのみ**返答する:
```
resolved: {N}/{total}
partial: {N}
not_addressed: {N}
new_issues: {N}
verdict: PASS / NEEDS_ATTENTION
details: {未対応項目またはリグレッションがある場合にカンマ区切りで列挙（例: "C-1未対応, I-5部分的解決, リグレッション1件"）。なければ「none」}
```
