以下の手順でIssue情報を分析し、要件を構造化してください:

1. Issue情報を確認する:
   - Issue番号: {issue_number}
   - タイトル: {issue_title}
   - 本文: {issue_body}
   - ラベル: {issue_labels}
   - コメント: {issue_comments}
   - 修正指示（ある場合）: {modification_instructions}
   - 注意: Issueには受け入れ基準が記載済みです。requirements.md の「受け入れ基準」セクションにIssueの内容を忠実に反映してください。

2. 以下の5観点で要件の明確さを判定する:
   - **目的**: 何を達成したいかが明確か
   - **背景**: なぜ必要かが説明されているか
   - **機能要件**: 具体的な振る舞いが定義されているか
   - **非機能要件**: パフォーマンス、セキュリティ等の制約が言及されているか
   - **スコープ**: 対象範囲と対象外が区別できるか

   判定基準: 目的・背景・機能要件の3つが揃っていれば「明確」とする。非機能要件・スコープは補足的情報として扱い、不足していても「不明確」とはしない。

3. 修正指示がある場合は、その内容を判定と構造化に反映する。

4. 判定結果に応じて分岐する:

---

### 要件が不明確な場合

ファイル保存は行わず、以下のフォーマットで返答する:

```
result: unclear
questions:
- {質問1}
- {質問2}
- ...
```

質問の作成ルール:
- 最大5問に絞る（優先度の高い不足情報から）
- 「はい/いいえ」で答えられる質問を避け、具体的な情報を引き出す質問にする
- Issue本文やコメントで既に言及されている内容を重複して聞かない
- 各質問は、対応する不足観点（目的/背景/機能要件）を冒頭に明示する

---

### 要件が明確な場合

5. `.tasks/{issue_number}/requirements.md` を以下の構造で {requirements_save_path} に Write で保存する:

```markdown
# 要件定義: #{issue_number} {issue_title}

## 目的

{Issueから抽出した目的}

## 背景

{Issueから抽出した背景・動機}

## 機能要件

1. {要件1}
2. {要件2}
...

## 非機能要件

- {パフォーマンス、セキュリティ、可用性等の制約。Issue内に記載がなければ「特記なし」}

## スコープ

### 対象

- {対象範囲}

### 対象外

- {明示的に対象外とするもの。Issue内に記載がなければ「特記なし」}

## 前提条件・制約

- {技術的前提、依存関係等。Issue内に記載がなければ「特記なし」}

## 受け入れ基準

1. {基準1}
2. {基準2}
...
```

6. 以下のフォーマットで返答する:

```
result: clear
summary: {要件の1行サマリ}
size_estimate: {S/M/L/XL}
size_reason: {規模見積もりの根拠（変更ファイル数、影響範囲等の概算）}
functional_requirements_count: {機能要件の数}
```

規模見積もりの基準:
- **S**: 1-2ファイル変更、単一機能の小修正
- **M**: 3-5ファイル変更、1つの機能追加/修正
- **L**: 6-10ファイル変更、複数機能にまたがる変更
- **XL**: 11ファイル以上、アーキテクチャレベルの変更
